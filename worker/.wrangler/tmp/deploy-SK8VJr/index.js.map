{
  "version": 3,
  "sources": ["../../../src/db.js", "../../../src/services/estimate.js", "../../../src/services/fund.js", "../../../src/crypto.js", "../../../src/services/email.js", "../../../src/services/prompts.js", "../../../node_modules/hono/dist/compose.js", "../../../node_modules/hono/dist/request/constants.js", "../../../node_modules/hono/dist/utils/body.js", "../../../node_modules/hono/dist/utils/url.js", "../../../node_modules/hono/dist/request.js", "../../../node_modules/hono/dist/utils/html.js", "../../../node_modules/hono/dist/context.js", "../../../node_modules/hono/dist/router.js", "../../../node_modules/hono/dist/utils/constants.js", "../../../node_modules/hono/dist/hono-base.js", "../../../node_modules/hono/dist/router/reg-exp-router/matcher.js", "../../../node_modules/hono/dist/router/reg-exp-router/node.js", "../../../node_modules/hono/dist/router/reg-exp-router/trie.js", "../../../node_modules/hono/dist/router/reg-exp-router/router.js", "../../../node_modules/hono/dist/router/smart-router/router.js", "../../../node_modules/hono/dist/router/trie-router/node.js", "../../../node_modules/hono/dist/router/trie-router/router.js", "../../../node_modules/hono/dist/hono.js", "../../../node_modules/hono/dist/middleware/cors/index.js", "../../../src/index.js", "../../../src/services/scheduler.js", "../../../src/services/subscription.js", "../../../src/auth.js", "../../../src/routes/auth.js", "../../../src/routes/funds.js", "../../../src/services/account.js", "../../../src/routes/account.js", "../../../src/services/ai.js", "../../../src/routes/ai.js", "../../../src/routes/settings.js", "../../../src/services/data-io.js", "../../../src/routes/data.js", "../../../src/routes/system.js"],
  "sourceRoot": "D:\\workspace\\FundVal-Live\\worker\\.wrangler\\tmp\\deploy-SK8VJr",
  "sourcesContent": ["/**\n * Database initialization and helper functions for Cloudflare D1\n */\n\nconst CURRENT_SCHEMA_VERSION = 1;\n\n/**\n * Initialize database schema (runs on first request)\n */\nexport async function initDb(db) {\n  // Check if schema_version table exists\n  const tableCheck = await db.prepare(\n    \"SELECT name FROM sqlite_master WHERE type='table' AND name='schema_version'\"\n  ).first();\n\n  if (!tableCheck) {\n    // First run: execute full schema\n    // D1 doesn't support multi-statement exec easily, so we create tables individually\n    await createTables(db);\n    await db.prepare('INSERT OR IGNORE INTO schema_version (version) VALUES (?)').bind(CURRENT_SCHEMA_VERSION).run();\n    await insertDefaultSettings(db);\n    return;\n  }\n\n  // Check version\n  const versionRow = await db.prepare('SELECT MAX(version) as version FROM schema_version').first();\n  const currentVersion = versionRow?.version || 0;\n\n  if (currentVersion > 0 && currentVersion !== CURRENT_SCHEMA_VERSION) {\n    // Version mismatch - rebuild\n    await dropAllTables(db);\n    await createTables(db);\n    await db.prepare('INSERT INTO schema_version (version) VALUES (?)').bind(CURRENT_SCHEMA_VERSION).run();\n    await insertDefaultSettings(db);\n  }\n}\n\nasync function createTables(db) {\n  const statements = [\n    `CREATE TABLE IF NOT EXISTS schema_version (\n      version INTEGER PRIMARY KEY,\n      applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n    )`,\n    `CREATE TABLE IF NOT EXISTS users (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      username TEXT NOT NULL UNIQUE,\n      password_hash TEXT NOT NULL,\n      is_admin INTEGER DEFAULT 0,\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n    )`,\n    `CREATE INDEX IF NOT EXISTS idx_users_username ON users(username)`,\n    `CREATE TABLE IF NOT EXISTS accounts (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      name TEXT NOT NULL,\n      description TEXT,\n      user_id INTEGER NOT NULL,\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n      UNIQUE(name, user_id),\n      FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n    )`,\n    `CREATE INDEX IF NOT EXISTS idx_accounts_user_id ON accounts(user_id)`,\n    `CREATE TABLE IF NOT EXISTS funds (\n      code TEXT PRIMARY KEY,\n      name TEXT NOT NULL,\n      type TEXT,\n      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n    )`,\n    `CREATE INDEX IF NOT EXISTS idx_funds_name ON funds(name)`,\n    `CREATE TABLE IF NOT EXISTS positions (\n      account_id INTEGER NOT NULL,\n      code TEXT NOT NULL,\n      cost REAL NOT NULL DEFAULT 0.0,\n      shares REAL NOT NULL DEFAULT 0.0,\n      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n      PRIMARY KEY (account_id, code),\n      FOREIGN KEY (account_id) REFERENCES accounts(id) ON DELETE CASCADE\n    )`,\n    `CREATE INDEX IF NOT EXISTS idx_positions_account_id ON positions(account_id)`,\n    `CREATE TABLE IF NOT EXISTS transactions (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      account_id INTEGER NOT NULL,\n      code TEXT NOT NULL,\n      op_type TEXT NOT NULL,\n      amount_cny REAL,\n      shares_redeemed REAL,\n      confirm_date TEXT NOT NULL,\n      confirm_nav REAL,\n      shares_added REAL,\n      cost_after REAL,\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n      applied_at TIMESTAMP,\n      FOREIGN KEY (account_id) REFERENCES accounts(id) ON DELETE CASCADE\n    )`,\n    `CREATE INDEX IF NOT EXISTS idx_transactions_account_id ON transactions(account_id)`,\n    `CREATE INDEX IF NOT EXISTS idx_transactions_code ON transactions(code)`,\n    `CREATE INDEX IF NOT EXISTS idx_transactions_confirm_date ON transactions(confirm_date)`,\n    `CREATE TABLE IF NOT EXISTS fund_history (\n      code TEXT NOT NULL,\n      date TEXT NOT NULL,\n      nav REAL NOT NULL,\n      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n      PRIMARY KEY (code, date)\n    )`,\n    `CREATE INDEX IF NOT EXISTS idx_fund_history_code ON fund_history(code)`,\n    `CREATE INDEX IF NOT EXISTS idx_fund_history_date ON fund_history(date)`,\n    `CREATE TABLE IF NOT EXISTS fund_intraday_snapshots (\n      fund_code TEXT NOT NULL,\n      date TEXT NOT NULL,\n      time TEXT NOT NULL,\n      estimate REAL NOT NULL,\n      PRIMARY KEY (fund_code, date, time)\n    )`,\n    `CREATE TABLE IF NOT EXISTS subscriptions (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      code TEXT NOT NULL,\n      email TEXT NOT NULL,\n      user_id INTEGER NOT NULL,\n      threshold_up REAL,\n      threshold_down REAL,\n      enable_digest INTEGER DEFAULT 0,\n      digest_time TEXT DEFAULT '14:45',\n      enable_volatility INTEGER DEFAULT 1,\n      last_notified_at TIMESTAMP,\n      last_digest_at TIMESTAMP,\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n      UNIQUE(code, email, user_id),\n      FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n    )`,\n    `CREATE INDEX IF NOT EXISTS idx_subscriptions_user_id ON subscriptions(user_id)`,\n    `CREATE TABLE IF NOT EXISTS settings (\n      key TEXT NOT NULL,\n      value TEXT,\n      encrypted INTEGER DEFAULT 0,\n      user_id INTEGER,\n      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n      PRIMARY KEY (key, user_id)\n    )`,\n    `CREATE INDEX IF NOT EXISTS idx_settings_user_id ON settings(user_id)`,\n    `CREATE TABLE IF NOT EXISTS ai_prompts (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      name TEXT NOT NULL,\n      prompt TEXT NOT NULL,\n      system_prompt TEXT,\n      user_prompt TEXT,\n      is_default INTEGER DEFAULT 0,\n      user_id INTEGER NOT NULL,\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n      UNIQUE(name, user_id),\n      FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n    )`,\n    `CREATE INDEX IF NOT EXISTS idx_ai_prompts_user_id ON ai_prompts(user_id)`,\n    `CREATE TABLE IF NOT EXISTS ai_analysis_history (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      user_id INTEGER NOT NULL,\n      account_id INTEGER NOT NULL,\n      fund_code TEXT NOT NULL,\n      fund_name TEXT NOT NULL,\n      prompt_id INTEGER,\n      prompt_name TEXT NOT NULL,\n      markdown TEXT NOT NULL,\n      indicators_json TEXT,\n      status TEXT NOT NULL CHECK(status IN ('success', 'failed')) DEFAULT 'success',\n      error_message TEXT,\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n      FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n      FOREIGN KEY (account_id) REFERENCES accounts(id) ON DELETE CASCADE\n    )`,\n    `CREATE INDEX IF NOT EXISTS idx_analysis_history_main ON ai_analysis_history(user_id, account_id, fund_code, created_at DESC)`,\n    `CREATE INDEX IF NOT EXISTS idx_analysis_history_prompt ON ai_analysis_history(user_id, prompt_id, created_at DESC)`,\n    `CREATE INDEX IF NOT EXISTS idx_analysis_history_user_id ON ai_analysis_history(user_id, id)`,\n  ];\n\n  for (const sql of statements) {\n    await db.prepare(sql).run();\n  }\n}\n\nasync function insertDefaultSettings(db) {\n  const defaults = [\n    ['OPENAI_API_KEY', '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', 1, null],\n    ['OPENAI_API_BASE', 'https://integrate.api.nvidia.com/v1', 0, null],\n    ['AI_MODEL_NAME', 'deepseek-ai/deepseek-v3.2', 0, null],\n    ['SMTP_HOST', 'smtp.gmail.com', 0, null],\n    ['SMTP_PORT', '587', 0, null],\n    ['SMTP_USER', '', 0, null],\n    ['SMTP_PASSWORD', '', 1, null],\n    ['EMAIL_FROM', 'noreply@fundval.live', 0, null],\n    ['INTRADAY_COLLECT_INTERVAL', '5', 0, null],\n  ];\n\n  for (const [key, value, encrypted, userId] of defaults) {\n    await db.prepare(\n      'INSERT OR IGNORE INTO settings (key, value, encrypted, user_id) VALUES (?, ?, ?, ?)'\n    ).bind(key, value, encrypted, userId).run();\n  }\n}\n\nasync function dropAllTables(db) {\n  const tables = await db.prepare(\n    \"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' AND name NOT LIKE '_cf_%'\"\n  ).all();\n\n  for (const { name } of tables.results) {\n    await db.prepare(`DROP TABLE IF EXISTS ${name}`).run();\n  }\n}\n\n/**\n * Check database schema version\n */\nexport async function checkDatabaseVersion(db) {\n  try {\n    const tableCheck = await db.prepare(\n      \"SELECT name FROM sqlite_master WHERE type='table' AND name='schema_version'\"\n    ).first();\n    if (!tableCheck) return 0;\n\n    const row = await db.prepare('SELECT MAX(version) as version FROM schema_version').first();\n    return row?.version || 0;\n  } catch {\n    return 0;\n  }\n}\n\n/**\n * Get all table names\n */\nexport async function getAllTables(db) {\n  const result = await db.prepare(\n    \"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' AND name NOT LIKE '_cf_%' ORDER BY name\"\n  ).all();\n  return result.results.map(r => r.name);\n}\n\nexport { CURRENT_SCHEMA_VERSION, dropAllTables };\n", "/**\n * Estimation algorithms (pure JS, replaces numpy-based estimate.py)\n */\n\n/**\n * Weighted moving average estimation\n */\nexport function estimateWithWeightedMa(history, weights = null) {\n  if (!history || history.length < 2) return null;\n\n  weights = weights || [0.4, 0.3, 0.2, 0.07, 0.03];\n  const n = Math.min(weights.length, history.length - 1);\n  if (n < 2) return null;\n\n  try {\n    const changes = [];\n    for (let i = 1; i <= n; i++) {\n      const currentNav = parseFloat(history[history.length - i].nav);\n      const prevNav = parseFloat(history[history.length - i - 1].nav);\n      changes.push((currentNav - prevNav) / prevNav * 100);\n    }\n\n    const weightedSum = changes.reduce((sum, c, i) => sum + c * weights[i], 0);\n    const weightTotal = weights.slice(0, n).reduce((a, b) => a + b, 0);\n    const weightedChange = weightedSum / weightTotal;\n\n    const yesterdayNav = parseFloat(history[history.length - 1].nav);\n    const estimatedNav = yesterdayNav * (1 + weightedChange / 100);\n\n    let confidence = Math.min(n / weights.length, 1.0);\n    const avgVolatility = changes.reduce((s, c) => s + Math.abs(c), 0) / n;\n    if (avgVolatility > 3.0) confidence *= 0.8;\n\n    return {\n      estimate: Math.round(estimatedNav * 10000) / 10000,\n      est_rate: Math.round(weightedChange * 100) / 100,\n      confidence: Math.round(confidence * 100) / 100,\n      method: 'weighted_ma',\n    };\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Simple moving average estimation (fallback)\n */\nexport function estimateWithSimpleMa(history, days = 5) {\n  if (!history || history.length < 2) return null;\n  const n = Math.min(days, history.length - 1);\n\n  try {\n    const changes = [];\n    for (let i = 1; i <= n; i++) {\n      const currentNav = parseFloat(history[history.length - i].nav);\n      const prevNav = parseFloat(history[history.length - i - 1].nav);\n      changes.push((currentNav - prevNav) / prevNav * 100);\n    }\n\n    const avgChange = changes.reduce((a, b) => a + b, 0) / changes.length;\n    const yesterdayNav = parseFloat(history[history.length - 1].nav);\n    const estimatedNav = yesterdayNav * (1 + avgChange / 100);\n\n    return {\n      estimate: Math.round(estimatedNav * 10000) / 10000,\n      est_rate: Math.round(avgChange * 100) / 100,\n      confidence: 0.6,\n      method: 'simple_ma',\n    };\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Smart estimation entry point\n */\nexport function estimateNav(code, history) {\n  if (!history || history.length < 2) return null;\n\n  if (history.length >= 5) {\n    const result = estimateWithWeightedMa(history);\n    if (result) return result;\n  }\n\n  return estimateWithSimpleMa(history);\n}\n", "/**\n * Fund data service - fetch valuations, history, holdings\n * Replaces Python fund.py (akshare + requests \u2192 fetch API)\n */\n\n/**\n * Get fund type from database\n */\nexport function getFundType(type, name) {\n  if (type) return type;\n  // Fallback heuristics\n  if (name.includes('\u503A') || name.includes('\u7EAF\u503A') || name.includes('\u56FA\u6536')) return '\u503A\u5238';\n  if (name.includes('QDII') || name.includes('\u7EB3\u65AF\u8FBE\u514B') || name.includes('\u6807\u666E') || name.includes('\u6052\u751F')) return 'QDII';\n  if (name.includes('\u8D27\u5E01')) return '\u8D27\u5E01';\n  return '\u672A\u77E5';\n}\n\n/**\n * Map fund type to major category\n */\nexport function getFundCategory(fundType) {\n  if (!fundType) return '\u672A\u5206\u7C7B';\n  if (fundType.startsWith('\u8D27\u5E01\u578B') || fundType === '\u8D27\u5E01') return '\u8D27\u5E01\u7C7B';\n\n  const debtKeys = ['\u503A\u5238\u578B-', '\u6DF7\u5408\u578B-\u504F\u503A', '\u6DF7\u5408\u578B-\u7EDD\u5BF9\u6536\u76CA', 'QDII-\u7EAF\u503A', 'QDII-\u6DF7\u5408\u503A', '\u6307\u6570\u578B-\u56FA\u6536'];\n  if (debtKeys.some(k => fundType.startsWith(k)) || fundType === '\u503A\u5238') return '\u504F\u503A\u7C7B';\n\n  const commodityKeys = ['\u5546\u54C1', 'QDII-\u5546\u54C1', 'REITs', 'Reits', 'QDII-REITs'];\n  if (commodityKeys.some(k => fundType.includes(k))) return '\u5546\u54C1\u7C7B';\n\n  const equityKeys = ['\u80A1\u7968\u578B', '\u6DF7\u5408\u578B-\u504F\u80A1', '\u6DF7\u5408\u578B-\u5E73\u8861', '\u6DF7\u5408\u578B-\u7075\u6D3B', '\u6307\u6570\u578B-\u80A1\u7968', '\u6307\u6570\u578B-\u6D77\u5916\u80A1\u7968', '\u6307\u6570\u578B-\u5176\u4ED6', 'QDII-\u666E\u901A\u80A1\u7968', 'QDII-\u6DF7\u5408\u504F\u80A1', 'QDII-\u6DF7\u5408\u5E73\u8861', 'QDII-\u6DF7\u5408\u7075\u6D3B', 'FOF-', 'QDII-FOF'];\n  if (equityKeys.some(k => fundType.startsWith(k) || fundType.includes(k))) return '\u504F\u80A1\u7C7B';\n\n  return '\u672A\u5206\u7C7B';\n}\n\n/**\n * Fetch real-time valuation from Eastmoney API\n */\nexport async function getEastmoneyValuation(code) {\n  const url = `http://fundgz.1234567.com.cn/js/${code}.js?rt=${Date.now()}`;\n  try {\n    const resp = await fetch(url, {\n      headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' },\n    });\n    if (!resp.ok) return {};\n    const text = await resp.text();\n    const match = text.match(/jsonpgz\\((.*)\\)/);\n    if (match && match[1]) {\n      const data = JSON.parse(match[1]);\n      return {\n        name: data.name,\n        nav: parseFloat(data.dwjz || 0),\n        estimate: parseFloat(data.gsz || 0),\n        estRate: parseFloat(data.gszzl || 0),\n        time: data.gztime,\n      };\n    }\n  } catch (e) {\n    console.warn(`Eastmoney API error for ${code}: ${e.message}`);\n  }\n  return {};\n}\n\n/**\n * Fetch valuation from Sina API (backup source)\n */\nexport async function getSinaValuation(code) {\n  const url = `http://hq.sinajs.cn/list=fu_${code}`;\n  try {\n    const resp = await fetch(url, {\n      headers: { 'Referer': 'http://finance.sina.com.cn' },\n    });\n    const text = await resp.text();\n    const match = text.match(/=\"(.*)\"/);\n    if (match && match[1]) {\n      const parts = match[1].split(',');\n      if (parts.length >= 8) {\n        return {\n          estimate: parseFloat(parts[2]),\n          nav: parseFloat(parts[3]),\n          estRate: parseFloat(parts[6]),\n          time: `${parts[7]} ${parts[1]}`,\n        };\n      }\n    }\n  } catch (e) {\n    console.warn(`Sina API error for ${code}: ${e.message}`);\n  }\n  return {};\n}\n\n/**\n * Combined valuation with multi-source failover\n */\nexport async function getCombinedValuation(db, code) {\n  // 1. Try Eastmoney\n  let data = await getEastmoneyValuation(code);\n  if (data.estimate && data.estimate > 0) return data;\n\n  // 2. Fallback to Sina\n  const sinaData = await getSinaValuation(code);\n  if (sinaData.estimate && sinaData.estimate > 0) {\n    if (data && Object.keys(data).length > 0) {\n      return { ...data, ...sinaData };\n    }\n    return sinaData;\n  }\n\n  // 3. Try custom estimation\n  const { estimateNav } = await import('./estimate.js');\n  try {\n    const history = await getFundHistory(db, code, 30);\n    if (history && history.length >= 2) {\n      const mlResult = estimateNav(code, history);\n      if (mlResult) {\n        const yesterdayNav = history[history.length - 1].nav;\n        let fundName = data?.name || code;\n        if (!fundName || fundName === code) {\n          const row = await db.prepare('SELECT name FROM funds WHERE code = ?').bind(code).first();\n          if (row) fundName = row.name;\n        }\n        return {\n          code,\n          name: fundName,\n          nav: yesterdayNav,\n          navDate: history[history.length - 1].date,\n          estimate: mlResult.estimate,\n          estRate: mlResult.est_rate,\n          time: new Date().toTimeString().slice(0, 5),\n          source: 'ml_estimate',\n          confidence: mlResult.confidence || 0,\n          method: mlResult.method || 'unknown',\n        };\n      }\n    }\n  } catch (e) {\n    console.error(`Custom estimation failed for ${code}: ${e.message}`);\n  }\n\n  // 4. Fallback: return yesterday's NAV\n  if (data && Object.keys(data).length > 0) return data;\n\n  try {\n    const history = await getFundHistory(db, code, 1);\n    if (history && history.length > 0) {\n      let fundName = code;\n      const row = await db.prepare('SELECT name FROM funds WHERE code = ?').bind(code).first();\n      if (row) fundName = row.name;\n      return {\n        code,\n        name: fundName,\n        nav: history[history.length - 1].nav,\n        navDate: history[history.length - 1].date,\n        estimate: history[history.length - 1].nav,\n        estRate: 0.0,\n        time: '--',\n        source: 'fallback',\n      };\n    }\n  } catch {}\n\n  return { code, name: code, nav: 0, estimate: 0, estRate: 0 };\n}\n\n/**\n * Search funds in D1\n */\nexport async function searchFunds(db, q) {\n  if (!q) return [];\n  const qClean = q.trim();\n  const pattern = `%${qClean}%`;\n  const prefixPattern = `${qClean}%`;\n\n  const result = await db.prepare(`\n    SELECT code, name, type,\n      CASE\n        WHEN code = ? THEN 1\n        WHEN code LIKE ? THEN 2\n        WHEN name LIKE ? THEN 3\n        ELSE 4\n      END as relevance\n    FROM funds\n    WHERE code LIKE ? OR name LIKE ?\n    ORDER BY relevance, code\n    LIMIT 30\n  `).bind(qClean, prefixPattern, pattern, pattern, pattern).all();\n\n  return result.results.map(row => ({\n    id: String(row.code),\n    name: row.name,\n    type: row.type || '\u672A\u77E5',\n  }));\n}\n\n/**\n * Get historical NAV with D1 caching\n */\nexport async function getFundHistory(db, code, limit = 30) {\n  // 1. Try D1 cache\n  let rows;\n  if (limit >= 9999) {\n    rows = await db.prepare(\n      'SELECT date, nav, updated_at FROM fund_history WHERE code = ? ORDER BY date DESC'\n    ).bind(code).all();\n  } else {\n    rows = await db.prepare(\n      'SELECT date, nav, updated_at FROM fund_history WHERE code = ? ORDER BY date DESC LIMIT ?'\n    ).bind(code, limit).all();\n  }\n\n  const results = rows.results;\n\n  // Check cache validity\n  if (results.length > 0) {\n    const latestUpdate = results[0].updated_at;\n    const latestNavDate = results[0].date;\n    try {\n      const updateTime = new Date(latestUpdate);\n      const ageHours = (Date.now() - updateTime.getTime()) / (1000 * 60 * 60);\n      const now = new Date();\n      const todayStr = now.toISOString().slice(0, 10);\n      const currentHour = now.getUTCHours() + 8; // CST approximation\n\n      const minRows = limit < 9999 ? 10 : 100;\n\n      let cacheValid;\n      if (currentHour >= 16 && latestNavDate < todayStr) {\n        cacheValid = false;\n      } else {\n        cacheValid = ageHours < 24 && results.length >= Math.min(limit, minRows);\n      }\n\n      if (cacheValid) {\n        return results.reverse().map(r => ({ date: r.date, nav: r.nav }));\n      }\n    } catch {}\n  }\n\n  // 2. Fetch from Eastmoney API (replaces akshare)\n  try {\n    const history = await fetchFundHistoryFromApi(code, limit);\n    if (!history || history.length === 0) return [];\n\n    // Save to D1 cache\n    for (const item of history) {\n      await db.prepare(\n        'INSERT OR REPLACE INTO fund_history (code, date, nav, updated_at) VALUES (?, ?, ?, datetime())'\n      ).bind(code, item.date, item.nav).run();\n    }\n\n    return history;\n  } catch (e) {\n    console.error(`History fetch error for ${code}: ${e.message}`);\n    // Return cached data even if stale\n    if (results.length > 0) {\n      return results.reverse().map(r => ({ date: r.date, nav: r.nav }));\n    }\n    return [];\n  }\n}\n\n/**\n * Fetch fund history from Eastmoney PingZhong data\n * Replaces akshare fund_open_fund_info_em\n */\nasync function fetchFundHistoryFromApi(code, limit) {\n  const url = `http://fund.eastmoney.com/pingzhongdata/${code}.js`;\n  try {\n    const resp = await fetch(url, {\n      headers: { 'User-Agent': 'Mozilla/5.0' },\n    });\n    if (!resp.ok) return [];\n    const text = await resp.text();\n\n    // Extract Data_netWorthTrend\n    const match = text.match(/Data_netWorthTrend\\s*=\\s*(\\[.+?\\])\\s*;/s);\n    if (!match) return [];\n\n    const rawHist = JSON.parse(match[1]);\n    if (!rawHist || rawHist.length === 0) return [];\n\n    let results = rawHist\n      .filter(item => 'x' in item && 'y' in item)\n      .map(item => ({\n        date: new Date(item.x).toISOString().slice(0, 10),\n        nav: parseFloat(item.y),\n      }));\n\n    // Sort ascending\n    results.sort((a, b) => a.date.localeCompare(b.date));\n\n    // Limit if needed\n    if (limit < 9999) {\n      results = results.slice(-limit);\n    }\n\n    return results;\n  } catch (e) {\n    console.error(`PingZhong history error for ${code}: ${e.message}`);\n    return [];\n  }\n}\n\n/**\n * Get Eastmoney PingZhong detailed data\n */\nexport async function getEastmoneyPingzhongData(code) {\n  const url = `http://fund.eastmoney.com/pingzhongdata/${code}.js`;\n  try {\n    const resp = await fetch(url, {\n      headers: { 'User-Agent': 'Mozilla/5.0' },\n    });\n    if (!resp.ok) return {};\n    const text = await resp.text();\n    const data = {};\n\n    // Fund name\n    const nameMatch = text.match(/fS_name\\s*=\\s*\"(.*?)\";/);\n    if (nameMatch) data.name = nameMatch[1];\n\n    // Fund code\n    const codeMatch = text.match(/fS_code\\s*=\\s*\"(.*?)\";/);\n    if (codeMatch) data.code = codeMatch[1];\n\n    // Manager\n    const managerMatch = text.match(/Data_currentFundManager\\s*=\\s*(\\[.+?\\])\\s*;\\s*\\/\\*/);\n    if (managerMatch) {\n      try {\n        const managers = JSON.parse(managerMatch[1]);\n        if (managers && managers.length > 0) {\n          data.manager = managers.map(m => m.name).join(', ');\n        }\n      } catch {}\n    }\n\n    // Performance metrics\n    for (const key of ['syl_1n', 'syl_6y', 'syl_3y', 'syl_1y']) {\n      const m = text.match(new RegExp(`${key}\\\\s*=\\\\s*\"(.*?)\";`));\n      if (m) data[key] = m[1];\n    }\n\n    // Performance evaluation\n    const perfMatch = text.match(/Data_performanceEvaluation\\s*=\\s*(\\{.+?\\})\\s*;\\s*\\/\\*/);\n    if (perfMatch) {\n      try {\n        const perf = JSON.parse(perfMatch[1]);\n        if (perf && perf.data && perf.categories) {\n          data.performance = {};\n          perf.categories.forEach((cat, i) => {\n            data.performance[cat] = perf.data[i];\n          });\n        }\n      } catch {}\n    }\n\n    // History (Data_netWorthTrend)\n    const histMatch = text.match(/Data_netWorthTrend\\s*=\\s*(\\[.+?\\])\\s*;/s);\n    if (histMatch) {\n      try {\n        const rawHist = JSON.parse(histMatch[1]);\n        if (rawHist && rawHist.length > 0) {\n          data.history = rawHist\n            .filter(item => 'x' in item && 'y' in item)\n            .map(item => ({\n              date: new Date(item.x).toISOString().slice(0, 10),\n              nav: parseFloat(item.y),\n            }));\n        }\n      } catch (e) {\n        console.error(`Failed to parse history for ${code}: ${e.message}`);\n      }\n    }\n\n    return data;\n  } catch (e) {\n    console.warn(`PingZhong API error for ${code}: ${e.message}`);\n    return {};\n  }\n}\n\n/**\n * Get fund info from D1\n */\nasync function getFundInfoFromDb(db, code) {\n  try {\n    const row = await db.prepare('SELECT name, type FROM funds WHERE code = ?').bind(code).first();\n    if (row) return { name: row.name, type: row.type };\n  } catch {}\n  return {};\n}\n\n/**\n * Fetch stock prices from Sina API in batch\n */\nexport async function fetchStockSpotsSina(codes) {\n  if (!codes || codes.length === 0) return {};\n\n  const formatted = [];\n  const codeMap = {};\n\n  for (const c of codes) {\n    if (!c) continue;\n    const cStr = String(c).trim();\n    let prefix = '';\n    let cleanC = cStr;\n\n    if (/^\\d+$/.test(cStr)) {\n      if (cStr.length === 6) {\n        prefix = ['60', '68', '90', '11'].some(p => cStr.startsWith(p)) ? 'sh' : 'sz';\n      } else if (cStr.length === 5) {\n        prefix = 'hk';\n      }\n    } else if (/^[a-zA-Z]+$/.test(cStr)) {\n      prefix = 'gb_';\n      cleanC = cStr.toLowerCase();\n    }\n\n    if (prefix) {\n      const sinaCode = `${prefix}${cleanC}`;\n      formatted.push(sinaCode);\n      codeMap[sinaCode] = cStr;\n    }\n  }\n\n  if (formatted.length === 0) return {};\n\n  const url = `http://hq.sinajs.cn/list=${formatted.join(',')}`;\n  try {\n    const resp = await fetch(url, {\n      headers: { 'Referer': 'http://finance.sina.com.cn' },\n    });\n    const text = await resp.text();\n    const results = {};\n\n    for (const line of text.trim().split('\\n')) {\n      if (!line || !line.includes('=') || !line.includes('\"')) continue;\n\n      const lineKey = line.split('=')[0].split('_str_').pop();\n      const originalCode = codeMap[lineKey];\n      if (!originalCode) continue;\n\n      const dataPart = line.split('\"')[1];\n      if (!dataPart) continue;\n      const parts = dataPart.split(',');\n\n      let change = 0.0;\n      try {\n        if (lineKey.startsWith('gb_')) {\n          if (parts.length > 2) change = parseFloat(parts[2]);\n        } else if (lineKey.startsWith('hk')) {\n          if (parts.length > 6) {\n            const prevClose = parseFloat(parts[3]);\n            const last = parseFloat(parts[6]);\n            if (prevClose > 0) change = Math.round((last - prevClose) / prevClose * 10000) / 100;\n          }\n        } else {\n          if (parts.length > 3) {\n            const prevClose = parseFloat(parts[2]);\n            const last = parseFloat(parts[3]);\n            if (prevClose > 0) change = Math.round((last - prevClose) / prevClose * 10000) / 100;\n          }\n        }\n        results[originalCode] = change;\n      } catch {}\n    }\n\n    return results;\n  } catch (e) {\n    console.warn(`Sina stock fetch failed: ${e.message}`);\n    return {};\n  }\n}\n\n/**\n * Calculate technical indicators (pure JS, replaces numpy)\n */\nexport function calculateTechnicalIndicators(history) {\n  if (!history || history.length < 10) {\n    return { sharpe: '--', volatility: '--', max_drawdown: '--', annual_return: '--' };\n  }\n\n  try {\n    const navs = history.map(item => item.nav);\n\n    // Daily returns\n    const dailyReturns = [];\n    for (let i = 1; i < navs.length; i++) {\n      dailyReturns.push((navs[i] - navs[i - 1]) / navs[i - 1]);\n    }\n\n    // Annualized return\n    const totalReturn = (navs[navs.length - 1] - navs[0]) / navs[0];\n    const years = history.length / 250.0;\n    const annualReturn = years > 0 ? Math.pow(1 + totalReturn, 1 / years) - 1 : 0;\n\n    // Annualized volatility\n    const mean = dailyReturns.reduce((s, v) => s + v, 0) / dailyReturns.length;\n    const variance = dailyReturns.reduce((s, v) => s + Math.pow(v - mean, 2), 0) / dailyReturns.length;\n    const volatility = Math.sqrt(variance) * Math.sqrt(250);\n\n    // Sharpe ratio (rf = 2%)\n    const rf = 0.02;\n    const sharpe = volatility > 0 ? (annualReturn - rf) / volatility : 0;\n\n    // Max drawdown\n    let maxDrawdown = 0;\n    let peak = navs[0];\n    for (const nav of navs) {\n      if (nav > peak) peak = nav;\n      const drawdown = (nav - peak) / peak;\n      if (drawdown < maxDrawdown) maxDrawdown = drawdown;\n    }\n\n    return {\n      sharpe: Math.round(sharpe * 100) / 100,\n      volatility: `${Math.round(volatility * 10000) / 100}%`,\n      max_drawdown: `${Math.round(maxDrawdown * 10000) / 100}%`,\n      annual_return: `${Math.round(annualReturn * 10000) / 100}%`,\n    };\n  } catch (e) {\n    console.error(`Indicator calculation error: ${e.message}`);\n    return { sharpe: '--', volatility: '--', max_drawdown: '--', annual_return: '--' };\n  }\n}\n\n/**\n * Get NAV on a specific date\n */\nexport async function getNavOnDate(db, code, dateStr) {\n  const history = await getFundHistory(db, code, 90);\n  for (const item of history) {\n    if (item.date.slice(0, 10) === dateStr.slice(0, 10)) {\n      return item.nav;\n    }\n  }\n  return null;\n}\n\n/**\n * Get complete fund intraday data (main API response)\n */\nexport async function getFundIntraday(db, code) {\n  // 1) Real-time valuation\n  const emData = await getCombinedValuation(db, code);\n  let name = emData.name;\n  const nav = parseFloat(emData.nav || 0);\n  const estimate = parseFloat(emData.estimate || 0);\n  const estRate = parseFloat(emData.estRate || 0);\n  const updateTime = emData.time || new Date().toTimeString().slice(0, 8);\n  const source = emData.source;\n  const method = emData.method;\n  const confidence = emData.confidence;\n\n  // 1.5) Enrich with detailed info\n  const pzData = await getEastmoneyPingzhongData(code);\n  const extraInfo = {};\n  if (pzData.name) extraInfo.full_name = pzData.name;\n  if (pzData.manager) extraInfo.manager = pzData.manager;\n  for (const k of ['syl_1n', 'syl_6y', 'syl_3y', 'syl_1y']) {\n    if (pzData[k]) extraInfo[k] = pzData[k];\n  }\n\n  const dbInfo = await getFundInfoFromDb(db, code);\n  if (dbInfo.name && !extraInfo.full_name) extraInfo.full_name = dbInfo.name;\n  if (dbInfo.type) extraInfo.official_type = dbInfo.type;\n\n  if (!name) name = extraInfo.full_name || `\u57FA\u91D1 ${code}`;\n  const manager = extraInfo.manager || '--';\n\n  // 2) Technical indicators\n  let historyData = pzData.history || [];\n  let techIndicators;\n  if (historyData.length > 0) {\n    techIndicators = calculateTechnicalIndicators(historyData.slice(-250));\n  } else {\n    historyData = await getFundHistory(db, code, 250);\n    techIndicators = calculateTechnicalIndicators(historyData);\n  }\n\n  // 3) Holdings\n  let holdings = [];\n  let concentrationRate = 0.0;\n  try {\n    holdings = await fetchFundHoldings(db, code);\n    // Calculate concentration from top 10\n    const top10 = holdings.slice(0, 10);\n    concentrationRate = top10.reduce((sum, h) => sum + h.percent, 0);\n    holdings = holdings.slice(0, 20);\n  } catch {}\n\n  // 4) Type\n  const sector = getFundType(dbInfo.type, name);\n\n  return {\n    id: String(code),\n    name,\n    type: sector,\n    manager,\n    nav,\n    estimate,\n    estRate,\n    time: updateTime,\n    source,\n    method,\n    confidence,\n    holdings,\n    indicators: {\n      returns: {\n        '1M': extraInfo.syl_1y || '--',\n        '3M': extraInfo.syl_3y || '--',\n        '6M': extraInfo.syl_6y || '--',\n        '1Y': extraInfo.syl_1n || '--',\n      },\n      concentration: Math.round(concentrationRate * 100) / 100,\n      technical: techIndicators,\n    },\n  };\n}\n\n/**\n * Fetch fund holdings from Eastmoney\n * Replaces akshare fund_portfolio_hold_em\n */\nasync function fetchFundHoldings(db, code) {\n  const currentYear = new Date().getFullYear();\n\n  for (const year of [currentYear, currentYear - 1]) {\n    try {\n      const url = `http://fundf10.eastmoney.com/FundArchivesDatas.aspx?type=jjcc&code=${code}&topline=20&year=${year}`;\n      const resp = await fetch(url, {\n        headers: { 'User-Agent': 'Mozilla/5.0', 'Referer': 'http://fundf10.eastmoney.com/' },\n      });\n      if (!resp.ok) continue;\n      const text = await resp.text();\n\n      // Parse HTML table\n      const holdings = parseHoldingsHtml(text);\n      if (holdings.length > 0) {\n        // Fetch stock spot prices\n        const stockCodes = holdings.map(h => h.stockCode).filter(Boolean);\n        const spotMap = await fetchStockSpotsSina(stockCodes);\n\n        return holdings.map(h => ({\n          name: h.name,\n          percent: h.percent,\n          change: spotMap[h.stockCode] || 0.0,\n        }));\n      }\n    } catch {}\n  }\n\n  return [];\n}\n\n/**\n * Parse holdings HTML from Eastmoney\n */\nfunction parseHoldingsHtml(html) {\n  const holdings = [];\n\n  // Extract table rows with regex (no DOM in Workers)\n  // Pattern: <td>...</td> cells in sequence: \u5E8F\u53F7, \u80A1\u7968\u4EE3\u7801, \u80A1\u7968\u540D\u79F0, \u5360\u51C0\u503C\u6BD4\u4F8B, ...\n  const tableMatch = html.match(/<table[^>]*class=\"w782 comm tzxq\"[^>]*>([\\s\\S]*?)<\\/table>/);\n  if (!tableMatch) {\n    // Try alternative pattern\n    const trMatches = html.matchAll(/<tr[^>]*>([\\s\\S]*?)<\\/tr>/g);\n    let seenCodes = new Set();\n\n    for (const trMatch of trMatches) {\n      const tdMatches = [...trMatch[1].matchAll(/<td[^>]*>([\\s\\S]*?)<\\/td>/g)];\n      if (tdMatches.length >= 4) {\n        // Extract stock code from link or plain text\n        const codeCell = tdMatches[1]?.[1] || '';\n        const codeMatch = codeCell.match(/(\\d{5,6})/);\n        if (!codeMatch) continue;\n\n        const stockCode = codeMatch[1];\n        if (seenCodes.has(stockCode)) continue;\n\n        // Extract name\n        const nameCell = tdMatches[2]?.[1] || '';\n        const nameMatch = nameCell.match(/>([^<]+)</);\n        const name = nameMatch ? nameMatch[1].trim() : nameCell.replace(/<[^>]*>/g, '').trim();\n        if (!name) continue;\n\n        // Extract percent\n        const percentCell = tdMatches[3]?.[1] || '';\n        const percentStr = percentCell.replace(/<[^>]*>/g, '').replace('%', '').trim();\n        const percent = parseFloat(percentStr);\n        if (isNaN(percent) || percent < 0.01) continue;\n\n        seenCodes.add(stockCode);\n        holdings.push({ stockCode, name, percent });\n      }\n    }\n  }\n\n  // Sort by percent descending\n  holdings.sort((a, b) => b.percent - a.percent);\n  return holdings;\n}\n\n/**\n * Fetch and update fund list from Eastmoney\n * Replaces akshare fund_name_em\n */\nexport async function fetchAndUpdateFunds(db) {\n  console.log('Starting fund list update...');\n  try {\n    const url = 'http://fund.eastmoney.com/js/fundcode_search.js';\n    const resp = await fetch(url, {\n      headers: { 'User-Agent': 'Mozilla/5.0' },\n    });\n    if (!resp.ok) {\n      console.warn('Failed to fetch fund list');\n      return;\n    }\n\n    const text = await resp.text();\n    // Format: var r = [[\"000001\",\"HXCZHH\",\"\u534E\u590F\u6210\u957F\u6DF7\u5408\",\"\u6DF7\u5408\u578B-\u504F\u80A1\",\"HUAXIACHENGZHANGHUNHE\"],...]\n    const match = text.match(/var\\s+r\\s*=\\s*(\\[[\\s\\S]*?\\]);/);\n    if (!match) {\n      console.warn('Failed to parse fund list');\n      return;\n    }\n\n    const fundList = JSON.parse(match[1]);\n    let count = 0;\n\n    // Batch insert (D1 has batch limit)\n    const batchSize = 50;\n    for (let i = 0; i < fundList.length; i += batchSize) {\n      const batch = fundList.slice(i, i + batchSize);\n      const stmts = batch.map(item =>\n        db.prepare(\n          'INSERT OR REPLACE INTO funds (code, name, type, updated_at) VALUES (?, ?, ?, datetime())'\n        ).bind(item[0], item[2], item[3])\n      );\n      await db.batch(stmts);\n      count += batch.length;\n    }\n\n    console.log(`Fund list updated. Total funds: ${count}`);\n  } catch (e) {\n    console.error(`Failed to update fund list: ${e.message}`);\n  }\n}\n", "/**\n * Encryption utilities using Web Crypto API\n * Replaces Python cryptography library\n */\n\n// Derive an AES key from the app secret\nasync function getKey(env) {\n  const secret = env.ENCRYPTION_KEY || 'fundval-live-default-key-change-me';\n  const keyMaterial = await crypto.subtle.importKey(\n    'raw',\n    new TextEncoder().encode(secret),\n    { name: 'PBKDF2' },\n    false,\n    ['deriveKey']\n  );\n\n  return crypto.subtle.deriveKey(\n    {\n      name: 'PBKDF2',\n      salt: new TextEncoder().encode('fundval-live-salt'),\n      iterations: 100000,\n      hash: 'SHA-256',\n    },\n    keyMaterial,\n    { name: 'AES-GCM', length: 256 },\n    false,\n    ['encrypt', 'decrypt']\n  );\n}\n\n/**\n * Encrypt a string value\n * Returns base64 encoded IV + ciphertext\n */\nexport async function encryptValue(value, env) {\n  if (!value) return value;\n\n  const key = await getKey(env);\n  const iv = crypto.getRandomValues(new Uint8Array(12));\n  const encoded = new TextEncoder().encode(value);\n\n  const ciphertext = await crypto.subtle.encrypt(\n    { name: 'AES-GCM', iv },\n    key,\n    encoded\n  );\n\n  // Combine IV + ciphertext and base64 encode\n  const combined = new Uint8Array(iv.length + ciphertext.byteLength);\n  combined.set(iv);\n  combined.set(new Uint8Array(ciphertext), iv.length);\n\n  return btoa(String.fromCharCode(...combined));\n}\n\n/**\n * Decrypt a base64 encoded value\n */\nexport async function decryptValue(encryptedValue, env) {\n  if (!encryptedValue) return encryptedValue;\n\n  try {\n    const key = await getKey(env);\n    const combined = Uint8Array.from(atob(encryptedValue), c => c.charCodeAt(0));\n\n    const iv = combined.slice(0, 12);\n    const ciphertext = combined.slice(12);\n\n    const decrypted = await crypto.subtle.decrypt(\n      { name: 'AES-GCM', iv },\n      key,\n      ciphertext\n    );\n\n    return new TextDecoder().decode(decrypted);\n  } catch (e) {\n    // If decryption fails (e.g., old format), return as-is\n    return encryptedValue;\n  }\n}\n", "/**\n * Email notification service\n * Replaces Python smtplib with HTTP-based email API\n * Supports: Resend, Mailgun, SendGrid, or custom SMTP relay\n */\n\nimport { decryptValue } from '../crypto.js';\n\n/**\n * Send notification email via HTTP API\n */\nexport async function sendNotificationEmail(env, to, data) {\n  const { fundCode, fundName, estRate, reason, estimate, nav } = data;\n\n  const subject = `[FundVal] ${fundName}(${fundCode}) \u4F30\u503C\u63D0\u9192`;\n  const html = `\n    <div style=\"font-family: -apple-system, BlinkMacSystemFont, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;\">\n      <h2 style=\"color: #1a1a1a; border-bottom: 2px solid #3b82f6; padding-bottom: 10px;\">\n        \uD83D\uDCCA \u57FA\u91D1\u4F30\u503C\u63D0\u9192\n      </h2>\n      <div style=\"background: #f8fafc; border-radius: 8px; padding: 16px; margin: 16px 0;\">\n        <p style=\"margin: 4px 0;\"><strong>\u57FA\u91D1\u540D\u79F0:</strong> ${fundName}</p>\n        <p style=\"margin: 4px 0;\"><strong>\u57FA\u91D1\u4EE3\u7801:</strong> ${fundCode}</p>\n        <p style=\"margin: 4px 0;\"><strong>\u6628\u65E5\u51C0\u503C:</strong> ${nav}</p>\n        <p style=\"margin: 4px 0;\"><strong>\u5B9E\u65F6\u4F30\u503C:</strong> ${estimate}</p>\n        <p style=\"margin: 4px 0; color: ${estRate >= 0 ? '#16a34a' : '#dc2626'};\">\n          <strong>\u4F30\u503C\u6DA8\u8DCC:</strong> ${estRate >= 0 ? '+' : ''}${estRate}%\n        </p>\n      </div>\n      <p style=\"color: #666; background: #fef3c7; padding: 12px; border-radius: 6px;\">\n        \u26A0\uFE0F <strong>\u89E6\u53D1\u539F\u56E0:</strong> ${reason}\n      </p>\n      <hr style=\"border: none; border-top: 1px solid #e5e7eb; margin: 20px 0;\">\n      <p style=\"color: #9ca3af; font-size: 12px; text-align: center;\">\n        FundVal-Live \u57FA\u91D1\u4F30\u503C\u7CFB\u7EDF \u00B7 \u6B64\u90AE\u4EF6\u4E3A\u81EA\u52A8\u53D1\u9001\n      </p>\n    </div>\n  `;\n\n  await sendEmail(env, to, subject, html);\n}\n\n/**\n * Send email via configured provider\n */\nasync function sendEmail(env, to, subject, html) {\n  const emailProvider = env.EMAIL_PROVIDER || 'resend';\n\n  try {\n    switch (emailProvider.toLowerCase()) {\n      case 'resend':\n        await sendViaResend(env, to, subject, html);\n        break;\n      case 'mailgun':\n        await sendViaMailgun(env, to, subject, html);\n        break;\n      case 'sendgrid':\n        await sendViaSendGrid(env, to, subject, html);\n        break;\n      default:\n        console.warn(`Unknown email provider: ${emailProvider}`);\n    }\n  } catch (e) {\n    console.error(`Email send failed: ${e.message}`);\n    throw e;\n  }\n}\n\nasync function sendViaResend(env, to, subject, html) {\n  const apiKey = env.RESEND_API_KEY;\n  if (!apiKey) throw new Error('RESEND_API_KEY not configured');\n\n  const resp = await fetch('https://api.resend.com/emails', {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${apiKey}`,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      from: env.EMAIL_FROM || 'FundVal <noreply@fundval.live>',\n      to: [to],\n      subject,\n      html,\n    }),\n  });\n\n  if (!resp.ok) {\n    const err = await resp.text();\n    throw new Error(`Resend API error: ${resp.status} ${err}`);\n  }\n}\n\nasync function sendViaMailgun(env, to, subject, html) {\n  const apiKey = env.MAILGUN_API_KEY;\n  const domain = env.MAILGUN_DOMAIN;\n  if (!apiKey || !domain) throw new Error('MAILGUN_API_KEY and MAILGUN_DOMAIN required');\n\n  const form = new FormData();\n  form.append('from', env.EMAIL_FROM || `FundVal <noreply@${domain}>`);\n  form.append('to', to);\n  form.append('subject', subject);\n  form.append('html', html);\n\n  const resp = await fetch(`https://api.mailgun.net/v3/${domain}/messages`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Basic ${btoa('api:' + apiKey)}`,\n    },\n    body: form,\n  });\n\n  if (!resp.ok) {\n    const err = await resp.text();\n    throw new Error(`Mailgun API error: ${resp.status} ${err}`);\n  }\n}\n\nasync function sendViaSendGrid(env, to, subject, html) {\n  const apiKey = env.SENDGRID_API_KEY;\n  if (!apiKey) throw new Error('SENDGRID_API_KEY not configured');\n\n  const resp = await fetch('https://api.sendgrid.com/v3/mail/send', {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${apiKey}`,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      personalizations: [{ to: [{ email: to }] }],\n      from: { email: env.EMAIL_FROM || 'noreply@fundval.live' },\n      subject,\n      content: [{ type: 'text/html', value: html }],\n    }),\n  });\n\n  if (!resp.ok) {\n    const err = await resp.text();\n    throw new Error(`SendGrid API error: ${resp.status} ${err}`);\n  }\n}\n", "/**\n * Default AI analysis prompt template\n * Replaces Python prompts.py\n */\n\nexport function LINUS_FINANCIAL_ANALYSIS_PROMPT(variables) {\n  return [\n    {\n      role: 'system',\n      content: `\u4F60\u662F\u4E00\u4F4D\u8D44\u6DF1\u7684\u57FA\u91D1\u5206\u6790\u5E08,\u4EE5Linus Torvalds\u7684\u98CE\u683C\u8FDB\u884C\u6280\u672F\u5BA1\u8BA1\u5F0F\u5206\u6790\u3002\n\n\u4F60\u7684\u6838\u5FC3\u539F\u5219\uFF1A\n1. \u62D2\u7EDD\u9ED1\u7BB1 - \u6240\u6709\u7ED3\u8BBA\u5FC5\u987B\u57FA\u4E8E\u6570\u636E\u7684\u6570\u5B66\u4E8B\u5B9E\n2. \u62D2\u7EDD\u60C5\u7EEA\u5316\u53D9\u4E8B - \u4E0D\u4F7F\u7528\"\u75AF\u6DA8\"\"\u66B4\u8DCC\"\"\u6050\u614C\"\u7B49\u60C5\u7EEA\u8BCD\n3. \u6570\u636E\u5F52\u56E0 - \u7528\u5177\u4F53\u6570\u5B57\u652F\u6491\u6BCF\u4E00\u4E2A\u89C2\u70B9\n4. \u903B\u8F91\u5BA1\u8BA1 - \u68C0\u67E5\u6570\u636E\u7684\u81EA\u6D3D\u6027\u548C\u4E00\u81F4\u6027\n\n\u8F93\u51FA\u683C\u5F0F\u8981\u6C42\uFF1A\u4F7F\u7528Markdown\u683C\u5F0F\uFF0C\u5305\u542B\u6807\u9898\u3001\u5217\u8868\u3001\u8868\u683C\u7B49\u3002`,\n    },\n    {\n      role: 'user',\n      content: `\u8BF7\u5BF9\u4EE5\u4E0B\u57FA\u91D1\u8FDB\u884C\u6DF1\u5EA6\u5206\u6790\uFF1A\n\n## \u57FA\u91D1\u57FA\u672C\u4FE1\u606F\n- \u4EE3\u7801: ${variables.fund_code}\n- \u540D\u79F0: ${variables.fund_name}\n- \u7C7B\u578B: ${variables.fund_type}\n- \u57FA\u91D1\u7ECF\u7406: ${variables.manager}\n\n## \u5F53\u524D\u4F30\u503C\n- \u6628\u65E5\u51C0\u503C: ${variables.nav}\n- \u5B9E\u65F6\u4F30\u503C: ${variables.estimate}\n- \u4F30\u503C\u6DA8\u8DCC\u5E45: ${variables.est_rate}\n\n## \u6280\u672F\u6307\u6807\n- \u590F\u666E\u6BD4\u7387: ${variables.sharpe}\n- \u5E74\u5316\u6CE2\u52A8\u7387: ${variables.volatility}\n- \u6700\u5927\u56DE\u64A4: ${variables.max_drawdown}\n- \u5E74\u5316\u6536\u76CA\u7387: ${variables.annual_return}\n\n## \u524D\u5341\u5927\u6301\u4ED3\n${variables.holdings}\n\n## \u6301\u4ED3\u96C6\u4E2D\u5EA6\n${variables.concentration}%\n\n## \u5386\u53F2\u8D70\u52BF\n${variables.history_summary}\n\n\u8BF7\u63D0\u4F9B:\n1. **\u6280\u672F\u6307\u6807\u5BA1\u8BA1** - \u5206\u6790\u590F\u666E\u6BD4\u7387\u3001\u6CE2\u52A8\u7387\u3001\u6700\u5927\u56DE\u64A4\u7684\u5408\u7406\u6027\n2. **\u6301\u4ED3\u5206\u6790** - \u5206\u6790\u524D\u5341\u5927\u6301\u4ED3\u7684\u884C\u4E1A\u5206\u5E03\u548C\u96C6\u4E2D\u5EA6\u98CE\u9669\n3. **\u4F30\u503C\u504F\u5DEE\u5206\u6790** - \u5F53\u524D\u4F30\u503C\u4E0E\u51C0\u503C\u7684\u504F\u5DEE\u539F\u56E0\n4. **\u98CE\u9669\u8BC4\u4F30** - \u57FA\u4E8E\u6570\u636E\u7684\u98CE\u9669\u7B49\u7EA7\u8BC4\u4F30\n5. **\u603B\u7ED3** - \u4E00\u53E5\u8BDD\u603B\u7ED3`,\n    },\n  ];\n}\n", "// src/compose.ts\nvar compose = (middleware, onError, onNotFound) => {\n  return (context, next) => {\n    let index = -1;\n    return dispatch(0);\n    async function dispatch(i) {\n      if (i <= index) {\n        throw new Error(\"next() called multiple times\");\n      }\n      index = i;\n      let res;\n      let isError = false;\n      let handler;\n      if (middleware[i]) {\n        handler = middleware[i][0][0];\n        context.req.routeIndex = i;\n      } else {\n        handler = i === middleware.length && next || void 0;\n      }\n      if (handler) {\n        try {\n          res = await handler(context, () => dispatch(i + 1));\n        } catch (err) {\n          if (err instanceof Error && onError) {\n            context.error = err;\n            res = await onError(err, context);\n            isError = true;\n          } else {\n            throw err;\n          }\n        }\n      } else {\n        if (context.finalized === false && onNotFound) {\n          res = await onNotFound(context);\n        }\n      }\n      if (res && (context.finalized === false || isError)) {\n        context.res = res;\n      }\n      return context;\n    }\n  };\n};\nexport {\n  compose\n};\n", "// src/request/constants.ts\nvar GET_MATCH_RESULT = /* @__PURE__ */ Symbol();\nexport {\n  GET_MATCH_RESULT\n};\n", "// src/utils/body.ts\nimport { HonoRequest } from \"../request.js\";\nvar parseBody = async (request, options = /* @__PURE__ */ Object.create(null)) => {\n  const { all = false, dot = false } = options;\n  const headers = request instanceof HonoRequest ? request.raw.headers : request.headers;\n  const contentType = headers.get(\"Content-Type\");\n  if (contentType?.startsWith(\"multipart/form-data\") || contentType?.startsWith(\"application/x-www-form-urlencoded\")) {\n    return parseFormData(request, { all, dot });\n  }\n  return {};\n};\nasync function parseFormData(request, options) {\n  const formData = await request.formData();\n  if (formData) {\n    return convertFormDataToBodyData(formData, options);\n  }\n  return {};\n}\nfunction convertFormDataToBodyData(formData, options) {\n  const form = /* @__PURE__ */ Object.create(null);\n  formData.forEach((value, key) => {\n    const shouldParseAllValues = options.all || key.endsWith(\"[]\");\n    if (!shouldParseAllValues) {\n      form[key] = value;\n    } else {\n      handleParsingAllValues(form, key, value);\n    }\n  });\n  if (options.dot) {\n    Object.entries(form).forEach(([key, value]) => {\n      const shouldParseDotValues = key.includes(\".\");\n      if (shouldParseDotValues) {\n        handleParsingNestedValues(form, key, value);\n        delete form[key];\n      }\n    });\n  }\n  return form;\n}\nvar handleParsingAllValues = (form, key, value) => {\n  if (form[key] !== void 0) {\n    if (Array.isArray(form[key])) {\n      ;\n      form[key].push(value);\n    } else {\n      form[key] = [form[key], value];\n    }\n  } else {\n    if (!key.endsWith(\"[]\")) {\n      form[key] = value;\n    } else {\n      form[key] = [value];\n    }\n  }\n};\nvar handleParsingNestedValues = (form, key, value) => {\n  let nestedForm = form;\n  const keys = key.split(\".\");\n  keys.forEach((key2, index) => {\n    if (index === keys.length - 1) {\n      nestedForm[key2] = value;\n    } else {\n      if (!nestedForm[key2] || typeof nestedForm[key2] !== \"object\" || Array.isArray(nestedForm[key2]) || nestedForm[key2] instanceof File) {\n        nestedForm[key2] = /* @__PURE__ */ Object.create(null);\n      }\n      nestedForm = nestedForm[key2];\n    }\n  });\n};\nexport {\n  parseBody\n};\n", "// src/utils/url.ts\nvar splitPath = (path) => {\n  const paths = path.split(\"/\");\n  if (paths[0] === \"\") {\n    paths.shift();\n  }\n  return paths;\n};\nvar splitRoutingPath = (routePath) => {\n  const { groups, path } = extractGroupsFromPath(routePath);\n  const paths = splitPath(path);\n  return replaceGroupMarks(paths, groups);\n};\nvar extractGroupsFromPath = (path) => {\n  const groups = [];\n  path = path.replace(/\\{[^}]+\\}/g, (match, index) => {\n    const mark = `@${index}`;\n    groups.push([mark, match]);\n    return mark;\n  });\n  return { groups, path };\n};\nvar replaceGroupMarks = (paths, groups) => {\n  for (let i = groups.length - 1; i >= 0; i--) {\n    const [mark] = groups[i];\n    for (let j = paths.length - 1; j >= 0; j--) {\n      if (paths[j].includes(mark)) {\n        paths[j] = paths[j].replace(mark, groups[i][1]);\n        break;\n      }\n    }\n  }\n  return paths;\n};\nvar patternCache = {};\nvar getPattern = (label, next) => {\n  if (label === \"*\") {\n    return \"*\";\n  }\n  const match = label.match(/^\\:([^\\{\\}]+)(?:\\{(.+)\\})?$/);\n  if (match) {\n    const cacheKey = `${label}#${next}`;\n    if (!patternCache[cacheKey]) {\n      if (match[2]) {\n        patternCache[cacheKey] = next && next[0] !== \":\" && next[0] !== \"*\" ? [cacheKey, match[1], new RegExp(`^${match[2]}(?=/${next})`)] : [label, match[1], new RegExp(`^${match[2]}$`)];\n      } else {\n        patternCache[cacheKey] = [label, match[1], true];\n      }\n    }\n    return patternCache[cacheKey];\n  }\n  return null;\n};\nvar tryDecode = (str, decoder) => {\n  try {\n    return decoder(str);\n  } catch {\n    return str.replace(/(?:%[0-9A-Fa-f]{2})+/g, (match) => {\n      try {\n        return decoder(match);\n      } catch {\n        return match;\n      }\n    });\n  }\n};\nvar tryDecodeURI = (str) => tryDecode(str, decodeURI);\nvar getPath = (request) => {\n  const url = request.url;\n  const start = url.indexOf(\"/\", url.indexOf(\":\") + 4);\n  let i = start;\n  for (; i < url.length; i++) {\n    const charCode = url.charCodeAt(i);\n    if (charCode === 37) {\n      const queryIndex = url.indexOf(\"?\", i);\n      const hashIndex = url.indexOf(\"#\", i);\n      const end = queryIndex === -1 ? hashIndex === -1 ? void 0 : hashIndex : hashIndex === -1 ? queryIndex : Math.min(queryIndex, hashIndex);\n      const path = url.slice(start, end);\n      return tryDecodeURI(path.includes(\"%25\") ? path.replace(/%25/g, \"%2525\") : path);\n    } else if (charCode === 63 || charCode === 35) {\n      break;\n    }\n  }\n  return url.slice(start, i);\n};\nvar getQueryStrings = (url) => {\n  const queryIndex = url.indexOf(\"?\", 8);\n  return queryIndex === -1 ? \"\" : \"?\" + url.slice(queryIndex + 1);\n};\nvar getPathNoStrict = (request) => {\n  const result = getPath(request);\n  return result.length > 1 && result.at(-1) === \"/\" ? result.slice(0, -1) : result;\n};\nvar mergePath = (base, sub, ...rest) => {\n  if (rest.length) {\n    sub = mergePath(sub, ...rest);\n  }\n  return `${base?.[0] === \"/\" ? \"\" : \"/\"}${base}${sub === \"/\" ? \"\" : `${base?.at(-1) === \"/\" ? \"\" : \"/\"}${sub?.[0] === \"/\" ? sub.slice(1) : sub}`}`;\n};\nvar checkOptionalParameter = (path) => {\n  if (path.charCodeAt(path.length - 1) !== 63 || !path.includes(\":\")) {\n    return null;\n  }\n  const segments = path.split(\"/\");\n  const results = [];\n  let basePath = \"\";\n  segments.forEach((segment) => {\n    if (segment !== \"\" && !/\\:/.test(segment)) {\n      basePath += \"/\" + segment;\n    } else if (/\\:/.test(segment)) {\n      if (/\\?/.test(segment)) {\n        if (results.length === 0 && basePath === \"\") {\n          results.push(\"/\");\n        } else {\n          results.push(basePath);\n        }\n        const optionalSegment = segment.replace(\"?\", \"\");\n        basePath += \"/\" + optionalSegment;\n        results.push(basePath);\n      } else {\n        basePath += \"/\" + segment;\n      }\n    }\n  });\n  return results.filter((v, i, a) => a.indexOf(v) === i);\n};\nvar _decodeURI = (value) => {\n  if (!/[%+]/.test(value)) {\n    return value;\n  }\n  if (value.indexOf(\"+\") !== -1) {\n    value = value.replace(/\\+/g, \" \");\n  }\n  return value.indexOf(\"%\") !== -1 ? tryDecode(value, decodeURIComponent_) : value;\n};\nvar _getQueryParam = (url, key, multiple) => {\n  let encoded;\n  if (!multiple && key && !/[%+]/.test(key)) {\n    let keyIndex2 = url.indexOf(\"?\", 8);\n    if (keyIndex2 === -1) {\n      return void 0;\n    }\n    if (!url.startsWith(key, keyIndex2 + 1)) {\n      keyIndex2 = url.indexOf(`&${key}`, keyIndex2 + 1);\n    }\n    while (keyIndex2 !== -1) {\n      const trailingKeyCode = url.charCodeAt(keyIndex2 + key.length + 1);\n      if (trailingKeyCode === 61) {\n        const valueIndex = keyIndex2 + key.length + 2;\n        const endIndex = url.indexOf(\"&\", valueIndex);\n        return _decodeURI(url.slice(valueIndex, endIndex === -1 ? void 0 : endIndex));\n      } else if (trailingKeyCode == 38 || isNaN(trailingKeyCode)) {\n        return \"\";\n      }\n      keyIndex2 = url.indexOf(`&${key}`, keyIndex2 + 1);\n    }\n    encoded = /[%+]/.test(url);\n    if (!encoded) {\n      return void 0;\n    }\n  }\n  const results = {};\n  encoded ??= /[%+]/.test(url);\n  let keyIndex = url.indexOf(\"?\", 8);\n  while (keyIndex !== -1) {\n    const nextKeyIndex = url.indexOf(\"&\", keyIndex + 1);\n    let valueIndex = url.indexOf(\"=\", keyIndex);\n    if (valueIndex > nextKeyIndex && nextKeyIndex !== -1) {\n      valueIndex = -1;\n    }\n    let name = url.slice(\n      keyIndex + 1,\n      valueIndex === -1 ? nextKeyIndex === -1 ? void 0 : nextKeyIndex : valueIndex\n    );\n    if (encoded) {\n      name = _decodeURI(name);\n    }\n    keyIndex = nextKeyIndex;\n    if (name === \"\") {\n      continue;\n    }\n    let value;\n    if (valueIndex === -1) {\n      value = \"\";\n    } else {\n      value = url.slice(valueIndex + 1, nextKeyIndex === -1 ? void 0 : nextKeyIndex);\n      if (encoded) {\n        value = _decodeURI(value);\n      }\n    }\n    if (multiple) {\n      if (!(results[name] && Array.isArray(results[name]))) {\n        results[name] = [];\n      }\n      ;\n      results[name].push(value);\n    } else {\n      results[name] ??= value;\n    }\n  }\n  return key ? results[key] : results;\n};\nvar getQueryParam = _getQueryParam;\nvar getQueryParams = (url, key) => {\n  return _getQueryParam(url, key, true);\n};\nvar decodeURIComponent_ = decodeURIComponent;\nexport {\n  checkOptionalParameter,\n  decodeURIComponent_,\n  getPath,\n  getPathNoStrict,\n  getPattern,\n  getQueryParam,\n  getQueryParams,\n  getQueryStrings,\n  mergePath,\n  splitPath,\n  splitRoutingPath,\n  tryDecode\n};\n", "// src/request.ts\nimport { HTTPException } from \"./http-exception.js\";\nimport { GET_MATCH_RESULT } from \"./request/constants.js\";\nimport { parseBody } from \"./utils/body.js\";\nimport { decodeURIComponent_, getQueryParam, getQueryParams, tryDecode } from \"./utils/url.js\";\nvar tryDecodeURIComponent = (str) => tryDecode(str, decodeURIComponent_);\nvar HonoRequest = class {\n  /**\n   * `.raw` can get the raw Request object.\n   *\n   * @see {@link https://hono.dev/docs/api/request#raw}\n   *\n   * @example\n   * ```ts\n   * // For Cloudflare Workers\n   * app.post('/', async (c) => {\n   *   const metadata = c.req.raw.cf?.hostMetadata?\n   *   ...\n   * })\n   * ```\n   */\n  raw;\n  #validatedData;\n  // Short name of validatedData\n  #matchResult;\n  routeIndex = 0;\n  /**\n   * `.path` can get the pathname of the request.\n   *\n   * @see {@link https://hono.dev/docs/api/request#path}\n   *\n   * @example\n   * ```ts\n   * app.get('/about/me', (c) => {\n   *   const pathname = c.req.path // `/about/me`\n   * })\n   * ```\n   */\n  path;\n  bodyCache = {};\n  constructor(request, path = \"/\", matchResult = [[]]) {\n    this.raw = request;\n    this.path = path;\n    this.#matchResult = matchResult;\n    this.#validatedData = {};\n  }\n  param(key) {\n    return key ? this.#getDecodedParam(key) : this.#getAllDecodedParams();\n  }\n  #getDecodedParam(key) {\n    const paramKey = this.#matchResult[0][this.routeIndex][1][key];\n    const param = this.#getParamValue(paramKey);\n    return param && /\\%/.test(param) ? tryDecodeURIComponent(param) : param;\n  }\n  #getAllDecodedParams() {\n    const decoded = {};\n    const keys = Object.keys(this.#matchResult[0][this.routeIndex][1]);\n    for (const key of keys) {\n      const value = this.#getParamValue(this.#matchResult[0][this.routeIndex][1][key]);\n      if (value !== void 0) {\n        decoded[key] = /\\%/.test(value) ? tryDecodeURIComponent(value) : value;\n      }\n    }\n    return decoded;\n  }\n  #getParamValue(paramKey) {\n    return this.#matchResult[1] ? this.#matchResult[1][paramKey] : paramKey;\n  }\n  query(key) {\n    return getQueryParam(this.url, key);\n  }\n  queries(key) {\n    return getQueryParams(this.url, key);\n  }\n  header(name) {\n    if (name) {\n      return this.raw.headers.get(name) ?? void 0;\n    }\n    const headerData = {};\n    this.raw.headers.forEach((value, key) => {\n      headerData[key] = value;\n    });\n    return headerData;\n  }\n  async parseBody(options) {\n    return this.bodyCache.parsedBody ??= await parseBody(this, options);\n  }\n  #cachedBody = (key) => {\n    const { bodyCache, raw } = this;\n    const cachedBody = bodyCache[key];\n    if (cachedBody) {\n      return cachedBody;\n    }\n    const anyCachedKey = Object.keys(bodyCache)[0];\n    if (anyCachedKey) {\n      return bodyCache[anyCachedKey].then((body) => {\n        if (anyCachedKey === \"json\") {\n          body = JSON.stringify(body);\n        }\n        return new Response(body)[key]();\n      });\n    }\n    return bodyCache[key] = raw[key]();\n  };\n  /**\n   * `.json()` can parse Request body of type `application/json`\n   *\n   * @see {@link https://hono.dev/docs/api/request#json}\n   *\n   * @example\n   * ```ts\n   * app.post('/entry', async (c) => {\n   *   const body = await c.req.json()\n   * })\n   * ```\n   */\n  json() {\n    return this.#cachedBody(\"text\").then((text) => JSON.parse(text));\n  }\n  /**\n   * `.text()` can parse Request body of type `text/plain`\n   *\n   * @see {@link https://hono.dev/docs/api/request#text}\n   *\n   * @example\n   * ```ts\n   * app.post('/entry', async (c) => {\n   *   const body = await c.req.text()\n   * })\n   * ```\n   */\n  text() {\n    return this.#cachedBody(\"text\");\n  }\n  /**\n   * `.arrayBuffer()` parse Request body as an `ArrayBuffer`\n   *\n   * @see {@link https://hono.dev/docs/api/request#arraybuffer}\n   *\n   * @example\n   * ```ts\n   * app.post('/entry', async (c) => {\n   *   const body = await c.req.arrayBuffer()\n   * })\n   * ```\n   */\n  arrayBuffer() {\n    return this.#cachedBody(\"arrayBuffer\");\n  }\n  /**\n   * Parses the request body as a `Blob`.\n   * @example\n   * ```ts\n   * app.post('/entry', async (c) => {\n   *   const body = await c.req.blob();\n   * });\n   * ```\n   * @see https://hono.dev/docs/api/request#blob\n   */\n  blob() {\n    return this.#cachedBody(\"blob\");\n  }\n  /**\n   * Parses the request body as `FormData`.\n   * @example\n   * ```ts\n   * app.post('/entry', async (c) => {\n   *   const body = await c.req.formData();\n   * });\n   * ```\n   * @see https://hono.dev/docs/api/request#formdata\n   */\n  formData() {\n    return this.#cachedBody(\"formData\");\n  }\n  /**\n   * Adds validated data to the request.\n   *\n   * @param target - The target of the validation.\n   * @param data - The validated data to add.\n   */\n  addValidatedData(target, data) {\n    this.#validatedData[target] = data;\n  }\n  valid(target) {\n    return this.#validatedData[target];\n  }\n  /**\n   * `.url()` can get the request url strings.\n   *\n   * @see {@link https://hono.dev/docs/api/request#url}\n   *\n   * @example\n   * ```ts\n   * app.get('/about/me', (c) => {\n   *   const url = c.req.url // `http://localhost:8787/about/me`\n   *   ...\n   * })\n   * ```\n   */\n  get url() {\n    return this.raw.url;\n  }\n  /**\n   * `.method()` can get the method name of the request.\n   *\n   * @see {@link https://hono.dev/docs/api/request#method}\n   *\n   * @example\n   * ```ts\n   * app.get('/about/me', (c) => {\n   *   const method = c.req.method // `GET`\n   * })\n   * ```\n   */\n  get method() {\n    return this.raw.method;\n  }\n  get [GET_MATCH_RESULT]() {\n    return this.#matchResult;\n  }\n  /**\n   * `.matchedRoutes()` can return a matched route in the handler\n   *\n   * @deprecated\n   *\n   * Use matchedRoutes helper defined in \"hono/route\" instead.\n   *\n   * @see {@link https://hono.dev/docs/api/request#matchedroutes}\n   *\n   * @example\n   * ```ts\n   * app.use('*', async function logger(c, next) {\n   *   await next()\n   *   c.req.matchedRoutes.forEach(({ handler, method, path }, i) => {\n   *     const name = handler.name || (handler.length < 2 ? '[handler]' : '[middleware]')\n   *     console.log(\n   *       method,\n   *       ' ',\n   *       path,\n   *       ' '.repeat(Math.max(10 - path.length, 0)),\n   *       name,\n   *       i === c.req.routeIndex ? '<- respond from here' : ''\n   *     )\n   *   })\n   * })\n   * ```\n   */\n  get matchedRoutes() {\n    return this.#matchResult[0].map(([[, route]]) => route);\n  }\n  /**\n   * `routePath()` can retrieve the path registered within the handler\n   *\n   * @deprecated\n   *\n   * Use routePath helper defined in \"hono/route\" instead.\n   *\n   * @see {@link https://hono.dev/docs/api/request#routepath}\n   *\n   * @example\n   * ```ts\n   * app.get('/posts/:id', (c) => {\n   *   return c.json({ path: c.req.routePath })\n   * })\n   * ```\n   */\n  get routePath() {\n    return this.#matchResult[0].map(([[, route]]) => route)[this.routeIndex].path;\n  }\n};\nvar cloneRawRequest = async (req) => {\n  if (!req.raw.bodyUsed) {\n    return req.raw.clone();\n  }\n  const cacheKey = Object.keys(req.bodyCache)[0];\n  if (!cacheKey) {\n    throw new HTTPException(500, {\n      message: \"Cannot clone request: body was already consumed and not cached. Please use HonoRequest methods (e.g., req.json(), req.text()) instead of consuming req.raw directly.\"\n    });\n  }\n  const requestInit = {\n    body: await req[cacheKey](),\n    cache: req.raw.cache,\n    credentials: req.raw.credentials,\n    headers: req.header(),\n    integrity: req.raw.integrity,\n    keepalive: req.raw.keepalive,\n    method: req.method,\n    mode: req.raw.mode,\n    redirect: req.raw.redirect,\n    referrer: req.raw.referrer,\n    referrerPolicy: req.raw.referrerPolicy,\n    signal: req.raw.signal\n  };\n  return new Request(req.url, requestInit);\n};\nexport {\n  HonoRequest,\n  cloneRawRequest\n};\n", "// src/utils/html.ts\nvar HtmlEscapedCallbackPhase = {\n  Stringify: 1,\n  BeforeStream: 2,\n  Stream: 3\n};\nvar raw = (value, callbacks) => {\n  const escapedString = new String(value);\n  escapedString.isEscaped = true;\n  escapedString.callbacks = callbacks;\n  return escapedString;\n};\nvar escapeRe = /[&<>'\"]/;\nvar stringBufferToString = async (buffer, callbacks) => {\n  let str = \"\";\n  callbacks ||= [];\n  const resolvedBuffer = await Promise.all(buffer);\n  for (let i = resolvedBuffer.length - 1; ; i--) {\n    str += resolvedBuffer[i];\n    i--;\n    if (i < 0) {\n      break;\n    }\n    let r = resolvedBuffer[i];\n    if (typeof r === \"object\") {\n      callbacks.push(...r.callbacks || []);\n    }\n    const isEscaped = r.isEscaped;\n    r = await (typeof r === \"object\" ? r.toString() : r);\n    if (typeof r === \"object\") {\n      callbacks.push(...r.callbacks || []);\n    }\n    if (r.isEscaped ?? isEscaped) {\n      str += r;\n    } else {\n      const buf = [str];\n      escapeToBuffer(r, buf);\n      str = buf[0];\n    }\n  }\n  return raw(str, callbacks);\n};\nvar escapeToBuffer = (str, buffer) => {\n  const match = str.search(escapeRe);\n  if (match === -1) {\n    buffer[0] += str;\n    return;\n  }\n  let escape;\n  let index;\n  let lastIndex = 0;\n  for (index = match; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34:\n        escape = \"&quot;\";\n        break;\n      case 39:\n        escape = \"&#39;\";\n        break;\n      case 38:\n        escape = \"&amp;\";\n        break;\n      case 60:\n        escape = \"&lt;\";\n        break;\n      case 62:\n        escape = \"&gt;\";\n        break;\n      default:\n        continue;\n    }\n    buffer[0] += str.substring(lastIndex, index) + escape;\n    lastIndex = index + 1;\n  }\n  buffer[0] += str.substring(lastIndex, index);\n};\nvar resolveCallbackSync = (str) => {\n  const callbacks = str.callbacks;\n  if (!callbacks?.length) {\n    return str;\n  }\n  const buffer = [str];\n  const context = {};\n  callbacks.forEach((c) => c({ phase: HtmlEscapedCallbackPhase.Stringify, buffer, context }));\n  return buffer[0];\n};\nvar resolveCallback = async (str, phase, preserveCallbacks, context, buffer) => {\n  if (typeof str === \"object\" && !(str instanceof String)) {\n    if (!(str instanceof Promise)) {\n      str = str.toString();\n    }\n    if (str instanceof Promise) {\n      str = await str;\n    }\n  }\n  const callbacks = str.callbacks;\n  if (!callbacks?.length) {\n    return Promise.resolve(str);\n  }\n  if (buffer) {\n    buffer[0] += str;\n  } else {\n    buffer = [str];\n  }\n  const resStr = Promise.all(callbacks.map((c) => c({ phase, buffer, context }))).then(\n    (res) => Promise.all(\n      res.filter(Boolean).map((str2) => resolveCallback(str2, phase, false, context, buffer))\n    ).then(() => buffer[0])\n  );\n  if (preserveCallbacks) {\n    return raw(await resStr, callbacks);\n  } else {\n    return resStr;\n  }\n};\nexport {\n  HtmlEscapedCallbackPhase,\n  escapeToBuffer,\n  raw,\n  resolveCallback,\n  resolveCallbackSync,\n  stringBufferToString\n};\n", "// src/context.ts\nimport { HonoRequest } from \"./request.js\";\nimport { HtmlEscapedCallbackPhase, resolveCallback } from \"./utils/html.js\";\nvar TEXT_PLAIN = \"text/plain; charset=UTF-8\";\nvar setDefaultContentType = (contentType, headers) => {\n  return {\n    \"Content-Type\": contentType,\n    ...headers\n  };\n};\nvar Context = class {\n  #rawRequest;\n  #req;\n  /**\n   * `.env` can get bindings (environment variables, secrets, KV namespaces, D1 database, R2 bucket etc.) in Cloudflare Workers.\n   *\n   * @see {@link https://hono.dev/docs/api/context#env}\n   *\n   * @example\n   * ```ts\n   * // Environment object for Cloudflare Workers\n   * app.get('*', async c => {\n   *   const counter = c.env.COUNTER\n   * })\n   * ```\n   */\n  env = {};\n  #var;\n  finalized = false;\n  /**\n   * `.error` can get the error object from the middleware if the Handler throws an error.\n   *\n   * @see {@link https://hono.dev/docs/api/context#error}\n   *\n   * @example\n   * ```ts\n   * app.use('*', async (c, next) => {\n   *   await next()\n   *   if (c.error) {\n   *     // do something...\n   *   }\n   * })\n   * ```\n   */\n  error;\n  #status;\n  #executionCtx;\n  #res;\n  #layout;\n  #renderer;\n  #notFoundHandler;\n  #preparedHeaders;\n  #matchResult;\n  #path;\n  /**\n   * Creates an instance of the Context class.\n   *\n   * @param req - The Request object.\n   * @param options - Optional configuration options for the context.\n   */\n  constructor(req, options) {\n    this.#rawRequest = req;\n    if (options) {\n      this.#executionCtx = options.executionCtx;\n      this.env = options.env;\n      this.#notFoundHandler = options.notFoundHandler;\n      this.#path = options.path;\n      this.#matchResult = options.matchResult;\n    }\n  }\n  /**\n   * `.req` is the instance of {@link HonoRequest}.\n   */\n  get req() {\n    this.#req ??= new HonoRequest(this.#rawRequest, this.#path, this.#matchResult);\n    return this.#req;\n  }\n  /**\n   * @see {@link https://hono.dev/docs/api/context#event}\n   * The FetchEvent associated with the current request.\n   *\n   * @throws Will throw an error if the context does not have a FetchEvent.\n   */\n  get event() {\n    if (this.#executionCtx && \"respondWith\" in this.#executionCtx) {\n      return this.#executionCtx;\n    } else {\n      throw Error(\"This context has no FetchEvent\");\n    }\n  }\n  /**\n   * @see {@link https://hono.dev/docs/api/context#executionctx}\n   * The ExecutionContext associated with the current request.\n   *\n   * @throws Will throw an error if the context does not have an ExecutionContext.\n   */\n  get executionCtx() {\n    if (this.#executionCtx) {\n      return this.#executionCtx;\n    } else {\n      throw Error(\"This context has no ExecutionContext\");\n    }\n  }\n  /**\n   * @see {@link https://hono.dev/docs/api/context#res}\n   * The Response object for the current request.\n   */\n  get res() {\n    return this.#res ||= new Response(null, {\n      headers: this.#preparedHeaders ??= new Headers()\n    });\n  }\n  /**\n   * Sets the Response object for the current request.\n   *\n   * @param _res - The Response object to set.\n   */\n  set res(_res) {\n    if (this.#res && _res) {\n      _res = new Response(_res.body, _res);\n      for (const [k, v] of this.#res.headers.entries()) {\n        if (k === \"content-type\") {\n          continue;\n        }\n        if (k === \"set-cookie\") {\n          const cookies = this.#res.headers.getSetCookie();\n          _res.headers.delete(\"set-cookie\");\n          for (const cookie of cookies) {\n            _res.headers.append(\"set-cookie\", cookie);\n          }\n        } else {\n          _res.headers.set(k, v);\n        }\n      }\n    }\n    this.#res = _res;\n    this.finalized = true;\n  }\n  /**\n   * `.render()` can create a response within a layout.\n   *\n   * @see {@link https://hono.dev/docs/api/context#render-setrenderer}\n   *\n   * @example\n   * ```ts\n   * app.get('/', (c) => {\n   *   return c.render('Hello!')\n   * })\n   * ```\n   */\n  render = (...args) => {\n    this.#renderer ??= (content) => this.html(content);\n    return this.#renderer(...args);\n  };\n  /**\n   * Sets the layout for the response.\n   *\n   * @param layout - The layout to set.\n   * @returns The layout function.\n   */\n  setLayout = (layout) => this.#layout = layout;\n  /**\n   * Gets the current layout for the response.\n   *\n   * @returns The current layout function.\n   */\n  getLayout = () => this.#layout;\n  /**\n   * `.setRenderer()` can set the layout in the custom middleware.\n   *\n   * @see {@link https://hono.dev/docs/api/context#render-setrenderer}\n   *\n   * @example\n   * ```tsx\n   * app.use('*', async (c, next) => {\n   *   c.setRenderer((content) => {\n   *     return c.html(\n   *       <html>\n   *         <body>\n   *           <p>{content}</p>\n   *         </body>\n   *       </html>\n   *     )\n   *   })\n   *   await next()\n   * })\n   * ```\n   */\n  setRenderer = (renderer) => {\n    this.#renderer = renderer;\n  };\n  /**\n   * `.header()` can set headers.\n   *\n   * @see {@link https://hono.dev/docs/api/context#header}\n   *\n   * @example\n   * ```ts\n   * app.get('/welcome', (c) => {\n   *   // Set headers\n   *   c.header('X-Message', 'Hello!')\n   *   c.header('Content-Type', 'text/plain')\n   *\n   *   return c.body('Thank you for coming')\n   * })\n   * ```\n   */\n  header = (name, value, options) => {\n    if (this.finalized) {\n      this.#res = new Response(this.#res.body, this.#res);\n    }\n    const headers = this.#res ? this.#res.headers : this.#preparedHeaders ??= new Headers();\n    if (value === void 0) {\n      headers.delete(name);\n    } else if (options?.append) {\n      headers.append(name, value);\n    } else {\n      headers.set(name, value);\n    }\n  };\n  status = (status) => {\n    this.#status = status;\n  };\n  /**\n   * `.set()` can set the value specified by the key.\n   *\n   * @see {@link https://hono.dev/docs/api/context#set-get}\n   *\n   * @example\n   * ```ts\n   * app.use('*', async (c, next) => {\n   *   c.set('message', 'Hono is hot!!')\n   *   await next()\n   * })\n   * ```\n   */\n  set = (key, value) => {\n    this.#var ??= /* @__PURE__ */ new Map();\n    this.#var.set(key, value);\n  };\n  /**\n   * `.get()` can use the value specified by the key.\n   *\n   * @see {@link https://hono.dev/docs/api/context#set-get}\n   *\n   * @example\n   * ```ts\n   * app.get('/', (c) => {\n   *   const message = c.get('message')\n   *   return c.text(`The message is \"${message}\"`)\n   * })\n   * ```\n   */\n  get = (key) => {\n    return this.#var ? this.#var.get(key) : void 0;\n  };\n  /**\n   * `.var` can access the value of a variable.\n   *\n   * @see {@link https://hono.dev/docs/api/context#var}\n   *\n   * @example\n   * ```ts\n   * const result = c.var.client.oneMethod()\n   * ```\n   */\n  // c.var.propName is a read-only\n  get var() {\n    if (!this.#var) {\n      return {};\n    }\n    return Object.fromEntries(this.#var);\n  }\n  #newResponse(data, arg, headers) {\n    const responseHeaders = this.#res ? new Headers(this.#res.headers) : this.#preparedHeaders ?? new Headers();\n    if (typeof arg === \"object\" && \"headers\" in arg) {\n      const argHeaders = arg.headers instanceof Headers ? arg.headers : new Headers(arg.headers);\n      for (const [key, value] of argHeaders) {\n        if (key.toLowerCase() === \"set-cookie\") {\n          responseHeaders.append(key, value);\n        } else {\n          responseHeaders.set(key, value);\n        }\n      }\n    }\n    if (headers) {\n      for (const [k, v] of Object.entries(headers)) {\n        if (typeof v === \"string\") {\n          responseHeaders.set(k, v);\n        } else {\n          responseHeaders.delete(k);\n          for (const v2 of v) {\n            responseHeaders.append(k, v2);\n          }\n        }\n      }\n    }\n    const status = typeof arg === \"number\" ? arg : arg?.status ?? this.#status;\n    return new Response(data, { status, headers: responseHeaders });\n  }\n  newResponse = (...args) => this.#newResponse(...args);\n  /**\n   * `.body()` can return the HTTP response.\n   * You can set headers with `.header()` and set HTTP status code with `.status`.\n   * This can also be set in `.text()`, `.json()` and so on.\n   *\n   * @see {@link https://hono.dev/docs/api/context#body}\n   *\n   * @example\n   * ```ts\n   * app.get('/welcome', (c) => {\n   *   // Set headers\n   *   c.header('X-Message', 'Hello!')\n   *   c.header('Content-Type', 'text/plain')\n   *   // Set HTTP status code\n   *   c.status(201)\n   *\n   *   // Return the response body\n   *   return c.body('Thank you for coming')\n   * })\n   * ```\n   */\n  body = (data, arg, headers) => this.#newResponse(data, arg, headers);\n  /**\n   * `.text()` can render text as `Content-Type:text/plain`.\n   *\n   * @see {@link https://hono.dev/docs/api/context#text}\n   *\n   * @example\n   * ```ts\n   * app.get('/say', (c) => {\n   *   return c.text('Hello!')\n   * })\n   * ```\n   */\n  text = (text, arg, headers) => {\n    return !this.#preparedHeaders && !this.#status && !arg && !headers && !this.finalized ? new Response(text) : this.#newResponse(\n      text,\n      arg,\n      setDefaultContentType(TEXT_PLAIN, headers)\n    );\n  };\n  /**\n   * `.json()` can render JSON as `Content-Type:application/json`.\n   *\n   * @see {@link https://hono.dev/docs/api/context#json}\n   *\n   * @example\n   * ```ts\n   * app.get('/api', (c) => {\n   *   return c.json({ message: 'Hello!' })\n   * })\n   * ```\n   */\n  json = (object, arg, headers) => {\n    return this.#newResponse(\n      JSON.stringify(object),\n      arg,\n      setDefaultContentType(\"application/json\", headers)\n    );\n  };\n  html = (html, arg, headers) => {\n    const res = (html2) => this.#newResponse(html2, arg, setDefaultContentType(\"text/html; charset=UTF-8\", headers));\n    return typeof html === \"object\" ? resolveCallback(html, HtmlEscapedCallbackPhase.Stringify, false, {}).then(res) : res(html);\n  };\n  /**\n   * `.redirect()` can Redirect, default status code is 302.\n   *\n   * @see {@link https://hono.dev/docs/api/context#redirect}\n   *\n   * @example\n   * ```ts\n   * app.get('/redirect', (c) => {\n   *   return c.redirect('/')\n   * })\n   * app.get('/redirect-permanently', (c) => {\n   *   return c.redirect('/', 301)\n   * })\n   * ```\n   */\n  redirect = (location, status) => {\n    const locationString = String(location);\n    this.header(\n      \"Location\",\n      // Multibyes should be encoded\n      // eslint-disable-next-line no-control-regex\n      !/[^\\x00-\\xFF]/.test(locationString) ? locationString : encodeURI(locationString)\n    );\n    return this.newResponse(null, status ?? 302);\n  };\n  /**\n   * `.notFound()` can return the Not Found Response.\n   *\n   * @see {@link https://hono.dev/docs/api/context#notfound}\n   *\n   * @example\n   * ```ts\n   * app.get('/notfound', (c) => {\n   *   return c.notFound()\n   * })\n   * ```\n   */\n  notFound = () => {\n    this.#notFoundHandler ??= () => new Response();\n    return this.#notFoundHandler(this);\n  };\n};\nexport {\n  Context,\n  TEXT_PLAIN\n};\n", "// src/router.ts\nvar METHOD_NAME_ALL = \"ALL\";\nvar METHOD_NAME_ALL_LOWERCASE = \"all\";\nvar METHODS = [\"get\", \"post\", \"put\", \"delete\", \"options\", \"patch\"];\nvar MESSAGE_MATCHER_IS_ALREADY_BUILT = \"Can not add a route since the matcher is already built.\";\nvar UnsupportedPathError = class extends Error {\n};\nexport {\n  MESSAGE_MATCHER_IS_ALREADY_BUILT,\n  METHODS,\n  METHOD_NAME_ALL,\n  METHOD_NAME_ALL_LOWERCASE,\n  UnsupportedPathError\n};\n", "// src/utils/constants.ts\nvar COMPOSED_HANDLER = \"__COMPOSED_HANDLER\";\nexport {\n  COMPOSED_HANDLER\n};\n", "// src/hono-base.ts\nimport { compose } from \"./compose.js\";\nimport { Context } from \"./context.js\";\nimport { METHODS, METHOD_NAME_ALL, METHOD_NAME_ALL_LOWERCASE } from \"./router.js\";\nimport { COMPOSED_HANDLER } from \"./utils/constants.js\";\nimport { getPath, getPathNoStrict, mergePath } from \"./utils/url.js\";\nvar notFoundHandler = (c) => {\n  return c.text(\"404 Not Found\", 404);\n};\nvar errorHandler = (err, c) => {\n  if (\"getResponse\" in err) {\n    const res = err.getResponse();\n    return c.newResponse(res.body, res);\n  }\n  console.error(err);\n  return c.text(\"Internal Server Error\", 500);\n};\nvar Hono = class _Hono {\n  get;\n  post;\n  put;\n  delete;\n  options;\n  patch;\n  all;\n  on;\n  use;\n  /*\n    This class is like an abstract class and does not have a router.\n    To use it, inherit the class and implement router in the constructor.\n  */\n  router;\n  getPath;\n  // Cannot use `#` because it requires visibility at JavaScript runtime.\n  _basePath = \"/\";\n  #path = \"/\";\n  routes = [];\n  constructor(options = {}) {\n    const allMethods = [...METHODS, METHOD_NAME_ALL_LOWERCASE];\n    allMethods.forEach((method) => {\n      this[method] = (args1, ...args) => {\n        if (typeof args1 === \"string\") {\n          this.#path = args1;\n        } else {\n          this.#addRoute(method, this.#path, args1);\n        }\n        args.forEach((handler) => {\n          this.#addRoute(method, this.#path, handler);\n        });\n        return this;\n      };\n    });\n    this.on = (method, path, ...handlers) => {\n      for (const p of [path].flat()) {\n        this.#path = p;\n        for (const m of [method].flat()) {\n          handlers.map((handler) => {\n            this.#addRoute(m.toUpperCase(), this.#path, handler);\n          });\n        }\n      }\n      return this;\n    };\n    this.use = (arg1, ...handlers) => {\n      if (typeof arg1 === \"string\") {\n        this.#path = arg1;\n      } else {\n        this.#path = \"*\";\n        handlers.unshift(arg1);\n      }\n      handlers.forEach((handler) => {\n        this.#addRoute(METHOD_NAME_ALL, this.#path, handler);\n      });\n      return this;\n    };\n    const { strict, ...optionsWithoutStrict } = options;\n    Object.assign(this, optionsWithoutStrict);\n    this.getPath = strict ?? true ? options.getPath ?? getPath : getPathNoStrict;\n  }\n  #clone() {\n    const clone = new _Hono({\n      router: this.router,\n      getPath: this.getPath\n    });\n    clone.errorHandler = this.errorHandler;\n    clone.#notFoundHandler = this.#notFoundHandler;\n    clone.routes = this.routes;\n    return clone;\n  }\n  #notFoundHandler = notFoundHandler;\n  // Cannot use `#` because it requires visibility at JavaScript runtime.\n  errorHandler = errorHandler;\n  /**\n   * `.route()` allows grouping other Hono instance in routes.\n   *\n   * @see {@link https://hono.dev/docs/api/routing#grouping}\n   *\n   * @param {string} path - base Path\n   * @param {Hono} app - other Hono instance\n   * @returns {Hono} routed Hono instance\n   *\n   * @example\n   * ```ts\n   * const app = new Hono()\n   * const app2 = new Hono()\n   *\n   * app2.get(\"/user\", (c) => c.text(\"user\"))\n   * app.route(\"/api\", app2) // GET /api/user\n   * ```\n   */\n  route(path, app) {\n    const subApp = this.basePath(path);\n    app.routes.map((r) => {\n      let handler;\n      if (app.errorHandler === errorHandler) {\n        handler = r.handler;\n      } else {\n        handler = async (c, next) => (await compose([], app.errorHandler)(c, () => r.handler(c, next))).res;\n        handler[COMPOSED_HANDLER] = r.handler;\n      }\n      subApp.#addRoute(r.method, r.path, handler);\n    });\n    return this;\n  }\n  /**\n   * `.basePath()` allows base paths to be specified.\n   *\n   * @see {@link https://hono.dev/docs/api/routing#base-path}\n   *\n   * @param {string} path - base Path\n   * @returns {Hono} changed Hono instance\n   *\n   * @example\n   * ```ts\n   * const api = new Hono().basePath('/api')\n   * ```\n   */\n  basePath(path) {\n    const subApp = this.#clone();\n    subApp._basePath = mergePath(this._basePath, path);\n    return subApp;\n  }\n  /**\n   * `.onError()` handles an error and returns a customized Response.\n   *\n   * @see {@link https://hono.dev/docs/api/hono#error-handling}\n   *\n   * @param {ErrorHandler} handler - request Handler for error\n   * @returns {Hono} changed Hono instance\n   *\n   * @example\n   * ```ts\n   * app.onError((err, c) => {\n   *   console.error(`${err}`)\n   *   return c.text('Custom Error Message', 500)\n   * })\n   * ```\n   */\n  onError = (handler) => {\n    this.errorHandler = handler;\n    return this;\n  };\n  /**\n   * `.notFound()` allows you to customize a Not Found Response.\n   *\n   * @see {@link https://hono.dev/docs/api/hono#not-found}\n   *\n   * @param {NotFoundHandler} handler - request handler for not-found\n   * @returns {Hono} changed Hono instance\n   *\n   * @example\n   * ```ts\n   * app.notFound((c) => {\n   *   return c.text('Custom 404 Message', 404)\n   * })\n   * ```\n   */\n  notFound = (handler) => {\n    this.#notFoundHandler = handler;\n    return this;\n  };\n  /**\n   * `.mount()` allows you to mount applications built with other frameworks into your Hono application.\n   *\n   * @see {@link https://hono.dev/docs/api/hono#mount}\n   *\n   * @param {string} path - base Path\n   * @param {Function} applicationHandler - other Request Handler\n   * @param {MountOptions} [options] - options of `.mount()`\n   * @returns {Hono} mounted Hono instance\n   *\n   * @example\n   * ```ts\n   * import { Router as IttyRouter } from 'itty-router'\n   * import { Hono } from 'hono'\n   * // Create itty-router application\n   * const ittyRouter = IttyRouter()\n   * // GET /itty-router/hello\n   * ittyRouter.get('/hello', () => new Response('Hello from itty-router'))\n   *\n   * const app = new Hono()\n   * app.mount('/itty-router', ittyRouter.handle)\n   * ```\n   *\n   * @example\n   * ```ts\n   * const app = new Hono()\n   * // Send the request to another application without modification.\n   * app.mount('/app', anotherApp, {\n   *   replaceRequest: (req) => req,\n   * })\n   * ```\n   */\n  mount(path, applicationHandler, options) {\n    let replaceRequest;\n    let optionHandler;\n    if (options) {\n      if (typeof options === \"function\") {\n        optionHandler = options;\n      } else {\n        optionHandler = options.optionHandler;\n        if (options.replaceRequest === false) {\n          replaceRequest = (request) => request;\n        } else {\n          replaceRequest = options.replaceRequest;\n        }\n      }\n    }\n    const getOptions = optionHandler ? (c) => {\n      const options2 = optionHandler(c);\n      return Array.isArray(options2) ? options2 : [options2];\n    } : (c) => {\n      let executionContext = void 0;\n      try {\n        executionContext = c.executionCtx;\n      } catch {\n      }\n      return [c.env, executionContext];\n    };\n    replaceRequest ||= (() => {\n      const mergedPath = mergePath(this._basePath, path);\n      const pathPrefixLength = mergedPath === \"/\" ? 0 : mergedPath.length;\n      return (request) => {\n        const url = new URL(request.url);\n        url.pathname = url.pathname.slice(pathPrefixLength) || \"/\";\n        return new Request(url, request);\n      };\n    })();\n    const handler = async (c, next) => {\n      const res = await applicationHandler(replaceRequest(c.req.raw), ...getOptions(c));\n      if (res) {\n        return res;\n      }\n      await next();\n    };\n    this.#addRoute(METHOD_NAME_ALL, mergePath(path, \"*\"), handler);\n    return this;\n  }\n  #addRoute(method, path, handler) {\n    method = method.toUpperCase();\n    path = mergePath(this._basePath, path);\n    const r = { basePath: this._basePath, path, method, handler };\n    this.router.add(method, path, [handler, r]);\n    this.routes.push(r);\n  }\n  #handleError(err, c) {\n    if (err instanceof Error) {\n      return this.errorHandler(err, c);\n    }\n    throw err;\n  }\n  #dispatch(request, executionCtx, env, method) {\n    if (method === \"HEAD\") {\n      return (async () => new Response(null, await this.#dispatch(request, executionCtx, env, \"GET\")))();\n    }\n    const path = this.getPath(request, { env });\n    const matchResult = this.router.match(method, path);\n    const c = new Context(request, {\n      path,\n      matchResult,\n      env,\n      executionCtx,\n      notFoundHandler: this.#notFoundHandler\n    });\n    if (matchResult[0].length === 1) {\n      let res;\n      try {\n        res = matchResult[0][0][0][0](c, async () => {\n          c.res = await this.#notFoundHandler(c);\n        });\n      } catch (err) {\n        return this.#handleError(err, c);\n      }\n      return res instanceof Promise ? res.then(\n        (resolved) => resolved || (c.finalized ? c.res : this.#notFoundHandler(c))\n      ).catch((err) => this.#handleError(err, c)) : res ?? this.#notFoundHandler(c);\n    }\n    const composed = compose(matchResult[0], this.errorHandler, this.#notFoundHandler);\n    return (async () => {\n      try {\n        const context = await composed(c);\n        if (!context.finalized) {\n          throw new Error(\n            \"Context is not finalized. Did you forget to return a Response object or `await next()`?\"\n          );\n        }\n        return context.res;\n      } catch (err) {\n        return this.#handleError(err, c);\n      }\n    })();\n  }\n  /**\n   * `.fetch()` will be entry point of your app.\n   *\n   * @see {@link https://hono.dev/docs/api/hono#fetch}\n   *\n   * @param {Request} request - request Object of request\n   * @param {Env} Env - env Object\n   * @param {ExecutionContext} - context of execution\n   * @returns {Response | Promise<Response>} response of request\n   *\n   */\n  fetch = (request, ...rest) => {\n    return this.#dispatch(request, rest[1], rest[0], request.method);\n  };\n  /**\n   * `.request()` is a useful method for testing.\n   * You can pass a URL or pathname to send a GET request.\n   * app will return a Response object.\n   * ```ts\n   * test('GET /hello is ok', async () => {\n   *   const res = await app.request('/hello')\n   *   expect(res.status).toBe(200)\n   * })\n   * ```\n   * @see https://hono.dev/docs/api/hono#request\n   */\n  request = (input, requestInit, Env, executionCtx) => {\n    if (input instanceof Request) {\n      return this.fetch(requestInit ? new Request(input, requestInit) : input, Env, executionCtx);\n    }\n    input = input.toString();\n    return this.fetch(\n      new Request(\n        /^https?:\\/\\//.test(input) ? input : `http://localhost${mergePath(\"/\", input)}`,\n        requestInit\n      ),\n      Env,\n      executionCtx\n    );\n  };\n  /**\n   * `.fire()` automatically adds a global fetch event listener.\n   * This can be useful for environments that adhere to the Service Worker API, such as non-ES module Cloudflare Workers.\n   * @deprecated\n   * Use `fire` from `hono/service-worker` instead.\n   * ```ts\n   * import { Hono } from 'hono'\n   * import { fire } from 'hono/service-worker'\n   *\n   * const app = new Hono()\n   * // ...\n   * fire(app)\n   * ```\n   * @see https://hono.dev/docs/api/hono#fire\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API\n   * @see https://developers.cloudflare.com/workers/reference/migrate-to-module-workers/\n   */\n  fire = () => {\n    addEventListener(\"fetch\", (event) => {\n      event.respondWith(this.#dispatch(event.request, event, void 0, event.request.method));\n    });\n  };\n};\nexport {\n  Hono as HonoBase\n};\n", "// src/router/reg-exp-router/matcher.ts\nimport { METHOD_NAME_ALL } from \"../../router.js\";\nvar emptyParam = [];\nfunction match(method, path) {\n  const matchers = this.buildAllMatchers();\n  const match2 = ((method2, path2) => {\n    const matcher = matchers[method2] || matchers[METHOD_NAME_ALL];\n    const staticMatch = matcher[2][path2];\n    if (staticMatch) {\n      return staticMatch;\n    }\n    const match3 = path2.match(matcher[0]);\n    if (!match3) {\n      return [[], emptyParam];\n    }\n    const index = match3.indexOf(\"\", 1);\n    return [matcher[1][index], match3];\n  });\n  this.match = match2;\n  return match2(method, path);\n}\nexport {\n  emptyParam,\n  match\n};\n", "// src/router/reg-exp-router/node.ts\nvar LABEL_REG_EXP_STR = \"[^/]+\";\nvar ONLY_WILDCARD_REG_EXP_STR = \".*\";\nvar TAIL_WILDCARD_REG_EXP_STR = \"(?:|/.*)\";\nvar PATH_ERROR = /* @__PURE__ */ Symbol();\nvar regExpMetaChars = new Set(\".\\\\+*[^]$()\");\nfunction compareKey(a, b) {\n  if (a.length === 1) {\n    return b.length === 1 ? a < b ? -1 : 1 : -1;\n  }\n  if (b.length === 1) {\n    return 1;\n  }\n  if (a === ONLY_WILDCARD_REG_EXP_STR || a === TAIL_WILDCARD_REG_EXP_STR) {\n    return 1;\n  } else if (b === ONLY_WILDCARD_REG_EXP_STR || b === TAIL_WILDCARD_REG_EXP_STR) {\n    return -1;\n  }\n  if (a === LABEL_REG_EXP_STR) {\n    return 1;\n  } else if (b === LABEL_REG_EXP_STR) {\n    return -1;\n  }\n  return a.length === b.length ? a < b ? -1 : 1 : b.length - a.length;\n}\nvar Node = class _Node {\n  #index;\n  #varIndex;\n  #children = /* @__PURE__ */ Object.create(null);\n  insert(tokens, index, paramMap, context, pathErrorCheckOnly) {\n    if (tokens.length === 0) {\n      if (this.#index !== void 0) {\n        throw PATH_ERROR;\n      }\n      if (pathErrorCheckOnly) {\n        return;\n      }\n      this.#index = index;\n      return;\n    }\n    const [token, ...restTokens] = tokens;\n    const pattern = token === \"*\" ? restTokens.length === 0 ? [\"\", \"\", ONLY_WILDCARD_REG_EXP_STR] : [\"\", \"\", LABEL_REG_EXP_STR] : token === \"/*\" ? [\"\", \"\", TAIL_WILDCARD_REG_EXP_STR] : token.match(/^\\:([^\\{\\}]+)(?:\\{(.+)\\})?$/);\n    let node;\n    if (pattern) {\n      const name = pattern[1];\n      let regexpStr = pattern[2] || LABEL_REG_EXP_STR;\n      if (name && pattern[2]) {\n        if (regexpStr === \".*\") {\n          throw PATH_ERROR;\n        }\n        regexpStr = regexpStr.replace(/^\\((?!\\?:)(?=[^)]+\\)$)/, \"(?:\");\n        if (/\\((?!\\?:)/.test(regexpStr)) {\n          throw PATH_ERROR;\n        }\n      }\n      node = this.#children[regexpStr];\n      if (!node) {\n        if (Object.keys(this.#children).some(\n          (k) => k !== ONLY_WILDCARD_REG_EXP_STR && k !== TAIL_WILDCARD_REG_EXP_STR\n        )) {\n          throw PATH_ERROR;\n        }\n        if (pathErrorCheckOnly) {\n          return;\n        }\n        node = this.#children[regexpStr] = new _Node();\n        if (name !== \"\") {\n          node.#varIndex = context.varIndex++;\n        }\n      }\n      if (!pathErrorCheckOnly && name !== \"\") {\n        paramMap.push([name, node.#varIndex]);\n      }\n    } else {\n      node = this.#children[token];\n      if (!node) {\n        if (Object.keys(this.#children).some(\n          (k) => k.length > 1 && k !== ONLY_WILDCARD_REG_EXP_STR && k !== TAIL_WILDCARD_REG_EXP_STR\n        )) {\n          throw PATH_ERROR;\n        }\n        if (pathErrorCheckOnly) {\n          return;\n        }\n        node = this.#children[token] = new _Node();\n      }\n    }\n    node.insert(restTokens, index, paramMap, context, pathErrorCheckOnly);\n  }\n  buildRegExpStr() {\n    const childKeys = Object.keys(this.#children).sort(compareKey);\n    const strList = childKeys.map((k) => {\n      const c = this.#children[k];\n      return (typeof c.#varIndex === \"number\" ? `(${k})@${c.#varIndex}` : regExpMetaChars.has(k) ? `\\\\${k}` : k) + c.buildRegExpStr();\n    });\n    if (typeof this.#index === \"number\") {\n      strList.unshift(`#${this.#index}`);\n    }\n    if (strList.length === 0) {\n      return \"\";\n    }\n    if (strList.length === 1) {\n      return strList[0];\n    }\n    return \"(?:\" + strList.join(\"|\") + \")\";\n  }\n};\nexport {\n  Node,\n  PATH_ERROR\n};\n", "// src/router/reg-exp-router/trie.ts\nimport { Node } from \"./node.js\";\nvar Trie = class {\n  #context = { varIndex: 0 };\n  #root = new Node();\n  insert(path, index, pathErrorCheckOnly) {\n    const paramAssoc = [];\n    const groups = [];\n    for (let i = 0; ; ) {\n      let replaced = false;\n      path = path.replace(/\\{[^}]+\\}/g, (m) => {\n        const mark = `@\\\\${i}`;\n        groups[i] = [mark, m];\n        i++;\n        replaced = true;\n        return mark;\n      });\n      if (!replaced) {\n        break;\n      }\n    }\n    const tokens = path.match(/(?::[^\\/]+)|(?:\\/\\*$)|./g) || [];\n    for (let i = groups.length - 1; i >= 0; i--) {\n      const [mark] = groups[i];\n      for (let j = tokens.length - 1; j >= 0; j--) {\n        if (tokens[j].indexOf(mark) !== -1) {\n          tokens[j] = tokens[j].replace(mark, groups[i][1]);\n          break;\n        }\n      }\n    }\n    this.#root.insert(tokens, index, paramAssoc, this.#context, pathErrorCheckOnly);\n    return paramAssoc;\n  }\n  buildRegExp() {\n    let regexp = this.#root.buildRegExpStr();\n    if (regexp === \"\") {\n      return [/^$/, [], []];\n    }\n    let captureIndex = 0;\n    const indexReplacementMap = [];\n    const paramReplacementMap = [];\n    regexp = regexp.replace(/#(\\d+)|@(\\d+)|\\.\\*\\$/g, (_, handlerIndex, paramIndex) => {\n      if (handlerIndex !== void 0) {\n        indexReplacementMap[++captureIndex] = Number(handlerIndex);\n        return \"$()\";\n      }\n      if (paramIndex !== void 0) {\n        paramReplacementMap[Number(paramIndex)] = ++captureIndex;\n        return \"\";\n      }\n      return \"\";\n    });\n    return [new RegExp(`^${regexp}`), indexReplacementMap, paramReplacementMap];\n  }\n};\nexport {\n  Trie\n};\n", "// src/router/reg-exp-router/router.ts\nimport {\n  MESSAGE_MATCHER_IS_ALREADY_BUILT,\n  METHOD_NAME_ALL,\n  UnsupportedPathError\n} from \"../../router.js\";\nimport { checkOptionalParameter } from \"../../utils/url.js\";\nimport { match, emptyParam } from \"./matcher.js\";\nimport { PATH_ERROR } from \"./node.js\";\nimport { Trie } from \"./trie.js\";\nvar nullMatcher = [/^$/, [], /* @__PURE__ */ Object.create(null)];\nvar wildcardRegExpCache = /* @__PURE__ */ Object.create(null);\nfunction buildWildcardRegExp(path) {\n  return wildcardRegExpCache[path] ??= new RegExp(\n    path === \"*\" ? \"\" : `^${path.replace(\n      /\\/\\*$|([.\\\\+*[^\\]$()])/g,\n      (_, metaChar) => metaChar ? `\\\\${metaChar}` : \"(?:|/.*)\"\n    )}$`\n  );\n}\nfunction clearWildcardRegExpCache() {\n  wildcardRegExpCache = /* @__PURE__ */ Object.create(null);\n}\nfunction buildMatcherFromPreprocessedRoutes(routes) {\n  const trie = new Trie();\n  const handlerData = [];\n  if (routes.length === 0) {\n    return nullMatcher;\n  }\n  const routesWithStaticPathFlag = routes.map(\n    (route) => [!/\\*|\\/:/.test(route[0]), ...route]\n  ).sort(\n    ([isStaticA, pathA], [isStaticB, pathB]) => isStaticA ? 1 : isStaticB ? -1 : pathA.length - pathB.length\n  );\n  const staticMap = /* @__PURE__ */ Object.create(null);\n  for (let i = 0, j = -1, len = routesWithStaticPathFlag.length; i < len; i++) {\n    const [pathErrorCheckOnly, path, handlers] = routesWithStaticPathFlag[i];\n    if (pathErrorCheckOnly) {\n      staticMap[path] = [handlers.map(([h]) => [h, /* @__PURE__ */ Object.create(null)]), emptyParam];\n    } else {\n      j++;\n    }\n    let paramAssoc;\n    try {\n      paramAssoc = trie.insert(path, j, pathErrorCheckOnly);\n    } catch (e) {\n      throw e === PATH_ERROR ? new UnsupportedPathError(path) : e;\n    }\n    if (pathErrorCheckOnly) {\n      continue;\n    }\n    handlerData[j] = handlers.map(([h, paramCount]) => {\n      const paramIndexMap = /* @__PURE__ */ Object.create(null);\n      paramCount -= 1;\n      for (; paramCount >= 0; paramCount--) {\n        const [key, value] = paramAssoc[paramCount];\n        paramIndexMap[key] = value;\n      }\n      return [h, paramIndexMap];\n    });\n  }\n  const [regexp, indexReplacementMap, paramReplacementMap] = trie.buildRegExp();\n  for (let i = 0, len = handlerData.length; i < len; i++) {\n    for (let j = 0, len2 = handlerData[i].length; j < len2; j++) {\n      const map = handlerData[i][j]?.[1];\n      if (!map) {\n        continue;\n      }\n      const keys = Object.keys(map);\n      for (let k = 0, len3 = keys.length; k < len3; k++) {\n        map[keys[k]] = paramReplacementMap[map[keys[k]]];\n      }\n    }\n  }\n  const handlerMap = [];\n  for (const i in indexReplacementMap) {\n    handlerMap[i] = handlerData[indexReplacementMap[i]];\n  }\n  return [regexp, handlerMap, staticMap];\n}\nfunction findMiddleware(middleware, path) {\n  if (!middleware) {\n    return void 0;\n  }\n  for (const k of Object.keys(middleware).sort((a, b) => b.length - a.length)) {\n    if (buildWildcardRegExp(k).test(path)) {\n      return [...middleware[k]];\n    }\n  }\n  return void 0;\n}\nvar RegExpRouter = class {\n  name = \"RegExpRouter\";\n  #middleware;\n  #routes;\n  constructor() {\n    this.#middleware = { [METHOD_NAME_ALL]: /* @__PURE__ */ Object.create(null) };\n    this.#routes = { [METHOD_NAME_ALL]: /* @__PURE__ */ Object.create(null) };\n  }\n  add(method, path, handler) {\n    const middleware = this.#middleware;\n    const routes = this.#routes;\n    if (!middleware || !routes) {\n      throw new Error(MESSAGE_MATCHER_IS_ALREADY_BUILT);\n    }\n    if (!middleware[method]) {\n      ;\n      [middleware, routes].forEach((handlerMap) => {\n        handlerMap[method] = /* @__PURE__ */ Object.create(null);\n        Object.keys(handlerMap[METHOD_NAME_ALL]).forEach((p) => {\n          handlerMap[method][p] = [...handlerMap[METHOD_NAME_ALL][p]];\n        });\n      });\n    }\n    if (path === \"/*\") {\n      path = \"*\";\n    }\n    const paramCount = (path.match(/\\/:/g) || []).length;\n    if (/\\*$/.test(path)) {\n      const re = buildWildcardRegExp(path);\n      if (method === METHOD_NAME_ALL) {\n        Object.keys(middleware).forEach((m) => {\n          middleware[m][path] ||= findMiddleware(middleware[m], path) || findMiddleware(middleware[METHOD_NAME_ALL], path) || [];\n        });\n      } else {\n        middleware[method][path] ||= findMiddleware(middleware[method], path) || findMiddleware(middleware[METHOD_NAME_ALL], path) || [];\n      }\n      Object.keys(middleware).forEach((m) => {\n        if (method === METHOD_NAME_ALL || method === m) {\n          Object.keys(middleware[m]).forEach((p) => {\n            re.test(p) && middleware[m][p].push([handler, paramCount]);\n          });\n        }\n      });\n      Object.keys(routes).forEach((m) => {\n        if (method === METHOD_NAME_ALL || method === m) {\n          Object.keys(routes[m]).forEach(\n            (p) => re.test(p) && routes[m][p].push([handler, paramCount])\n          );\n        }\n      });\n      return;\n    }\n    const paths = checkOptionalParameter(path) || [path];\n    for (let i = 0, len = paths.length; i < len; i++) {\n      const path2 = paths[i];\n      Object.keys(routes).forEach((m) => {\n        if (method === METHOD_NAME_ALL || method === m) {\n          routes[m][path2] ||= [\n            ...findMiddleware(middleware[m], path2) || findMiddleware(middleware[METHOD_NAME_ALL], path2) || []\n          ];\n          routes[m][path2].push([handler, paramCount - len + i + 1]);\n        }\n      });\n    }\n  }\n  match = match;\n  buildAllMatchers() {\n    const matchers = /* @__PURE__ */ Object.create(null);\n    Object.keys(this.#routes).concat(Object.keys(this.#middleware)).forEach((method) => {\n      matchers[method] ||= this.#buildMatcher(method);\n    });\n    this.#middleware = this.#routes = void 0;\n    clearWildcardRegExpCache();\n    return matchers;\n  }\n  #buildMatcher(method) {\n    const routes = [];\n    let hasOwnRoute = method === METHOD_NAME_ALL;\n    [this.#middleware, this.#routes].forEach((r) => {\n      const ownRoute = r[method] ? Object.keys(r[method]).map((path) => [path, r[method][path]]) : [];\n      if (ownRoute.length !== 0) {\n        hasOwnRoute ||= true;\n        routes.push(...ownRoute);\n      } else if (method !== METHOD_NAME_ALL) {\n        routes.push(\n          ...Object.keys(r[METHOD_NAME_ALL]).map((path) => [path, r[METHOD_NAME_ALL][path]])\n        );\n      }\n    });\n    if (!hasOwnRoute) {\n      return null;\n    } else {\n      return buildMatcherFromPreprocessedRoutes(routes);\n    }\n  }\n};\nexport {\n  RegExpRouter\n};\n", "// src/router/smart-router/router.ts\nimport { MESSAGE_MATCHER_IS_ALREADY_BUILT, UnsupportedPathError } from \"../../router.js\";\nvar SmartRouter = class {\n  name = \"SmartRouter\";\n  #routers = [];\n  #routes = [];\n  constructor(init) {\n    this.#routers = init.routers;\n  }\n  add(method, path, handler) {\n    if (!this.#routes) {\n      throw new Error(MESSAGE_MATCHER_IS_ALREADY_BUILT);\n    }\n    this.#routes.push([method, path, handler]);\n  }\n  match(method, path) {\n    if (!this.#routes) {\n      throw new Error(\"Fatal error\");\n    }\n    const routers = this.#routers;\n    const routes = this.#routes;\n    const len = routers.length;\n    let i = 0;\n    let res;\n    for (; i < len; i++) {\n      const router = routers[i];\n      try {\n        for (let i2 = 0, len2 = routes.length; i2 < len2; i2++) {\n          router.add(...routes[i2]);\n        }\n        res = router.match(method, path);\n      } catch (e) {\n        if (e instanceof UnsupportedPathError) {\n          continue;\n        }\n        throw e;\n      }\n      this.match = router.match.bind(router);\n      this.#routers = [router];\n      this.#routes = void 0;\n      break;\n    }\n    if (i === len) {\n      throw new Error(\"Fatal error\");\n    }\n    this.name = `SmartRouter + ${this.activeRouter.name}`;\n    return res;\n  }\n  get activeRouter() {\n    if (this.#routes || this.#routers.length !== 1) {\n      throw new Error(\"No active router has been determined yet.\");\n    }\n    return this.#routers[0];\n  }\n};\nexport {\n  SmartRouter\n};\n", "// src/router/trie-router/node.ts\nimport { METHOD_NAME_ALL } from \"../../router.js\";\nimport { getPattern, splitPath, splitRoutingPath } from \"../../utils/url.js\";\nvar emptyParams = /* @__PURE__ */ Object.create(null);\nvar Node = class _Node {\n  #methods;\n  #children;\n  #patterns;\n  #order = 0;\n  #params = emptyParams;\n  constructor(method, handler, children) {\n    this.#children = children || /* @__PURE__ */ Object.create(null);\n    this.#methods = [];\n    if (method && handler) {\n      const m = /* @__PURE__ */ Object.create(null);\n      m[method] = { handler, possibleKeys: [], score: 0 };\n      this.#methods = [m];\n    }\n    this.#patterns = [];\n  }\n  insert(method, path, handler) {\n    this.#order = ++this.#order;\n    let curNode = this;\n    const parts = splitRoutingPath(path);\n    const possibleKeys = [];\n    for (let i = 0, len = parts.length; i < len; i++) {\n      const p = parts[i];\n      const nextP = parts[i + 1];\n      const pattern = getPattern(p, nextP);\n      const key = Array.isArray(pattern) ? pattern[0] : p;\n      if (key in curNode.#children) {\n        curNode = curNode.#children[key];\n        if (pattern) {\n          possibleKeys.push(pattern[1]);\n        }\n        continue;\n      }\n      curNode.#children[key] = new _Node();\n      if (pattern) {\n        curNode.#patterns.push(pattern);\n        possibleKeys.push(pattern[1]);\n      }\n      curNode = curNode.#children[key];\n    }\n    curNode.#methods.push({\n      [method]: {\n        handler,\n        possibleKeys: possibleKeys.filter((v, i, a) => a.indexOf(v) === i),\n        score: this.#order\n      }\n    });\n    return curNode;\n  }\n  #getHandlerSets(node, method, nodeParams, params) {\n    const handlerSets = [];\n    for (let i = 0, len = node.#methods.length; i < len; i++) {\n      const m = node.#methods[i];\n      const handlerSet = m[method] || m[METHOD_NAME_ALL];\n      const processedSet = {};\n      if (handlerSet !== void 0) {\n        handlerSet.params = /* @__PURE__ */ Object.create(null);\n        handlerSets.push(handlerSet);\n        if (nodeParams !== emptyParams || params && params !== emptyParams) {\n          for (let i2 = 0, len2 = handlerSet.possibleKeys.length; i2 < len2; i2++) {\n            const key = handlerSet.possibleKeys[i2];\n            const processed = processedSet[handlerSet.score];\n            handlerSet.params[key] = params?.[key] && !processed ? params[key] : nodeParams[key] ?? params?.[key];\n            processedSet[handlerSet.score] = true;\n          }\n        }\n      }\n    }\n    return handlerSets;\n  }\n  search(method, path) {\n    const handlerSets = [];\n    this.#params = emptyParams;\n    const curNode = this;\n    let curNodes = [curNode];\n    const parts = splitPath(path);\n    const curNodesQueue = [];\n    for (let i = 0, len = parts.length; i < len; i++) {\n      const part = parts[i];\n      const isLast = i === len - 1;\n      const tempNodes = [];\n      for (let j = 0, len2 = curNodes.length; j < len2; j++) {\n        const node = curNodes[j];\n        const nextNode = node.#children[part];\n        if (nextNode) {\n          nextNode.#params = node.#params;\n          if (isLast) {\n            if (nextNode.#children[\"*\"]) {\n              handlerSets.push(\n                ...this.#getHandlerSets(nextNode.#children[\"*\"], method, node.#params)\n              );\n            }\n            handlerSets.push(...this.#getHandlerSets(nextNode, method, node.#params));\n          } else {\n            tempNodes.push(nextNode);\n          }\n        }\n        for (let k = 0, len3 = node.#patterns.length; k < len3; k++) {\n          const pattern = node.#patterns[k];\n          const params = node.#params === emptyParams ? {} : { ...node.#params };\n          if (pattern === \"*\") {\n            const astNode = node.#children[\"*\"];\n            if (astNode) {\n              handlerSets.push(...this.#getHandlerSets(astNode, method, node.#params));\n              astNode.#params = params;\n              tempNodes.push(astNode);\n            }\n            continue;\n          }\n          const [key, name, matcher] = pattern;\n          if (!part && !(matcher instanceof RegExp)) {\n            continue;\n          }\n          const child = node.#children[key];\n          const restPathString = parts.slice(i).join(\"/\");\n          if (matcher instanceof RegExp) {\n            const m = matcher.exec(restPathString);\n            if (m) {\n              params[name] = m[0];\n              handlerSets.push(...this.#getHandlerSets(child, method, node.#params, params));\n              if (Object.keys(child.#children).length) {\n                child.#params = params;\n                const componentCount = m[0].match(/\\//)?.length ?? 0;\n                const targetCurNodes = curNodesQueue[componentCount] ||= [];\n                targetCurNodes.push(child);\n              }\n              continue;\n            }\n          }\n          if (matcher === true || matcher.test(part)) {\n            params[name] = part;\n            if (isLast) {\n              handlerSets.push(...this.#getHandlerSets(child, method, params, node.#params));\n              if (child.#children[\"*\"]) {\n                handlerSets.push(\n                  ...this.#getHandlerSets(child.#children[\"*\"], method, params, node.#params)\n                );\n              }\n            } else {\n              child.#params = params;\n              tempNodes.push(child);\n            }\n          }\n        }\n      }\n      curNodes = tempNodes.concat(curNodesQueue.shift() ?? []);\n    }\n    if (handlerSets.length > 1) {\n      handlerSets.sort((a, b) => {\n        return a.score - b.score;\n      });\n    }\n    return [handlerSets.map(({ handler, params }) => [handler, params])];\n  }\n};\nexport {\n  Node\n};\n", "// src/router/trie-router/router.ts\nimport { checkOptionalParameter } from \"../../utils/url.js\";\nimport { Node } from \"./node.js\";\nvar TrieRouter = class {\n  name = \"TrieRouter\";\n  #node;\n  constructor() {\n    this.#node = new Node();\n  }\n  add(method, path, handler) {\n    const results = checkOptionalParameter(path);\n    if (results) {\n      for (let i = 0, len = results.length; i < len; i++) {\n        this.#node.insert(method, results[i], handler);\n      }\n      return;\n    }\n    this.#node.insert(method, path, handler);\n  }\n  match(method, path) {\n    return this.#node.search(method, path);\n  }\n};\nexport {\n  TrieRouter\n};\n", "// src/hono.ts\nimport { HonoBase } from \"./hono-base.js\";\nimport { RegExpRouter } from \"./router/reg-exp-router/index.js\";\nimport { SmartRouter } from \"./router/smart-router/index.js\";\nimport { TrieRouter } from \"./router/trie-router/index.js\";\nvar Hono = class extends HonoBase {\n  /**\n   * Creates an instance of the Hono class.\n   *\n   * @param options - Optional configuration options for the Hono instance.\n   */\n  constructor(options = {}) {\n    super(options);\n    this.router = options.router ?? new SmartRouter({\n      routers: [new RegExpRouter(), new TrieRouter()]\n    });\n  }\n};\nexport {\n  Hono\n};\n", "// src/middleware/cors/index.ts\nvar cors = (options) => {\n  const defaults = {\n    origin: \"*\",\n    allowMethods: [\"GET\", \"HEAD\", \"PUT\", \"POST\", \"DELETE\", \"PATCH\"],\n    allowHeaders: [],\n    exposeHeaders: []\n  };\n  const opts = {\n    ...defaults,\n    ...options\n  };\n  const findAllowOrigin = ((optsOrigin) => {\n    if (typeof optsOrigin === \"string\") {\n      if (optsOrigin === \"*\") {\n        return () => optsOrigin;\n      } else {\n        return (origin) => optsOrigin === origin ? origin : null;\n      }\n    } else if (typeof optsOrigin === \"function\") {\n      return optsOrigin;\n    } else {\n      return (origin) => optsOrigin.includes(origin) ? origin : null;\n    }\n  })(opts.origin);\n  const findAllowMethods = ((optsAllowMethods) => {\n    if (typeof optsAllowMethods === \"function\") {\n      return optsAllowMethods;\n    } else if (Array.isArray(optsAllowMethods)) {\n      return () => optsAllowMethods;\n    } else {\n      return () => [];\n    }\n  })(opts.allowMethods);\n  return async function cors2(c, next) {\n    function set(key, value) {\n      c.res.headers.set(key, value);\n    }\n    const allowOrigin = await findAllowOrigin(c.req.header(\"origin\") || \"\", c);\n    if (allowOrigin) {\n      set(\"Access-Control-Allow-Origin\", allowOrigin);\n    }\n    if (opts.credentials) {\n      set(\"Access-Control-Allow-Credentials\", \"true\");\n    }\n    if (opts.exposeHeaders?.length) {\n      set(\"Access-Control-Expose-Headers\", opts.exposeHeaders.join(\",\"));\n    }\n    if (c.req.method === \"OPTIONS\") {\n      if (opts.origin !== \"*\") {\n        set(\"Vary\", \"Origin\");\n      }\n      if (opts.maxAge != null) {\n        set(\"Access-Control-Max-Age\", opts.maxAge.toString());\n      }\n      const allowMethods = await findAllowMethods(c.req.header(\"origin\") || \"\", c);\n      if (allowMethods.length) {\n        set(\"Access-Control-Allow-Methods\", allowMethods.join(\",\"));\n      }\n      let headers = opts.allowHeaders;\n      if (!headers?.length) {\n        const requestHeaders = c.req.header(\"Access-Control-Request-Headers\");\n        if (requestHeaders) {\n          headers = requestHeaders.split(/\\s*,\\s*/);\n        }\n      }\n      if (headers?.length) {\n        set(\"Access-Control-Allow-Headers\", headers.join(\",\"));\n        c.res.headers.append(\"Vary\", \"Access-Control-Request-Headers\");\n      }\n      c.res.headers.delete(\"Content-Length\");\n      c.res.headers.delete(\"Content-Type\");\n      return new Response(null, {\n        headers: c.res.headers,\n        status: 204,\n        statusText: \"No Content\"\n      });\n    }\n    await next();\n    if (opts.origin !== \"*\") {\n      c.header(\"Vary\", \"Origin\", { append: true });\n    }\n  };\n};\nexport {\n  cors\n};\n", "/**\n * FundVal-Live Cloudflare Workers Entry Point\n * Main Hono application with all routes mounted\n */\n\nimport { Hono } from 'hono';\nimport { cors } from 'hono/cors';\nimport { initDb } from './db.js';\nimport { handleScheduled } from './services/scheduler.js';\n\n// Import routes\nimport authRoutes from './routes/auth.js';\nimport fundRoutes from './routes/funds.js';\nimport accountRoutes from './routes/account.js';\nimport aiRoutes from './routes/ai.js';\nimport settingsRoutes from './routes/settings.js';\nimport dataRoutes from './routes/data.js';\nimport systemRoutes from './routes/system.js';\n\nconst app = new Hono();\n\n// ============================================================================\n// Middleware\n// ============================================================================\n\n// CORS\napp.use('/api/*', cors({\n  origin: '*',\n  allowMethods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],\n  allowHeaders: ['Content-Type', 'Authorization'],\n  credentials: true,\n}));\n\n// Database initialization (on first request)\nlet dbInitialized = false;\napp.use('/api/*', async (c, next) => {\n  if (!dbInitialized) {\n    try {\n      await initDb(c.env.DB);\n      dbInitialized = true;\n    } catch (e) {\n      console.error(`DB init error: ${e.message}`);\n      // Continue anyway - system endpoint should still work\n    }\n  }\n  return next();\n});\n\n// ============================================================================\n// API Routes\n// ============================================================================\n\n// Auth routes: /api/auth/*\napp.route('/api/auth', authRoutes);\n\n// Fund routes: /api/* (search, fund/:id, categories, etc.)\napp.route('/api', fundRoutes);\n\n// Account routes: /api/* (accounts, positions, trade, transactions)\napp.route('/api', accountRoutes);\n\n// AI routes: /api/ai/*\napp.route('/api/ai', aiRoutes);\n\n// Settings routes: /api/* (settings, preferences)\napp.route('/api', settingsRoutes);\n\n// Data routes: /api/* (data/export, data/import)\napp.route('/api', dataRoutes);\n\n// System routes: /api/system/*\napp.route('/api/system', systemRoutes);\n\n// ============================================================================\n// Export\n// ============================================================================\n\nexport default {\n  fetch: app.fetch,\n\n  // Cron Triggers handler\n  async scheduled(event, env, ctx) {\n    ctx.waitUntil(handleScheduled(event, env));\n  },\n};\n", "/**\n * Scheduled tasks (Cloudflare Cron Triggers)\n * Replaces Python threading-based scheduler\n */\n\nimport { fetchAndUpdateFunds, getCombinedValuation } from './fund.js';\nimport { checkSubscriptions } from './subscription.js';\nimport { getNavOnDate } from './fund.js';\n\n/**\n * Main scheduled event handler\n * Called by Cloudflare Cron Triggers\n */\nexport async function handleScheduled(event, env) {\n  const db = env.DB;\n\n  // Get current time in CST (UTC+8)\n  const now = new Date();\n  const cstHour = (now.getUTCHours() + 8) % 24;\n  const cstMinute = now.getUTCMinutes();\n  const dayOfWeek = new Date(now.getTime() + 8 * 60 * 60 * 1000).getDay();\n  const isWeekday = dayOfWeek >= 1 && dayOfWeek <= 5;\n\n  console.log(`Cron triggered at CST ${cstHour}:${String(cstMinute).padStart(2, '0')} (day=${dayOfWeek})`);\n\n  try {\n    // Daily tasks (run once at 8:00 CST)\n    if (cstHour === 8 && cstMinute < 10) {\n      await dailyTasks(db, env);\n    }\n\n    // Trading hours tasks (9:30-15:00 weekdays)\n    if (isWeekday && cstHour >= 9 && cstHour < 16) {\n      await tradingHoursTasks(db, env, cstHour, cstMinute);\n    }\n\n    // Post-market tasks (16:00-22:00 weekdays)\n    if (isWeekday && cstHour >= 16 && cstHour <= 22) {\n      await postMarketTasks(db, env, cstHour);\n    }\n  } catch (e) {\n    console.error(`Scheduled task error: ${e.message}`);\n  }\n}\n\n/**\n * Daily tasks: update fund list, cleanup\n */\nasync function dailyTasks(db, env) {\n  console.log('Running daily tasks...');\n\n  // Update fund list from Eastmoney\n  try {\n    await fetchAndUpdateFunds(db);\n  } catch (e) {\n    console.error(`Fund list update failed: ${e.message}`);\n  }\n\n  // Cleanup old snapshots (keep last 30 days)\n  try {\n    const cutoff = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10);\n    await db.prepare('DELETE FROM fund_intraday_snapshots WHERE date < ?').bind(cutoff).run();\n    console.log('Old snapshots cleaned up');\n  } catch (e) {\n    console.error(`Snapshot cleanup failed: ${e.message}`);\n  }\n}\n\n/**\n * Trading hours tasks: collect intraday data, check subscriptions\n */\nasync function tradingHoursTasks(db, env, cstHour, cstMinute) {\n  // Only during actual trading hours (9:30-11:30, 13:00-15:00)\n  const inTradeSession =\n    (cstHour === 9 && cstMinute >= 30) ||\n    (cstHour === 10) ||\n    (cstHour === 11 && cstMinute <= 30) ||\n    (cstHour >= 13 && cstHour < 15);\n\n  if (!inTradeSession) return;\n\n  // Collect intraday snapshots for all positions\n  try {\n    const positions = await db.prepare(`\n      SELECT DISTINCT p.code\n      FROM positions p\n      JOIN accounts a ON a.id = p.account_id\n    `).all();\n\n    const today = new Date(Date.now() + 8 * 60 * 60 * 1000).toISOString().slice(0, 10);\n    const timeStr = `${String(cstHour).padStart(2, '0')}:${String(cstMinute).padStart(2, '0')}`;\n\n    for (const { code } of positions.results) {\n      try {\n        const valuation = await getCombinedValuation(db, code);\n        if (valuation && valuation.estimate > 0) {\n          await db.prepare(`\n            INSERT OR REPLACE INTO fund_intraday_snapshots (fund_code, date, time, estimate)\n            VALUES (?, ?, ?, ?)\n          `).bind(code, today, timeStr, valuation.estimate).run();\n        }\n      } catch (e) {\n        console.warn(`Snapshot failed for ${code}: ${e.message}`);\n      }\n    }\n  } catch (e) {\n    console.error(`Intraday collection failed: ${e.message}`);\n  }\n\n  // Check subscriptions\n  try {\n    await checkSubscriptions(db, env);\n  } catch (e) {\n    console.error(`Subscription check failed: ${e.message}`);\n  }\n}\n\n/**\n * Post-market tasks: confirm transactions, update NAVs\n */\nasync function postMarketTasks(db, env, cstHour) {\n  // Run once at 16:00\n  if (cstHour !== 16) return;\n\n  console.log('Running post-market tasks...');\n\n  // Process pending transactions (T+1 confirmation)\n  try {\n    const today = new Date(Date.now() + 8 * 60 * 60 * 1000).toISOString().slice(0, 10);\n\n    const pending = await db.prepare(`\n      SELECT * FROM transactions\n      WHERE applied_at IS NULL AND confirm_date <= ?\n      ORDER BY confirm_date\n    `).bind(today).all();\n\n    for (const tx of pending.results) {\n      try {\n        const nav = await getNavOnDate(db, tx.code, tx.confirm_date);\n        if (!nav) continue; // NAV not yet available\n\n        if (tx.op_type === 'buy') {\n          // Calculate shares bought\n          const sharesBought = tx.amount_cny / nav;\n\n          // Get current position\n          const pos = await db.prepare(\n            'SELECT cost, shares FROM positions WHERE account_id = ? AND code = ?'\n          ).bind(tx.account_id, tx.code).first();\n\n          const currentCost = pos ? pos.cost : 0;\n          const currentShares = pos ? pos.shares : 0;\n          const totalCost = currentCost + tx.amount_cny;\n          const totalShares = currentShares + sharesBought;\n\n          // Update position\n          await db.prepare(`\n            INSERT INTO positions (account_id, code, cost, shares, updated_at)\n            VALUES (?, ?, ?, ?, datetime())\n            ON CONFLICT(account_id, code) DO UPDATE SET\n              cost = excluded.cost,\n              shares = excluded.shares,\n              updated_at = datetime()\n          `).bind(tx.account_id, tx.code, totalCost, totalShares).run();\n\n          // Update transaction\n          await db.prepare(`\n            UPDATE transactions SET confirm_nav = ?, shares_added = ?, cost_after = ?, applied_at = datetime()\n            WHERE id = ?\n          `).bind(nav, sharesBought, totalCost, tx.id).run();\n\n        } else if (tx.op_type === 'sell') {\n          // Calculate redemption value\n          const pos = await db.prepare(\n            'SELECT cost, shares FROM positions WHERE account_id = ? AND code = ?'\n          ).bind(tx.account_id, tx.code).first();\n\n          if (!pos || pos.shares < tx.shares_redeemed) continue;\n\n          const costPerShare = pos.shares > 0 ? pos.cost / pos.shares : 0;\n          const costReduced = costPerShare * tx.shares_redeemed;\n          const newCost = Math.max(0, pos.cost - costReduced);\n          const newShares = pos.shares - tx.shares_redeemed;\n\n          if (newShares <= 0.001) {\n            await db.prepare(\n              'DELETE FROM positions WHERE account_id = ? AND code = ?'\n            ).bind(tx.account_id, tx.code).run();\n          } else {\n            await db.prepare(`\n              UPDATE positions SET cost = ?, shares = ?, updated_at = datetime()\n              WHERE account_id = ? AND code = ?\n            `).bind(newCost, newShares, tx.account_id, tx.code).run();\n          }\n\n          // Update transaction\n          await db.prepare(`\n            UPDATE transactions SET confirm_nav = ?, cost_after = ?, applied_at = datetime()\n            WHERE id = ?\n          `).bind(nav, newCost, tx.id).run();\n        }\n      } catch (e) {\n        console.error(`Transaction processing failed for tx ${tx.id}: ${e.message}`);\n      }\n    }\n\n    console.log(`Processed ${pending.results.length} pending transactions`);\n  } catch (e) {\n    console.error(`Transaction processing failed: ${e.message}`);\n  }\n}\n", "/**\n * Subscription management service\n */\n\n/**\n * Get subscriptions for a user\n */\nexport async function getSubscriptions(db, userId) {\n  const result = await db.prepare(\n    'SELECT * FROM subscriptions WHERE user_id = ? ORDER BY created_at DESC'\n  ).bind(userId).all();\n  return result.results;\n}\n\n/**\n * Add or update subscription\n */\nexport async function upsertSubscription(db, userId, code, email, thresholdUp, thresholdDown, options = {}) {\n  const {\n    enableDigest = 0,\n    digestTime = '14:45',\n    enableVolatility = 1,\n  } = options;\n\n  await db.prepare(`\n    INSERT INTO subscriptions (code, email, user_id, threshold_up, threshold_down, enable_digest, digest_time, enable_volatility)\n    VALUES (?, ?, ?, ?, ?, ?, ?, ?)\n    ON CONFLICT(code, email, user_id) DO UPDATE SET\n      threshold_up = excluded.threshold_up,\n      threshold_down = excluded.threshold_down,\n      enable_digest = excluded.enable_digest,\n      digest_time = excluded.digest_time,\n      enable_volatility = excluded.enable_volatility\n  `).bind(code, email, userId, thresholdUp, thresholdDown, enableDigest, digestTime, enableVolatility).run();\n}\n\n/**\n * Delete subscription\n */\nexport async function deleteSubscription(db, userId, subscriptionId) {\n  await db.prepare(\n    'DELETE FROM subscriptions WHERE id = ? AND user_id = ?'\n  ).bind(subscriptionId, userId).run();\n}\n\n/**\n * Check subscriptions and trigger alerts\n */\nexport async function checkSubscriptions(db, env) {\n  const result = await db.prepare(\n    'SELECT s.*, f.name as fund_name FROM subscriptions s LEFT JOIN funds f ON s.code = f.code'\n  ).all();\n\n  const { getCombinedValuation } = await import('./fund.js');\n\n  for (const sub of result.results) {\n    try {\n      const valuation = await getCombinedValuation(db, sub.code);\n      if (!valuation || !valuation.estRate) continue;\n\n      const estRate = parseFloat(valuation.estRate);\n      let shouldNotify = false;\n      let reason = '';\n\n      if (sub.threshold_up && estRate >= sub.threshold_up) {\n        shouldNotify = true;\n        reason = `\u6DA8\u5E45\u8FBE\u5230 ${estRate}%\uFF0C\u8D85\u8FC7\u9608\u503C ${sub.threshold_up}%`;\n      } else if (sub.threshold_down && estRate <= -Math.abs(sub.threshold_down)) {\n        shouldNotify = true;\n        reason = `\u8DCC\u5E45\u8FBE\u5230 ${estRate}%\uFF0C\u8D85\u8FC7\u9608\u503C -${Math.abs(sub.threshold_down)}%`;\n      }\n\n      if (shouldNotify) {\n        // Check if already notified recently (within 1 hour)\n        if (sub.last_notified_at) {\n          const lastNotified = new Date(sub.last_notified_at);\n          if (Date.now() - lastNotified.getTime() < 60 * 60 * 1000) continue;\n        }\n\n        // Send notification\n        const { sendNotificationEmail } = await import('./email.js');\n        await sendNotificationEmail(env, sub.email, {\n          fundCode: sub.code,\n          fundName: sub.fund_name || sub.code,\n          estRate,\n          reason,\n          estimate: valuation.estimate,\n          nav: valuation.nav,\n        });\n\n        // Update last_notified_at\n        await db.prepare(\n          'UPDATE subscriptions SET last_notified_at = datetime() WHERE id = ?'\n        ).bind(sub.id).run();\n      }\n    } catch (e) {\n      console.error(`Subscription check failed for ${sub.code}: ${e.message}`);\n    }\n  }\n}\n", "/**\n * Authentication module using Web Crypto API + KV sessions\n * Replaces Python bcrypt + in-memory sessions\n */\n\nconst SESSION_COOKIE_NAME = 'session_id';\nconst SESSION_EXPIRY_SECONDS = 30 * 24 * 60 * 60; // 30 days\n\n/**\n * Hash password using PBKDF2 (Web Crypto API)\n * Returns format: iterations:salt_b64:hash_b64\n */\nexport async function hashPassword(password) {\n  const salt = crypto.getRandomValues(new Uint8Array(16));\n  const iterations = 100000;\n\n  const keyMaterial = await crypto.subtle.importKey(\n    'raw',\n    new TextEncoder().encode(password),\n    { name: 'PBKDF2' },\n    false,\n    ['deriveBits']\n  );\n\n  const hash = await crypto.subtle.deriveBits(\n    {\n      name: 'PBKDF2',\n      salt,\n      iterations,\n      hash: 'SHA-256',\n    },\n    keyMaterial,\n    256\n  );\n\n  const saltB64 = btoa(String.fromCharCode(...salt));\n  const hashB64 = btoa(String.fromCharCode(...new Uint8Array(hash)));\n\n  return `${iterations}:${saltB64}:${hashB64}`;\n}\n\n/**\n * Verify password against stored hash\n */\nexport async function verifyPassword(password, storedHash) {\n  try {\n    const [iterationsStr, saltB64, expectedHashB64] = storedHash.split(':');\n    const iterations = parseInt(iterationsStr);\n    const salt = Uint8Array.from(atob(saltB64), c => c.charCodeAt(0));\n\n    const keyMaterial = await crypto.subtle.importKey(\n      'raw',\n      new TextEncoder().encode(password),\n      { name: 'PBKDF2' },\n      false,\n      ['deriveBits']\n    );\n\n    const hash = await crypto.subtle.deriveBits(\n      {\n        name: 'PBKDF2',\n        salt,\n        iterations,\n        hash: 'SHA-256',\n      },\n      keyMaterial,\n      256\n    );\n\n    const hashB64 = btoa(String.fromCharCode(...new Uint8Array(hash)));\n    return hashB64 === expectedHashB64;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Check if any admin user exists\n */\nexport async function hasAdminUser(db) {\n  const row = await db.prepare('SELECT COUNT(*) as count FROM users WHERE is_admin = 1').first();\n  return row.count > 0;\n}\n\n/**\n * Create a session in KV store\n */\nexport async function createSession(kv, userId) {\n  const sessionId = crypto.randomUUID() + '-' + crypto.randomUUID();\n\n  await kv.put(`session:${sessionId}`, JSON.stringify({\n    userId,\n    createdAt: Date.now(),\n  }), {\n    expirationTtl: SESSION_EXPIRY_SECONDS,\n  });\n\n  return sessionId;\n}\n\n/**\n * Get user ID from session\n */\nexport async function getSessionUser(kv, sessionId) {\n  if (!sessionId) return null;\n\n  const data = await kv.get(`session:${sessionId}`, 'json');\n  if (!data) return null;\n\n  // Renew session on access (sliding window)\n  await kv.put(`session:${sessionId}`, JSON.stringify(data), {\n    expirationTtl: SESSION_EXPIRY_SECONDS,\n  });\n\n  return data.userId;\n}\n\n/**\n * Delete session\n */\nexport async function deleteSession(kv, sessionId) {\n  if (sessionId) {\n    await kv.delete(`session:${sessionId}`);\n  }\n}\n\n/**\n * Get user by ID\n */\nasync function getUserById(db, userId) {\n  const row = await db.prepare(\n    'SELECT id, username, is_admin FROM users WHERE id = ?'\n  ).bind(userId).first();\n\n  if (!row) return null;\n  return { id: row.id, username: row.username, isAdmin: !!row.is_admin };\n}\n\n/**\n * Get current user from request cookies\n */\nexport async function getCurrentUser(c) {\n  const sessionId = getCookie(c, SESSION_COOKIE_NAME);\n  if (!sessionId) return null;\n\n  const userId = await getSessionUser(c.env.SESSION_KV, sessionId);\n  if (!userId) return null;\n\n  return getUserById(c.env.DB, userId);\n}\n\n/**\n * Middleware: require authentication\n */\nexport async function requireAuth(c, next) {\n  const user = await getCurrentUser(c);\n  if (!user) {\n    return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n  }\n  c.set('user', user);\n  if (next) return next();\n  return user;\n}\n\n/**\n * Middleware: require admin\n */\nexport async function requireAdmin(c, next) {\n  const user = await getCurrentUser(c);\n  if (!user) {\n    return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n  }\n  if (!user.isAdmin) {\n    return c.json({ detail: '\u6743\u9650\u4E0D\u8DB3' }, 403);\n  }\n  c.set('user', user);\n  if (next) return next();\n  return user;\n}\n\n/**\n * Verify account ownership\n */\nexport async function verifyAccountOwnership(db, accountId, user) {\n  if (!user) return false;\n  const row = await db.prepare(\n    'SELECT user_id FROM accounts WHERE id = ?'\n  ).bind(accountId).first();\n\n  if (!row) return false;\n  return row.user_id === user.id;\n}\n\n/**\n * Helper: get cookie value from request\n */\nfunction getCookie(c, name) {\n  const cookieHeader = c.req.header('cookie');\n  if (!cookieHeader) return null;\n\n  const cookies = cookieHeader.split(';').map(c => c.trim());\n  for (const cookie of cookies) {\n    const [key, ...valueParts] = cookie.split('=');\n    if (key.trim() === name) {\n      return valueParts.join('=').trim();\n    }\n  }\n  return null;\n}\n\n/**\n * Helper: set session cookie on response\n */\nexport function setSessionCookie(c, sessionId) {\n  c.header('Set-Cookie',\n    `${SESSION_COOKIE_NAME}=${sessionId}; Path=/; HttpOnly; SameSite=Lax; Max-Age=${SESSION_EXPIRY_SECONDS}`\n  );\n}\n\n/**\n * Helper: clear session cookie\n */\nexport function clearSessionCookie(c) {\n  c.header('Set-Cookie',\n    `${SESSION_COOKIE_NAME}=; Path=/; HttpOnly; SameSite=Lax; Max-Age=0`\n  );\n}\n\nexport { SESSION_COOKIE_NAME, getUserById };\n", "/**\r\n * Auth API routes (Hono)\r\n * Migrated from backend/app/routers/auth.py\r\n */\r\n\r\nimport { Hono } from 'hono';\r\nimport {\r\n  hashPassword, verifyPassword, hasAdminUser,\r\n  createSession, deleteSession, getCurrentUser,\r\n  setSessionCookie, clearSessionCookie, getUserById,\r\n} from '../auth.js';\r\n\r\nconst auth = new Hono();\r\n\r\n// ============================================================================\r\n// Helper Functions\r\n// ============================================================================\r\n\r\nasync function getUserDefaultAccountId(db, userId) {\r\n  // Check user_settings\r\n  const settingRow = await db.prepare(\r\n    \"SELECT value FROM settings WHERE user_id = ? AND key = 'user_current_account'\"\r\n  ).bind(userId).first();\r\n\r\n  if (settingRow && settingRow.value) {\r\n    return parseInt(settingRow.value);\r\n  }\r\n\r\n  // Fallback: first account\r\n  const acc = await db.prepare(\r\n    'SELECT id FROM accounts WHERE user_id = ? ORDER BY id LIMIT 1'\r\n  ).bind(userId).first();\r\n\r\n  return acc ? acc.id : null;\r\n}\r\n\r\n// ============================================================================\r\n// Public Endpoints\r\n// ============================================================================\r\n\r\nauth.get('/init-status', async (c) => {\r\n  const db = c.env.DB;\r\n  const needsInit = !(await hasAdminUser(db));\r\n\r\n  let needsRebuild = false;\r\n  try {\r\n    const { checkDatabaseVersion, CURRENT_SCHEMA_VERSION } = await import('../db.js');\r\n    const version = await checkDatabaseVersion(db);\r\n    needsRebuild = version > 0 && version !== CURRENT_SCHEMA_VERSION;\r\n  } catch {}\r\n\r\n  return c.json({ needs_init: needsInit, needs_rebuild: needsRebuild });\r\n});\r\n\r\nauth.post('/init', async (c) => {\r\n  const db = c.env.DB;\r\n\r\n  if (await hasAdminUser(db)) {\r\n    return c.json({ detail: '\u5DF2\u5B58\u5728\u7BA1\u7406\u5458\u7528\u6237' }, 400);\r\n  }\r\n\r\n  const { username, password } = await c.req.json();\r\n  if (!username || !password) {\r\n    return c.json({ detail: '\u7528\u6237\u540D\u548C\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A' }, 400);\r\n  }\r\n\r\n  if (password.length < 6) {\r\n    return c.json({ detail: '\u5BC6\u7801\u957F\u5EA6\u81F3\u5C11 6 \u4F4D' }, 400);\r\n  }\r\n\r\n  const passwordHash = await hashPassword(password);\r\n\r\n  const result = await db.prepare(\r\n    'INSERT INTO users (username, password_hash, is_admin) VALUES (?, ?, 1)'\r\n  ).bind(username, passwordHash).run();\r\n\r\n  const userId = result.meta.last_row_id;\r\n\r\n  // Create default account\r\n  await db.prepare(\r\n    'INSERT INTO accounts (name, description, user_id) VALUES (?, ?, ?)'\r\n  ).bind('\u9ED8\u8BA4\u8D26\u6237', '\u521D\u59CB\u5316\u521B\u5EFA\u7684\u9ED8\u8BA4\u8D26\u6237', userId).run();\r\n\r\n  // Insert default AI prompt\r\n  const { LINUS_FINANCIAL_ANALYSIS_PROMPT } = await import('../services/prompts.js');\r\n  const defaultPrompt = LINUS_FINANCIAL_ANALYSIS_PROMPT({});\r\n  await db.prepare(\r\n    'INSERT INTO ai_prompts (name, prompt, system_prompt, user_prompt, is_default, user_id) VALUES (?, ?, ?, ?, 1, ?)'\r\n  ).bind('Linus \u98CE\u683C\u5206\u6790', '', defaultPrompt[0].content, defaultPrompt[1].content, userId).run();\r\n\r\n  return c.json({\r\n    message: '\u7BA1\u7406\u5458\u521D\u59CB\u5316\u6210\u529F',\r\n    user: { id: userId, username, is_admin: true },\r\n  });\r\n});\r\n\r\nauth.get('/registration', async (c) => {\r\n  const db = c.env.DB;\r\n  const row = await db.prepare(\r\n    \"SELECT value FROM settings WHERE key = 'REGISTRATION_ENABLED' AND user_id IS NULL\"\r\n  ).first();\r\n\r\n  const enabled = row ? row.value === '1' || row.value === 'true' : false;\r\n  return c.json({ registration_enabled: enabled });\r\n});\r\n\r\nauth.get('/mode', async (c) => {\n  const db = c.env.DB;\n  const multiUserMode = await hasAdminUser(db);\n  return c.json({\n    environment: c.env.ENVIRONMENT || 'production',\n    multi_user_mode: multiUserMode,\n  });\n});\n\r\nauth.post('/login', async (c) => {\r\n  const db = c.env.DB;\r\n  const { username, password } = await c.req.json();\r\n\r\n  if (!username || !password) {\r\n    return c.json({ detail: '\u7528\u6237\u540D\u548C\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A' }, 400);\r\n  }\r\n\r\n  const user = await db.prepare(\r\n    'SELECT id, username, password_hash, is_admin FROM users WHERE username = ?'\r\n  ).bind(username).first();\r\n\r\n  if (!user || !(await verifyPassword(password, user.password_hash))) {\r\n    return c.json({ detail: '\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF' }, 401);\r\n  }\r\n\r\n  // Create session\r\n  const sessionId = await createSession(c.env.SESSION_KV, user.id);\r\n  setSessionCookie(c, sessionId);\r\n\r\n  const defaultAccountId = await getUserDefaultAccountId(db, user.id);\r\n\r\n  return c.json({\r\n    id: user.id,\r\n    username: user.username,\r\n    is_admin: !!user.is_admin,\r\n    default_account_id: defaultAccountId,\r\n  });\r\n});\r\n\r\nauth.post('/logout', async (c) => {\r\n  const user = await getCurrentUser(c);\r\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\r\n\r\n  // Get session from cookie\r\n  const cookieHeader = c.req.header('cookie') || '';\r\n  const match = cookieHeader.match(/session_id=([^;]+)/);\r\n  if (match) {\r\n    await deleteSession(c.env.SESSION_KV, match[1]);\r\n  }\r\n\r\n  clearSessionCookie(c);\r\n  return c.json({ message: '\u5DF2\u767B\u51FA' });\r\n});\r\n\r\nauth.post('/register', async (c) => {\r\n  const db = c.env.DB;\r\n\r\n  // Check registration enabled\r\n  const regRow = await db.prepare(\r\n    \"SELECT value FROM settings WHERE key = 'REGISTRATION_ENABLED' AND user_id IS NULL\"\r\n  ).first();\r\n  const regEnabled = regRow ? regRow.value === '1' || regRow.value === 'true' : false;\r\n\r\n  if (!regEnabled) {\r\n    return c.json({ detail: '\u6CE8\u518C\u529F\u80FD\u672A\u5F00\u542F' }, 403);\r\n  }\r\n\r\n  const { username, password } = await c.req.json();\r\n  if (!username || !password) {\r\n    return c.json({ detail: '\u7528\u6237\u540D\u548C\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A' }, 400);\r\n  }\r\n\r\n  if (password.length < 6) {\r\n    return c.json({ detail: '\u5BC6\u7801\u957F\u5EA6\u81F3\u5C11 6 \u4F4D' }, 400);\r\n  }\r\n\r\n  // Check duplicate\r\n  const existing = await db.prepare(\r\n    'SELECT id FROM users WHERE username = ?'\r\n  ).bind(username).first();\r\n\r\n  if (existing) {\r\n    return c.json({ detail: '\u7528\u6237\u540D\u5DF2\u5B58\u5728' }, 400);\r\n  }\r\n\r\n  const passwordHash = await hashPassword(password);\r\n  const result = await db.prepare(\r\n    'INSERT INTO users (username, password_hash, is_admin) VALUES (?, ?, 0)'\r\n  ).bind(username, passwordHash).run();\r\n\r\n  const userId = result.meta.last_row_id;\r\n\r\n  // Create default account\r\n  await db.prepare(\r\n    'INSERT INTO accounts (name, description, user_id) VALUES (?, ?, ?)'\r\n  ).bind('\u9ED8\u8BA4\u8D26\u6237', '', userId).run();\r\n\r\n  // Create session\r\n  const sessionId = await createSession(c.env.SESSION_KV, userId);\r\n  setSessionCookie(c, sessionId);\r\n\r\n  const defaultAccountId = await getUserDefaultAccountId(db, userId);\r\n\r\n  return c.json({\r\n    id: userId,\r\n    username,\r\n    is_admin: false,\r\n    default_account_id: defaultAccountId,\r\n  });\r\n});\r\n\r\nauth.get('/me', async (c) => {\r\n  const user = await getCurrentUser(c);\r\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\r\n\r\n  const db = c.env.DB;\r\n  const defaultAccountId = await getUserDefaultAccountId(db, user.id);\r\n\r\n  return c.json({\r\n    id: user.id,\r\n    username: user.username,\r\n    is_admin: user.isAdmin,\r\n    default_account_id: defaultAccountId,\r\n  });\r\n});\r\n\r\nauth.post('/change-password', async (c) => {\r\n  const user = await getCurrentUser(c);\r\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\r\n\r\n  const db = c.env.DB;\r\n  const { old_password, new_password } = await c.req.json();\r\n\r\n  if (!old_password || !new_password) {\r\n    return c.json({ detail: '\u65B0\u65E7\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A' }, 400);\r\n  }\r\n\r\n  if (new_password.length < 6) {\r\n    return c.json({ detail: '\u65B0\u5BC6\u7801\u957F\u5EA6\u81F3\u5C11 6 \u4F4D' }, 400);\r\n  }\r\n\r\n  const dbUser = await db.prepare(\r\n    'SELECT password_hash FROM users WHERE id = ?'\r\n  ).bind(user.id).first();\r\n\r\n  if (!(await verifyPassword(old_password, dbUser.password_hash))) {\r\n    return c.json({ detail: '\u65E7\u5BC6\u7801\u9519\u8BEF' }, 400);\r\n  }\r\n\r\n  const newHash = await hashPassword(new_password);\r\n  await db.prepare(\r\n    'UPDATE users SET password_hash = ? WHERE id = ?'\r\n  ).bind(newHash, user.id).run();\r\n\r\n  return c.json({ message: '\u5BC6\u7801\u4FEE\u6539\u6210\u529F' });\r\n});\r\n\r\n// ============================================================================\r\n// Admin Endpoints\r\n// ============================================================================\r\n\r\nauth.post('/users', async (c) => {\r\n  const admin = await getCurrentUser(c);\r\n  if (!admin) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\r\n  if (!admin.isAdmin) return c.json({ detail: '\u6743\u9650\u4E0D\u8DB3' }, 403);\r\n\r\n  const db = c.env.DB;\r\n  const { username, password, is_admin = false } = await c.req.json();\r\n\r\n  if (!username || !password) {\r\n    return c.json({ detail: '\u7528\u6237\u540D\u548C\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A' }, 400);\r\n  }\r\n\r\n  const existing = await db.prepare(\r\n    'SELECT id FROM users WHERE username = ?'\r\n  ).bind(username).first();\r\n\r\n  if (existing) {\r\n    return c.json({ detail: '\u7528\u6237\u540D\u5DF2\u5B58\u5728' }, 400);\r\n  }\r\n\r\n  const passwordHash = await hashPassword(password);\r\n  const result = await db.prepare(\r\n    'INSERT INTO users (username, password_hash, is_admin) VALUES (?, ?, ?)'\r\n  ).bind(username, passwordHash, is_admin ? 1 : 0).run();\r\n\r\n  const userId = result.meta.last_row_id;\r\n\r\n  // Create default account\r\n  await db.prepare(\r\n    'INSERT INTO accounts (name, description, user_id) VALUES (?, ?, ?)'\r\n  ).bind('\u9ED8\u8BA4\u8D26\u6237', '', userId).run();\r\n\r\n  return c.json({ id: userId, username, is_admin: !!is_admin });\r\n});\r\n\r\nauth.get('/users', async (c) => {\r\n  const admin = await getCurrentUser(c);\r\n  if (!admin) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\r\n  if (!admin.isAdmin) return c.json({ detail: '\u6743\u9650\u4E0D\u8DB3' }, 403);\r\n\r\n  const db = c.env.DB;\r\n  const result = await db.prepare(\r\n    'SELECT id, username, is_admin, created_at FROM users ORDER BY id'\r\n  ).all();\r\n\r\n  const users = [];\r\n  for (const row of result.results) {\r\n    const defaultAccountId = await getUserDefaultAccountId(db, row.id);\r\n    users.push({\r\n      id: row.id,\r\n      username: row.username,\r\n      is_admin: !!row.is_admin,\r\n      default_account_id: defaultAccountId,\r\n    });\r\n  }\r\n\r\n  return c.json(users);\r\n});\r\n\r\nauth.delete('/users/:id', async (c) => {\r\n  const admin = await getCurrentUser(c);\r\n  if (!admin) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\r\n  if (!admin.isAdmin) return c.json({ detail: '\u6743\u9650\u4E0D\u8DB3' }, 403);\r\n\r\n  const db = c.env.DB;\r\n  const userId = parseInt(c.req.param('id'));\r\n\r\n  if (userId === admin.id) {\r\n    return c.json({ detail: '\u4E0D\u80FD\u5220\u9664\u81EA\u5DF1' }, 400);\r\n  }\r\n\r\n  await db.prepare('DELETE FROM users WHERE id = ?').bind(userId).run();\r\n  return c.json({ message: '\u7528\u6237\u5DF2\u5220\u9664' });\r\n});\r\n\r\nauth.post('/registration', async (c) => {\r\n  const admin = await getCurrentUser(c);\r\n  if (!admin) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\r\n  if (!admin.isAdmin) return c.json({ detail: '\u6743\u9650\u4E0D\u8DB3' }, 403);\r\n\r\n  const db = c.env.DB;\r\n  const { enabled } = await c.req.json();\r\n\r\n  await db.prepare(`\r\n    INSERT INTO settings (key, value, user_id, updated_at)\r\n    VALUES ('REGISTRATION_ENABLED', ?, NULL, datetime())\r\n    ON CONFLICT(key, user_id) DO UPDATE SET\r\n      value = excluded.value, updated_at = datetime()\r\n  `).bind(enabled ? '1' : '0').run();\r\n\r\n  return c.json({ registration_enabled: !!enabled });\r\n});\r\n\r\nexport default auth;\r\n", "/**\n * Fund API routes (Hono)\n * Migrated from backend/app/routers/funds.py\n */\n\nimport { Hono } from 'hono';\nimport { getCurrentUser } from '../auth.js';\nimport {\n  searchFunds, getFundIntraday, getFundHistory,\n  getCombinedValuation, calculateTechnicalIndicators,\n  getFundCategory,\n} from '../services/fund.js';\nimport { upsertSubscription, getSubscriptions, deleteSubscription } from '../services/subscription.js';\n\nconst funds = new Hono();\n\n// GET /api/search?q=xxx\nfunds.get('/search', async (c) => {\n  const q = c.req.query('q')?.trim();\n  if (!q) return c.json([]);\n\n  const results = await searchFunds(c.env.DB, q);\n  return c.json(results);\n});\n\n// GET /api/fund/:id\nfunds.get('/fund/:id', async (c) => {\n  const fundId = c.req.param('id');\n  try {\n    const data = await getFundIntraday(c.env.DB, fundId);\n    return c.json(data);\n  } catch (e) {\n    console.error(`Fund detail error for ${fundId}: ${e.message}`);\n    return c.json({ detail: `\u83B7\u53D6\u57FA\u91D1\u8BE6\u60C5\u5931\u8D25: ${e.message}` }, 500);\n  }\n});\n\n// GET /api/fund/:id/history?limit=30\nfunds.get('/fund/:id/history', async (c) => {\n  const fundId = c.req.param('id');\n  const limit = parseInt(c.req.query('limit') || '30');\n\n  try {\n    const history = await getFundHistory(c.env.DB, fundId, limit);\n    return c.json(history);\n  } catch (e) {\n    return c.json({ detail: e.message }, 500);\n  }\n});\n\n// GET /api/fund/:id/intraday\nfunds.get('/fund/:id/intraday', async (c) => {\n  const fundId = c.req.param('id');\n  const db = c.env.DB;\n\n  try {\n    const today = new Date(Date.now() + 8 * 60 * 60 * 1000).toISOString().slice(0, 10);\n    const result = await db.prepare(\n      'SELECT time, estimate FROM fund_intraday_snapshots WHERE fund_code = ? AND date = ? ORDER BY time'\n    ).bind(fundId, today).all();\n\n    return c.json(result.results.map(r => ({\n      time: r.time,\n      estimate: r.estimate,\n    })));\n  } catch (e) {\n    return c.json({ detail: e.message }, 500);\n  }\n});\n\n// GET /api/fund/:id/backtest?period=30|90|180|365\nfunds.get('/fund/:id/backtest', async (c) => {\n  const fundId = c.req.param('id');\n  const period = parseInt(c.req.query('period') || '30');\n  const db = c.env.DB;\n\n  try {\n    const history = await getFundHistory(db, fundId, period);\n    if (!history || history.length === 0) {\n      return c.json({ detail: '\u65E0\u5386\u53F2\u6570\u636E' }, 404);\n    }\n\n    const indicators = calculateTechnicalIndicators(history);\n\n    // Build chart data\n    const chartData = history.map(item => ({\n      date: item.date,\n      nav: item.nav,\n    }));\n\n    // Calculate period returns\n    const startNav = history[0].nav;\n    const endNav = history[history.length - 1].nav;\n    const totalReturn = ((endNav - startNav) / startNav * 100).toFixed(2);\n\n    return c.json({\n      period,\n      total_return: `${totalReturn}%`,\n      start_nav: startNav,\n      end_nav: endNav,\n      data_points: history.length,\n      indicators,\n      chart_data: chartData,\n    });\n  } catch (e) {\n    return c.json({ detail: e.message }, 500);\n  }\n});\n\n// POST /api/fund/:id/subscribe\nfunds.post('/fund/:id/subscribe', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const fundId = c.req.param('id');\n  const body = await c.req.json();\n  const { email, threshold_up, threshold_down, enable_digest, digest_time, enable_volatility } = body;\n\n  if (!email) return c.json({ detail: '\u90AE\u7BB1\u4E0D\u80FD\u4E3A\u7A7A' }, 400);\n\n  try {\n    await upsertSubscription(c.env.DB, user.id, fundId, email, threshold_up, threshold_down, {\n      enableDigest: enable_digest ? 1 : 0,\n      digestTime: digest_time || '14:45',\n      enableVolatility: enable_volatility !== false ? 1 : 0,\n    });\n\n    return c.json({ status: 'ok', message: '\u8BA2\u9605\u5DF2\u6FC0\u6D3B' });\n  } catch (e) {\n    return c.json({ detail: e.message }, 500);\n  }\n});\n\n// GET /api/subscriptions\nfunds.get('/subscriptions', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const subs = await getSubscriptions(c.env.DB, user.id);\n  return c.json(subs);\n});\n\n// DELETE /api/subscriptions/:id\nfunds.delete('/subscriptions/:id', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const subId = parseInt(c.req.param('id'));\n  await deleteSubscription(c.env.DB, user.id, subId);\n  return c.json({ message: '\u5DF2\u53D6\u6D88\u8BA2\u9605' });\n});\n\n// GET /api/categories\nfunds.get('/categories', async (c) => {\n  const categories = ['\u504F\u80A1\u7C7B', '\u504F\u503A\u7C7B', '\u8D27\u5E01\u7C7B', '\u5546\u54C1\u7C7B', '\u672A\u5206\u7C7B'];\n  return c.json(categories);\n});\n\nexport default funds;\n", "/**\n * Account and position management service\n */\n\n/**\n * Get all accounts for a user\n */\nexport async function getUserAccounts(db, userId) {\n  const result = await db.prepare(\n    'SELECT id, name, description, created_at, updated_at FROM accounts WHERE user_id = ? ORDER BY id'\n  ).bind(userId).all();\n  return result.results;\n}\n\n/**\n * Create a new account\n */\nexport async function createAccount(db, userId, name, description = '') {\n  const result = await db.prepare(\n    'INSERT INTO accounts (name, description, user_id) VALUES (?, ?, ?)'\n  ).bind(name, description || '', userId).run();\n  return result.meta.last_row_id;\n}\n\n/**\n * Update account\n */\nexport async function updateAccount(db, accountId, name, description) {\n  await db.prepare(\n    'UPDATE accounts SET name = ?, description = ?, updated_at = datetime() WHERE id = ?'\n  ).bind(name, description || '', accountId).run();\n}\n\n/**\n * Delete account (checks positions)\n */\nexport async function deleteAccount(db, accountId) {\n  const posCount = await db.prepare(\n    'SELECT COUNT(*) as cnt FROM positions WHERE account_id = ?'\n  ).bind(accountId).first();\n\n  if (posCount.cnt > 0) {\n    throw new Error('\u8BE5\u8D26\u6237\u4E0B\u4ECD\u6709\u6301\u4ED3\uFF0C\u8BF7\u5148\u6E05\u7A7A\u6301\u4ED3\u540E\u518D\u5220\u9664');\n  }\n\n  await db.prepare('DELETE FROM accounts WHERE id = ?').bind(accountId).run();\n}\n\n/**\n * Get all positions for an account\n */\nexport async function getPositions(db, accountId) {\n  const result = await db.prepare(\n    'SELECT code, cost, shares, updated_at FROM positions WHERE account_id = ? ORDER BY code'\n  ).bind(accountId).all();\n  return result.results;\n}\n\n/**\n * Get all positions across accounts for a user (aggregated)\n */\nexport async function getAggregatePositions(db, userId) {\n  const result = await db.prepare(`\n    SELECT p.code, p.cost, p.shares, p.account_id, p.updated_at, a.name as account_name\n    FROM positions p\n    JOIN accounts a ON a.id = p.account_id\n    WHERE a.user_id = ?\n    ORDER BY p.code\n  `).bind(userId).all();\n  return result.results;\n}\n\n/**\n * Upsert position\n */\nexport async function upsertPosition(db, accountId, code, cost, shares) {\n  await db.prepare(`\n    INSERT INTO positions (account_id, code, cost, shares, updated_at)\n    VALUES (?, ?, ?, ?, datetime())\n    ON CONFLICT(account_id, code) DO UPDATE SET\n      cost = excluded.cost,\n      shares = excluded.shares,\n      updated_at = datetime()\n  `).bind(accountId, code, cost, shares).run();\n}\n\n/**\n * Remove position\n */\nexport async function removePosition(db, accountId, code) {\n  await db.prepare(\n    'DELETE FROM positions WHERE account_id = ? AND code = ?'\n  ).bind(accountId, code).run();\n}\n\n/**\n * Add trade (buy more)\n */\nexport async function addTrade(db, accountId, code, amountCny, tradeTime = null) {\n  const now = new Date();\n  const confirmDate = getConfirmDate(tradeTime ? new Date(tradeTime) : now);\n\n  await db.prepare(`\n    INSERT INTO transactions (account_id, code, op_type, amount_cny, confirm_date)\n    VALUES (?, ?, 'buy', ?, ?)\n  `).bind(accountId, code, amountCny, confirmDate).run();\n\n  return { confirm_date: confirmDate, message: `\u52A0\u4ED3 \u00A5${amountCny}\uFF0C\u786E\u8BA4\u65E5: ${confirmDate}` };\n}\n\n/**\n * Reduce trade (sell)\n */\nexport async function reduceTrade(db, accountId, code, shares, tradeTime = null) {\n  const position = await db.prepare(\n    'SELECT shares FROM positions WHERE account_id = ? AND code = ?'\n  ).bind(accountId, code).first();\n\n  if (!position || position.shares < shares) {\n    throw new Error('\u6301\u4ED3\u4EFD\u989D\u4E0D\u8DB3');\n  }\n\n  const now = new Date();\n  const confirmDate = getConfirmDate(tradeTime ? new Date(tradeTime) : now);\n\n  await db.prepare(`\n    INSERT INTO transactions (account_id, code, op_type, shares_redeemed, confirm_date)\n    VALUES (?, ?, 'sell', ?, ?)\n  `).bind(accountId, code, shares, confirmDate).run();\n\n  return { confirm_date: confirmDate, message: `\u51CF\u4ED3 ${shares} \u4EFD\uFF0C\u786E\u8BA4\u65E5: ${confirmDate}` };\n}\n\n/**\n * Get transactions for an account\n */\nexport async function getTransactions(db, accountId, code = null, limit = 100) {\n  let query = 'SELECT * FROM transactions WHERE account_id = ?';\n  const params = [accountId];\n\n  if (code) {\n    query += ' AND code = ?';\n    params.push(code);\n  }\n\n  query += ' ORDER BY created_at DESC LIMIT ?';\n  params.push(limit);\n\n  const stmt = db.prepare(query);\n  const result = await stmt.bind(...params).all();\n  return result.results;\n}\n\n/**\n * Get T+1 confirm date\n */\nfunction getConfirmDate(submitDate) {\n  const d = new Date(submitDate);\n  d.setDate(d.getDate() + 1);\n\n  // Skip weekends\n  while (d.getDay() === 0 || d.getDay() === 6) {\n    d.setDate(d.getDate() + 1);\n  }\n\n  return d.toISOString().slice(0, 10);\n}\n", "/**\n * Account/Position/Trade API routes (Hono)\n * Migrated from backend/app/routers/account.py\n */\n\nimport { Hono } from 'hono';\nimport { getCurrentUser, verifyAccountOwnership } from '../auth.js';\nimport {\n  getUserAccounts, createAccount, updateAccount, deleteAccount,\n  getPositions, getAggregatePositions, upsertPosition, removePosition,\n  addTrade, reduceTrade, getTransactions,\n} from '../services/account.js';\nimport { getCombinedValuation, getFundHistory, calculateTechnicalIndicators, getFundCategory } from '../services/fund.js';\n\nconst account = new Hono();\n\n// ============================================================================\n// Account endpoints\n// ============================================================================\n\naccount.get('/accounts', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n  const accounts = await getUserAccounts(c.env.DB, user.id);\n  return c.json(accounts);\n});\n\naccount.post('/accounts', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n  const { name, description } = await c.req.json();\n  if (!name) return c.json({ detail: '\u8D26\u6237\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A' }, 400);\n\n  try {\n    const id = await createAccount(c.env.DB, user.id, name, description);\n    return c.json({ id, name, description, message: '\u8D26\u6237\u521B\u5EFA\u6210\u529F' });\n  } catch (e) {\n    return c.json({ detail: e.message }, 400);\n  }\n});\n\naccount.put('/accounts/:id', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const accountId = parseInt(c.req.param('id'));\n  if (!(await verifyAccountOwnership(c.env.DB, accountId, user))) {\n    return c.json({ detail: '\u65E0\u6743\u64CD\u4F5C\u6B64\u8D26\u6237' }, 403);\n  }\n\n  const { name, description } = await c.req.json();\n  await updateAccount(c.env.DB, accountId, name, description);\n  return c.json({ message: '\u8D26\u6237\u5DF2\u66F4\u65B0' });\n});\n\naccount.delete('/accounts/:id', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const accountId = parseInt(c.req.param('id'));\n  if (!(await verifyAccountOwnership(c.env.DB, accountId, user))) {\n    return c.json({ detail: '\u65E0\u6743\u64CD\u4F5C\u6B64\u8D26\u6237' }, 403);\n  }\n\n  try {\n    await deleteAccount(c.env.DB, accountId);\n    return c.json({ message: '\u8D26\u6237\u5DF2\u5220\u9664' });\n  } catch (e) {\n    return c.json({ detail: e.message }, 400);\n  }\n});\n\n// ============================================================================\n// Position endpoints\n// ============================================================================\n\n// GET /api/positions/aggregate - aggregated positions across all accounts\naccount.get('/positions/aggregate', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const db = c.env.DB;\n  const positions = await getAggregatePositions(db, user.id);\n\n  // Enrich with real-time valuations\n  const enriched = [];\n  for (const pos of positions) {\n    try {\n      const valuation = await getCombinedValuation(db, pos.code);\n      const fundRow = await db.prepare('SELECT name, type FROM funds WHERE code = ?').bind(pos.code).first();\n      const name = valuation.name || fundRow?.name || pos.code;\n      const type = fundRow?.type || '';\n      const category = getFundCategory(type);\n\n      const nav = parseFloat(valuation.nav || 0);\n      const estimate = parseFloat(valuation.estimate || 0);\n      const estRate = parseFloat(valuation.estRate || 0);\n      const shares = parseFloat(pos.shares || 0);\n      const cost = parseFloat(pos.cost || 0);\n\n      const marketValue = estimate > 0 ? estimate * shares : nav * shares;\n      const totalReturn = cost > 0 ? ((marketValue - cost) / cost * 100) : 0;\n\n      enriched.push({\n        code: pos.code,\n        name,\n        type,\n        category,\n        cost,\n        shares,\n        nav,\n        estimate,\n        estRate,\n        marketValue: Math.round(marketValue * 100) / 100,\n        totalReturn: Math.round(totalReturn * 100) / 100,\n        time: valuation.time || '--',\n        account_id: pos.account_id,\n        account_name: pos.account_name,\n      });\n    } catch (e) {\n      enriched.push({\n        code: pos.code,\n        name: pos.code,\n        cost: pos.cost,\n        shares: pos.shares,\n        error: e.message,\n        account_id: pos.account_id,\n        account_name: pos.account_name,\n      });\n    }\n  }\n\n  return c.json(enriched);\n});\n\n// GET /api/positions?account_id=X\naccount.get('/positions', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const accountId = parseInt(c.req.query('account_id'));\n  if (!accountId) return c.json({ detail: '\u9700\u8981 account_id \u53C2\u6570' }, 400);\n\n  if (!(await verifyAccountOwnership(c.env.DB, accountId, user))) {\n    return c.json({ detail: '\u65E0\u6743\u64CD\u4F5C\u6B64\u8D26\u6237' }, 403);\n  }\n\n  const positions = await getPositions(c.env.DB, accountId);\n  return c.json(positions);\n});\n\n// PUT /api/positions - upsert position\naccount.put('/positions', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const accountId = parseInt(c.req.query('account_id'));\n  if (!accountId) return c.json({ detail: '\u9700\u8981 account_id \u53C2\u6570' }, 400);\n\n  if (!(await verifyAccountOwnership(c.env.DB, accountId, user))) {\n    return c.json({ detail: '\u65E0\u6743\u64CD\u4F5C\u6B64\u8D26\u6237' }, 403);\n  }\n\n  const { code, cost, shares } = await c.req.json();\n  if (!code) return c.json({ detail: '\u57FA\u91D1\u4EE3\u7801\u4E0D\u80FD\u4E3A\u7A7A' }, 400);\n\n  await upsertPosition(c.env.DB, accountId, code, cost, shares);\n  return c.json({ message: '\u6301\u4ED3\u5DF2\u66F4\u65B0' });\n});\n\n// DELETE /api/positions/:code\naccount.delete('/positions/:code', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const accountId = parseInt(c.req.query('account_id'));\n  if (!accountId) return c.json({ detail: '\u9700\u8981 account_id \u53C2\u6570' }, 400);\n\n  if (!(await verifyAccountOwnership(c.env.DB, accountId, user))) {\n    return c.json({ detail: '\u65E0\u6743\u64CD\u4F5C\u6B64\u8D26\u6237' }, 403);\n  }\n\n  const code = c.req.param('code');\n  await removePosition(c.env.DB, accountId, code);\n  return c.json({ message: '\u6301\u4ED3\u5DF2\u5220\u9664' });\n});\n\n// POST /api/positions/update-nav\naccount.post('/positions/update-nav', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const accountId = parseInt(c.req.query('account_id'));\n  if (!accountId) return c.json({ detail: '\u9700\u8981 account_id \u53C2\u6570' }, 400);\n\n  if (!(await verifyAccountOwnership(c.env.DB, accountId, user))) {\n    return c.json({ detail: '\u65E0\u6743\u64CD\u4F5C\u6B64\u8D26\u6237' }, 403);\n  }\n\n  const db = c.env.DB;\n  const positions = await getPositions(db, accountId);\n\n  let updated = 0;\n  let failed = 0;\n  const errors = [];\n\n  for (const pos of positions) {\n    try {\n      const history = await getFundHistory(db, pos.code, 5);\n      if (history.length > 0) updated++;\n      else failed++;\n    } catch (e) {\n      failed++;\n      errors.push(`${pos.code}: ${e.message}`);\n    }\n  }\n\n  return c.json({\n    message: `\u51C0\u503C\u66F4\u65B0\u5B8C\u6210: ${updated} \u6210\u529F, ${failed} \u5931\u8D25`,\n    updated,\n    failed,\n    errors: errors.length > 0 ? errors : undefined,\n  });\n});\n\n// ============================================================================\n// Trade endpoints\n// ============================================================================\n\n// POST /api/trade/:code/buy\naccount.post('/trade/:code/buy', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const accountId = parseInt(c.req.query('account_id'));\n  if (!accountId) return c.json({ detail: '\u9700\u8981 account_id \u53C2\u6570' }, 400);\n\n  if (!(await verifyAccountOwnership(c.env.DB, accountId, user))) {\n    return c.json({ detail: '\u65E0\u6743\u64CD\u4F5C\u6B64\u8D26\u6237' }, 403);\n  }\n\n  const code = c.req.param('code');\n  const { amount, trade_time } = await c.req.json();\n\n  if (!amount || amount <= 0) return c.json({ detail: '\u52A0\u4ED3\u91D1\u989D\u5FC5\u987B\u5927\u4E8E 0' }, 400);\n\n  try {\n    const result = await addTrade(c.env.DB, accountId, code, amount, trade_time);\n    return c.json(result);\n  } catch (e) {\n    return c.json({ detail: e.message }, 400);\n  }\n});\n\n// POST /api/trade/:code/sell\naccount.post('/trade/:code/sell', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const accountId = parseInt(c.req.query('account_id'));\n  if (!accountId) return c.json({ detail: '\u9700\u8981 account_id \u53C2\u6570' }, 400);\n\n  if (!(await verifyAccountOwnership(c.env.DB, accountId, user))) {\n    return c.json({ detail: '\u65E0\u6743\u64CD\u4F5C\u6B64\u8D26\u6237' }, 403);\n  }\n\n  const code = c.req.param('code');\n  const { shares, trade_time } = await c.req.json();\n\n  if (!shares || shares <= 0) return c.json({ detail: '\u51CF\u4ED3\u4EFD\u989D\u5FC5\u987B\u5927\u4E8E 0' }, 400);\n\n  try {\n    const result = await reduceTrade(c.env.DB, accountId, code, shares, trade_time);\n    return c.json(result);\n  } catch (e) {\n    return c.json({ detail: e.message }, 400);\n  }\n});\n\n// GET /api/transactions\naccount.get('/transactions', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const accountId = parseInt(c.req.query('account_id'));\n  if (!accountId) return c.json({ detail: '\u9700\u8981 account_id \u53C2\u6570' }, 400);\n\n  if (!(await verifyAccountOwnership(c.env.DB, accountId, user))) {\n    return c.json({ detail: '\u65E0\u6743\u64CD\u4F5C\u6B64\u8D26\u6237' }, 403);\n  }\n\n  const code = c.req.query('code') || null;\n  const limit = parseInt(c.req.query('limit') || '100');\n  const transactions = await getTransactions(c.env.DB, accountId, code, limit);\n  return c.json(transactions);\n});\n\nexport default account;\n", "/**\n * AI analysis service - replaces LangChain with direct OpenAI API calls\n */\n\nimport { decryptValue } from '../crypto.js';\nimport { LINUS_FINANCIAL_ANALYSIS_PROMPT } from './prompts.js';\nimport { getFundHistory, getFundIntraday, calculateTechnicalIndicators } from './fund.js';\n\n/**\n * AI Service class\n */\nexport class AIService {\n  /**\n   * Get AI settings for a user\n   */\n  async getAISettings(db, env, userId) {\n    const loadSettings = async (targetUserId) => {\n      let rows = [];\n      if (targetUserId == null) {\n        const result = await db.prepare(\n          'SELECT key, value, encrypted FROM settings WHERE user_id IS NULL'\n        ).all();\n        rows = result.results || [];\n      } else {\n        const result = await db.prepare(\n          'SELECT key, value, encrypted FROM settings WHERE user_id = ?'\n        ).bind(targetUserId).all();\n        rows = result.results || [];\n      }\n\n      const settingsObj = {};\n      for (const row of rows) {\n        let value = row.value;\n        if (row.encrypted && value) {\n          value = await decryptValue(value, env);\n        }\n        settingsObj[row.key] = value;\n      }\n      return settingsObj;\n    };\n\n    const globalSettings = await loadSettings(null);\n    let adminSettings = {};\n    if (userId != null) {\n      const adminRow = await db.prepare(\n        'SELECT id FROM users WHERE is_admin = 1 ORDER BY id LIMIT 1'\n      ).first();\n\n      if (adminRow?.id && adminRow.id !== userId) {\n        adminSettings = await loadSettings(adminRow.id);\n      }\n    }\n\n    const userSettings = userId != null ? await loadSettings(userId) : {};\n    const settings = { ...globalSettings, ...adminSettings, ...userSettings };\n\n    return {\n      apiBase: env.OPENAI_API_BASE || settings.OPENAI_API_BASE || 'https://integrate.api.nvidia.com/v1',\n      apiKey: env.OPENAI_API_KEY || settings.OPENAI_API_KEY || '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',\n      model: env.AI_MODEL_NAME || settings.AI_MODEL_NAME || 'deepseek-ai/deepseek-v3.2',\n    };\n  }\n\n  /**\n   * Get prompt template from database\n   */\n  async getPromptTemplate(db, promptId, userId) {\n    let row;\n    if (promptId) {\n      if (userId == null) {\n        row = await db.prepare(\n          'SELECT system_prompt, user_prompt FROM ai_prompts WHERE id = ? AND user_id IS NULL'\n        ).bind(promptId).first();\n      } else {\n        row = await db.prepare(\n          'SELECT system_prompt, user_prompt FROM ai_prompts WHERE id = ? AND user_id = ?'\n        ).bind(promptId, userId).first();\n      }\n    } else {\n      if (userId == null) {\n        row = await db.prepare(\n          'SELECT system_prompt, user_prompt FROM ai_prompts WHERE is_default = 1 AND user_id IS NULL LIMIT 1'\n        ).first();\n      } else {\n        row = await db.prepare(\n          'SELECT system_prompt, user_prompt FROM ai_prompts WHERE is_default = 1 AND user_id = ? LIMIT 1'\n        ).bind(userId).first();\n      }\n    }\n\n    if (!row) return null;\n    return { systemPrompt: row.system_prompt, userPrompt: row.user_prompt };\n  }\n\n  /**\n   * Search news via DuckDuckGo\n   */\n  async searchNews(query) {\n    try {\n      const resp = await fetch(\n        `https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_redirect=1&no_html=1&t=fundval`,\n        { headers: { 'User-Agent': 'FundVal-Live/1.0' } }\n      );\n      const data = await resp.json();\n\n      if (!data.RelatedTopics || data.RelatedTopics.length === 0) {\n        return '\u6682\u65E0\u76F8\u5173\u8FD1\u671F\u65B0\u95FB\u3002';\n      }\n\n      return data.RelatedTopics\n        .slice(0, 5)\n        .map((t, i) => `${i + 1}. ${t.Text || ''}`)\n        .join('\\n');\n    } catch {\n      return '\u65B0\u95FB\u641C\u7D22\u670D\u52A1\u6682\u65F6\u4E0D\u53EF\u7528\u3002';\n    }\n  }\n\n  /**\n   * Calculate simple indicators\n   */\n  calculateIndicators(history) {\n    if (!history || history.length < 5) {\n      return { status: '\u6570\u636E\u4E0D\u8DB3', desc: '\u65B0\u57FA\u91D1\u6216\u6570\u636E\u7F3A\u5931' };\n    }\n\n    const navs = history.map(h => h.nav);\n    const current = navs[navs.length - 1];\n    const max = Math.max(...navs);\n    const min = Math.min(...navs);\n    const avg = navs.reduce((a, b) => a + b, 0) / navs.length;\n\n    const position = max > min ? (current - min) / (max - min) : 0.5;\n\n    let status = '\u6B63\u5E38';\n    if (position > 0.9) status = '\u9AD8\u4F4D';\n    else if (position < 0.1) status = '\u4F4E\u4F4D';\n    else if (current > avg * 1.05) status = '\u504F\u9AD8';\n    else if (current < avg * 0.95) status = '\u504F\u4F4E';\n\n    const posLabel = position > 0.8 ? '\u9AD8\u4F4D' : position < 0.2 ? '\u4F4E\u4F4D' : '\u4E2D\u4F4D';\n    return {\n      status,\n      desc: `\u8FD130\u65E5\u6700\u9AD8${max.toFixed(4)}, \u6700\u4F4E${min.toFixed(4)}, \u73B0\u4EF7\u5904\u4E8E${posLabel}\u533A\u95F4 (${Math.round(position * 100)}%)`,\n    };\n  }\n\n  /**\n   * Analyze fund using LLM\n   */\n  async analyzeFund(db, env, fundInfo, promptId = null, userId = null) {\n    const settings = await this.getAISettings(db, env, userId);\n\n    if (!settings.apiKey) {\n      return {\n        markdown: '## \u914D\u7F6E\u9519\u8BEF\\n\\n\u672A\u914D\u7F6E OpenAI API Key\uFF0C\u8BF7\u524D\u5F80\u8BBE\u7F6E\u9875\u9762\u914D\u7F6E\u3002',\n        indicators: { status: '\u672A\u77E5', desc: '\u65E0\u6CD5\u5206\u6790' },\n        timestamp: new Date().toTimeString().slice(0, 8),\n      };\n    }\n\n    const fundId = fundInfo.id;\n    const fundName = fundInfo.name || '\u672A\u77E5\u57FA\u91D1';\n\n    // 1. Gather data\n    const fundDetail = await getFundIntraday(db, fundId);\n    const techData = fundDetail.indicators?.technical || {};\n\n    const history = await getFundHistory(db, fundId, 250);\n    const indicators = this.calculateIndicators(\n      history.length >= 30 ? history.slice(0, 30) : history\n    );\n\n    let historySummary = '\u6682\u65E0\u5386\u53F2\u6570\u636E';\n    if (history.length > 0) {\n      const recent = history.slice(0, 30);\n      historySummary = `\u8FD130\u65E5\u8D70\u52BF: \u8D77\u59CB${recent[0].nav} -> \u7ED3\u675F${recent[recent.length - 1].nav}. ${indicators.desc}`;\n    }\n\n    let holdingsStr = '';\n    if (fundDetail.holdings && fundDetail.holdings.length > 0) {\n      holdingsStr = fundDetail.holdings\n        .slice(0, 10)\n        .map(h => `- ${h.name}: ${h.percent}% (\u6DA8\u8DCC: ${h.change >= 0 ? '+' : ''}${h.change.toFixed(2)}%)`)\n        .join('\\n');\n    }\n\n    // 2. Build prompt\n    const variables = {\n      fund_code: fundId,\n      fund_name: fundName,\n      fund_type: fundDetail.type || '\u672A\u77E5',\n      manager: fundDetail.manager || '\u672A\u77E5',\n      nav: fundDetail.nav || '--',\n      estimate: fundDetail.estimate || '--',\n      est_rate: `${fundDetail.estRate || 0}%`,\n      concentration: fundDetail.indicators?.concentration || '--',\n      holdings: holdingsStr || '\u6682\u65E0\u6301\u4ED3\u6570\u636E',\n      sharpe: techData.sharpe || '--',\n      volatility: techData.volatility || '--',\n      max_drawdown: techData.max_drawdown || '--',\n      annual_return: techData.annual_return || '--',\n      history_summary: historySummary,\n    };\n\n    // Get custom or default prompt\n    const customPrompt = await this.getPromptTemplate(db, promptId, userId);\n\n    let messages;\n    if (customPrompt && customPrompt.systemPrompt && customPrompt.userPrompt) {\n      messages = [\n        { role: 'system', content: this.replaceVariables(customPrompt.systemPrompt, variables) },\n        { role: 'user', content: this.replaceVariables(customPrompt.userPrompt, variables) },\n      ];\n    } else {\n      // Use default hardcoded prompt\n      messages = LINUS_FINANCIAL_ANALYSIS_PROMPT(variables);\n    }\n\n    // 3. Call LLM\n    try {\n      const apiUrl = `${settings.apiBase.replace(/\\/$/, '')}/chat/completions`;\n      const resp = await fetch(apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${settings.apiKey}`,\n        },\n        body: JSON.stringify({\n          model: settings.model,\n          messages,\n          temperature: 0.3,\n          max_tokens: 4096,\n        }),\n      });\n\n      if (!resp.ok) {\n        const errText = await resp.text();\n        throw new Error(`API returned ${resp.status}: ${errText}`);\n      }\n\n      const result = await resp.json();\n      let markdown = result.choices?.[0]?.message?.content || '';\n\n      // Clean up\n      markdown = markdown.trim();\n      if (markdown.includes('```markdown')) {\n        markdown = markdown.split('```markdown')[1].split('```')[0].trim();\n      } else if (markdown.startsWith('```') && markdown.endsWith('```')) {\n        markdown = markdown.slice(3, -3).trim();\n      }\n\n      // Save history\n      await this.saveAnalysisHistory(db, {\n        userId,\n        accountId: fundInfo.account_id || 1,\n        fundCode: fundId,\n        fundName,\n        promptId,\n        promptName: await this.getPromptName(db, promptId, userId),\n        markdown,\n        indicatorsJson: JSON.stringify(indicators),\n        status: 'success',\n      });\n\n      return {\n        markdown,\n        indicators,\n        timestamp: new Date().toTimeString().slice(0, 8),\n      };\n    } catch (e) {\n      console.error(`AI Analysis Error: ${e.message}`);\n      const errorMarkdown = `## \u5206\u6790\u5931\u8D25\\n\\nLLM \u8C03\u7528\u5931\u8D25: ${e.message}\\n\\n\u8BF7\u68C0\u67E5 API \u914D\u7F6E\u548C\u63D0\u793A\u8BCD\u683C\u5F0F\u3002`;\n\n      await this.saveAnalysisHistory(db, {\n        userId,\n        accountId: fundInfo.account_id || 1,\n        fundCode: fundId,\n        fundName,\n        promptId,\n        promptName: await this.getPromptName(db, promptId, userId),\n        markdown: errorMarkdown,\n        indicatorsJson: JSON.stringify(indicators),\n        status: 'failed',\n        errorMessage: e.message,\n      });\n\n      return {\n        markdown: errorMarkdown,\n        indicators,\n        timestamp: new Date().toTimeString().slice(0, 8),\n      };\n    }\n  }\n\n  /**\n   * Replace template variables in prompt\n   */\n  replaceVariables(template, variables) {\n    return template.replace(/\\{(\\w+)\\}/g, (match, key) => {\n      return variables[key] !== undefined ? String(variables[key]) : match;\n    });\n  }\n\n  async getPromptName(db, promptId, userId) {\n    if (!promptId) return '\u9ED8\u8BA4\u63D0\u793A\u8BCD';\n    let row;\n    if (userId == null) {\n      row = await db.prepare('SELECT name FROM ai_prompts WHERE id = ? AND user_id IS NULL').bind(promptId).first();\n    } else {\n      row = await db.prepare('SELECT name FROM ai_prompts WHERE id = ? AND user_id = ?').bind(promptId, userId).first();\n    }\n    return row?.name || `Prompt #${promptId}`;\n  }\n\n  async saveAnalysisHistory(db, { userId, accountId, fundCode, fundName, promptId, promptName, markdown, indicatorsJson, status, errorMessage = null }) {\n    try {\n      await db.prepare(`\n        INSERT INTO ai_analysis_history\n        (user_id, account_id, fund_code, fund_name, prompt_id, prompt_name, markdown, indicators_json, status, error_message)\n        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n      `).bind(userId, accountId, fundCode, fundName, promptId, promptName, markdown, indicatorsJson, status, errorMessage).run();\n\n      // Cleanup old records (keep last 50)\n      await this.cleanupOldHistory(db, userId, accountId, fundCode);\n    } catch (e) {\n      console.error(`Failed to save analysis history: ${e.message}`);\n    }\n  }\n\n  async cleanupOldHistory(db, userId, accountId, fundCode) {\n    try {\n      let countRow;\n      if (userId == null) {\n        countRow = await db.prepare(\n          'SELECT COUNT(*) as cnt FROM ai_analysis_history WHERE user_id IS NULL AND account_id = ? AND fund_code = ?'\n        ).bind(accountId, fundCode).first();\n      } else {\n        countRow = await db.prepare(\n          'SELECT COUNT(*) as cnt FROM ai_analysis_history WHERE user_id = ? AND account_id = ? AND fund_code = ?'\n        ).bind(userId, accountId, fundCode).first();\n      }\n\n      if (countRow.cnt > 50) {\n        const toDelete = countRow.cnt - 50;\n        if (userId == null) {\n          await db.prepare(`\n            DELETE FROM ai_analysis_history WHERE rowid IN (\n              SELECT rowid FROM ai_analysis_history\n              WHERE user_id IS NULL AND account_id = ? AND fund_code = ?\n              ORDER BY created_at ASC LIMIT ?\n            )\n          `).bind(accountId, fundCode, toDelete).run();\n        } else {\n          await db.prepare(`\n            DELETE FROM ai_analysis_history WHERE rowid IN (\n              SELECT rowid FROM ai_analysis_history\n              WHERE user_id = ? AND account_id = ? AND fund_code = ?\n              ORDER BY created_at ASC LIMIT ?\n            )\n          `).bind(userId, accountId, fundCode, toDelete).run();\n        }\n      }\n    } catch (e) {\n      console.error(`Failed to cleanup history: ${e.message}`);\n    }\n  }\n}\n\nexport const aiService = new AIService();\n", "/**\n * AI API routes (Hono)\n * Migrated from backend/app/routers/ai.py\n */\n\nimport { Hono } from 'hono';\nimport { getCurrentUser, hasAdminUser } from '../auth.js';\nimport { aiService } from '../services/ai.js';\n\nconst ai = new Hono();\n\nai.post('/chat', async (c) => {\n  const multiUserMode = await hasAdminUser(c.env.DB);\n  const user = await getCurrentUser(c);\n  if (multiUserMode && !user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const body = await c.req.json();\n  const { messages, stream, temperature, max_tokens, top_p } = body || {};\n  if (!Array.isArray(messages) || messages.length === 0) {\n    return c.json({ detail: 'messages \u4E0D\u80FD\u4E3A\u7A7A' }, 400);\n  }\n\n  let settings = { apiBase: '', apiKey: '', model: '' };\n  try {\n    settings = await aiService.getAISettings(c.env.DB, c.env, user?.id ?? null);\n  } catch {\n    settings = { apiBase: '', apiKey: '', model: '' };\n  }\n\n  const apiBase = (c.env.NVIDIA_API_BASE || settings.apiBase || 'https://integrate.api.nvidia.com/v1').replace(/\\/$/, '');\n  const apiKey = c.env.NVIDIA_API_KEY || settings.apiKey;\n  const model = c.env.NVIDIA_MODEL || settings.model || 'meta/llama-3.1-70b-instruct';\n\n  if (!apiKey) {\n    return c.json({ detail: '\u672A\u914D\u7F6E NVIDIA_API_KEY\u3002\u4E5F\u53EF\u5728 \u7CFB\u7EDF\u8BBE\u7F6E \u2192 AI \u914D\u7F6E \u4E2D\u586B\u5199 OPENAI_API_KEY\uFF08\u53EF\u76F4\u63A5\u586B NVIDIA Key\uFF09\u540E\u91CD\u8BD5\u3002' }, 500);\n  }\n\n  const resp = await fetch(`${apiBase}/chat/completions`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${apiKey}`,\n    },\n    body: JSON.stringify({\n      model,\n      messages,\n      stream: !!stream,\n      temperature: typeof temperature === 'number' ? temperature : 0.2,\n      top_p: typeof top_p === 'number' ? top_p : 0.9,\n      max_tokens: typeof max_tokens === 'number' ? max_tokens : 2048,\n    }),\n  });\n\n  if (!resp.ok) {\n    const errText = await resp.text();\n    return c.json({ detail: errText || `\u4E0A\u6E38\u8FD4\u56DE ${resp.status}` }, 500);\n  }\n\n  if (stream) {\n    return new Response(resp.body, {\n      status: 200,\n      headers: {\n        'Content-Type': 'text/event-stream; charset=utf-8',\n        'Cache-Control': 'no-cache',\n      },\n    });\n  }\n\n  const data = await resp.json();\n  return c.json(data);\n});\n\n// POST /api/ai/analyze\nai.post('/analyze', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const body = await c.req.json();\n  const { fund_id, fund_name, prompt_id, account_id } = body;\n\n  if (!fund_id) return c.json({ detail: '\u9700\u8981\u6307\u5B9A\u57FA\u91D1\u4EE3\u7801' }, 400);\n\n  try {\n    const result = await aiService.analyzeFund(c.env.DB, c.env, {\n      id: fund_id,\n      name: fund_name,\n      account_id: account_id || 1,\n    }, prompt_id, user.id);\n\n    return c.json(result);\n  } catch (e) {\n    console.error(`AI analysis error: ${e.message}`);\n    return c.json({ detail: e.message }, 500);\n  }\n});\n\n// GET /api/ai/history?account_id=X&fund_code=Y&limit=10\nai.get('/history', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const db = c.env.DB;\n  const accountId = c.req.query('account_id');\n  const fundCode = c.req.query('fund_code');\n  const limit = parseInt(c.req.query('limit') || '10');\n\n  let query = 'SELECT * FROM ai_analysis_history WHERE user_id = ?';\n  const params = [user.id];\n\n  if (accountId) {\n    query += ' AND account_id = ?';\n    params.push(parseInt(accountId));\n  }\n\n  if (fundCode) {\n    query += ' AND fund_code = ?';\n    params.push(fundCode);\n  }\n\n  query += ' ORDER BY created_at DESC LIMIT ?';\n  params.push(limit);\n\n  const result = await db.prepare(query).bind(...params).all();\n  return c.json(result.results);\n});\n\n// DELETE /api/ai/history/:id\nai.delete('/history/:id', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const historyId = parseInt(c.req.param('id'));\n  await c.env.DB.prepare(\n    'DELETE FROM ai_analysis_history WHERE id = ? AND user_id = ?'\n  ).bind(historyId, user.id).run();\n\n  return c.json({ message: '\u5DF2\u5220\u9664' });\n});\n\n// ============================================================================\n// Prompt Management\n// ============================================================================\n\n// GET /api/ai/prompts\nai.get('/prompts', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const result = await c.env.DB.prepare(\n    'SELECT id, name, system_prompt, user_prompt, is_default, created_at, updated_at FROM ai_prompts WHERE user_id = ? ORDER BY is_default DESC, id'\n  ).bind(user.id).all();\n\n  return c.json(result.results);\n});\n\n// POST /api/ai/prompts\nai.post('/prompts', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const { name, system_prompt, user_prompt, is_default } = await c.req.json();\n  if (!name) return c.json({ detail: '\u63D0\u793A\u8BCD\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A' }, 400);\n\n  const db = c.env.DB;\n\n  // If setting as default, unset existing defaults\n  if (is_default) {\n    await db.prepare(\n      'UPDATE ai_prompts SET is_default = 0 WHERE user_id = ?'\n    ).bind(user.id).run();\n  }\n\n  const result = await db.prepare(\n    'INSERT INTO ai_prompts (name, prompt, system_prompt, user_prompt, is_default, user_id) VALUES (?, ?, ?, ?, ?, ?)'\n  ).bind(name, '', system_prompt || '', user_prompt || '', is_default ? 1 : 0, user.id).run();\n\n  return c.json({ id: result.meta.last_row_id, message: '\u63D0\u793A\u8BCD\u5DF2\u521B\u5EFA' });\n});\n\n// PUT /api/ai/prompts/:id\nai.put('/prompts/:id', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const promptId = parseInt(c.req.param('id'));\n  const { name, system_prompt, user_prompt, is_default } = await c.req.json();\n\n  const db = c.env.DB;\n\n  if (is_default) {\n    await db.prepare(\n      'UPDATE ai_prompts SET is_default = 0 WHERE user_id = ?'\n    ).bind(user.id).run();\n  }\n\n  await db.prepare(\n    'UPDATE ai_prompts SET name = ?, system_prompt = ?, user_prompt = ?, is_default = ?, updated_at = datetime() WHERE id = ? AND user_id = ?'\n  ).bind(name, system_prompt || '', user_prompt || '', is_default ? 1 : 0, promptId, user.id).run();\n\n  return c.json({ message: '\u63D0\u793A\u8BCD\u5DF2\u66F4\u65B0' });\n});\n\n// DELETE /api/ai/prompts/:id\nai.delete('/prompts/:id', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const promptId = parseInt(c.req.param('id'));\n  await c.env.DB.prepare(\n    'DELETE FROM ai_prompts WHERE id = ? AND user_id = ?'\n  ).bind(promptId, user.id).run();\n\n  return c.json({ message: '\u63D0\u793A\u8BCD\u5DF2\u5220\u9664' });\n});\n\nexport default ai;\n", "/**\n * Settings API routes (Hono)\n * Migrated from backend/app/routers/settings.py\n */\n\nimport { Hono } from 'hono';\nimport { getCurrentUser } from '../auth.js';\nimport { encryptValue, decryptValue } from '../crypto.js';\n\nconst settings = new Hono();\n\nconst ENCRYPTED_FIELDS = new Set(['OPENAI_API_KEY', 'SMTP_PASSWORD']);\n\nfunction validateEmail(email) {\n  return /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/.test(email);\n}\n\nfunction validateUrl(url) {\n  return /^https?:\\/\\/\\S+$/.test(url);\n}\n\nfunction validatePort(port) {\n  const p = parseInt(port);\n  return !isNaN(p) && p >= 1 && p <= 65535;\n}\n\n// GET /api/settings\nsettings.get('/settings', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const db = c.env.DB;\n  const result = await db.prepare(\n    'SELECT key, value, encrypted FROM settings WHERE user_id = ?'\n  ).bind(user.id).all();\n\n  const settingsObj = {};\n  for (const row of result.results) {\n    if (row.encrypted && row.value) {\n      settingsObj[row.key] = '***';\n    } else {\n      settingsObj[row.key] = row.value;\n    }\n  }\n\n  // Fallback defaults\n  if (Object.keys(settingsObj).length === 0) {\n    return c.json({\n      settings: {\n        OPENAI_API_KEY: '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',\n        OPENAI_API_BASE: 'https://integrate.api.nvidia.com/v1',\n        AI_MODEL_NAME: 'deepseek-ai/deepseek-v3.2',\n        SMTP_HOST: 'smtp.gmail.com',\n        SMTP_PORT: '587',\n        SMTP_USER: '',\n        SMTP_PASSWORD: '',\n        EMAIL_FROM: '',\n      },\n    });\n  }\n\n  return c.json({ settings: settingsObj });\n});\n\n// POST /api/settings\nsettings.post('/settings', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const body = await c.req.json();\n  const settingsData = body.settings || {};\n  const errors = {};\n\n  // Validate\n  if ('SMTP_PORT' in settingsData && settingsData.SMTP_PORT) {\n    if (!validatePort(settingsData.SMTP_PORT)) {\n      errors.SMTP_PORT = '\u7AEF\u53E3\u5FC5\u987B\u5728 1-65535 \u4E4B\u95F4';\n    }\n  }\n  if ('SMTP_USER' in settingsData && settingsData.SMTP_USER) {\n    if (!validateEmail(settingsData.SMTP_USER)) {\n      errors.SMTP_USER = '\u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E';\n    }\n  }\n  if ('EMAIL_FROM' in settingsData && settingsData.EMAIL_FROM) {\n    if (!validateEmail(settingsData.EMAIL_FROM)) {\n      errors.EMAIL_FROM = '\u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E';\n    }\n  }\n  if ('OPENAI_API_BASE' in settingsData && settingsData.OPENAI_API_BASE) {\n    if (!validateUrl(settingsData.OPENAI_API_BASE)) {\n      errors.OPENAI_API_BASE = 'URL \u683C\u5F0F\u4E0D\u6B63\u786E';\n    }\n  }\n\n  if (Object.keys(errors).length > 0) {\n    return c.json({ detail: { errors } }, 400);\n  }\n\n  const db = c.env.DB;\n  for (const [key, value] of Object.entries(settingsData)) {\n    if (value === '***') continue; // Masked, not modified\n\n    const encrypted = ENCRYPTED_FIELDS.has(key) ? 1 : 0;\n    let storedValue = value;\n    if (encrypted && value) {\n      storedValue = await encryptValue(value, c.env);\n    }\n\n    await db.prepare(`\n      INSERT INTO settings (key, value, encrypted, user_id, updated_at)\n      VALUES (?, ?, ?, ?, datetime())\n      ON CONFLICT(key, user_id) DO UPDATE SET\n        value = excluded.value,\n        encrypted = excluded.encrypted,\n        updated_at = datetime()\n    `).bind(key, storedValue, encrypted, user.id).run();\n  }\n\n  return c.json({ message: '\u8BBE\u7F6E\u5DF2\u4FDD\u5B58' });\n});\n\n// GET /api/preferences\nsettings.get('/preferences', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const db = c.env.DB;\n\n  const watchlistRow = await db.prepare(\n    \"SELECT value FROM settings WHERE user_id = ? AND key = 'user_watchlist'\"\n  ).bind(user.id).first();\n\n  const accountRow = await db.prepare(\n    \"SELECT value FROM settings WHERE user_id = ? AND key = 'user_current_account'\"\n  ).bind(user.id).first();\n\n  const sortRow = await db.prepare(\n    \"SELECT value FROM settings WHERE user_id = ? AND key = 'user_sort_option'\"\n  ).bind(user.id).first();\n\n  return c.json({\n    watchlist: watchlistRow?.value || '[]',\n    currentAccount: accountRow ? parseInt(accountRow.value) : 1,\n    sortOption: sortRow?.value || null,\n  });\n});\n\n// POST /api/preferences\nsettings.post('/preferences', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const db = c.env.DB;\n  const data = await c.req.json();\n\n  const upsertPref = async (key, value) => {\n    await db.prepare(`\n      INSERT INTO settings (key, value, encrypted, user_id, updated_at)\n      VALUES (?, ?, 0, ?, datetime())\n      ON CONFLICT(key, user_id) DO UPDATE SET\n        value = excluded.value, updated_at = datetime()\n    `).bind(key, String(value), user.id).run();\n  };\n\n  if ('watchlist' in data) await upsertPref('user_watchlist', data.watchlist);\n  if ('currentAccount' in data) await upsertPref('user_current_account', data.currentAccount);\n  if ('sortOption' in data) await upsertPref('user_sort_option', data.sortOption);\n\n  return c.json({ message: '\u504F\u597D\u5DF2\u4FDD\u5B58' });\n});\n\nexport default settings;\n", "/**\n * Data import/export service\n */\n\n/**\n * Export user data\n */\nexport async function exportData(db, modules, user) {\n  const data = { version: 1, exported_at: new Date().toISOString(), modules: {} };\n\n  for (const mod of modules) {\n    switch (mod) {\n      case 'accounts': {\n        const result = await db.prepare(\n          'SELECT id, name, description, created_at, updated_at FROM accounts WHERE user_id = ?'\n        ).bind(user.id).all();\n        data.modules.accounts = result.results;\n        break;\n      }\n      case 'positions': {\n        const result = await db.prepare(`\n          SELECT p.account_id, p.code, p.cost, p.shares, p.updated_at, a.name as account_name\n          FROM positions p\n          JOIN accounts a ON a.id = p.account_id\n          WHERE a.user_id = ?\n        `).bind(user.id).all();\n        data.modules.positions = result.results;\n        break;\n      }\n      case 'transactions': {\n        const result = await db.prepare(`\n          SELECT t.*\n          FROM transactions t\n          JOIN accounts a ON a.id = t.account_id\n          WHERE a.user_id = ?\n          ORDER BY t.created_at DESC\n        `).bind(user.id).all();\n        data.modules.transactions = result.results;\n        break;\n      }\n      case 'ai_prompts': {\n        const result = await db.prepare(\n          'SELECT id, name, prompt, system_prompt, user_prompt, is_default, created_at, updated_at FROM ai_prompts WHERE user_id = ?'\n        ).bind(user.id).all();\n        data.modules.ai_prompts = result.results;\n        break;\n      }\n      case 'subscriptions': {\n        const result = await db.prepare(\n          'SELECT * FROM subscriptions WHERE user_id = ?'\n        ).bind(user.id).all();\n        data.modules.subscriptions = result.results;\n        break;\n      }\n      case 'settings': {\n        const result = await db.prepare(\n          'SELECT key, value, encrypted FROM settings WHERE user_id = ? AND key NOT IN (?, ?)'\n        ).bind(user.id, 'OPENAI_API_KEY', 'SMTP_PASSWORD').all();\n        data.modules.settings = result.results;\n        break;\n      }\n    }\n  }\n\n  return data;\n}\n\n/**\n * Import user data\n */\nexport async function importData(db, data, modules, mode, user) {\n  const results = {};\n\n  for (const mod of modules) {\n    const modData = data[mod] || data?.modules?.[mod];\n    if (!modData || !Array.isArray(modData)) {\n      results[mod] = { status: 'skipped', reason: '\u65E0\u6570\u636E' };\n      continue;\n    }\n\n    try {\n      if (mode === 'replace') {\n        await clearModuleData(db, mod, user.id);\n      }\n\n      let imported = 0;\n      switch (mod) {\n        case 'accounts':\n          for (const item of modData) {\n            await db.prepare(\n              'INSERT OR IGNORE INTO accounts (name, description, user_id) VALUES (?, ?, ?)'\n            ).bind(item.name, item.description || '', user.id).run();\n            imported++;\n          }\n          break;\n\n        case 'positions':\n          for (const item of modData) {\n            let accountId = item.account_id;\n            if (item.account_name) {\n              const acc = await db.prepare(\n                'SELECT id FROM accounts WHERE name = ? AND user_id = ?'\n              ).bind(item.account_name, user.id).first();\n              if (acc) accountId = acc.id;\n            }\n            if (!accountId) continue;\n            await db.prepare(`\n              INSERT OR REPLACE INTO positions (account_id, code, cost, shares, updated_at)\n              VALUES (?, ?, ?, ?, datetime())\n            `).bind(accountId, item.code, item.cost, item.shares).run();\n            imported++;\n          }\n          break;\n\n        case 'transactions':\n          for (const item of modData) {\n            await db.prepare(`\n              INSERT INTO transactions (account_id, code, op_type, amount_cny, shares_redeemed, confirm_date, confirm_nav, shares_added, cost_after)\n              VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)\n            `).bind(\n              item.account_id, item.code, item.op_type, item.amount_cny,\n              item.shares_redeemed, item.confirm_date, item.confirm_nav,\n              item.shares_added, item.cost_after\n            ).run();\n            imported++;\n          }\n          break;\n\n        case 'ai_prompts':\n          for (const item of modData) {\n            await db.prepare(`\n              INSERT OR REPLACE INTO ai_prompts (name, prompt, system_prompt, user_prompt, is_default, user_id)\n              VALUES (?, ?, ?, ?, ?, ?)\n            `).bind(item.name, item.prompt || '', item.system_prompt || '', item.user_prompt || '', item.is_default || 0, user.id).run();\n            imported++;\n          }\n          break;\n\n        case 'subscriptions':\n          for (const item of modData) {\n            await db.prepare(`\n              INSERT OR IGNORE INTO subscriptions (code, email, user_id, threshold_up, threshold_down, enable_digest, digest_time, enable_volatility)\n              VALUES (?, ?, ?, ?, ?, ?, ?, ?)\n            `).bind(item.code, item.email, user.id, item.threshold_up, item.threshold_down, item.enable_digest || 0, item.digest_time || '14:45', item.enable_volatility ?? 1).run();\n            imported++;\n          }\n          break;\n\n        case 'settings':\n          for (const item of modData) {\n            if (item.key === 'OPENAI_API_KEY' || item.key === 'SMTP_PASSWORD') continue;\n            await db.prepare(`\n              INSERT OR REPLACE INTO settings (key, value, encrypted, user_id, updated_at)\n              VALUES (?, ?, ?, ?, datetime())\n            `).bind(item.key, item.value, item.encrypted || 0, user.id).run();\n            imported++;\n          }\n          break;\n      }\n\n      results[mod] = { status: 'ok', imported };\n    } catch (e) {\n      results[mod] = { status: 'error', error: e.message };\n    }\n  }\n\n  return { results };\n}\n\nasync function clearModuleData(db, mod, userId) {\n  switch (mod) {\n    case 'accounts':\n      await db.prepare('DELETE FROM accounts WHERE user_id = ?').bind(userId).run();\n      break;\n    case 'positions':\n      await db.prepare(`\n        DELETE FROM positions WHERE account_id IN (\n          SELECT id FROM accounts WHERE user_id = ?\n        )\n      `).bind(userId).run();\n      break;\n    case 'transactions':\n      await db.prepare(`\n        DELETE FROM transactions WHERE account_id IN (\n          SELECT id FROM accounts WHERE user_id = ?\n        )\n      `).bind(userId).run();\n      break;\n    case 'ai_prompts':\n      await db.prepare('DELETE FROM ai_prompts WHERE user_id = ?').bind(userId).run();\n      break;\n    case 'subscriptions':\n      await db.prepare('DELETE FROM subscriptions WHERE user_id = ?').bind(userId).run();\n      break;\n    case 'settings':\n      await db.prepare(\n        'DELETE FROM settings WHERE user_id = ? AND key NOT IN (?, ?)'\n      ).bind(userId, 'OPENAI_API_KEY', 'SMTP_PASSWORD').run();\n      break;\n  }\n}\n", "/**\n * Data import/export API routes (Hono)\n * Migrated from backend/app/routers/data.py\n */\n\nimport { Hono } from 'hono';\nimport { getCurrentUser } from '../auth.js';\nimport { exportData, importData } from '../services/data-io.js';\n\nconst data = new Hono();\n\nconst VALID_MODULES = ['accounts', 'positions', 'transactions', 'ai_prompts', 'subscriptions', 'settings'];\n\n// GET /api/data/export?modules=accounts,positions\ndata.get('/data/export', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const modulesParam = c.req.query('modules');\n  let moduleList;\n\n  if (modulesParam) {\n    moduleList = modulesParam.split(',').map(m => m.trim());\n    const invalid = moduleList.filter(m => !VALID_MODULES.includes(m));\n    if (invalid.length > 0) {\n      return c.json({ detail: `Invalid modules: ${invalid.join(', ')}` }, 400);\n    }\n  } else {\n    moduleList = VALID_MODULES;\n  }\n\n  try {\n    const result = await exportData(c.env.DB, moduleList, user);\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '').slice(0, 15);\n    const filename = `fundval_export_${timestamp}.json`;\n\n    return new Response(JSON.stringify(result, null, 2), {\n      headers: {\n        'Content-Type': 'application/json',\n        'Content-Disposition': `attachment; filename=${filename}`,\n      },\n    });\n  } catch (e) {\n    return c.json({ detail: e.message }, 500);\n  }\n});\n\n// POST /api/data/import\ndata.post('/data/import', async (c) => {\n  const user = await getCurrentUser(c);\n  if (!user) return c.json({ detail: '\u672A\u767B\u5F55' }, 401);\n\n  const body = await c.req.json();\n  const { data: importDataObj, modules, mode = 'merge' } = body;\n\n  if (!modules || !Array.isArray(modules)) {\n    return c.json({ detail: '\u9700\u8981\u6307\u5B9A\u5BFC\u5165\u6A21\u5757\u5217\u8868' }, 400);\n  }\n\n  if (!['merge', 'replace'].includes(mode)) {\n    return c.json({ detail: \"Invalid mode. Must be 'merge' or 'replace'\" }, 400);\n  }\n\n  const invalid = modules.filter(m => !VALID_MODULES.includes(m));\n  if (invalid.length > 0) {\n    return c.json({ detail: `Invalid modules: ${invalid.join(', ')}` }, 400);\n  }\n\n  try {\n    const result = await importData(c.env.DB, importDataObj, modules, mode, user);\n    return c.json(result);\n  } catch (e) {\n    return c.json({ detail: e.message }, 500);\n  }\n});\n\nexport default data;\n", "/**\n * System API routes (Hono)\n * Migrated from backend/app/routers/system.py\n */\n\nimport { Hono } from 'hono';\nimport { checkDatabaseVersion, CURRENT_SCHEMA_VERSION, dropAllTables, initDb, getAllTables } from '../db.js';\n\nconst system = new Hono();\n\n// GET /api/system/db-status\nsystem.get('/db-status', async (c) => {\n  const db = c.env.DB;\n\n  try {\n    const version = await checkDatabaseVersion(db);\n    const needsRebuild = version > 0 && version !== CURRENT_SCHEMA_VERSION;\n    const tables = await getAllTables(db);\n\n    return c.json({\n      version,\n      current_version: CURRENT_SCHEMA_VERSION,\n      needs_rebuild: needsRebuild,\n      table_count: tables.length,\n    });\n  } catch (e) {\n    return c.json({ detail: `Failed to check database status: ${e.message}` }, 500);\n  }\n});\n\n// POST /api/system/rebuild-db\nsystem.post('/rebuild-db', async (c) => {\n  const db = c.env.DB;\n\n  try {\n    const version = await checkDatabaseVersion(db);\n\n    if (version === CURRENT_SCHEMA_VERSION) {\n      return c.json({ detail: 'Database is already at current version, no rebuild needed' }, 400);\n    }\n\n    console.warn(`Rebuilding database (current version: ${version}, target: ${CURRENT_SCHEMA_VERSION})`);\n\n    await dropAllTables(db);\n    await initDb(db);\n\n    const newVersion = await checkDatabaseVersion(db);\n    if (newVersion !== CURRENT_SCHEMA_VERSION) {\n      throw new Error(`Rebuild failed: version is ${newVersion}, expected ${CURRENT_SCHEMA_VERSION}`);\n    }\n\n    return c.json({\n      message: 'Database rebuilt successfully',\n      version: newVersion,\n    });\n  } catch (e) {\n    if (e.message?.includes('already at current version')) {\n      return c.json({ detail: e.message }, 400);\n    }\n    return c.json({ detail: `Failed to rebuild database: ${e.message}` }, 500);\n  }\n});\n\nexport default system;\n"],
  "mappings": ";;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA,eAAsB,OAAO,IAAI;AAE/B,QAAM,aAAa,MAAM,GAAG;AAAA,IAC1B;AAAA,EACF,EAAE,MAAM;AAER,MAAI,CAAC,YAAY;AAGf,UAAM,aAAa,EAAE;AACrB,UAAM,GAAG,QAAQ,2DAA2D,EAAE,KAAK,sBAAsB,EAAE,IAAI;AAC/G,UAAM,sBAAsB,EAAE;AAC9B;AAAA,EACF;AAGA,QAAM,aAAa,MAAM,GAAG,QAAQ,oDAAoD,EAAE,MAAM;AAChG,QAAM,iBAAiB,YAAY,WAAW;AAE9C,MAAI,iBAAiB,KAAK,mBAAmB,wBAAwB;AAEnE,UAAM,cAAc,EAAE;AACtB,UAAM,aAAa,EAAE;AACrB,UAAM,GAAG,QAAQ,iDAAiD,EAAE,KAAK,sBAAsB,EAAE,IAAI;AACrG,UAAM,sBAAsB,EAAE;AAAA,EAChC;AACF;AAEA,eAAe,aAAa,IAAI;AAC9B,QAAM,aAAa;AAAA,IACjB;AAAA;AAAA;AAAA;AAAA,IAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAOA;AAAA,IACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAUA;AAAA,IACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAMA;AAAA,IACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IASA;AAAA,IACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAeA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAOA;AAAA,IACA;AAAA,IACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAgBA;AAAA,IACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAQA;AAAA,IACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAaA;AAAA,IACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAgBA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AAEA,aAAW,OAAO,YAAY;AAC5B,UAAM,GAAG,QAAQ,GAAG,EAAE,IAAI;AAAA,EAC5B;AACF;AAEA,eAAe,sBAAsB,IAAI;AACvC,QAAM,WAAW;AAAA,IACf,CAAC,kBAAkB,0EAA0E,GAAG,IAAI;AAAA,IACpG,CAAC,mBAAmB,uCAAuC,GAAG,IAAI;AAAA,IAClE,CAAC,iBAAiB,6BAA6B,GAAG,IAAI;AAAA,IACtD,CAAC,aAAa,kBAAkB,GAAG,IAAI;AAAA,IACvC,CAAC,aAAa,OAAO,GAAG,IAAI;AAAA,IAC5B,CAAC,aAAa,IAAI,GAAG,IAAI;AAAA,IACzB,CAAC,iBAAiB,IAAI,GAAG,IAAI;AAAA,IAC7B,CAAC,cAAc,wBAAwB,GAAG,IAAI;AAAA,IAC9C,CAAC,6BAA6B,KAAK,GAAG,IAAI;AAAA,EAC5C;AAEA,aAAW,CAAC,KAAK,OAAO,WAAW,MAAM,KAAK,UAAU;AACtD,UAAM,GAAG;AAAA,MACP;AAAA,IACF,EAAE,KAAK,KAAK,OAAO,WAAW,MAAM,EAAE,IAAI;AAAA,EAC5C;AACF;AAEA,eAAe,cAAc,IAAI;AAC/B,QAAM,SAAS,MAAM,GAAG;AAAA,IACtB;AAAA,EACF,EAAE,IAAI;AAEN,aAAW,EAAE,KAAK,KAAK,OAAO,SAAS;AACrC,UAAM,GAAG,QAAQ,wBAAwB,MAAM,EAAE,IAAI;AAAA,EACvD;AACF;AAKA,eAAsB,qBAAqB,IAAI;AAC7C,MAAI;AACF,UAAM,aAAa,MAAM,GAAG;AAAA,MAC1B;AAAA,IACF,EAAE,MAAM;AACR,QAAI,CAAC;AAAY,aAAO;AAExB,UAAM,MAAM,MAAM,GAAG,QAAQ,oDAAoD,EAAE,MAAM;AACzF,WAAO,KAAK,WAAW;AAAA,EACzB,QAAE;AACA,WAAO;AAAA,EACT;AACF;AAKA,eAAsB,aAAa,IAAI;AACrC,QAAM,SAAS,MAAM,GAAG;AAAA,IACtB;AAAA,EACF,EAAE,IAAI;AACN,SAAO,OAAO,QAAQ,IAAI,OAAK,EAAE,IAAI;AACvC;AA1OA,IAIM;AAJN;AAAA;AAIA,IAAM,yBAAyB;AAKT;AA4BP;AA8IA;AAoBA;AAaO;AAiBA;AAAA;AAAA;;;ACrOtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAOO,SAAS,uBAAuB,SAAS,UAAU,MAAM;AAC9D,MAAI,CAAC,WAAW,QAAQ,SAAS;AAAG,WAAO;AAE3C,YAAU,WAAW,CAAC,KAAK,KAAK,KAAK,MAAM,IAAI;AAC/C,QAAM,IAAI,KAAK,IAAI,QAAQ,QAAQ,QAAQ,SAAS,CAAC;AACrD,MAAI,IAAI;AAAG,WAAO;AAElB,MAAI;AACF,UAAM,UAAU,CAAC;AACjB,aAAS,IAAI,GAAG,KAAK,GAAG,KAAK;AAC3B,YAAM,aAAa,WAAW,QAAQ,QAAQ,SAAS,CAAC,EAAE,GAAG;AAC7D,YAAM,UAAU,WAAW,QAAQ,QAAQ,SAAS,IAAI,CAAC,EAAE,GAAG;AAC9D,cAAQ,MAAM,aAAa,WAAW,UAAU,GAAG;AAAA,IACrD;AAEA,UAAM,cAAc,QAAQ,OAAO,CAAC,KAAK,GAAG,MAAM,MAAM,IAAI,QAAQ,CAAC,GAAG,CAAC;AACzE,UAAM,cAAc,QAAQ,MAAM,GAAG,CAAC,EAAE,OAAO,CAAC,GAAG,MAAM,IAAI,GAAG,CAAC;AACjE,UAAM,iBAAiB,cAAc;AAErC,UAAM,eAAe,WAAW,QAAQ,QAAQ,SAAS,CAAC,EAAE,GAAG;AAC/D,UAAM,eAAe,gBAAgB,IAAI,iBAAiB;AAE1D,QAAI,aAAa,KAAK,IAAI,IAAI,QAAQ,QAAQ,CAAG;AACjD,UAAM,gBAAgB,QAAQ,OAAO,CAAC,GAAG,MAAM,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,IAAI;AACrE,QAAI,gBAAgB;AAAK,oBAAc;AAEvC,WAAO;AAAA,MACL,UAAU,KAAK,MAAM,eAAe,GAAK,IAAI;AAAA,MAC7C,UAAU,KAAK,MAAM,iBAAiB,GAAG,IAAI;AAAA,MAC7C,YAAY,KAAK,MAAM,aAAa,GAAG,IAAI;AAAA,MAC3C,QAAQ;AAAA,IACV;AAAA,EACF,QAAE;AACA,WAAO;AAAA,EACT;AACF;AAKO,SAAS,qBAAqB,SAAS,OAAO,GAAG;AACtD,MAAI,CAAC,WAAW,QAAQ,SAAS;AAAG,WAAO;AAC3C,QAAM,IAAI,KAAK,IAAI,MAAM,QAAQ,SAAS,CAAC;AAE3C,MAAI;AACF,UAAM,UAAU,CAAC;AACjB,aAAS,IAAI,GAAG,KAAK,GAAG,KAAK;AAC3B,YAAM,aAAa,WAAW,QAAQ,QAAQ,SAAS,CAAC,EAAE,GAAG;AAC7D,YAAM,UAAU,WAAW,QAAQ,QAAQ,SAAS,IAAI,CAAC,EAAE,GAAG;AAC9D,cAAQ,MAAM,aAAa,WAAW,UAAU,GAAG;AAAA,IACrD;AAEA,UAAM,YAAY,QAAQ,OAAO,CAAC,GAAG,MAAM,IAAI,GAAG,CAAC,IAAI,QAAQ;AAC/D,UAAM,eAAe,WAAW,QAAQ,QAAQ,SAAS,CAAC,EAAE,GAAG;AAC/D,UAAM,eAAe,gBAAgB,IAAI,YAAY;AAErD,WAAO;AAAA,MACL,UAAU,KAAK,MAAM,eAAe,GAAK,IAAI;AAAA,MAC7C,UAAU,KAAK,MAAM,YAAY,GAAG,IAAI;AAAA,MACxC,YAAY;AAAA,MACZ,QAAQ;AAAA,IACV;AAAA,EACF,QAAE;AACA,WAAO;AAAA,EACT;AACF;AAKO,SAAS,YAAY,MAAM,SAAS;AACzC,MAAI,CAAC,WAAW,QAAQ,SAAS;AAAG,WAAO;AAE3C,MAAI,QAAQ,UAAU,GAAG;AACvB,UAAM,SAAS,uBAAuB,OAAO;AAC7C,QAAI;AAAQ,aAAO;AAAA,EACrB;AAEA,SAAO,qBAAqB,OAAO;AACrC;AAtFA;AAAA;AAOgB;AAwCA;AA8BA;AAAA;AAAA;;;AC7EhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQO,SAAS,YAAY,MAAM,MAAM;AACtC,MAAI;AAAM,WAAO;AAEjB,MAAI,KAAK,SAAS,QAAG,KAAK,KAAK,SAAS,cAAI,KAAK,KAAK,SAAS,cAAI;AAAG,WAAO;AAC7E,MAAI,KAAK,SAAS,MAAM,KAAK,KAAK,SAAS,0BAAM,KAAK,KAAK,SAAS,cAAI,KAAK,KAAK,SAAS,cAAI;AAAG,WAAO;AACzG,MAAI,KAAK,SAAS,cAAI;AAAG,WAAO;AAChC,SAAO;AACT;AAKO,SAAS,gBAAgB,UAAU;AACxC,MAAI,CAAC;AAAU,WAAO;AACtB,MAAI,SAAS,WAAW,oBAAK,KAAK,aAAa;AAAM,WAAO;AAE5D,QAAM,WAAW,CAAC,uBAAQ,mCAAU,+CAAY,qBAAW,2BAAY,iCAAQ;AAC/E,MAAI,SAAS,KAAK,OAAK,SAAS,WAAW,CAAC,CAAC,KAAK,aAAa;AAAM,WAAO;AAE5E,QAAM,gBAAgB,CAAC,gBAAM,qBAAW,SAAS,SAAS,YAAY;AACtE,MAAI,cAAc,KAAK,OAAK,SAAS,SAAS,CAAC,CAAC;AAAG,WAAO;AAE1D,QAAM,aAAa,CAAC,sBAAO,mCAAU,mCAAU,mCAAU,mCAAU,+CAAY,mCAAU,iCAAa,iCAAa,iCAAa,iCAAa,QAAQ,UAAU;AAC/J,MAAI,WAAW,KAAK,OAAK,SAAS,WAAW,CAAC,KAAK,SAAS,SAAS,CAAC,CAAC;AAAG,WAAO;AAEjF,SAAO;AACT;AAKA,eAAsB,sBAAsB,MAAM;AAChD,QAAM,MAAM,mCAAmC,cAAc,KAAK,IAAI;AACtE,MAAI;AACF,UAAM,OAAO,MAAM,MAAM,KAAK;AAAA,MAC5B,SAAS,EAAE,cAAc,+DAA+D;AAAA,IAC1F,CAAC;AACD,QAAI,CAAC,KAAK;AAAI,aAAO,CAAC;AACtB,UAAM,OAAO,MAAM,KAAK,KAAK;AAC7B,UAAMA,SAAQ,KAAK,MAAM,iBAAiB;AAC1C,QAAIA,UAASA,OAAM,CAAC,GAAG;AACrB,YAAMC,QAAO,KAAK,MAAMD,OAAM,CAAC,CAAC;AAChC,aAAO;AAAA,QACL,MAAMC,MAAK;AAAA,QACX,KAAK,WAAWA,MAAK,QAAQ,CAAC;AAAA,QAC9B,UAAU,WAAWA,MAAK,OAAO,CAAC;AAAA,QAClC,SAAS,WAAWA,MAAK,SAAS,CAAC;AAAA,QACnC,MAAMA,MAAK;AAAA,MACb;AAAA,IACF;AAAA,EACF,SAAS,GAAP;AACA,YAAQ,KAAK,2BAA2B,SAAS,EAAE,SAAS;AAAA,EAC9D;AACA,SAAO,CAAC;AACV;AAKA,eAAsB,iBAAiB,MAAM;AAC3C,QAAM,MAAM,+BAA+B;AAC3C,MAAI;AACF,UAAM,OAAO,MAAM,MAAM,KAAK;AAAA,MAC5B,SAAS,EAAE,WAAW,6BAA6B;AAAA,IACrD,CAAC;AACD,UAAM,OAAO,MAAM,KAAK,KAAK;AAC7B,UAAMD,SAAQ,KAAK,MAAM,SAAS;AAClC,QAAIA,UAASA,OAAM,CAAC,GAAG;AACrB,YAAM,QAAQA,OAAM,CAAC,EAAE,MAAM,GAAG;AAChC,UAAI,MAAM,UAAU,GAAG;AACrB,eAAO;AAAA,UACL,UAAU,WAAW,MAAM,CAAC,CAAC;AAAA,UAC7B,KAAK,WAAW,MAAM,CAAC,CAAC;AAAA,UACxB,SAAS,WAAW,MAAM,CAAC,CAAC;AAAA,UAC5B,MAAM,GAAG,MAAM,CAAC,KAAK,MAAM,CAAC;AAAA,QAC9B;AAAA,MACF;AAAA,IACF;AAAA,EACF,SAAS,GAAP;AACA,YAAQ,KAAK,sBAAsB,SAAS,EAAE,SAAS;AAAA,EACzD;AACA,SAAO,CAAC;AACV;AAKA,eAAsB,qBAAqB,IAAI,MAAM;AAEnD,MAAIC,QAAO,MAAM,sBAAsB,IAAI;AAC3C,MAAIA,MAAK,YAAYA,MAAK,WAAW;AAAG,WAAOA;AAG/C,QAAM,WAAW,MAAM,iBAAiB,IAAI;AAC5C,MAAI,SAAS,YAAY,SAAS,WAAW,GAAG;AAC9C,QAAIA,SAAQ,OAAO,KAAKA,KAAI,EAAE,SAAS,GAAG;AACxC,aAAO,EAAE,GAAGA,OAAM,GAAG,SAAS;AAAA,IAChC;AACA,WAAO;AAAA,EACT;AAGA,QAAM,EAAE,aAAAC,aAAY,IAAI,MAAM;AAC9B,MAAI;AACF,UAAM,UAAU,MAAM,eAAe,IAAI,MAAM,EAAE;AACjD,QAAI,WAAW,QAAQ,UAAU,GAAG;AAClC,YAAM,WAAWA,aAAY,MAAM,OAAO;AAC1C,UAAI,UAAU;AACZ,cAAM,eAAe,QAAQ,QAAQ,SAAS,CAAC,EAAE;AACjD,YAAI,WAAWD,OAAM,QAAQ;AAC7B,YAAI,CAAC,YAAY,aAAa,MAAM;AAClC,gBAAM,MAAM,MAAM,GAAG,QAAQ,uCAAuC,EAAE,KAAK,IAAI,EAAE,MAAM;AACvF,cAAI;AAAK,uBAAW,IAAI;AAAA,QAC1B;AACA,eAAO;AAAA,UACL;AAAA,UACA,MAAM;AAAA,UACN,KAAK;AAAA,UACL,SAAS,QAAQ,QAAQ,SAAS,CAAC,EAAE;AAAA,UACrC,UAAU,SAAS;AAAA,UACnB,SAAS,SAAS;AAAA,UAClB,OAAM,oBAAI,KAAK,GAAE,aAAa,EAAE,MAAM,GAAG,CAAC;AAAA,UAC1C,QAAQ;AAAA,UACR,YAAY,SAAS,cAAc;AAAA,UACnC,QAAQ,SAAS,UAAU;AAAA,QAC7B;AAAA,MACF;AAAA,IACF;AAAA,EACF,SAAS,GAAP;AACA,YAAQ,MAAM,gCAAgC,SAAS,EAAE,SAAS;AAAA,EACpE;AAGA,MAAIA,SAAQ,OAAO,KAAKA,KAAI,EAAE,SAAS;AAAG,WAAOA;AAEjD,MAAI;AACF,UAAM,UAAU,MAAM,eAAe,IAAI,MAAM,CAAC;AAChD,QAAI,WAAW,QAAQ,SAAS,GAAG;AACjC,UAAI,WAAW;AACf,YAAM,MAAM,MAAM,GAAG,QAAQ,uCAAuC,EAAE,KAAK,IAAI,EAAE,MAAM;AACvF,UAAI;AAAK,mBAAW,IAAI;AACxB,aAAO;AAAA,QACL;AAAA,QACA,MAAM;AAAA,QACN,KAAK,QAAQ,QAAQ,SAAS,CAAC,EAAE;AAAA,QACjC,SAAS,QAAQ,QAAQ,SAAS,CAAC,EAAE;AAAA,QACrC,UAAU,QAAQ,QAAQ,SAAS,CAAC,EAAE;AAAA,QACtC,SAAS;AAAA,QACT,MAAM;AAAA,QACN,QAAQ;AAAA,MACV;AAAA,IACF;AAAA,EACF,QAAE;AAAA,EAAO;AAET,SAAO,EAAE,MAAM,MAAM,MAAM,KAAK,GAAG,UAAU,GAAG,SAAS,EAAE;AAC7D;AAKA,eAAsB,YAAY,IAAI,GAAG;AACvC,MAAI,CAAC;AAAG,WAAO,CAAC;AAChB,QAAM,SAAS,EAAE,KAAK;AACtB,QAAM,UAAU,IAAI;AACpB,QAAM,gBAAgB,GAAG;AAEzB,QAAM,SAAS,MAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAY/B,EAAE,KAAK,QAAQ,eAAe,SAAS,SAAS,OAAO,EAAE,IAAI;AAE9D,SAAO,OAAO,QAAQ,IAAI,UAAQ;AAAA,IAChC,IAAI,OAAO,IAAI,IAAI;AAAA,IACnB,MAAM,IAAI;AAAA,IACV,MAAM,IAAI,QAAQ;AAAA,EACpB,EAAE;AACJ;AAKA,eAAsB,eAAe,IAAI,MAAM,QAAQ,IAAI;AAEzD,MAAI;AACJ,MAAI,SAAS,MAAM;AACjB,WAAO,MAAM,GAAG;AAAA,MACd;AAAA,IACF,EAAE,KAAK,IAAI,EAAE,IAAI;AAAA,EACnB,OAAO;AACL,WAAO,MAAM,GAAG;AAAA,MACd;AAAA,IACF,EAAE,KAAK,MAAM,KAAK,EAAE,IAAI;AAAA,EAC1B;AAEA,QAAM,UAAU,KAAK;AAGrB,MAAI,QAAQ,SAAS,GAAG;AACtB,UAAM,eAAe,QAAQ,CAAC,EAAE;AAChC,UAAM,gBAAgB,QAAQ,CAAC,EAAE;AACjC,QAAI;AACF,YAAM,aAAa,IAAI,KAAK,YAAY;AACxC,YAAM,YAAY,KAAK,IAAI,IAAI,WAAW,QAAQ,MAAM,MAAO,KAAK;AACpE,YAAM,MAAM,oBAAI,KAAK;AACrB,YAAM,WAAW,IAAI,YAAY,EAAE,MAAM,GAAG,EAAE;AAC9C,YAAM,cAAc,IAAI,YAAY,IAAI;AAExC,YAAM,UAAU,QAAQ,OAAO,KAAK;AAEpC,UAAI;AACJ,UAAI,eAAe,MAAM,gBAAgB,UAAU;AACjD,qBAAa;AAAA,MACf,OAAO;AACL,qBAAa,WAAW,MAAM,QAAQ,UAAU,KAAK,IAAI,OAAO,OAAO;AAAA,MACzE;AAEA,UAAI,YAAY;AACd,eAAO,QAAQ,QAAQ,EAAE,IAAI,QAAM,EAAE,MAAM,EAAE,MAAM,KAAK,EAAE,IAAI,EAAE;AAAA,MAClE;AAAA,IACF,QAAE;AAAA,IAAO;AAAA,EACX;AAGA,MAAI;AACF,UAAM,UAAU,MAAM,wBAAwB,MAAM,KAAK;AACzD,QAAI,CAAC,WAAW,QAAQ,WAAW;AAAG,aAAO,CAAC;AAG9C,eAAW,QAAQ,SAAS;AAC1B,YAAM,GAAG;AAAA,QACP;AAAA,MACF,EAAE,KAAK,MAAM,KAAK,MAAM,KAAK,GAAG,EAAE,IAAI;AAAA,IACxC;AAEA,WAAO;AAAA,EACT,SAAS,GAAP;AACA,YAAQ,MAAM,2BAA2B,SAAS,EAAE,SAAS;AAE7D,QAAI,QAAQ,SAAS,GAAG;AACtB,aAAO,QAAQ,QAAQ,EAAE,IAAI,QAAM,EAAE,MAAM,EAAE,MAAM,KAAK,EAAE,IAAI,EAAE;AAAA,IAClE;AACA,WAAO,CAAC;AAAA,EACV;AACF;AAMA,eAAe,wBAAwB,MAAM,OAAO;AAClD,QAAM,MAAM,2CAA2C;AACvD,MAAI;AACF,UAAM,OAAO,MAAM,MAAM,KAAK;AAAA,MAC5B,SAAS,EAAE,cAAc,cAAc;AAAA,IACzC,CAAC;AACD,QAAI,CAAC,KAAK;AAAI,aAAO,CAAC;AACtB,UAAM,OAAO,MAAM,KAAK,KAAK;AAG7B,UAAMD,SAAQ,KAAK,MAAM,yCAAyC;AAClE,QAAI,CAACA;AAAO,aAAO,CAAC;AAEpB,UAAM,UAAU,KAAK,MAAMA,OAAM,CAAC,CAAC;AACnC,QAAI,CAAC,WAAW,QAAQ,WAAW;AAAG,aAAO,CAAC;AAE9C,QAAI,UAAU,QACX,OAAO,UAAQ,OAAO,QAAQ,OAAO,IAAI,EACzC,IAAI,WAAS;AAAA,MACZ,MAAM,IAAI,KAAK,KAAK,CAAC,EAAE,YAAY,EAAE,MAAM,GAAG,EAAE;AAAA,MAChD,KAAK,WAAW,KAAK,CAAC;AAAA,IACxB,EAAE;AAGJ,YAAQ,KAAK,CAAC,GAAG,MAAM,EAAE,KAAK,cAAc,EAAE,IAAI,CAAC;AAGnD,QAAI,QAAQ,MAAM;AAChB,gBAAU,QAAQ,MAAM,CAAC,KAAK;AAAA,IAChC;AAEA,WAAO;AAAA,EACT,SAAS,GAAP;AACA,YAAQ,MAAM,+BAA+B,SAAS,EAAE,SAAS;AACjE,WAAO,CAAC;AAAA,EACV;AACF;AAKA,eAAsB,0BAA0B,MAAM;AACpD,QAAM,MAAM,2CAA2C;AACvD,MAAI;AACF,UAAM,OAAO,MAAM,MAAM,KAAK;AAAA,MAC5B,SAAS,EAAE,cAAc,cAAc;AAAA,IACzC,CAAC;AACD,QAAI,CAAC,KAAK;AAAI,aAAO,CAAC;AACtB,UAAM,OAAO,MAAM,KAAK,KAAK;AAC7B,UAAMC,QAAO,CAAC;AAGd,UAAM,YAAY,KAAK,MAAM,wBAAwB;AACrD,QAAI;AAAW,MAAAA,MAAK,OAAO,UAAU,CAAC;AAGtC,UAAM,YAAY,KAAK,MAAM,wBAAwB;AACrD,QAAI;AAAW,MAAAA,MAAK,OAAO,UAAU,CAAC;AAGtC,UAAM,eAAe,KAAK,MAAM,oDAAoD;AACpF,QAAI,cAAc;AAChB,UAAI;AACF,cAAM,WAAW,KAAK,MAAM,aAAa,CAAC,CAAC;AAC3C,YAAI,YAAY,SAAS,SAAS,GAAG;AACnC,UAAAA,MAAK,UAAU,SAAS,IAAI,OAAK,EAAE,IAAI,EAAE,KAAK,IAAI;AAAA,QACpD;AAAA,MACF,QAAE;AAAA,MAAO;AAAA,IACX;AAGA,eAAW,OAAO,CAAC,UAAU,UAAU,UAAU,QAAQ,GAAG;AAC1D,YAAM,IAAI,KAAK,MAAM,IAAI,OAAO,GAAG,sBAAsB,CAAC;AAC1D,UAAI;AAAG,QAAAA,MAAK,GAAG,IAAI,EAAE,CAAC;AAAA,IACxB;AAGA,UAAM,YAAY,KAAK,MAAM,uDAAuD;AACpF,QAAI,WAAW;AACb,UAAI;AACF,cAAM,OAAO,KAAK,MAAM,UAAU,CAAC,CAAC;AACpC,YAAI,QAAQ,KAAK,QAAQ,KAAK,YAAY;AACxC,UAAAA,MAAK,cAAc,CAAC;AACpB,eAAK,WAAW,QAAQ,CAAC,KAAK,MAAM;AAClC,YAAAA,MAAK,YAAY,GAAG,IAAI,KAAK,KAAK,CAAC;AAAA,UACrC,CAAC;AAAA,QACH;AAAA,MACF,QAAE;AAAA,MAAO;AAAA,IACX;AAGA,UAAM,YAAY,KAAK,MAAM,yCAAyC;AACtE,QAAI,WAAW;AACb,UAAI;AACF,cAAM,UAAU,KAAK,MAAM,UAAU,CAAC,CAAC;AACvC,YAAI,WAAW,QAAQ,SAAS,GAAG;AACjC,UAAAA,MAAK,UAAU,QACZ,OAAO,UAAQ,OAAO,QAAQ,OAAO,IAAI,EACzC,IAAI,WAAS;AAAA,YACZ,MAAM,IAAI,KAAK,KAAK,CAAC,EAAE,YAAY,EAAE,MAAM,GAAG,EAAE;AAAA,YAChD,KAAK,WAAW,KAAK,CAAC;AAAA,UACxB,EAAE;AAAA,QACN;AAAA,MACF,SAAS,GAAP;AACA,gBAAQ,MAAM,+BAA+B,SAAS,EAAE,SAAS;AAAA,MACnE;AAAA,IACF;AAEA,WAAOA;AAAA,EACT,SAAS,GAAP;AACA,YAAQ,KAAK,2BAA2B,SAAS,EAAE,SAAS;AAC5D,WAAO,CAAC;AAAA,EACV;AACF;AAKA,eAAe,kBAAkB,IAAI,MAAM;AACzC,MAAI;AACF,UAAM,MAAM,MAAM,GAAG,QAAQ,6CAA6C,EAAE,KAAK,IAAI,EAAE,MAAM;AAC7F,QAAI;AAAK,aAAO,EAAE,MAAM,IAAI,MAAM,MAAM,IAAI,KAAK;AAAA,EACnD,QAAE;AAAA,EAAO;AACT,SAAO,CAAC;AACV;AAKA,eAAsB,oBAAoB,OAAO;AAC/C,MAAI,CAAC,SAAS,MAAM,WAAW;AAAG,WAAO,CAAC;AAE1C,QAAM,YAAY,CAAC;AACnB,QAAM,UAAU,CAAC;AAEjB,aAAW,KAAK,OAAO;AACrB,QAAI,CAAC;AAAG;AACR,UAAM,OAAO,OAAO,CAAC,EAAE,KAAK;AAC5B,QAAI,SAAS;AACb,QAAI,SAAS;AAEb,QAAI,QAAQ,KAAK,IAAI,GAAG;AACtB,UAAI,KAAK,WAAW,GAAG;AACrB,iBAAS,CAAC,MAAM,MAAM,MAAM,IAAI,EAAE,KAAK,OAAK,KAAK,WAAW,CAAC,CAAC,IAAI,OAAO;AAAA,MAC3E,WAAW,KAAK,WAAW,GAAG;AAC5B,iBAAS;AAAA,MACX;AAAA,IACF,WAAW,cAAc,KAAK,IAAI,GAAG;AACnC,eAAS;AACT,eAAS,KAAK,YAAY;AAAA,IAC5B;AAEA,QAAI,QAAQ;AACV,YAAM,WAAW,GAAG,SAAS;AAC7B,gBAAU,KAAK,QAAQ;AACvB,cAAQ,QAAQ,IAAI;AAAA,IACtB;AAAA,EACF;AAEA,MAAI,UAAU,WAAW;AAAG,WAAO,CAAC;AAEpC,QAAM,MAAM,4BAA4B,UAAU,KAAK,GAAG;AAC1D,MAAI;AACF,UAAM,OAAO,MAAM,MAAM,KAAK;AAAA,MAC5B,SAAS,EAAE,WAAW,6BAA6B;AAAA,IACrD,CAAC;AACD,UAAM,OAAO,MAAM,KAAK,KAAK;AAC7B,UAAM,UAAU,CAAC;AAEjB,eAAW,QAAQ,KAAK,KAAK,EAAE,MAAM,IAAI,GAAG;AAC1C,UAAI,CAAC,QAAQ,CAAC,KAAK,SAAS,GAAG,KAAK,CAAC,KAAK,SAAS,GAAG;AAAG;AAEzD,YAAM,UAAU,KAAK,MAAM,GAAG,EAAE,CAAC,EAAE,MAAM,OAAO,EAAE,IAAI;AACtD,YAAM,eAAe,QAAQ,OAAO;AACpC,UAAI,CAAC;AAAc;AAEnB,YAAM,WAAW,KAAK,MAAM,GAAG,EAAE,CAAC;AAClC,UAAI,CAAC;AAAU;AACf,YAAM,QAAQ,SAAS,MAAM,GAAG;AAEhC,UAAI,SAAS;AACb,UAAI;AACF,YAAI,QAAQ,WAAW,KAAK,GAAG;AAC7B,cAAI,MAAM,SAAS;AAAG,qBAAS,WAAW,MAAM,CAAC,CAAC;AAAA,QACpD,WAAW,QAAQ,WAAW,IAAI,GAAG;AACnC,cAAI,MAAM,SAAS,GAAG;AACpB,kBAAM,YAAY,WAAW,MAAM,CAAC,CAAC;AACrC,kBAAM,OAAO,WAAW,MAAM,CAAC,CAAC;AAChC,gBAAI,YAAY;AAAG,uBAAS,KAAK,OAAO,OAAO,aAAa,YAAY,GAAK,IAAI;AAAA,UACnF;AAAA,QACF,OAAO;AACL,cAAI,MAAM,SAAS,GAAG;AACpB,kBAAM,YAAY,WAAW,MAAM,CAAC,CAAC;AACrC,kBAAM,OAAO,WAAW,MAAM,CAAC,CAAC;AAChC,gBAAI,YAAY;AAAG,uBAAS,KAAK,OAAO,OAAO,aAAa,YAAY,GAAK,IAAI;AAAA,UACnF;AAAA,QACF;AACA,gBAAQ,YAAY,IAAI;AAAA,MAC1B,QAAE;AAAA,MAAO;AAAA,IACX;AAEA,WAAO;AAAA,EACT,SAAS,GAAP;AACA,YAAQ,KAAK,4BAA4B,EAAE,SAAS;AACpD,WAAO,CAAC;AAAA,EACV;AACF;AAKO,SAAS,6BAA6B,SAAS;AACpD,MAAI,CAAC,WAAW,QAAQ,SAAS,IAAI;AACnC,WAAO,EAAE,QAAQ,MAAM,YAAY,MAAM,cAAc,MAAM,eAAe,KAAK;AAAA,EACnF;AAEA,MAAI;AACF,UAAM,OAAO,QAAQ,IAAI,UAAQ,KAAK,GAAG;AAGzC,UAAM,eAAe,CAAC;AACtB,aAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AACpC,mBAAa,MAAM,KAAK,CAAC,IAAI,KAAK,IAAI,CAAC,KAAK,KAAK,IAAI,CAAC,CAAC;AAAA,IACzD;AAGA,UAAM,eAAe,KAAK,KAAK,SAAS,CAAC,IAAI,KAAK,CAAC,KAAK,KAAK,CAAC;AAC9D,UAAM,QAAQ,QAAQ,SAAS;AAC/B,UAAM,eAAe,QAAQ,IAAI,KAAK,IAAI,IAAI,aAAa,IAAI,KAAK,IAAI,IAAI;AAG5E,UAAM,OAAO,aAAa,OAAO,CAAC,GAAG,MAAM,IAAI,GAAG,CAAC,IAAI,aAAa;AACpE,UAAM,WAAW,aAAa,OAAO,CAAC,GAAG,MAAM,IAAI,KAAK,IAAI,IAAI,MAAM,CAAC,GAAG,CAAC,IAAI,aAAa;AAC5F,UAAM,aAAa,KAAK,KAAK,QAAQ,IAAI,KAAK,KAAK,GAAG;AAGtD,UAAM,KAAK;AACX,UAAM,SAAS,aAAa,KAAK,eAAe,MAAM,aAAa;AAGnE,QAAI,cAAc;AAClB,QAAI,OAAO,KAAK,CAAC;AACjB,eAAW,OAAO,MAAM;AACtB,UAAI,MAAM;AAAM,eAAO;AACvB,YAAM,YAAY,MAAM,QAAQ;AAChC,UAAI,WAAW;AAAa,sBAAc;AAAA,IAC5C;AAEA,WAAO;AAAA,MACL,QAAQ,KAAK,MAAM,SAAS,GAAG,IAAI;AAAA,MACnC,YAAY,GAAG,KAAK,MAAM,aAAa,GAAK,IAAI;AAAA,MAChD,cAAc,GAAG,KAAK,MAAM,cAAc,GAAK,IAAI;AAAA,MACnD,eAAe,GAAG,KAAK,MAAM,eAAe,GAAK,IAAI;AAAA,IACvD;AAAA,EACF,SAAS,GAAP;AACA,YAAQ,MAAM,gCAAgC,EAAE,SAAS;AACzD,WAAO,EAAE,QAAQ,MAAM,YAAY,MAAM,cAAc,MAAM,eAAe,KAAK;AAAA,EACnF;AACF;AAKA,eAAsB,aAAa,IAAI,MAAM,SAAS;AACpD,QAAM,UAAU,MAAM,eAAe,IAAI,MAAM,EAAE;AACjD,aAAW,QAAQ,SAAS;AAC1B,QAAI,KAAK,KAAK,MAAM,GAAG,EAAE,MAAM,QAAQ,MAAM,GAAG,EAAE,GAAG;AACnD,aAAO,KAAK;AAAA,IACd;AAAA,EACF;AACA,SAAO;AACT;AAKA,eAAsB,gBAAgB,IAAI,MAAM;AAE9C,QAAM,SAAS,MAAM,qBAAqB,IAAI,IAAI;AAClD,MAAI,OAAO,OAAO;AAClB,QAAM,MAAM,WAAW,OAAO,OAAO,CAAC;AACtC,QAAM,WAAW,WAAW,OAAO,YAAY,CAAC;AAChD,QAAM,UAAU,WAAW,OAAO,WAAW,CAAC;AAC9C,QAAM,aAAa,OAAO,SAAQ,oBAAI,KAAK,GAAE,aAAa,EAAE,MAAM,GAAG,CAAC;AACtE,QAAM,SAAS,OAAO;AACtB,QAAM,SAAS,OAAO;AACtB,QAAM,aAAa,OAAO;AAG1B,QAAM,SAAS,MAAM,0BAA0B,IAAI;AACnD,QAAM,YAAY,CAAC;AACnB,MAAI,OAAO;AAAM,cAAU,YAAY,OAAO;AAC9C,MAAI,OAAO;AAAS,cAAU,UAAU,OAAO;AAC/C,aAAW,KAAK,CAAC,UAAU,UAAU,UAAU,QAAQ,GAAG;AACxD,QAAI,OAAO,CAAC;AAAG,gBAAU,CAAC,IAAI,OAAO,CAAC;AAAA,EACxC;AAEA,QAAM,SAAS,MAAM,kBAAkB,IAAI,IAAI;AAC/C,MAAI,OAAO,QAAQ,CAAC,UAAU;AAAW,cAAU,YAAY,OAAO;AACtE,MAAI,OAAO;AAAM,cAAU,gBAAgB,OAAO;AAElD,MAAI,CAAC;AAAM,WAAO,UAAU,aAAa,gBAAM;AAC/C,QAAM,UAAU,UAAU,WAAW;AAGrC,MAAI,cAAc,OAAO,WAAW,CAAC;AACrC,MAAI;AACJ,MAAI,YAAY,SAAS,GAAG;AAC1B,qBAAiB,6BAA6B,YAAY,MAAM,IAAI,CAAC;AAAA,EACvE,OAAO;AACL,kBAAc,MAAM,eAAe,IAAI,MAAM,GAAG;AAChD,qBAAiB,6BAA6B,WAAW;AAAA,EAC3D;AAGA,MAAI,WAAW,CAAC;AAChB,MAAI,oBAAoB;AACxB,MAAI;AACF,eAAW,MAAM,kBAAkB,IAAI,IAAI;AAE3C,UAAM,QAAQ,SAAS,MAAM,GAAG,EAAE;AAClC,wBAAoB,MAAM,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,SAAS,CAAC;AAC/D,eAAW,SAAS,MAAM,GAAG,EAAE;AAAA,EACjC,QAAE;AAAA,EAAO;AAGT,QAAM,SAAS,YAAY,OAAO,MAAM,IAAI;AAE5C,SAAO;AAAA,IACL,IAAI,OAAO,IAAI;AAAA,IACf;AAAA,IACA,MAAM;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,MAAM;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAY;AAAA,MACV,SAAS;AAAA,QACP,MAAM,UAAU,UAAU;AAAA,QAC1B,MAAM,UAAU,UAAU;AAAA,QAC1B,MAAM,UAAU,UAAU;AAAA,QAC1B,MAAM,UAAU,UAAU;AAAA,MAC5B;AAAA,MACA,eAAe,KAAK,MAAM,oBAAoB,GAAG,IAAI;AAAA,MACrD,WAAW;AAAA,IACb;AAAA,EACF;AACF;AAMA,eAAe,kBAAkB,IAAI,MAAM;AACzC,QAAM,eAAc,oBAAI,KAAK,GAAE,YAAY;AAE3C,aAAW,QAAQ,CAAC,aAAa,cAAc,CAAC,GAAG;AACjD,QAAI;AACF,YAAM,MAAM,sEAAsE,wBAAwB;AAC1G,YAAM,OAAO,MAAM,MAAM,KAAK;AAAA,QAC5B,SAAS,EAAE,cAAc,eAAe,WAAW,gCAAgC;AAAA,MACrF,CAAC;AACD,UAAI,CAAC,KAAK;AAAI;AACd,YAAM,OAAO,MAAM,KAAK,KAAK;AAG7B,YAAM,WAAW,kBAAkB,IAAI;AACvC,UAAI,SAAS,SAAS,GAAG;AAEvB,cAAM,aAAa,SAAS,IAAI,OAAK,EAAE,SAAS,EAAE,OAAO,OAAO;AAChE,cAAM,UAAU,MAAM,oBAAoB,UAAU;AAEpD,eAAO,SAAS,IAAI,QAAM;AAAA,UACxB,MAAM,EAAE;AAAA,UACR,SAAS,EAAE;AAAA,UACX,QAAQ,QAAQ,EAAE,SAAS,KAAK;AAAA,QAClC,EAAE;AAAA,MACJ;AAAA,IACF,QAAE;AAAA,IAAO;AAAA,EACX;AAEA,SAAO,CAAC;AACV;AAKA,SAAS,kBAAkB,MAAM;AAC/B,QAAM,WAAW,CAAC;AAIlB,QAAM,aAAa,KAAK,MAAM,4DAA4D;AAC1F,MAAI,CAAC,YAAY;AAEf,UAAM,YAAY,KAAK,SAAS,4BAA4B;AAC5D,QAAI,YAAY,oBAAI,IAAI;AAExB,eAAW,WAAW,WAAW;AAC/B,YAAM,YAAY,CAAC,GAAG,QAAQ,CAAC,EAAE,SAAS,4BAA4B,CAAC;AACvE,UAAI,UAAU,UAAU,GAAG;AAEzB,cAAM,WAAW,UAAU,CAAC,IAAI,CAAC,KAAK;AACtC,cAAM,YAAY,SAAS,MAAM,WAAW;AAC5C,YAAI,CAAC;AAAW;AAEhB,cAAM,YAAY,UAAU,CAAC;AAC7B,YAAI,UAAU,IAAI,SAAS;AAAG;AAG9B,cAAM,WAAW,UAAU,CAAC,IAAI,CAAC,KAAK;AACtC,cAAM,YAAY,SAAS,MAAM,WAAW;AAC5C,cAAM,OAAO,YAAY,UAAU,CAAC,EAAE,KAAK,IAAI,SAAS,QAAQ,YAAY,EAAE,EAAE,KAAK;AACrF,YAAI,CAAC;AAAM;AAGX,cAAM,cAAc,UAAU,CAAC,IAAI,CAAC,KAAK;AACzC,cAAM,aAAa,YAAY,QAAQ,YAAY,EAAE,EAAE,QAAQ,KAAK,EAAE,EAAE,KAAK;AAC7E,cAAM,UAAU,WAAW,UAAU;AACrC,YAAI,MAAM,OAAO,KAAK,UAAU;AAAM;AAEtC,kBAAU,IAAI,SAAS;AACvB,iBAAS,KAAK,EAAE,WAAW,MAAM,QAAQ,CAAC;AAAA,MAC5C;AAAA,IACF;AAAA,EACF;AAGA,WAAS,KAAK,CAAC,GAAG,MAAM,EAAE,UAAU,EAAE,OAAO;AAC7C,SAAO;AACT;AAMA,eAAsB,oBAAoB,IAAI;AAC5C,UAAQ,IAAI,8BAA8B;AAC1C,MAAI;AACF,UAAM,MAAM;AACZ,UAAM,OAAO,MAAM,MAAM,KAAK;AAAA,MAC5B,SAAS,EAAE,cAAc,cAAc;AAAA,IACzC,CAAC;AACD,QAAI,CAAC,KAAK,IAAI;AACZ,cAAQ,KAAK,2BAA2B;AACxC;AAAA,IACF;AAEA,UAAM,OAAO,MAAM,KAAK,KAAK;AAE7B,UAAMD,SAAQ,KAAK,MAAM,+BAA+B;AACxD,QAAI,CAACA,QAAO;AACV,cAAQ,KAAK,2BAA2B;AACxC;AAAA,IACF;AAEA,UAAM,WAAW,KAAK,MAAMA,OAAM,CAAC,CAAC;AACpC,QAAI,QAAQ;AAGZ,UAAM,YAAY;AAClB,aAAS,IAAI,GAAG,IAAI,SAAS,QAAQ,KAAK,WAAW;AACnD,YAAM,QAAQ,SAAS,MAAM,GAAG,IAAI,SAAS;AAC7C,YAAM,QAAQ,MAAM;AAAA,QAAI,UACtB,GAAG;AAAA,UACD;AAAA,QACF,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAG,KAAK,CAAC,CAAC;AAAA,MAClC;AACA,YAAM,GAAG,MAAM,KAAK;AACpB,eAAS,MAAM;AAAA,IACjB;AAEA,YAAQ,IAAI,mCAAmC,OAAO;AAAA,EACxD,SAAS,GAAP;AACA,YAAQ,MAAM,+BAA+B,EAAE,SAAS;AAAA,EAC1D;AACF;AA3uBA;AAAA;AAQgB;AAYA;AAmBM;AA4BA;AA4BA;AAyEA;AA8BA;AAoEP;AAyCO;AA6EP;AAWO;AAkFN;AAoDM;AAaA;AAkFP;AAkCN;AAiDa;AAAA;AAAA;;;AC7rBtB,eAAe,OAAO,KAAK;AACzB,QAAM,SAAS,IAAI,kBAAkB;AACrC,QAAM,cAAc,MAAM,OAAO,OAAO;AAAA,IACtC;AAAA,IACA,IAAI,YAAY,EAAE,OAAO,MAAM;AAAA,IAC/B,EAAE,MAAM,SAAS;AAAA,IACjB;AAAA,IACA,CAAC,WAAW;AAAA,EACd;AAEA,SAAO,OAAO,OAAO;AAAA,IACnB;AAAA,MACE,MAAM;AAAA,MACN,MAAM,IAAI,YAAY,EAAE,OAAO,mBAAmB;AAAA,MAClD,YAAY;AAAA,MACZ,MAAM;AAAA,IACR;AAAA,IACA;AAAA,IACA,EAAE,MAAM,WAAW,QAAQ,IAAI;AAAA,IAC/B;AAAA,IACA,CAAC,WAAW,SAAS;AAAA,EACvB;AACF;AAMA,eAAsB,aAAa,OAAO,KAAK;AAC7C,MAAI,CAAC;AAAO,WAAO;AAEnB,QAAM,MAAM,MAAM,OAAO,GAAG;AAC5B,QAAM,KAAK,OAAO,gBAAgB,IAAI,WAAW,EAAE,CAAC;AACpD,QAAM,UAAU,IAAI,YAAY,EAAE,OAAO,KAAK;AAE9C,QAAM,aAAa,MAAM,OAAO,OAAO;AAAA,IACrC,EAAE,MAAM,WAAW,GAAG;AAAA,IACtB;AAAA,IACA;AAAA,EACF;AAGA,QAAM,WAAW,IAAI,WAAW,GAAG,SAAS,WAAW,UAAU;AACjE,WAAS,IAAI,EAAE;AACf,WAAS,IAAI,IAAI,WAAW,UAAU,GAAG,GAAG,MAAM;AAElD,SAAO,KAAK,OAAO,aAAa,GAAG,QAAQ,CAAC;AAC9C;AAKA,eAAsB,aAAa,gBAAgB,KAAK;AACtD,MAAI,CAAC;AAAgB,WAAO;AAE5B,MAAI;AACF,UAAM,MAAM,MAAM,OAAO,GAAG;AAC5B,UAAM,WAAW,WAAW,KAAK,KAAK,cAAc,GAAG,OAAK,EAAE,WAAW,CAAC,CAAC;AAE3E,UAAM,KAAK,SAAS,MAAM,GAAG,EAAE;AAC/B,UAAM,aAAa,SAAS,MAAM,EAAE;AAEpC,UAAM,YAAY,MAAM,OAAO,OAAO;AAAA,MACpC,EAAE,MAAM,WAAW,GAAG;AAAA,MACtB;AAAA,MACA;AAAA,IACF;AAEA,WAAO,IAAI,YAAY,EAAE,OAAO,SAAS;AAAA,EAC3C,SAAS,GAAP;AAEA,WAAO;AAAA,EACT;AACF;AA/EA;AAAA;AAMe;AA4BO;AAwBA;AAAA;AAAA;;;AC1DtB;AAAA;AAAA;AAAA;AAWA,eAAsB,sBAAsB,KAAK,IAAIG,OAAM;AACzD,QAAM,EAAE,UAAU,UAAU,SAAS,QAAQ,UAAU,IAAI,IAAIA;AAE/D,QAAM,UAAU,aAAa,YAAY;AACzC,QAAM,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+EAM4C;AAAA,+EACA;AAAA,+EACA;AAAA,+EACA;AAAA,0CACjB,WAAW,IAAI,YAAY;AAAA,uDAClC,WAAW,IAAI,MAAM,KAAK;AAAA;AAAA;AAAA;AAAA,kEAIzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASlC,QAAM,UAAU,KAAK,IAAI,SAAS,IAAI;AACxC;AAKA,eAAe,UAAU,KAAK,IAAI,SAAS,MAAM;AAC/C,QAAM,gBAAgB,IAAI,kBAAkB;AAE5C,MAAI;AACF,YAAQ,cAAc,YAAY,GAAG;AAAA,MACnC,KAAK;AACH,cAAM,cAAc,KAAK,IAAI,SAAS,IAAI;AAC1C;AAAA,MACF,KAAK;AACH,cAAM,eAAe,KAAK,IAAI,SAAS,IAAI;AAC3C;AAAA,MACF,KAAK;AACH,cAAM,gBAAgB,KAAK,IAAI,SAAS,IAAI;AAC5C;AAAA,MACF;AACE,gBAAQ,KAAK,2BAA2B,eAAe;AAAA,IAC3D;AAAA,EACF,SAAS,GAAP;AACA,YAAQ,MAAM,sBAAsB,EAAE,SAAS;AAC/C,UAAM;AAAA,EACR;AACF;AAEA,eAAe,cAAc,KAAK,IAAI,SAAS,MAAM;AACnD,QAAM,SAAS,IAAI;AACnB,MAAI,CAAC;AAAQ,UAAM,IAAI,MAAM,+BAA+B;AAE5D,QAAM,OAAO,MAAM,MAAM,iCAAiC;AAAA,IACxD,QAAQ;AAAA,IACR,SAAS;AAAA,MACP,iBAAiB,UAAU;AAAA,MAC3B,gBAAgB;AAAA,IAClB;AAAA,IACA,MAAM,KAAK,UAAU;AAAA,MACnB,MAAM,IAAI,cAAc;AAAA,MACxB,IAAI,CAAC,EAAE;AAAA,MACP;AAAA,MACA;AAAA,IACF,CAAC;AAAA,EACH,CAAC;AAED,MAAI,CAAC,KAAK,IAAI;AACZ,UAAM,MAAM,MAAM,KAAK,KAAK;AAC5B,UAAM,IAAI,MAAM,qBAAqB,KAAK,UAAU,KAAK;AAAA,EAC3D;AACF;AAEA,eAAe,eAAe,KAAK,IAAI,SAAS,MAAM;AACpD,QAAM,SAAS,IAAI;AACnB,QAAM,SAAS,IAAI;AACnB,MAAI,CAAC,UAAU,CAAC;AAAQ,UAAM,IAAI,MAAM,6CAA6C;AAErF,QAAM,OAAO,IAAI,SAAS;AAC1B,OAAK,OAAO,QAAQ,IAAI,cAAc,oBAAoB,SAAS;AACnE,OAAK,OAAO,MAAM,EAAE;AACpB,OAAK,OAAO,WAAW,OAAO;AAC9B,OAAK,OAAO,QAAQ,IAAI;AAExB,QAAM,OAAO,MAAM,MAAM,8BAA8B,mBAAmB;AAAA,IACxE,QAAQ;AAAA,IACR,SAAS;AAAA,MACP,iBAAiB,SAAS,KAAK,SAAS,MAAM;AAAA,IAChD;AAAA,IACA,MAAM;AAAA,EACR,CAAC;AAED,MAAI,CAAC,KAAK,IAAI;AACZ,UAAM,MAAM,MAAM,KAAK,KAAK;AAC5B,UAAM,IAAI,MAAM,sBAAsB,KAAK,UAAU,KAAK;AAAA,EAC5D;AACF;AAEA,eAAe,gBAAgB,KAAK,IAAI,SAAS,MAAM;AACrD,QAAM,SAAS,IAAI;AACnB,MAAI,CAAC;AAAQ,UAAM,IAAI,MAAM,iCAAiC;AAE9D,QAAM,OAAO,MAAM,MAAM,yCAAyC;AAAA,IAChE,QAAQ;AAAA,IACR,SAAS;AAAA,MACP,iBAAiB,UAAU;AAAA,MAC3B,gBAAgB;AAAA,IAClB;AAAA,IACA,MAAM,KAAK,UAAU;AAAA,MACnB,kBAAkB,CAAC,EAAE,IAAI,CAAC,EAAE,OAAO,GAAG,CAAC,EAAE,CAAC;AAAA,MAC1C,MAAM,EAAE,OAAO,IAAI,cAAc,uBAAuB;AAAA,MACxD;AAAA,MACA,SAAS,CAAC,EAAE,MAAM,aAAa,OAAO,KAAK,CAAC;AAAA,IAC9C,CAAC;AAAA,EACH,CAAC;AAED,MAAI,CAAC,KAAK,IAAI;AACZ,UAAM,MAAM,MAAM,KAAK,KAAK;AAC5B,UAAM,IAAI,MAAM,uBAAuB,KAAK,UAAU,KAAK;AAAA,EAC7D;AACF;AA3IA;AAAA;AAMA;AAKsB;AAkCP;AAuBA;AAwBA;AAyBA;AAAA;AAAA;;;ACrHf;AAAA;AAAA;AAAA;AAKO,SAAS,gCAAgC,WAAW;AACzD,SAAO;AAAA,IACL;AAAA,MACE,MAAM;AAAA,MACN,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IASX;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,SAAS;AAAA;AAAA;AAAA,kBAGP,UAAU;AAAA,kBACV,UAAU;AAAA,kBACV,UAAU;AAAA,8BACR,UAAU;AAAA;AAAA;AAAA,8BAGV,UAAU;AAAA,8BACV,UAAU;AAAA,oCACT,UAAU;AAAA;AAAA;AAAA,8BAGX,UAAU;AAAA,oCACT,UAAU;AAAA,8BACX,UAAU;AAAA,oCACT,UAAU;AAAA;AAAA;AAAA,EAGnB,UAAU;AAAA;AAAA;AAAA,EAGV,UAAU;AAAA;AAAA;AAAA,EAGV,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAQR;AAAA,EACF;AACF;AAzDA;AAAA;AAKgB;AAAA;AAAA;;;ACJhB,IAAI,UAAU,wBAAC,YAAY,SAAS,eAAe;AACjD,SAAO,CAAC,SAAS,SAAS;AACxB,QAAI,QAAQ;AACZ,WAAO,SAAS,CAAC;AACjB,mBAAe,SAAS,GAAG;AACzB,UAAI,KAAK,OAAO;AACd,cAAM,IAAI,MAAM,8BAA8B;AAAA,MAChD;AACA,cAAQ;AACR,UAAI;AACJ,UAAI,UAAU;AACd,UAAI;AACJ,UAAI,WAAW,CAAC,GAAG;AACjB,kBAAU,WAAW,CAAC,EAAE,CAAC,EAAE,CAAC;AAC5B,gBAAQ,IAAI,aAAa;AAAA,MAC3B,OAAO;AACL,kBAAU,MAAM,WAAW,UAAU,QAAQ;AAAA,MAC/C;AACA,UAAI,SAAS;AACX,YAAI;AACF,gBAAM,MAAM,QAAQ,SAAS,MAAM,SAAS,IAAI,CAAC,CAAC;AAAA,QACpD,SAAS,KAAP;AACA,cAAI,eAAe,SAAS,SAAS;AACnC,oBAAQ,QAAQ;AAChB,kBAAM,MAAM,QAAQ,KAAK,OAAO;AAChC,sBAAU;AAAA,UACZ,OAAO;AACL,kBAAM;AAAA,UACR;AAAA,QACF;AAAA,MACF,OAAO;AACL,YAAI,QAAQ,cAAc,SAAS,YAAY;AAC7C,gBAAM,MAAM,WAAW,OAAO;AAAA,QAChC;AAAA,MACF;AACA,UAAI,QAAQ,QAAQ,cAAc,SAAS,UAAU;AACnD,gBAAQ,MAAM;AAAA,MAChB;AACA,aAAO;AAAA,IACT;AAnCe;AAAA,EAoCjB;AACF,GAzCc;;;ACAd,IAAI,mBAAmC,uBAAO;;;ACC9C,IAAI,YAAY,8BAAO,SAAS,UAA0B,uBAAO,OAAO,IAAI,MAAM;AAChF,QAAM,EAAE,MAAM,OAAO,MAAM,MAAM,IAAI;AACrC,QAAM,UAAU,mBAAmB,cAAc,QAAQ,IAAI,UAAU,QAAQ;AAC/E,QAAM,cAAc,QAAQ,IAAI,cAAc;AAC9C,MAAI,aAAa,WAAW,qBAAqB,KAAK,aAAa,WAAW,mCAAmC,GAAG;AAClH,WAAO,cAAc,SAAS,EAAE,KAAK,IAAI,CAAC;AAAA,EAC5C;AACA,SAAO,CAAC;AACV,GARgB;AAShB,eAAe,cAAc,SAAS,SAAS;AAC7C,QAAM,WAAW,MAAM,QAAQ,SAAS;AACxC,MAAI,UAAU;AACZ,WAAO,0BAA0B,UAAU,OAAO;AAAA,EACpD;AACA,SAAO,CAAC;AACV;AANe;AAOf,SAAS,0BAA0B,UAAU,SAAS;AACpD,QAAM,OAAuB,uBAAO,OAAO,IAAI;AAC/C,WAAS,QAAQ,CAAC,OAAO,QAAQ;AAC/B,UAAM,uBAAuB,QAAQ,OAAO,IAAI,SAAS,IAAI;AAC7D,QAAI,CAAC,sBAAsB;AACzB,WAAK,GAAG,IAAI;AAAA,IACd,OAAO;AACL,6BAAuB,MAAM,KAAK,KAAK;AAAA,IACzC;AAAA,EACF,CAAC;AACD,MAAI,QAAQ,KAAK;AACf,WAAO,QAAQ,IAAI,EAAE,QAAQ,CAAC,CAAC,KAAK,KAAK,MAAM;AAC7C,YAAM,uBAAuB,IAAI,SAAS,GAAG;AAC7C,UAAI,sBAAsB;AACxB,kCAA0B,MAAM,KAAK,KAAK;AAC1C,eAAO,KAAK,GAAG;AAAA,MACjB;AAAA,IACF,CAAC;AAAA,EACH;AACA,SAAO;AACT;AApBS;AAqBT,IAAI,yBAAyB,wBAAC,MAAM,KAAK,UAAU;AACjD,MAAI,KAAK,GAAG,MAAM,QAAQ;AACxB,QAAI,MAAM,QAAQ,KAAK,GAAG,CAAC,GAAG;AAC5B;AACA,WAAK,GAAG,EAAE,KAAK,KAAK;AAAA,IACtB,OAAO;AACL,WAAK,GAAG,IAAI,CAAC,KAAK,GAAG,GAAG,KAAK;AAAA,IAC/B;AAAA,EACF,OAAO;AACL,QAAI,CAAC,IAAI,SAAS,IAAI,GAAG;AACvB,WAAK,GAAG,IAAI;AAAA,IACd,OAAO;AACL,WAAK,GAAG,IAAI,CAAC,KAAK;AAAA,IACpB;AAAA,EACF;AACF,GAf6B;AAgB7B,IAAI,4BAA4B,wBAAC,MAAM,KAAK,UAAU;AACpD,MAAI,aAAa;AACjB,QAAM,OAAO,IAAI,MAAM,GAAG;AAC1B,OAAK,QAAQ,CAAC,MAAM,UAAU;AAC5B,QAAI,UAAU,KAAK,SAAS,GAAG;AAC7B,iBAAW,IAAI,IAAI;AAAA,IACrB,OAAO;AACL,UAAI,CAAC,WAAW,IAAI,KAAK,OAAO,WAAW,IAAI,MAAM,YAAY,MAAM,QAAQ,WAAW,IAAI,CAAC,KAAK,WAAW,IAAI,aAAa,MAAM;AACpI,mBAAW,IAAI,IAAoB,uBAAO,OAAO,IAAI;AAAA,MACvD;AACA,mBAAa,WAAW,IAAI;AAAA,IAC9B;AAAA,EACF,CAAC;AACH,GAbgC;;;ACtDhC,IAAI,YAAY,wBAAC,SAAS;AACxB,QAAM,QAAQ,KAAK,MAAM,GAAG;AAC5B,MAAI,MAAM,CAAC,MAAM,IAAI;AACnB,UAAM,MAAM;AAAA,EACd;AACA,SAAO;AACT,GANgB;AAOhB,IAAI,mBAAmB,wBAAC,cAAc;AACpC,QAAM,EAAE,QAAQ,KAAK,IAAI,sBAAsB,SAAS;AACxD,QAAM,QAAQ,UAAU,IAAI;AAC5B,SAAO,kBAAkB,OAAO,MAAM;AACxC,GAJuB;AAKvB,IAAI,wBAAwB,wBAAC,SAAS;AACpC,QAAM,SAAS,CAAC;AAChB,SAAO,KAAK,QAAQ,cAAc,CAACC,QAAO,UAAU;AAClD,UAAM,OAAO,IAAI;AACjB,WAAO,KAAK,CAAC,MAAMA,MAAK,CAAC;AACzB,WAAO;AAAA,EACT,CAAC;AACD,SAAO,EAAE,QAAQ,KAAK;AACxB,GAR4B;AAS5B,IAAI,oBAAoB,wBAAC,OAAO,WAAW;AACzC,WAAS,IAAI,OAAO,SAAS,GAAG,KAAK,GAAG,KAAK;AAC3C,UAAM,CAAC,IAAI,IAAI,OAAO,CAAC;AACvB,aAAS,IAAI,MAAM,SAAS,GAAG,KAAK,GAAG,KAAK;AAC1C,UAAI,MAAM,CAAC,EAAE,SAAS,IAAI,GAAG;AAC3B,cAAM,CAAC,IAAI,MAAM,CAAC,EAAE,QAAQ,MAAM,OAAO,CAAC,EAAE,CAAC,CAAC;AAC9C;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACA,SAAO;AACT,GAXwB;AAYxB,IAAI,eAAe,CAAC;AACpB,IAAI,aAAa,wBAAC,OAAO,SAAS;AAChC,MAAI,UAAU,KAAK;AACjB,WAAO;AAAA,EACT;AACA,QAAMA,SAAQ,MAAM,MAAM,6BAA6B;AACvD,MAAIA,QAAO;AACT,UAAM,WAAW,GAAG,SAAS;AAC7B,QAAI,CAAC,aAAa,QAAQ,GAAG;AAC3B,UAAIA,OAAM,CAAC,GAAG;AACZ,qBAAa,QAAQ,IAAI,QAAQ,KAAK,CAAC,MAAM,OAAO,KAAK,CAAC,MAAM,MAAM,CAAC,UAAUA,OAAM,CAAC,GAAG,IAAI,OAAO,IAAIA,OAAM,CAAC,QAAQ,OAAO,CAAC,IAAI,CAAC,OAAOA,OAAM,CAAC,GAAG,IAAI,OAAO,IAAIA,OAAM,CAAC,IAAI,CAAC;AAAA,MACpL,OAAO;AACL,qBAAa,QAAQ,IAAI,CAAC,OAAOA,OAAM,CAAC,GAAG,IAAI;AAAA,MACjD;AAAA,IACF;AACA,WAAO,aAAa,QAAQ;AAAA,EAC9B;AACA,SAAO;AACT,GAjBiB;AAkBjB,IAAI,YAAY,wBAAC,KAAK,YAAY;AAChC,MAAI;AACF,WAAO,QAAQ,GAAG;AAAA,EACpB,QAAE;AACA,WAAO,IAAI,QAAQ,yBAAyB,CAACA,WAAU;AACrD,UAAI;AACF,eAAO,QAAQA,MAAK;AAAA,MACtB,QAAE;AACA,eAAOA;AAAA,MACT;AAAA,IACF,CAAC;AAAA,EACH;AACF,GAZgB;AAahB,IAAI,eAAe,wBAAC,QAAQ,UAAU,KAAK,SAAS,GAAjC;AACnB,IAAI,UAAU,wBAAC,YAAY;AACzB,QAAM,MAAM,QAAQ;AACpB,QAAM,QAAQ,IAAI,QAAQ,KAAK,IAAI,QAAQ,GAAG,IAAI,CAAC;AACnD,MAAI,IAAI;AACR,SAAO,IAAI,IAAI,QAAQ,KAAK;AAC1B,UAAM,WAAW,IAAI,WAAW,CAAC;AACjC,QAAI,aAAa,IAAI;AACnB,YAAM,aAAa,IAAI,QAAQ,KAAK,CAAC;AACrC,YAAM,YAAY,IAAI,QAAQ,KAAK,CAAC;AACpC,YAAM,MAAM,eAAe,KAAK,cAAc,KAAK,SAAS,YAAY,cAAc,KAAK,aAAa,KAAK,IAAI,YAAY,SAAS;AACtI,YAAM,OAAO,IAAI,MAAM,OAAO,GAAG;AACjC,aAAO,aAAa,KAAK,SAAS,KAAK,IAAI,KAAK,QAAQ,QAAQ,OAAO,IAAI,IAAI;AAAA,IACjF,WAAW,aAAa,MAAM,aAAa,IAAI;AAC7C;AAAA,IACF;AAAA,EACF;AACA,SAAO,IAAI,MAAM,OAAO,CAAC;AAC3B,GAjBc;AAsBd,IAAI,kBAAkB,wBAAC,YAAY;AACjC,QAAM,SAAS,QAAQ,OAAO;AAC9B,SAAO,OAAO,SAAS,KAAK,OAAO,GAAG,EAAE,MAAM,MAAM,OAAO,MAAM,GAAG,EAAE,IAAI;AAC5E,GAHsB;AAItB,IAAI,YAAY,wBAAC,MAAM,QAAQ,SAAS;AACtC,MAAI,KAAK,QAAQ;AACf,UAAM,UAAU,KAAK,GAAG,IAAI;AAAA,EAC9B;AACA,SAAO,GAAG,OAAO,CAAC,MAAM,MAAM,KAAK,MAAM,OAAO,QAAQ,MAAM,KAAK,GAAG,MAAM,GAAG,EAAE,MAAM,MAAM,KAAK,MAAM,MAAM,CAAC,MAAM,MAAM,IAAI,MAAM,CAAC,IAAI;AAC5I,GALgB;AAMhB,IAAI,yBAAyB,wBAAC,SAAS;AACrC,MAAI,KAAK,WAAW,KAAK,SAAS,CAAC,MAAM,MAAM,CAAC,KAAK,SAAS,GAAG,GAAG;AAClE,WAAO;AAAA,EACT;AACA,QAAM,WAAW,KAAK,MAAM,GAAG;AAC/B,QAAM,UAAU,CAAC;AACjB,MAAI,WAAW;AACf,WAAS,QAAQ,CAAC,YAAY;AAC5B,QAAI,YAAY,MAAM,CAAC,KAAK,KAAK,OAAO,GAAG;AACzC,kBAAY,MAAM;AAAA,IACpB,WAAW,KAAK,KAAK,OAAO,GAAG;AAC7B,UAAI,KAAK,KAAK,OAAO,GAAG;AACtB,YAAI,QAAQ,WAAW,KAAK,aAAa,IAAI;AAC3C,kBAAQ,KAAK,GAAG;AAAA,QAClB,OAAO;AACL,kBAAQ,KAAK,QAAQ;AAAA,QACvB;AACA,cAAM,kBAAkB,QAAQ,QAAQ,KAAK,EAAE;AAC/C,oBAAY,MAAM;AAClB,gBAAQ,KAAK,QAAQ;AAAA,MACvB,OAAO;AACL,oBAAY,MAAM;AAAA,MACpB;AAAA,IACF;AAAA,EACF,CAAC;AACD,SAAO,QAAQ,OAAO,CAAC,GAAG,GAAG,MAAM,EAAE,QAAQ,CAAC,MAAM,CAAC;AACvD,GA1B6B;AA2B7B,IAAI,aAAa,wBAAC,UAAU;AAC1B,MAAI,CAAC,OAAO,KAAK,KAAK,GAAG;AACvB,WAAO;AAAA,EACT;AACA,MAAI,MAAM,QAAQ,GAAG,MAAM,IAAI;AAC7B,YAAQ,MAAM,QAAQ,OAAO,GAAG;AAAA,EAClC;AACA,SAAO,MAAM,QAAQ,GAAG,MAAM,KAAK,UAAU,OAAO,mBAAmB,IAAI;AAC7E,GARiB;AASjB,IAAI,iBAAiB,wBAAC,KAAK,KAAK,aAAa;AAC3C,MAAI;AACJ,MAAI,CAAC,YAAY,OAAO,CAAC,OAAO,KAAK,GAAG,GAAG;AACzC,QAAI,YAAY,IAAI,QAAQ,KAAK,CAAC;AAClC,QAAI,cAAc,IAAI;AACpB,aAAO;AAAA,IACT;AACA,QAAI,CAAC,IAAI,WAAW,KAAK,YAAY,CAAC,GAAG;AACvC,kBAAY,IAAI,QAAQ,IAAI,OAAO,YAAY,CAAC;AAAA,IAClD;AACA,WAAO,cAAc,IAAI;AACvB,YAAM,kBAAkB,IAAI,WAAW,YAAY,IAAI,SAAS,CAAC;AACjE,UAAI,oBAAoB,IAAI;AAC1B,cAAM,aAAa,YAAY,IAAI,SAAS;AAC5C,cAAM,WAAW,IAAI,QAAQ,KAAK,UAAU;AAC5C,eAAO,WAAW,IAAI,MAAM,YAAY,aAAa,KAAK,SAAS,QAAQ,CAAC;AAAA,MAC9E,WAAW,mBAAmB,MAAM,MAAM,eAAe,GAAG;AAC1D,eAAO;AAAA,MACT;AACA,kBAAY,IAAI,QAAQ,IAAI,OAAO,YAAY,CAAC;AAAA,IAClD;AACA,cAAU,OAAO,KAAK,GAAG;AACzB,QAAI,CAAC,SAAS;AACZ,aAAO;AAAA,IACT;AAAA,EACF;AACA,QAAM,UAAU,CAAC;AACjB,cAAY,OAAO,KAAK,GAAG;AAC3B,MAAI,WAAW,IAAI,QAAQ,KAAK,CAAC;AACjC,SAAO,aAAa,IAAI;AACtB,UAAM,eAAe,IAAI,QAAQ,KAAK,WAAW,CAAC;AAClD,QAAI,aAAa,IAAI,QAAQ,KAAK,QAAQ;AAC1C,QAAI,aAAa,gBAAgB,iBAAiB,IAAI;AACpD,mBAAa;AAAA,IACf;AACA,QAAI,OAAO,IAAI;AAAA,MACb,WAAW;AAAA,MACX,eAAe,KAAK,iBAAiB,KAAK,SAAS,eAAe;AAAA,IACpE;AACA,QAAI,SAAS;AACX,aAAO,WAAW,IAAI;AAAA,IACxB;AACA,eAAW;AACX,QAAI,SAAS,IAAI;AACf;AAAA,IACF;AACA,QAAI;AACJ,QAAI,eAAe,IAAI;AACrB,cAAQ;AAAA,IACV,OAAO;AACL,cAAQ,IAAI,MAAM,aAAa,GAAG,iBAAiB,KAAK,SAAS,YAAY;AAC7E,UAAI,SAAS;AACX,gBAAQ,WAAW,KAAK;AAAA,MAC1B;AAAA,IACF;AACA,QAAI,UAAU;AACZ,UAAI,EAAE,QAAQ,IAAI,KAAK,MAAM,QAAQ,QAAQ,IAAI,CAAC,IAAI;AACpD,gBAAQ,IAAI,IAAI,CAAC;AAAA,MACnB;AACA;AACA,cAAQ,IAAI,EAAE,KAAK,KAAK;AAAA,IAC1B,OAAO;AACL,cAAQ,IAAI,MAAM;AAAA,IACpB;AAAA,EACF;AACA,SAAO,MAAM,QAAQ,GAAG,IAAI;AAC9B,GAlEqB;AAmErB,IAAI,gBAAgB;AACpB,IAAI,iBAAiB,wBAAC,KAAK,QAAQ;AACjC,SAAO,eAAe,KAAK,KAAK,IAAI;AACtC,GAFqB;AAGrB,IAAI,sBAAsB;;;ACzM1B,IAAI,wBAAwB,wBAAC,QAAQ,UAAU,KAAK,mBAAmB,GAA3C;AAC5B,IAAI,cAAc,6BAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAetB;AAAA,EACA;AAAA;AAAA,EAEA;AAAA,EACA,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAab;AAAA,EACA,YAAY,CAAC;AAAA,EACb,YAAY,SAAS,OAAO,KAAK,cAAc,CAAC,CAAC,CAAC,GAAG;AACnD,SAAK,MAAM;AACX,SAAK,OAAO;AACZ,SAAK,eAAe;AACpB,SAAK,iBAAiB,CAAC;AAAA,EACzB;AAAA,EACA,MAAM,KAAK;AACT,WAAO,MAAM,KAAK,iBAAiB,GAAG,IAAI,KAAK,qBAAqB;AAAA,EACtE;AAAA,EACA,iBAAiB,KAAK;AACpB,UAAM,WAAW,KAAK,aAAa,CAAC,EAAE,KAAK,UAAU,EAAE,CAAC,EAAE,GAAG;AAC7D,UAAM,QAAQ,KAAK,eAAe,QAAQ;AAC1C,WAAO,SAAS,KAAK,KAAK,KAAK,IAAI,sBAAsB,KAAK,IAAI;AAAA,EACpE;AAAA,EACA,uBAAuB;AACrB,UAAM,UAAU,CAAC;AACjB,UAAM,OAAO,OAAO,KAAK,KAAK,aAAa,CAAC,EAAE,KAAK,UAAU,EAAE,CAAC,CAAC;AACjE,eAAW,OAAO,MAAM;AACtB,YAAM,QAAQ,KAAK,eAAe,KAAK,aAAa,CAAC,EAAE,KAAK,UAAU,EAAE,CAAC,EAAE,GAAG,CAAC;AAC/E,UAAI,UAAU,QAAQ;AACpB,gBAAQ,GAAG,IAAI,KAAK,KAAK,KAAK,IAAI,sBAAsB,KAAK,IAAI;AAAA,MACnE;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAAA,EACA,eAAe,UAAU;AACvB,WAAO,KAAK,aAAa,CAAC,IAAI,KAAK,aAAa,CAAC,EAAE,QAAQ,IAAI;AAAA,EACjE;AAAA,EACA,MAAM,KAAK;AACT,WAAO,cAAc,KAAK,KAAK,GAAG;AAAA,EACpC;AAAA,EACA,QAAQ,KAAK;AACX,WAAO,eAAe,KAAK,KAAK,GAAG;AAAA,EACrC;AAAA,EACA,OAAO,MAAM;AACX,QAAI,MAAM;AACR,aAAO,KAAK,IAAI,QAAQ,IAAI,IAAI,KAAK;AAAA,IACvC;AACA,UAAM,aAAa,CAAC;AACpB,SAAK,IAAI,QAAQ,QAAQ,CAAC,OAAO,QAAQ;AACvC,iBAAW,GAAG,IAAI;AAAA,IACpB,CAAC;AACD,WAAO;AAAA,EACT;AAAA,EACA,MAAM,UAAU,SAAS;AACvB,WAAO,KAAK,UAAU,eAAe,MAAM,UAAU,MAAM,OAAO;AAAA,EACpE;AAAA,EACA,cAAc,CAAC,QAAQ;AACrB,UAAM,EAAE,WAAW,KAAAC,KAAI,IAAI;AAC3B,UAAM,aAAa,UAAU,GAAG;AAChC,QAAI,YAAY;AACd,aAAO;AAAA,IACT;AACA,UAAM,eAAe,OAAO,KAAK,SAAS,EAAE,CAAC;AAC7C,QAAI,cAAc;AAChB,aAAO,UAAU,YAAY,EAAE,KAAK,CAAC,SAAS;AAC5C,YAAI,iBAAiB,QAAQ;AAC3B,iBAAO,KAAK,UAAU,IAAI;AAAA,QAC5B;AACA,eAAO,IAAI,SAAS,IAAI,EAAE,GAAG,EAAE;AAAA,MACjC,CAAC;AAAA,IACH;AACA,WAAO,UAAU,GAAG,IAAIA,KAAI,GAAG,EAAE;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,OAAO;AACL,WAAO,KAAK,YAAY,MAAM,EAAE,KAAK,CAAC,SAAS,KAAK,MAAM,IAAI,CAAC;AAAA,EACjE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,OAAO;AACL,WAAO,KAAK,YAAY,MAAM;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,cAAc;AACZ,WAAO,KAAK,YAAY,aAAa;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,OAAO;AACL,WAAO,KAAK,YAAY,MAAM;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,WAAW;AACT,WAAO,KAAK,YAAY,UAAU;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,iBAAiB,QAAQC,OAAM;AAC7B,SAAK,eAAe,MAAM,IAAIA;AAAA,EAChC;AAAA,EACA,MAAM,QAAQ;AACZ,WAAO,KAAK,eAAe,MAAM;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,IAAI,MAAM;AACR,WAAO,KAAK,IAAI;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,IAAI,SAAS;AACX,WAAO,KAAK,IAAI;AAAA,EAClB;AAAA,EACA,KAAK,gBAAgB,IAAI;AACvB,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA4BA,IAAI,gBAAgB;AAClB,WAAO,KAAK,aAAa,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,MAAM,KAAK;AAAA,EACxD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiBA,IAAI,YAAY;AACd,WAAO,KAAK,aAAa,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,MAAM,KAAK,EAAE,KAAK,UAAU,EAAE;AAAA,EAC3E;AACF,GAxQkB;;;ACLlB,IAAI,2BAA2B;AAAA,EAC7B,WAAW;AAAA,EACX,cAAc;AAAA,EACd,QAAQ;AACV;AACA,IAAI,MAAM,wBAAC,OAAO,cAAc;AAC9B,QAAM,gBAAgB,IAAI,OAAO,KAAK;AACtC,gBAAc,YAAY;AAC1B,gBAAc,YAAY;AAC1B,SAAO;AACT,GALU;AAgFV,IAAI,kBAAkB,8BAAO,KAAK,OAAO,mBAAmB,SAAS,WAAW;AAC9E,MAAI,OAAO,QAAQ,YAAY,EAAE,eAAe,SAAS;AACvD,QAAI,EAAE,eAAe,UAAU;AAC7B,YAAM,IAAI,SAAS;AAAA,IACrB;AACA,QAAI,eAAe,SAAS;AAC1B,YAAM,MAAM;AAAA,IACd;AAAA,EACF;AACA,QAAM,YAAY,IAAI;AACtB,MAAI,CAAC,WAAW,QAAQ;AACtB,WAAO,QAAQ,QAAQ,GAAG;AAAA,EAC5B;AACA,MAAI,QAAQ;AACV,WAAO,CAAC,KAAK;AAAA,EACf,OAAO;AACL,aAAS,CAAC,GAAG;AAAA,EACf;AACA,QAAM,SAAS,QAAQ,IAAI,UAAU,IAAI,CAAC,MAAM,EAAE,EAAE,OAAO,QAAQ,QAAQ,CAAC,CAAC,CAAC,EAAE;AAAA,IAC9E,CAAC,QAAQ,QAAQ;AAAA,MACf,IAAI,OAAO,OAAO,EAAE,IAAI,CAAC,SAAS,gBAAgB,MAAM,OAAO,OAAO,SAAS,MAAM,CAAC;AAAA,IACxF,EAAE,KAAK,MAAM,OAAO,CAAC,CAAC;AAAA,EACxB;AACA,MAAI,mBAAmB;AACrB,WAAO,IAAI,MAAM,QAAQ,SAAS;AAAA,EACpC,OAAO;AACL,WAAO;AAAA,EACT;AACF,GA5BsB;;;ACnFtB,IAAI,aAAa;AACjB,IAAI,wBAAwB,wBAAC,aAAa,YAAY;AACpD,SAAO;AAAA,IACL,gBAAgB;AAAA,IAChB,GAAG;AAAA,EACL;AACF,GAL4B;AAM5B,IAAI,UAAU,6BAAM;AAAA,EAClB;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,MAAM,CAAC;AAAA,EACP;AAAA,EACA,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAgBZ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,YAAY,KAAK,SAAS;AACxB,SAAK,cAAc;AACnB,QAAI,SAAS;AACX,WAAK,gBAAgB,QAAQ;AAC7B,WAAK,MAAM,QAAQ;AACnB,WAAK,mBAAmB,QAAQ;AAChC,WAAK,QAAQ,QAAQ;AACrB,WAAK,eAAe,QAAQ;AAAA,IAC9B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAIA,IAAI,MAAM;AACR,SAAK,SAAS,IAAI,YAAY,KAAK,aAAa,KAAK,OAAO,KAAK,YAAY;AAC7E,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,IAAI,QAAQ;AACV,QAAI,KAAK,iBAAiB,iBAAiB,KAAK,eAAe;AAC7D,aAAO,KAAK;AAAA,IACd,OAAO;AACL,YAAM,MAAM,gCAAgC;AAAA,IAC9C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,IAAI,eAAe;AACjB,QAAI,KAAK,eAAe;AACtB,aAAO,KAAK;AAAA,IACd,OAAO;AACL,YAAM,MAAM,sCAAsC;AAAA,IACpD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,MAAM;AACR,WAAO,KAAK,SAAS,IAAI,SAAS,MAAM;AAAA,MACtC,SAAS,KAAK,qBAAqB,IAAI,QAAQ;AAAA,IACjD,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,IAAI,IAAI,MAAM;AACZ,QAAI,KAAK,QAAQ,MAAM;AACrB,aAAO,IAAI,SAAS,KAAK,MAAM,IAAI;AACnC,iBAAW,CAAC,GAAG,CAAC,KAAK,KAAK,KAAK,QAAQ,QAAQ,GAAG;AAChD,YAAI,MAAM,gBAAgB;AACxB;AAAA,QACF;AACA,YAAI,MAAM,cAAc;AACtB,gBAAM,UAAU,KAAK,KAAK,QAAQ,aAAa;AAC/C,eAAK,QAAQ,OAAO,YAAY;AAChC,qBAAW,UAAU,SAAS;AAC5B,iBAAK,QAAQ,OAAO,cAAc,MAAM;AAAA,UAC1C;AAAA,QACF,OAAO;AACL,eAAK,QAAQ,IAAI,GAAG,CAAC;AAAA,QACvB;AAAA,MACF;AAAA,IACF;AACA,SAAK,OAAO;AACZ,SAAK,YAAY;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,SAAS,IAAI,SAAS;AACpB,SAAK,cAAc,CAAC,YAAY,KAAK,KAAK,OAAO;AACjD,WAAO,KAAK,UAAU,GAAG,IAAI;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,YAAY,CAAC,WAAW,KAAK,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMvC,YAAY,MAAM,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAsBvB,cAAc,CAAC,aAAa;AAC1B,SAAK,YAAY;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiBA,SAAS,CAAC,MAAM,OAAO,YAAY;AACjC,QAAI,KAAK,WAAW;AAClB,WAAK,OAAO,IAAI,SAAS,KAAK,KAAK,MAAM,KAAK,IAAI;AAAA,IACpD;AACA,UAAM,UAAU,KAAK,OAAO,KAAK,KAAK,UAAU,KAAK,qBAAqB,IAAI,QAAQ;AACtF,QAAI,UAAU,QAAQ;AACpB,cAAQ,OAAO,IAAI;AAAA,IACrB,WAAW,SAAS,QAAQ;AAC1B,cAAQ,OAAO,MAAM,KAAK;AAAA,IAC5B,OAAO;AACL,cAAQ,IAAI,MAAM,KAAK;AAAA,IACzB;AAAA,EACF;AAAA,EACA,SAAS,CAAC,WAAW;AACnB,SAAK,UAAU;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,MAAM,CAAC,KAAK,UAAU;AACpB,SAAK,SAAyB,oBAAI,IAAI;AACtC,SAAK,KAAK,IAAI,KAAK,KAAK;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,MAAM,CAAC,QAAQ;AACb,WAAO,KAAK,OAAO,KAAK,KAAK,IAAI,GAAG,IAAI;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,IAAI,MAAM;AACR,QAAI,CAAC,KAAK,MAAM;AACd,aAAO,CAAC;AAAA,IACV;AACA,WAAO,OAAO,YAAY,KAAK,IAAI;AAAA,EACrC;AAAA,EACA,aAAaC,OAAM,KAAK,SAAS;AAC/B,UAAM,kBAAkB,KAAK,OAAO,IAAI,QAAQ,KAAK,KAAK,OAAO,IAAI,KAAK,oBAAoB,IAAI,QAAQ;AAC1G,QAAI,OAAO,QAAQ,YAAY,aAAa,KAAK;AAC/C,YAAM,aAAa,IAAI,mBAAmB,UAAU,IAAI,UAAU,IAAI,QAAQ,IAAI,OAAO;AACzF,iBAAW,CAAC,KAAK,KAAK,KAAK,YAAY;AACrC,YAAI,IAAI,YAAY,MAAM,cAAc;AACtC,0BAAgB,OAAO,KAAK,KAAK;AAAA,QACnC,OAAO;AACL,0BAAgB,IAAI,KAAK,KAAK;AAAA,QAChC;AAAA,MACF;AAAA,IACF;AACA,QAAI,SAAS;AACX,iBAAW,CAAC,GAAG,CAAC,KAAK,OAAO,QAAQ,OAAO,GAAG;AAC5C,YAAI,OAAO,MAAM,UAAU;AACzB,0BAAgB,IAAI,GAAG,CAAC;AAAA,QAC1B,OAAO;AACL,0BAAgB,OAAO,CAAC;AACxB,qBAAW,MAAM,GAAG;AAClB,4BAAgB,OAAO,GAAG,EAAE;AAAA,UAC9B;AAAA,QACF;AAAA,MACF;AAAA,IACF;AACA,UAAM,SAAS,OAAO,QAAQ,WAAW,MAAM,KAAK,UAAU,KAAK;AACnE,WAAO,IAAI,SAASA,OAAM,EAAE,QAAQ,SAAS,gBAAgB,CAAC;AAAA,EAChE;AAAA,EACA,cAAc,IAAI,SAAS,KAAK,aAAa,GAAG,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAsBpD,OAAO,CAACA,OAAM,KAAK,YAAY,KAAK,aAAaA,OAAM,KAAK,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAanE,OAAO,CAAC,MAAM,KAAK,YAAY;AAC7B,WAAO,CAAC,KAAK,oBAAoB,CAAC,KAAK,WAAW,CAAC,OAAO,CAAC,WAAW,CAAC,KAAK,YAAY,IAAI,SAAS,IAAI,IAAI,KAAK;AAAA,MAChH;AAAA,MACA;AAAA,MACA,sBAAsB,YAAY,OAAO;AAAA,IAC3C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,OAAO,CAAC,QAAQ,KAAK,YAAY;AAC/B,WAAO,KAAK;AAAA,MACV,KAAK,UAAU,MAAM;AAAA,MACrB;AAAA,MACA,sBAAsB,oBAAoB,OAAO;AAAA,IACnD;AAAA,EACF;AAAA,EACA,OAAO,CAAC,MAAM,KAAK,YAAY;AAC7B,UAAM,MAAM,wBAAC,UAAU,KAAK,aAAa,OAAO,KAAK,sBAAsB,4BAA4B,OAAO,CAAC,GAAnG;AACZ,WAAO,OAAO,SAAS,WAAW,gBAAgB,MAAM,yBAAyB,WAAW,OAAO,CAAC,CAAC,EAAE,KAAK,GAAG,IAAI,IAAI,IAAI;AAAA,EAC7H;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAgBA,WAAW,CAAC,UAAU,WAAW;AAC/B,UAAM,iBAAiB,OAAO,QAAQ;AACtC,SAAK;AAAA,MACH;AAAA;AAAA;AAAA,MAGA,CAAC,eAAe,KAAK,cAAc,IAAI,iBAAiB,UAAU,cAAc;AAAA,IAClF;AACA,WAAO,KAAK,YAAY,MAAM,UAAU,GAAG;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,WAAW,MAAM;AACf,SAAK,qBAAqB,MAAM,IAAI,SAAS;AAC7C,WAAO,KAAK,iBAAiB,IAAI;AAAA,EACnC;AACF,GA5Yc;;;ACTd,IAAI,kBAAkB;AACtB,IAAI,4BAA4B;AAChC,IAAI,UAAU,CAAC,OAAO,QAAQ,OAAO,UAAU,WAAW,OAAO;AACjE,IAAI,mCAAmC;AACvC,IAAI,uBAAuB,qCAAc,MAAM;AAC/C,GAD2B;;;ACJ3B,IAAI,mBAAmB;;;ACKvB,IAAI,kBAAkB,wBAAC,MAAM;AAC3B,SAAO,EAAE,KAAK,iBAAiB,GAAG;AACpC,GAFsB;AAGtB,IAAI,eAAe,wBAAC,KAAK,MAAM;AAC7B,MAAI,iBAAiB,KAAK;AACxB,UAAM,MAAM,IAAI,YAAY;AAC5B,WAAO,EAAE,YAAY,IAAI,MAAM,GAAG;AAAA,EACpC;AACA,UAAQ,MAAM,GAAG;AACjB,SAAO,EAAE,KAAK,yBAAyB,GAAG;AAC5C,GAPmB;AAQnB,IAAI,OAAO,6BAAM,MAAM;AAAA,EACrB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA;AAAA,EACA;AAAA;AAAA,EAEA,YAAY;AAAA,EACZ,QAAQ;AAAA,EACR,SAAS,CAAC;AAAA,EACV,YAAY,UAAU,CAAC,GAAG;AACxB,UAAM,aAAa,CAAC,GAAG,SAAS,yBAAyB;AACzD,eAAW,QAAQ,CAAC,WAAW;AAC7B,WAAK,MAAM,IAAI,CAAC,UAAU,SAAS;AACjC,YAAI,OAAO,UAAU,UAAU;AAC7B,eAAK,QAAQ;AAAA,QACf,OAAO;AACL,eAAK,UAAU,QAAQ,KAAK,OAAO,KAAK;AAAA,QAC1C;AACA,aAAK,QAAQ,CAAC,YAAY;AACxB,eAAK,UAAU,QAAQ,KAAK,OAAO,OAAO;AAAA,QAC5C,CAAC;AACD,eAAO;AAAA,MACT;AAAA,IACF,CAAC;AACD,SAAK,KAAK,CAAC,QAAQ,SAAS,aAAa;AACvC,iBAAW,KAAK,CAAC,IAAI,EAAE,KAAK,GAAG;AAC7B,aAAK,QAAQ;AACb,mBAAW,KAAK,CAAC,MAAM,EAAE,KAAK,GAAG;AAC/B,mBAAS,IAAI,CAAC,YAAY;AACxB,iBAAK,UAAU,EAAE,YAAY,GAAG,KAAK,OAAO,OAAO;AAAA,UACrD,CAAC;AAAA,QACH;AAAA,MACF;AACA,aAAO;AAAA,IACT;AACA,SAAK,MAAM,CAAC,SAAS,aAAa;AAChC,UAAI,OAAO,SAAS,UAAU;AAC5B,aAAK,QAAQ;AAAA,MACf,OAAO;AACL,aAAK,QAAQ;AACb,iBAAS,QAAQ,IAAI;AAAA,MACvB;AACA,eAAS,QAAQ,CAAC,YAAY;AAC5B,aAAK,UAAU,iBAAiB,KAAK,OAAO,OAAO;AAAA,MACrD,CAAC;AACD,aAAO;AAAA,IACT;AACA,UAAM,EAAE,QAAQ,GAAG,qBAAqB,IAAI;AAC5C,WAAO,OAAO,MAAM,oBAAoB;AACxC,SAAK,UAAU,UAAU,OAAO,QAAQ,WAAW,UAAU;AAAA,EAC/D;AAAA,EACA,SAAS;AACP,UAAM,QAAQ,IAAI,MAAM;AAAA,MACtB,QAAQ,KAAK;AAAA,MACb,SAAS,KAAK;AAAA,IAChB,CAAC;AACD,UAAM,eAAe,KAAK;AAC1B,UAAM,mBAAmB,KAAK;AAC9B,UAAM,SAAS,KAAK;AACpB,WAAO;AAAA,EACT;AAAA,EACA,mBAAmB;AAAA;AAAA,EAEnB,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAmBf,MAAM,MAAMC,MAAK;AACf,UAAM,SAAS,KAAK,SAAS,IAAI;AACjC,IAAAA,KAAI,OAAO,IAAI,CAAC,MAAM;AACpB,UAAI;AACJ,UAAIA,KAAI,iBAAiB,cAAc;AACrC,kBAAU,EAAE;AAAA,MACd,OAAO;AACL,kBAAU,8BAAO,GAAG,UAAU,MAAM,QAAQ,CAAC,GAAGA,KAAI,YAAY,EAAE,GAAG,MAAM,EAAE,QAAQ,GAAG,IAAI,CAAC,GAAG,KAAtF;AACV,gBAAQ,gBAAgB,IAAI,EAAE;AAAA,MAChC;AACA,aAAO,UAAU,EAAE,QAAQ,EAAE,MAAM,OAAO;AAAA,IAC5C,CAAC;AACD,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,SAAS,MAAM;AACb,UAAM,SAAS,KAAK,OAAO;AAC3B,WAAO,YAAY,UAAU,KAAK,WAAW,IAAI;AACjD,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiBA,UAAU,CAAC,YAAY;AACrB,SAAK,eAAe;AACpB,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAgBA,WAAW,CAAC,YAAY;AACtB,SAAK,mBAAmB;AACxB,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiCA,MAAM,MAAM,oBAAoB,SAAS;AACvC,QAAI;AACJ,QAAI;AACJ,QAAI,SAAS;AACX,UAAI,OAAO,YAAY,YAAY;AACjC,wBAAgB;AAAA,MAClB,OAAO;AACL,wBAAgB,QAAQ;AACxB,YAAI,QAAQ,mBAAmB,OAAO;AACpC,2BAAiB,wBAAC,YAAY,SAAb;AAAA,QACnB,OAAO;AACL,2BAAiB,QAAQ;AAAA,QAC3B;AAAA,MACF;AAAA,IACF;AACA,UAAM,aAAa,gBAAgB,CAAC,MAAM;AACxC,YAAM,WAAW,cAAc,CAAC;AAChC,aAAO,MAAM,QAAQ,QAAQ,IAAI,WAAW,CAAC,QAAQ;AAAA,IACvD,IAAI,CAAC,MAAM;AACT,UAAI,mBAAmB;AACvB,UAAI;AACF,2BAAmB,EAAE;AAAA,MACvB,QAAE;AAAA,MACF;AACA,aAAO,CAAC,EAAE,KAAK,gBAAgB;AAAA,IACjC;AACA,wBAAoB,MAAM;AACxB,YAAM,aAAa,UAAU,KAAK,WAAW,IAAI;AACjD,YAAM,mBAAmB,eAAe,MAAM,IAAI,WAAW;AAC7D,aAAO,CAAC,YAAY;AAClB,cAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;AAC/B,YAAI,WAAW,IAAI,SAAS,MAAM,gBAAgB,KAAK;AACvD,eAAO,IAAI,QAAQ,KAAK,OAAO;AAAA,MACjC;AAAA,IACF,GAAG;AACH,UAAM,UAAU,8BAAO,GAAG,SAAS;AACjC,YAAM,MAAM,MAAM,mBAAmB,eAAe,EAAE,IAAI,GAAG,GAAG,GAAG,WAAW,CAAC,CAAC;AAChF,UAAI,KAAK;AACP,eAAO;AAAA,MACT;AACA,YAAM,KAAK;AAAA,IACb,GANgB;AAOhB,SAAK,UAAU,iBAAiB,UAAU,MAAM,GAAG,GAAG,OAAO;AAC7D,WAAO;AAAA,EACT;AAAA,EACA,UAAU,QAAQ,MAAM,SAAS;AAC/B,aAAS,OAAO,YAAY;AAC5B,WAAO,UAAU,KAAK,WAAW,IAAI;AACrC,UAAM,IAAI,EAAE,UAAU,KAAK,WAAW,MAAM,QAAQ,QAAQ;AAC5D,SAAK,OAAO,IAAI,QAAQ,MAAM,CAAC,SAAS,CAAC,CAAC;AAC1C,SAAK,OAAO,KAAK,CAAC;AAAA,EACpB;AAAA,EACA,aAAa,KAAK,GAAG;AACnB,QAAI,eAAe,OAAO;AACxB,aAAO,KAAK,aAAa,KAAK,CAAC;AAAA,IACjC;AACA,UAAM;AAAA,EACR;AAAA,EACA,UAAU,SAAS,cAAc,KAAK,QAAQ;AAC5C,QAAI,WAAW,QAAQ;AACrB,cAAQ,YAAY,IAAI,SAAS,MAAM,MAAM,KAAK,UAAU,SAAS,cAAc,KAAK,KAAK,CAAC,GAAG;AAAA,IACnG;AACA,UAAM,OAAO,KAAK,QAAQ,SAAS,EAAE,IAAI,CAAC;AAC1C,UAAM,cAAc,KAAK,OAAO,MAAM,QAAQ,IAAI;AAClD,UAAM,IAAI,IAAI,QAAQ,SAAS;AAAA,MAC7B;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,iBAAiB,KAAK;AAAA,IACxB,CAAC;AACD,QAAI,YAAY,CAAC,EAAE,WAAW,GAAG;AAC/B,UAAI;AACJ,UAAI;AACF,cAAM,YAAY,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,YAAY;AAC3C,YAAE,MAAM,MAAM,KAAK,iBAAiB,CAAC;AAAA,QACvC,CAAC;AAAA,MACH,SAAS,KAAP;AACA,eAAO,KAAK,aAAa,KAAK,CAAC;AAAA,MACjC;AACA,aAAO,eAAe,UAAU,IAAI;AAAA,QAClC,CAAC,aAAa,aAAa,EAAE,YAAY,EAAE,MAAM,KAAK,iBAAiB,CAAC;AAAA,MAC1E,EAAE,MAAM,CAAC,QAAQ,KAAK,aAAa,KAAK,CAAC,CAAC,IAAI,OAAO,KAAK,iBAAiB,CAAC;AAAA,IAC9E;AACA,UAAM,WAAW,QAAQ,YAAY,CAAC,GAAG,KAAK,cAAc,KAAK,gBAAgB;AACjF,YAAQ,YAAY;AAClB,UAAI;AACF,cAAM,UAAU,MAAM,SAAS,CAAC;AAChC,YAAI,CAAC,QAAQ,WAAW;AACtB,gBAAM,IAAI;AAAA,YACR;AAAA,UACF;AAAA,QACF;AACA,eAAO,QAAQ;AAAA,MACjB,SAAS,KAAP;AACA,eAAO,KAAK,aAAa,KAAK,CAAC;AAAA,MACjC;AAAA,IACF,GAAG;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,QAAQ,CAAC,YAAY,SAAS;AAC5B,WAAO,KAAK,UAAU,SAAS,KAAK,CAAC,GAAG,KAAK,CAAC,GAAG,QAAQ,MAAM;AAAA,EACjE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,UAAU,CAAC,OAAO,aAAa,KAAK,iBAAiB;AACnD,QAAI,iBAAiB,SAAS;AAC5B,aAAO,KAAK,MAAM,cAAc,IAAI,QAAQ,OAAO,WAAW,IAAI,OAAO,KAAK,YAAY;AAAA,IAC5F;AACA,YAAQ,MAAM,SAAS;AACvB,WAAO,KAAK;AAAA,MACV,IAAI;AAAA,QACF,eAAe,KAAK,KAAK,IAAI,QAAQ,mBAAmB,UAAU,KAAK,KAAK;AAAA,QAC5E;AAAA,MACF;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAkBA,OAAO,MAAM;AACX,qBAAiB,SAAS,CAAC,UAAU;AACnC,YAAM,YAAY,KAAK,UAAU,MAAM,SAAS,OAAO,QAAQ,MAAM,QAAQ,MAAM,CAAC;AAAA,IACtF,CAAC;AAAA,EACH;AACF,GArWW;;;ACfX,IAAI,aAAa,CAAC;AAClB,SAAS,MAAM,QAAQ,MAAM;AAC3B,QAAM,WAAW,KAAK,iBAAiB;AACvC,QAAM,SAAU,wBAAC,SAAS,UAAU;AAClC,UAAM,UAAU,SAAS,OAAO,KAAK,SAAS,eAAe;AAC7D,UAAM,cAAc,QAAQ,CAAC,EAAE,KAAK;AACpC,QAAI,aAAa;AACf,aAAO;AAAA,IACT;AACA,UAAM,SAAS,MAAM,MAAM,QAAQ,CAAC,CAAC;AACrC,QAAI,CAAC,QAAQ;AACX,aAAO,CAAC,CAAC,GAAG,UAAU;AAAA,IACxB;AACA,UAAM,QAAQ,OAAO,QAAQ,IAAI,CAAC;AAClC,WAAO,CAAC,QAAQ,CAAC,EAAE,KAAK,GAAG,MAAM;AAAA,EACnC,GAZgB;AAahB,OAAK,QAAQ;AACb,SAAO,OAAO,QAAQ,IAAI;AAC5B;AAjBS;;;ACFT,IAAI,oBAAoB;AACxB,IAAI,4BAA4B;AAChC,IAAI,4BAA4B;AAChC,IAAI,aAA6B,uBAAO;AACxC,IAAI,kBAAkB,IAAI,IAAI,aAAa;AAC3C,SAAS,WAAW,GAAG,GAAG;AACxB,MAAI,EAAE,WAAW,GAAG;AAClB,WAAO,EAAE,WAAW,IAAI,IAAI,IAAI,KAAK,IAAI;AAAA,EAC3C;AACA,MAAI,EAAE,WAAW,GAAG;AAClB,WAAO;AAAA,EACT;AACA,MAAI,MAAM,6BAA6B,MAAM,2BAA2B;AACtE,WAAO;AAAA,EACT,WAAW,MAAM,6BAA6B,MAAM,2BAA2B;AAC7E,WAAO;AAAA,EACT;AACA,MAAI,MAAM,mBAAmB;AAC3B,WAAO;AAAA,EACT,WAAW,MAAM,mBAAmB;AAClC,WAAO;AAAA,EACT;AACA,SAAO,EAAE,WAAW,EAAE,SAAS,IAAI,IAAI,KAAK,IAAI,EAAE,SAAS,EAAE;AAC/D;AAlBS;AAmBT,IAAI,OAAO,6BAAM,MAAM;AAAA,EACrB;AAAA,EACA;AAAA,EACA,YAA4B,uBAAO,OAAO,IAAI;AAAA,EAC9C,OAAO,QAAQ,OAAO,UAAU,SAAS,oBAAoB;AAC3D,QAAI,OAAO,WAAW,GAAG;AACvB,UAAI,KAAK,WAAW,QAAQ;AAC1B,cAAM;AAAA,MACR;AACA,UAAI,oBAAoB;AACtB;AAAA,MACF;AACA,WAAK,SAAS;AACd;AAAA,IACF;AACA,UAAM,CAAC,OAAO,GAAG,UAAU,IAAI;AAC/B,UAAM,UAAU,UAAU,MAAM,WAAW,WAAW,IAAI,CAAC,IAAI,IAAI,yBAAyB,IAAI,CAAC,IAAI,IAAI,iBAAiB,IAAI,UAAU,OAAO,CAAC,IAAI,IAAI,yBAAyB,IAAI,MAAM,MAAM,6BAA6B;AAC9N,QAAI;AACJ,QAAI,SAAS;AACX,YAAM,OAAO,QAAQ,CAAC;AACtB,UAAI,YAAY,QAAQ,CAAC,KAAK;AAC9B,UAAI,QAAQ,QAAQ,CAAC,GAAG;AACtB,YAAI,cAAc,MAAM;AACtB,gBAAM;AAAA,QACR;AACA,oBAAY,UAAU,QAAQ,0BAA0B,KAAK;AAC7D,YAAI,YAAY,KAAK,SAAS,GAAG;AAC/B,gBAAM;AAAA,QACR;AAAA,MACF;AACA,aAAO,KAAK,UAAU,SAAS;AAC/B,UAAI,CAAC,MAAM;AACT,YAAI,OAAO,KAAK,KAAK,SAAS,EAAE;AAAA,UAC9B,CAAC,MAAM,MAAM,6BAA6B,MAAM;AAAA,QAClD,GAAG;AACD,gBAAM;AAAA,QACR;AACA,YAAI,oBAAoB;AACtB;AAAA,QACF;AACA,eAAO,KAAK,UAAU,SAAS,IAAI,IAAI,MAAM;AAC7C,YAAI,SAAS,IAAI;AACf,eAAK,YAAY,QAAQ;AAAA,QAC3B;AAAA,MACF;AACA,UAAI,CAAC,sBAAsB,SAAS,IAAI;AACtC,iBAAS,KAAK,CAAC,MAAM,KAAK,SAAS,CAAC;AAAA,MACtC;AAAA,IACF,OAAO;AACL,aAAO,KAAK,UAAU,KAAK;AAC3B,UAAI,CAAC,MAAM;AACT,YAAI,OAAO,KAAK,KAAK,SAAS,EAAE;AAAA,UAC9B,CAAC,MAAM,EAAE,SAAS,KAAK,MAAM,6BAA6B,MAAM;AAAA,QAClE,GAAG;AACD,gBAAM;AAAA,QACR;AACA,YAAI,oBAAoB;AACtB;AAAA,QACF;AACA,eAAO,KAAK,UAAU,KAAK,IAAI,IAAI,MAAM;AAAA,MAC3C;AAAA,IACF;AACA,SAAK,OAAO,YAAY,OAAO,UAAU,SAAS,kBAAkB;AAAA,EACtE;AAAA,EACA,iBAAiB;AACf,UAAM,YAAY,OAAO,KAAK,KAAK,SAAS,EAAE,KAAK,UAAU;AAC7D,UAAM,UAAU,UAAU,IAAI,CAAC,MAAM;AACnC,YAAM,IAAI,KAAK,UAAU,CAAC;AAC1B,cAAQ,OAAO,EAAE,cAAc,WAAW,IAAI,MAAM,EAAE,cAAc,gBAAgB,IAAI,CAAC,IAAI,KAAK,MAAM,KAAK,EAAE,eAAe;AAAA,IAChI,CAAC;AACD,QAAI,OAAO,KAAK,WAAW,UAAU;AACnC,cAAQ,QAAQ,IAAI,KAAK,QAAQ;AAAA,IACnC;AACA,QAAI,QAAQ,WAAW,GAAG;AACxB,aAAO;AAAA,IACT;AACA,QAAI,QAAQ,WAAW,GAAG;AACxB,aAAO,QAAQ,CAAC;AAAA,IAClB;AACA,WAAO,QAAQ,QAAQ,KAAK,GAAG,IAAI;AAAA,EACrC;AACF,GAjFW;;;ACvBX,IAAI,OAAO,6BAAM;AAAA,EACf,WAAW,EAAE,UAAU,EAAE;AAAA,EACzB,QAAQ,IAAI,KAAK;AAAA,EACjB,OAAO,MAAM,OAAO,oBAAoB;AACtC,UAAM,aAAa,CAAC;AACpB,UAAM,SAAS,CAAC;AAChB,aAAS,IAAI,OAAO;AAClB,UAAI,WAAW;AACf,aAAO,KAAK,QAAQ,cAAc,CAAC,MAAM;AACvC,cAAM,OAAO,MAAM;AACnB,eAAO,CAAC,IAAI,CAAC,MAAM,CAAC;AACpB;AACA,mBAAW;AACX,eAAO;AAAA,MACT,CAAC;AACD,UAAI,CAAC,UAAU;AACb;AAAA,MACF;AAAA,IACF;AACA,UAAM,SAAS,KAAK,MAAM,0BAA0B,KAAK,CAAC;AAC1D,aAAS,IAAI,OAAO,SAAS,GAAG,KAAK,GAAG,KAAK;AAC3C,YAAM,CAAC,IAAI,IAAI,OAAO,CAAC;AACvB,eAAS,IAAI,OAAO,SAAS,GAAG,KAAK,GAAG,KAAK;AAC3C,YAAI,OAAO,CAAC,EAAE,QAAQ,IAAI,MAAM,IAAI;AAClC,iBAAO,CAAC,IAAI,OAAO,CAAC,EAAE,QAAQ,MAAM,OAAO,CAAC,EAAE,CAAC,CAAC;AAChD;AAAA,QACF;AAAA,MACF;AAAA,IACF;AACA,SAAK,MAAM,OAAO,QAAQ,OAAO,YAAY,KAAK,UAAU,kBAAkB;AAC9E,WAAO;AAAA,EACT;AAAA,EACA,cAAc;AACZ,QAAI,SAAS,KAAK,MAAM,eAAe;AACvC,QAAI,WAAW,IAAI;AACjB,aAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAAA,IACtB;AACA,QAAI,eAAe;AACnB,UAAM,sBAAsB,CAAC;AAC7B,UAAM,sBAAsB,CAAC;AAC7B,aAAS,OAAO,QAAQ,yBAAyB,CAAC,GAAG,cAAc,eAAe;AAChF,UAAI,iBAAiB,QAAQ;AAC3B,4BAAoB,EAAE,YAAY,IAAI,OAAO,YAAY;AACzD,eAAO;AAAA,MACT;AACA,UAAI,eAAe,QAAQ;AACzB,4BAAoB,OAAO,UAAU,CAAC,IAAI,EAAE;AAC5C,eAAO;AAAA,MACT;AACA,aAAO;AAAA,IACT,CAAC;AACD,WAAO,CAAC,IAAI,OAAO,IAAI,QAAQ,GAAG,qBAAqB,mBAAmB;AAAA,EAC5E;AACF,GArDW;;;ACQX,IAAI,cAAc,CAAC,MAAM,CAAC,GAAmB,uBAAO,OAAO,IAAI,CAAC;AAChE,IAAI,sBAAsC,uBAAO,OAAO,IAAI;AAC5D,SAAS,oBAAoB,MAAM;AACjC,SAAO,oBAAoB,IAAI,MAAM,IAAI;AAAA,IACvC,SAAS,MAAM,KAAK,IAAI,KAAK;AAAA,MAC3B;AAAA,MACA,CAAC,GAAG,aAAa,WAAW,KAAK,aAAa;AAAA,IAChD;AAAA,EACF;AACF;AAPS;AAQT,SAAS,2BAA2B;AAClC,wBAAsC,uBAAO,OAAO,IAAI;AAC1D;AAFS;AAGT,SAAS,mCAAmC,QAAQ;AAClD,QAAM,OAAO,IAAI,KAAK;AACtB,QAAM,cAAc,CAAC;AACrB,MAAI,OAAO,WAAW,GAAG;AACvB,WAAO;AAAA,EACT;AACA,QAAM,2BAA2B,OAAO;AAAA,IACtC,CAAC,UAAU,CAAC,CAAC,SAAS,KAAK,MAAM,CAAC,CAAC,GAAG,GAAG,KAAK;AAAA,EAChD,EAAE;AAAA,IACA,CAAC,CAAC,WAAW,KAAK,GAAG,CAAC,WAAW,KAAK,MAAM,YAAY,IAAI,YAAY,KAAK,MAAM,SAAS,MAAM;AAAA,EACpG;AACA,QAAM,YAA4B,uBAAO,OAAO,IAAI;AACpD,WAAS,IAAI,GAAG,IAAI,IAAI,MAAM,yBAAyB,QAAQ,IAAI,KAAK,KAAK;AAC3E,UAAM,CAAC,oBAAoB,MAAM,QAAQ,IAAI,yBAAyB,CAAC;AACvE,QAAI,oBAAoB;AACtB,gBAAU,IAAI,IAAI,CAAC,SAAS,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,GAAmB,uBAAO,OAAO,IAAI,CAAC,CAAC,GAAG,UAAU;AAAA,IAChG,OAAO;AACL;AAAA,IACF;AACA,QAAI;AACJ,QAAI;AACF,mBAAa,KAAK,OAAO,MAAM,GAAG,kBAAkB;AAAA,IACtD,SAAS,GAAP;AACA,YAAM,MAAM,aAAa,IAAI,qBAAqB,IAAI,IAAI;AAAA,IAC5D;AACA,QAAI,oBAAoB;AACtB;AAAA,IACF;AACA,gBAAY,CAAC,IAAI,SAAS,IAAI,CAAC,CAAC,GAAG,UAAU,MAAM;AACjD,YAAM,gBAAgC,uBAAO,OAAO,IAAI;AACxD,oBAAc;AACd,aAAO,cAAc,GAAG,cAAc;AACpC,cAAM,CAAC,KAAK,KAAK,IAAI,WAAW,UAAU;AAC1C,sBAAc,GAAG,IAAI;AAAA,MACvB;AACA,aAAO,CAAC,GAAG,aAAa;AAAA,IAC1B,CAAC;AAAA,EACH;AACA,QAAM,CAAC,QAAQ,qBAAqB,mBAAmB,IAAI,KAAK,YAAY;AAC5E,WAAS,IAAI,GAAG,MAAM,YAAY,QAAQ,IAAI,KAAK,KAAK;AACtD,aAAS,IAAI,GAAG,OAAO,YAAY,CAAC,EAAE,QAAQ,IAAI,MAAM,KAAK;AAC3D,YAAM,MAAM,YAAY,CAAC,EAAE,CAAC,IAAI,CAAC;AACjC,UAAI,CAAC,KAAK;AACR;AAAA,MACF;AACA,YAAM,OAAO,OAAO,KAAK,GAAG;AAC5B,eAAS,IAAI,GAAG,OAAO,KAAK,QAAQ,IAAI,MAAM,KAAK;AACjD,YAAI,KAAK,CAAC,CAAC,IAAI,oBAAoB,IAAI,KAAK,CAAC,CAAC,CAAC;AAAA,MACjD;AAAA,IACF;AAAA,EACF;AACA,QAAM,aAAa,CAAC;AACpB,aAAW,KAAK,qBAAqB;AACnC,eAAW,CAAC,IAAI,YAAY,oBAAoB,CAAC,CAAC;AAAA,EACpD;AACA,SAAO,CAAC,QAAQ,YAAY,SAAS;AACvC;AAxDS;AAyDT,SAAS,eAAe,YAAY,MAAM;AACxC,MAAI,CAAC,YAAY;AACf,WAAO;AAAA,EACT;AACA,aAAW,KAAK,OAAO,KAAK,UAAU,EAAE,KAAK,CAAC,GAAG,MAAM,EAAE,SAAS,EAAE,MAAM,GAAG;AAC3E,QAAI,oBAAoB,CAAC,EAAE,KAAK,IAAI,GAAG;AACrC,aAAO,CAAC,GAAG,WAAW,CAAC,CAAC;AAAA,IAC1B;AAAA,EACF;AACA,SAAO;AACT;AAVS;AAWT,IAAI,eAAe,6BAAM;AAAA,EACvB,OAAO;AAAA,EACP;AAAA,EACA;AAAA,EACA,cAAc;AACZ,SAAK,cAAc,EAAE,CAAC,eAAe,GAAmB,uBAAO,OAAO,IAAI,EAAE;AAC5E,SAAK,UAAU,EAAE,CAAC,eAAe,GAAmB,uBAAO,OAAO,IAAI,EAAE;AAAA,EAC1E;AAAA,EACA,IAAI,QAAQ,MAAM,SAAS;AACzB,UAAM,aAAa,KAAK;AACxB,UAAM,SAAS,KAAK;AACpB,QAAI,CAAC,cAAc,CAAC,QAAQ;AAC1B,YAAM,IAAI,MAAM,gCAAgC;AAAA,IAClD;AACA,QAAI,CAAC,WAAW,MAAM,GAAG;AACvB;AACA,OAAC,YAAY,MAAM,EAAE,QAAQ,CAAC,eAAe;AAC3C,mBAAW,MAAM,IAAoB,uBAAO,OAAO,IAAI;AACvD,eAAO,KAAK,WAAW,eAAe,CAAC,EAAE,QAAQ,CAAC,MAAM;AACtD,qBAAW,MAAM,EAAE,CAAC,IAAI,CAAC,GAAG,WAAW,eAAe,EAAE,CAAC,CAAC;AAAA,QAC5D,CAAC;AAAA,MACH,CAAC;AAAA,IACH;AACA,QAAI,SAAS,MAAM;AACjB,aAAO;AAAA,IACT;AACA,UAAM,cAAc,KAAK,MAAM,MAAM,KAAK,CAAC,GAAG;AAC9C,QAAI,MAAM,KAAK,IAAI,GAAG;AACpB,YAAM,KAAK,oBAAoB,IAAI;AACnC,UAAI,WAAW,iBAAiB;AAC9B,eAAO,KAAK,UAAU,EAAE,QAAQ,CAAC,MAAM;AACrC,qBAAW,CAAC,EAAE,IAAI,MAAM,eAAe,WAAW,CAAC,GAAG,IAAI,KAAK,eAAe,WAAW,eAAe,GAAG,IAAI,KAAK,CAAC;AAAA,QACvH,CAAC;AAAA,MACH,OAAO;AACL,mBAAW,MAAM,EAAE,IAAI,MAAM,eAAe,WAAW,MAAM,GAAG,IAAI,KAAK,eAAe,WAAW,eAAe,GAAG,IAAI,KAAK,CAAC;AAAA,MACjI;AACA,aAAO,KAAK,UAAU,EAAE,QAAQ,CAAC,MAAM;AACrC,YAAI,WAAW,mBAAmB,WAAW,GAAG;AAC9C,iBAAO,KAAK,WAAW,CAAC,CAAC,EAAE,QAAQ,CAAC,MAAM;AACxC,eAAG,KAAK,CAAC,KAAK,WAAW,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,SAAS,UAAU,CAAC;AAAA,UAC3D,CAAC;AAAA,QACH;AAAA,MACF,CAAC;AACD,aAAO,KAAK,MAAM,EAAE,QAAQ,CAAC,MAAM;AACjC,YAAI,WAAW,mBAAmB,WAAW,GAAG;AAC9C,iBAAO,KAAK,OAAO,CAAC,CAAC,EAAE;AAAA,YACrB,CAAC,MAAM,GAAG,KAAK,CAAC,KAAK,OAAO,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,SAAS,UAAU,CAAC;AAAA,UAC9D;AAAA,QACF;AAAA,MACF,CAAC;AACD;AAAA,IACF;AACA,UAAM,QAAQ,uBAAuB,IAAI,KAAK,CAAC,IAAI;AACnD,aAAS,IAAI,GAAG,MAAM,MAAM,QAAQ,IAAI,KAAK,KAAK;AAChD,YAAM,QAAQ,MAAM,CAAC;AACrB,aAAO,KAAK,MAAM,EAAE,QAAQ,CAAC,MAAM;AACjC,YAAI,WAAW,mBAAmB,WAAW,GAAG;AAC9C,iBAAO,CAAC,EAAE,KAAK,MAAM;AAAA,YACnB,GAAG,eAAe,WAAW,CAAC,GAAG,KAAK,KAAK,eAAe,WAAW,eAAe,GAAG,KAAK,KAAK,CAAC;AAAA,UACpG;AACA,iBAAO,CAAC,EAAE,KAAK,EAAE,KAAK,CAAC,SAAS,aAAa,MAAM,IAAI,CAAC,CAAC;AAAA,QAC3D;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EACA,QAAQ;AAAA,EACR,mBAAmB;AACjB,UAAM,WAA2B,uBAAO,OAAO,IAAI;AACnD,WAAO,KAAK,KAAK,OAAO,EAAE,OAAO,OAAO,KAAK,KAAK,WAAW,CAAC,EAAE,QAAQ,CAAC,WAAW;AAClF,eAAS,MAAM,MAAM,KAAK,cAAc,MAAM;AAAA,IAChD,CAAC;AACD,SAAK,cAAc,KAAK,UAAU;AAClC,6BAAyB;AACzB,WAAO;AAAA,EACT;AAAA,EACA,cAAc,QAAQ;AACpB,UAAM,SAAS,CAAC;AAChB,QAAI,cAAc,WAAW;AAC7B,KAAC,KAAK,aAAa,KAAK,OAAO,EAAE,QAAQ,CAAC,MAAM;AAC9C,YAAM,WAAW,EAAE,MAAM,IAAI,OAAO,KAAK,EAAE,MAAM,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC;AAC9F,UAAI,SAAS,WAAW,GAAG;AACzB,wBAAgB;AAChB,eAAO,KAAK,GAAG,QAAQ;AAAA,MACzB,WAAW,WAAW,iBAAiB;AACrC,eAAO;AAAA,UACL,GAAG,OAAO,KAAK,EAAE,eAAe,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,eAAe,EAAE,IAAI,CAAC,CAAC;AAAA,QACnF;AAAA,MACF;AAAA,IACF,CAAC;AACD,QAAI,CAAC,aAAa;AAChB,aAAO;AAAA,IACT,OAAO;AACL,aAAO,mCAAmC,MAAM;AAAA,IAClD;AAAA,EACF;AACF,GA/FmB;;;ACzFnB,IAAI,cAAc,6BAAM;AAAA,EACtB,OAAO;AAAA,EACP,WAAW,CAAC;AAAA,EACZ,UAAU,CAAC;AAAA,EACX,YAAY,MAAM;AAChB,SAAK,WAAW,KAAK;AAAA,EACvB;AAAA,EACA,IAAI,QAAQ,MAAM,SAAS;AACzB,QAAI,CAAC,KAAK,SAAS;AACjB,YAAM,IAAI,MAAM,gCAAgC;AAAA,IAClD;AACA,SAAK,QAAQ,KAAK,CAAC,QAAQ,MAAM,OAAO,CAAC;AAAA,EAC3C;AAAA,EACA,MAAM,QAAQ,MAAM;AAClB,QAAI,CAAC,KAAK,SAAS;AACjB,YAAM,IAAI,MAAM,aAAa;AAAA,IAC/B;AACA,UAAM,UAAU,KAAK;AACrB,UAAM,SAAS,KAAK;AACpB,UAAM,MAAM,QAAQ;AACpB,QAAI,IAAI;AACR,QAAI;AACJ,WAAO,IAAI,KAAK,KAAK;AACnB,YAAM,SAAS,QAAQ,CAAC;AACxB,UAAI;AACF,iBAAS,KAAK,GAAG,OAAO,OAAO,QAAQ,KAAK,MAAM,MAAM;AACtD,iBAAO,IAAI,GAAG,OAAO,EAAE,CAAC;AAAA,QAC1B;AACA,cAAM,OAAO,MAAM,QAAQ,IAAI;AAAA,MACjC,SAAS,GAAP;AACA,YAAI,aAAa,sBAAsB;AACrC;AAAA,QACF;AACA,cAAM;AAAA,MACR;AACA,WAAK,QAAQ,OAAO,MAAM,KAAK,MAAM;AACrC,WAAK,WAAW,CAAC,MAAM;AACvB,WAAK,UAAU;AACf;AAAA,IACF;AACA,QAAI,MAAM,KAAK;AACb,YAAM,IAAI,MAAM,aAAa;AAAA,IAC/B;AACA,SAAK,OAAO,iBAAiB,KAAK,aAAa;AAC/C,WAAO;AAAA,EACT;AAAA,EACA,IAAI,eAAe;AACjB,QAAI,KAAK,WAAW,KAAK,SAAS,WAAW,GAAG;AAC9C,YAAM,IAAI,MAAM,2CAA2C;AAAA,IAC7D;AACA,WAAO,KAAK,SAAS,CAAC;AAAA,EACxB;AACF,GApDkB;;;ACClB,IAAI,cAA8B,uBAAO,OAAO,IAAI;AACpD,IAAIC,QAAO,6BAAMC,OAAM;AAAA,EACrB;AAAA,EACA;AAAA,EACA;AAAA,EACA,SAAS;AAAA,EACT,UAAU;AAAA,EACV,YAAY,QAAQ,SAAS,UAAU;AACrC,SAAK,YAAY,YAA4B,uBAAO,OAAO,IAAI;AAC/D,SAAK,WAAW,CAAC;AACjB,QAAI,UAAU,SAAS;AACrB,YAAM,IAAoB,uBAAO,OAAO,IAAI;AAC5C,QAAE,MAAM,IAAI,EAAE,SAAS,cAAc,CAAC,GAAG,OAAO,EAAE;AAClD,WAAK,WAAW,CAAC,CAAC;AAAA,IACpB;AACA,SAAK,YAAY,CAAC;AAAA,EACpB;AAAA,EACA,OAAO,QAAQ,MAAM,SAAS;AAC5B,SAAK,SAAS,EAAE,KAAK;AACrB,QAAI,UAAU;AACd,UAAM,QAAQ,iBAAiB,IAAI;AACnC,UAAM,eAAe,CAAC;AACtB,aAAS,IAAI,GAAG,MAAM,MAAM,QAAQ,IAAI,KAAK,KAAK;AAChD,YAAM,IAAI,MAAM,CAAC;AACjB,YAAM,QAAQ,MAAM,IAAI,CAAC;AACzB,YAAM,UAAU,WAAW,GAAG,KAAK;AACnC,YAAM,MAAM,MAAM,QAAQ,OAAO,IAAI,QAAQ,CAAC,IAAI;AAClD,UAAI,OAAO,QAAQ,WAAW;AAC5B,kBAAU,QAAQ,UAAU,GAAG;AAC/B,YAAI,SAAS;AACX,uBAAa,KAAK,QAAQ,CAAC,CAAC;AAAA,QAC9B;AACA;AAAA,MACF;AACA,cAAQ,UAAU,GAAG,IAAI,IAAIA,OAAM;AACnC,UAAI,SAAS;AACX,gBAAQ,UAAU,KAAK,OAAO;AAC9B,qBAAa,KAAK,QAAQ,CAAC,CAAC;AAAA,MAC9B;AACA,gBAAU,QAAQ,UAAU,GAAG;AAAA,IACjC;AACA,YAAQ,SAAS,KAAK;AAAA,MACpB,CAAC,MAAM,GAAG;AAAA,QACR;AAAA,QACA,cAAc,aAAa,OAAO,CAAC,GAAG,GAAG,MAAM,EAAE,QAAQ,CAAC,MAAM,CAAC;AAAA,QACjE,OAAO,KAAK;AAAA,MACd;AAAA,IACF,CAAC;AACD,WAAO;AAAA,EACT;AAAA,EACA,gBAAgB,MAAM,QAAQ,YAAY,QAAQ;AAChD,UAAM,cAAc,CAAC;AACrB,aAAS,IAAI,GAAG,MAAM,KAAK,SAAS,QAAQ,IAAI,KAAK,KAAK;AACxD,YAAM,IAAI,KAAK,SAAS,CAAC;AACzB,YAAM,aAAa,EAAE,MAAM,KAAK,EAAE,eAAe;AACjD,YAAM,eAAe,CAAC;AACtB,UAAI,eAAe,QAAQ;AACzB,mBAAW,SAAyB,uBAAO,OAAO,IAAI;AACtD,oBAAY,KAAK,UAAU;AAC3B,YAAI,eAAe,eAAe,UAAU,WAAW,aAAa;AAClE,mBAAS,KAAK,GAAG,OAAO,WAAW,aAAa,QAAQ,KAAK,MAAM,MAAM;AACvE,kBAAM,MAAM,WAAW,aAAa,EAAE;AACtC,kBAAM,YAAY,aAAa,WAAW,KAAK;AAC/C,uBAAW,OAAO,GAAG,IAAI,SAAS,GAAG,KAAK,CAAC,YAAY,OAAO,GAAG,IAAI,WAAW,GAAG,KAAK,SAAS,GAAG;AACpG,yBAAa,WAAW,KAAK,IAAI;AAAA,UACnC;AAAA,QACF;AAAA,MACF;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAAA,EACA,OAAO,QAAQ,MAAM;AACnB,UAAM,cAAc,CAAC;AACrB,SAAK,UAAU;AACf,UAAM,UAAU;AAChB,QAAI,WAAW,CAAC,OAAO;AACvB,UAAM,QAAQ,UAAU,IAAI;AAC5B,UAAM,gBAAgB,CAAC;AACvB,aAAS,IAAI,GAAG,MAAM,MAAM,QAAQ,IAAI,KAAK,KAAK;AAChD,YAAM,OAAO,MAAM,CAAC;AACpB,YAAM,SAAS,MAAM,MAAM;AAC3B,YAAM,YAAY,CAAC;AACnB,eAAS,IAAI,GAAG,OAAO,SAAS,QAAQ,IAAI,MAAM,KAAK;AACrD,cAAM,OAAO,SAAS,CAAC;AACvB,cAAM,WAAW,KAAK,UAAU,IAAI;AACpC,YAAI,UAAU;AACZ,mBAAS,UAAU,KAAK;AACxB,cAAI,QAAQ;AACV,gBAAI,SAAS,UAAU,GAAG,GAAG;AAC3B,0BAAY;AAAA,gBACV,GAAG,KAAK,gBAAgB,SAAS,UAAU,GAAG,GAAG,QAAQ,KAAK,OAAO;AAAA,cACvE;AAAA,YACF;AACA,wBAAY,KAAK,GAAG,KAAK,gBAAgB,UAAU,QAAQ,KAAK,OAAO,CAAC;AAAA,UAC1E,OAAO;AACL,sBAAU,KAAK,QAAQ;AAAA,UACzB;AAAA,QACF;AACA,iBAAS,IAAI,GAAG,OAAO,KAAK,UAAU,QAAQ,IAAI,MAAM,KAAK;AAC3D,gBAAM,UAAU,KAAK,UAAU,CAAC;AAChC,gBAAM,SAAS,KAAK,YAAY,cAAc,CAAC,IAAI,EAAE,GAAG,KAAK,QAAQ;AACrE,cAAI,YAAY,KAAK;AACnB,kBAAM,UAAU,KAAK,UAAU,GAAG;AAClC,gBAAI,SAAS;AACX,0BAAY,KAAK,GAAG,KAAK,gBAAgB,SAAS,QAAQ,KAAK,OAAO,CAAC;AACvE,sBAAQ,UAAU;AAClB,wBAAU,KAAK,OAAO;AAAA,YACxB;AACA;AAAA,UACF;AACA,gBAAM,CAAC,KAAK,MAAM,OAAO,IAAI;AAC7B,cAAI,CAAC,QAAQ,EAAE,mBAAmB,SAAS;AACzC;AAAA,UACF;AACA,gBAAM,QAAQ,KAAK,UAAU,GAAG;AAChC,gBAAM,iBAAiB,MAAM,MAAM,CAAC,EAAE,KAAK,GAAG;AAC9C,cAAI,mBAAmB,QAAQ;AAC7B,kBAAM,IAAI,QAAQ,KAAK,cAAc;AACrC,gBAAI,GAAG;AACL,qBAAO,IAAI,IAAI,EAAE,CAAC;AAClB,0BAAY,KAAK,GAAG,KAAK,gBAAgB,OAAO,QAAQ,KAAK,SAAS,MAAM,CAAC;AAC7E,kBAAI,OAAO,KAAK,MAAM,SAAS,EAAE,QAAQ;AACvC,sBAAM,UAAU;AAChB,sBAAM,iBAAiB,EAAE,CAAC,EAAE,MAAM,IAAI,GAAG,UAAU;AACnD,sBAAM,iBAAiB,cAAc,cAAc,MAAM,CAAC;AAC1D,+BAAe,KAAK,KAAK;AAAA,cAC3B;AACA;AAAA,YACF;AAAA,UACF;AACA,cAAI,YAAY,QAAQ,QAAQ,KAAK,IAAI,GAAG;AAC1C,mBAAO,IAAI,IAAI;AACf,gBAAI,QAAQ;AACV,0BAAY,KAAK,GAAG,KAAK,gBAAgB,OAAO,QAAQ,QAAQ,KAAK,OAAO,CAAC;AAC7E,kBAAI,MAAM,UAAU,GAAG,GAAG;AACxB,4BAAY;AAAA,kBACV,GAAG,KAAK,gBAAgB,MAAM,UAAU,GAAG,GAAG,QAAQ,QAAQ,KAAK,OAAO;AAAA,gBAC5E;AAAA,cACF;AAAA,YACF,OAAO;AACL,oBAAM,UAAU;AAChB,wBAAU,KAAK,KAAK;AAAA,YACtB;AAAA,UACF;AAAA,QACF;AAAA,MACF;AACA,iBAAW,UAAU,OAAO,cAAc,MAAM,KAAK,CAAC,CAAC;AAAA,IACzD;AACA,QAAI,YAAY,SAAS,GAAG;AAC1B,kBAAY,KAAK,CAAC,GAAG,MAAM;AACzB,eAAO,EAAE,QAAQ,EAAE;AAAA,MACrB,CAAC;AAAA,IACH;AACA,WAAO,CAAC,YAAY,IAAI,CAAC,EAAE,SAAS,OAAO,MAAM,CAAC,SAAS,MAAM,CAAC,CAAC;AAAA,EACrE;AACF,GA1JW;;;ACDX,IAAI,aAAa,6BAAM;AAAA,EACrB,OAAO;AAAA,EACP;AAAA,EACA,cAAc;AACZ,SAAK,QAAQ,IAAIC,MAAK;AAAA,EACxB;AAAA,EACA,IAAI,QAAQ,MAAM,SAAS;AACzB,UAAM,UAAU,uBAAuB,IAAI;AAC3C,QAAI,SAAS;AACX,eAAS,IAAI,GAAG,MAAM,QAAQ,QAAQ,IAAI,KAAK,KAAK;AAClD,aAAK,MAAM,OAAO,QAAQ,QAAQ,CAAC,GAAG,OAAO;AAAA,MAC/C;AACA;AAAA,IACF;AACA,SAAK,MAAM,OAAO,QAAQ,MAAM,OAAO;AAAA,EACzC;AAAA,EACA,MAAM,QAAQ,MAAM;AAClB,WAAO,KAAK,MAAM,OAAO,QAAQ,IAAI;AAAA,EACvC;AACF,GAnBiB;;;ACEjB,IAAIC,QAAO,qCAAc,KAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMhC,YAAY,UAAU,CAAC,GAAG;AACxB,UAAM,OAAO;AACb,SAAK,SAAS,QAAQ,UAAU,IAAI,YAAY;AAAA,MAC9C,SAAS,CAAC,IAAI,aAAa,GAAG,IAAI,WAAW,CAAC;AAAA,IAChD,CAAC;AAAA,EACH;AACF,GAZW;;;ACJX,IAAI,OAAO,wBAAC,YAAY;AACtB,QAAM,WAAW;AAAA,IACf,QAAQ;AAAA,IACR,cAAc,CAAC,OAAO,QAAQ,OAAO,QAAQ,UAAU,OAAO;AAAA,IAC9D,cAAc,CAAC;AAAA,IACf,eAAe,CAAC;AAAA,EAClB;AACA,QAAM,OAAO;AAAA,IACX,GAAG;AAAA,IACH,GAAG;AAAA,EACL;AACA,QAAM,mBAAmB,CAAC,eAAe;AACvC,QAAI,OAAO,eAAe,UAAU;AAClC,UAAI,eAAe,KAAK;AACtB,eAAO,MAAM;AAAA,MACf,OAAO;AACL,eAAO,CAAC,WAAW,eAAe,SAAS,SAAS;AAAA,MACtD;AAAA,IACF,WAAW,OAAO,eAAe,YAAY;AAC3C,aAAO;AAAA,IACT,OAAO;AACL,aAAO,CAAC,WAAW,WAAW,SAAS,MAAM,IAAI,SAAS;AAAA,IAC5D;AAAA,EACF,GAAG,KAAK,MAAM;AACd,QAAM,oBAAoB,CAAC,qBAAqB;AAC9C,QAAI,OAAO,qBAAqB,YAAY;AAC1C,aAAO;AAAA,IACT,WAAW,MAAM,QAAQ,gBAAgB,GAAG;AAC1C,aAAO,MAAM;AAAA,IACf,OAAO;AACL,aAAO,MAAM,CAAC;AAAA,IAChB;AAAA,EACF,GAAG,KAAK,YAAY;AACpB,SAAO,sCAAe,MAAM,GAAG,MAAM;AACnC,aAAS,IAAI,KAAK,OAAO;AACvB,QAAE,IAAI,QAAQ,IAAI,KAAK,KAAK;AAAA,IAC9B;AAFS;AAGT,UAAM,cAAc,MAAM,gBAAgB,EAAE,IAAI,OAAO,QAAQ,KAAK,IAAI,CAAC;AACzE,QAAI,aAAa;AACf,UAAI,+BAA+B,WAAW;AAAA,IAChD;AACA,QAAI,KAAK,aAAa;AACpB,UAAI,oCAAoC,MAAM;AAAA,IAChD;AACA,QAAI,KAAK,eAAe,QAAQ;AAC9B,UAAI,iCAAiC,KAAK,cAAc,KAAK,GAAG,CAAC;AAAA,IACnE;AACA,QAAI,EAAE,IAAI,WAAW,WAAW;AAC9B,UAAI,KAAK,WAAW,KAAK;AACvB,YAAI,QAAQ,QAAQ;AAAA,MACtB;AACA,UAAI,KAAK,UAAU,MAAM;AACvB,YAAI,0BAA0B,KAAK,OAAO,SAAS,CAAC;AAAA,MACtD;AACA,YAAM,eAAe,MAAM,iBAAiB,EAAE,IAAI,OAAO,QAAQ,KAAK,IAAI,CAAC;AAC3E,UAAI,aAAa,QAAQ;AACvB,YAAI,gCAAgC,aAAa,KAAK,GAAG,CAAC;AAAA,MAC5D;AACA,UAAI,UAAU,KAAK;AACnB,UAAI,CAAC,SAAS,QAAQ;AACpB,cAAM,iBAAiB,EAAE,IAAI,OAAO,gCAAgC;AACpE,YAAI,gBAAgB;AAClB,oBAAU,eAAe,MAAM,SAAS;AAAA,QAC1C;AAAA,MACF;AACA,UAAI,SAAS,QAAQ;AACnB,YAAI,gCAAgC,QAAQ,KAAK,GAAG,CAAC;AACrD,UAAE,IAAI,QAAQ,OAAO,QAAQ,gCAAgC;AAAA,MAC/D;AACA,QAAE,IAAI,QAAQ,OAAO,gBAAgB;AACrC,QAAE,IAAI,QAAQ,OAAO,cAAc;AACnC,aAAO,IAAI,SAAS,MAAM;AAAA,QACxB,SAAS,EAAE,IAAI;AAAA,QACf,QAAQ;AAAA,QACR,YAAY;AAAA,MACd,CAAC;AAAA,IACH;AACA,UAAM,KAAK;AACX,QAAI,KAAK,WAAW,KAAK;AACvB,QAAE,OAAO,QAAQ,UAAU,EAAE,QAAQ,KAAK,CAAC;AAAA,IAC7C;AAAA,EACF,GAhDO;AAiDT,GAlFW;;;ACMX;;;ACFA;;;ACEA,eAAsB,iBAAiB,IAAI,QAAQ;AACjD,QAAM,SAAS,MAAM,GAAG;AAAA,IACtB;AAAA,EACF,EAAE,KAAK,MAAM,EAAE,IAAI;AACnB,SAAO,OAAO;AAChB;AALsB;AAUtB,eAAsB,mBAAmB,IAAI,QAAQ,MAAM,OAAO,aAAa,eAAe,UAAU,CAAC,GAAG;AAC1G,QAAM;AAAA,IACJ,eAAe;AAAA,IACf,aAAa;AAAA,IACb,mBAAmB;AAAA,EACrB,IAAI;AAEJ,QAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAShB,EAAE,KAAK,MAAM,OAAO,QAAQ,aAAa,eAAe,cAAc,YAAY,gBAAgB,EAAE,IAAI;AAC3G;AAjBsB;AAsBtB,eAAsB,mBAAmB,IAAI,QAAQ,gBAAgB;AACnE,QAAM,GAAG;AAAA,IACP;AAAA,EACF,EAAE,KAAK,gBAAgB,MAAM,EAAE,IAAI;AACrC;AAJsB;AAStB,eAAsB,mBAAmB,IAAI,KAAK;AAChD,QAAM,SAAS,MAAM,GAAG;AAAA,IACtB;AAAA,EACF,EAAE,IAAI;AAEN,QAAM,EAAE,sBAAAC,sBAAqB,IAAI,MAAM;AAEvC,aAAW,OAAO,OAAO,SAAS;AAChC,QAAI;AACF,YAAM,YAAY,MAAMA,sBAAqB,IAAI,IAAI,IAAI;AACzD,UAAI,CAAC,aAAa,CAAC,UAAU;AAAS;AAEtC,YAAM,UAAU,WAAW,UAAU,OAAO;AAC5C,UAAI,eAAe;AACnB,UAAI,SAAS;AAEb,UAAI,IAAI,gBAAgB,WAAW,IAAI,cAAc;AACnD,uBAAe;AACf,iBAAS,4BAAQ,0CAAiB,IAAI;AAAA,MACxC,WAAW,IAAI,kBAAkB,WAAW,CAAC,KAAK,IAAI,IAAI,cAAc,GAAG;AACzE,uBAAe;AACf,iBAAS,4BAAQ,2CAAkB,KAAK,IAAI,IAAI,cAAc;AAAA,MAChE;AAEA,UAAI,cAAc;AAEhB,YAAI,IAAI,kBAAkB;AACxB,gBAAM,eAAe,IAAI,KAAK,IAAI,gBAAgB;AAClD,cAAI,KAAK,IAAI,IAAI,aAAa,QAAQ,IAAI,KAAK,KAAK;AAAM;AAAA,QAC5D;AAGA,cAAM,EAAE,uBAAAC,uBAAsB,IAAI,MAAM;AACxC,cAAMA,uBAAsB,KAAK,IAAI,OAAO;AAAA,UAC1C,UAAU,IAAI;AAAA,UACd,UAAU,IAAI,aAAa,IAAI;AAAA,UAC/B;AAAA,UACA;AAAA,UACA,UAAU,UAAU;AAAA,UACpB,KAAK,UAAU;AAAA,QACjB,CAAC;AAGD,cAAM,GAAG;AAAA,UACP;AAAA,QACF,EAAE,KAAK,IAAI,EAAE,EAAE,IAAI;AAAA,MACrB;AAAA,IACF,SAAS,GAAP;AACA,cAAQ,MAAM,iCAAiC,IAAI,SAAS,EAAE,SAAS;AAAA,IACzE;AAAA,EACF;AACF;AAnDsB;;;ADzCtB;AAMA,eAAsB,gBAAgB,OAAO,KAAK;AAChD,QAAM,KAAK,IAAI;AAGf,QAAM,MAAM,oBAAI,KAAK;AACrB,QAAM,WAAW,IAAI,YAAY,IAAI,KAAK;AAC1C,QAAM,YAAY,IAAI,cAAc;AACpC,QAAM,YAAY,IAAI,KAAK,IAAI,QAAQ,IAAI,IAAI,KAAK,KAAK,GAAI,EAAE,OAAO;AACtE,QAAM,YAAY,aAAa,KAAK,aAAa;AAEjD,UAAQ,IAAI,yBAAyB,WAAW,OAAO,SAAS,EAAE,SAAS,GAAG,GAAG,UAAU,YAAY;AAEvG,MAAI;AAEF,QAAI,YAAY,KAAK,YAAY,IAAI;AACnC,YAAM,WAAW,IAAI,GAAG;AAAA,IAC1B;AAGA,QAAI,aAAa,WAAW,KAAK,UAAU,IAAI;AAC7C,YAAM,kBAAkB,IAAI,KAAK,SAAS,SAAS;AAAA,IACrD;AAGA,QAAI,aAAa,WAAW,MAAM,WAAW,IAAI;AAC/C,YAAM,gBAAgB,IAAI,KAAK,OAAO;AAAA,IACxC;AAAA,EACF,SAAS,GAAP;AACA,YAAQ,MAAM,yBAAyB,EAAE,SAAS;AAAA,EACpD;AACF;AA9BsB;AAmCtB,eAAe,WAAW,IAAI,KAAK;AACjC,UAAQ,IAAI,wBAAwB;AAGpC,MAAI;AACF,UAAM,oBAAoB,EAAE;AAAA,EAC9B,SAAS,GAAP;AACA,YAAQ,MAAM,4BAA4B,EAAE,SAAS;AAAA,EACvD;AAGA,MAAI;AACF,UAAM,SAAS,IAAI,KAAK,KAAK,IAAI,IAAI,KAAK,KAAK,KAAK,KAAK,GAAI,EAAE,YAAY,EAAE,MAAM,GAAG,EAAE;AACxF,UAAM,GAAG,QAAQ,oDAAoD,EAAE,KAAK,MAAM,EAAE,IAAI;AACxF,YAAQ,IAAI,0BAA0B;AAAA,EACxC,SAAS,GAAP;AACA,YAAQ,MAAM,4BAA4B,EAAE,SAAS;AAAA,EACvD;AACF;AAlBe;AAuBf,eAAe,kBAAkB,IAAI,KAAK,SAAS,WAAW;AAE5D,QAAM,iBACH,YAAY,KAAK,aAAa,MAC9B,YAAY,MACZ,YAAY,MAAM,aAAa,MAC/B,WAAW,MAAM,UAAU;AAE9B,MAAI,CAAC;AAAgB;AAGrB,MAAI;AACF,UAAM,YAAY,MAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA,KAIlC,EAAE,IAAI;AAEP,UAAM,QAAQ,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,KAAK,KAAK,GAAI,EAAE,YAAY,EAAE,MAAM,GAAG,EAAE;AACjF,UAAM,UAAU,GAAG,OAAO,OAAO,EAAE,SAAS,GAAG,GAAG,KAAK,OAAO,SAAS,EAAE,SAAS,GAAG,GAAG;AAExF,eAAW,EAAE,KAAK,KAAK,UAAU,SAAS;AACxC,UAAI;AACF,cAAM,YAAY,MAAM,qBAAqB,IAAI,IAAI;AACrD,YAAI,aAAa,UAAU,WAAW,GAAG;AACvC,gBAAM,GAAG,QAAQ;AAAA;AAAA;AAAA,WAGhB,EAAE,KAAK,MAAM,OAAO,SAAS,UAAU,QAAQ,EAAE,IAAI;AAAA,QACxD;AAAA,MACF,SAAS,GAAP;AACA,gBAAQ,KAAK,uBAAuB,SAAS,EAAE,SAAS;AAAA,MAC1D;AAAA,IACF;AAAA,EACF,SAAS,GAAP;AACA,YAAQ,MAAM,+BAA+B,EAAE,SAAS;AAAA,EAC1D;AAGA,MAAI;AACF,UAAM,mBAAmB,IAAI,GAAG;AAAA,EAClC,SAAS,GAAP;AACA,YAAQ,MAAM,8BAA8B,EAAE,SAAS;AAAA,EACzD;AACF;AA5Ce;AAiDf,eAAe,gBAAgB,IAAI,KAAK,SAAS;AAE/C,MAAI,YAAY;AAAI;AAEpB,UAAQ,IAAI,8BAA8B;AAG1C,MAAI;AACF,UAAM,QAAQ,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,KAAK,KAAK,GAAI,EAAE,YAAY,EAAE,MAAM,GAAG,EAAE;AAEjF,UAAM,UAAU,MAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA,KAIhC,EAAE,KAAK,KAAK,EAAE,IAAI;AAEnB,eAAW,MAAM,QAAQ,SAAS;AAChC,UAAI;AACF,cAAM,MAAM,MAAM,aAAa,IAAI,GAAG,MAAM,GAAG,YAAY;AAC3D,YAAI,CAAC;AAAK;AAEV,YAAI,GAAG,YAAY,OAAO;AAExB,gBAAM,eAAe,GAAG,aAAa;AAGrC,gBAAM,MAAM,MAAM,GAAG;AAAA,YACnB;AAAA,UACF,EAAE,KAAK,GAAG,YAAY,GAAG,IAAI,EAAE,MAAM;AAErC,gBAAM,cAAc,MAAM,IAAI,OAAO;AACrC,gBAAM,gBAAgB,MAAM,IAAI,SAAS;AACzC,gBAAM,YAAY,cAAc,GAAG;AACnC,gBAAM,cAAc,gBAAgB;AAGpC,gBAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAOhB,EAAE,KAAK,GAAG,YAAY,GAAG,MAAM,WAAW,WAAW,EAAE,IAAI;AAG5D,gBAAM,GAAG,QAAQ;AAAA;AAAA;AAAA,WAGhB,EAAE,KAAK,KAAK,cAAc,WAAW,GAAG,EAAE,EAAE,IAAI;AAAA,QAEnD,WAAW,GAAG,YAAY,QAAQ;AAEhC,gBAAM,MAAM,MAAM,GAAG;AAAA,YACnB;AAAA,UACF,EAAE,KAAK,GAAG,YAAY,GAAG,IAAI,EAAE,MAAM;AAErC,cAAI,CAAC,OAAO,IAAI,SAAS,GAAG;AAAiB;AAE7C,gBAAM,eAAe,IAAI,SAAS,IAAI,IAAI,OAAO,IAAI,SAAS;AAC9D,gBAAM,cAAc,eAAe,GAAG;AACtC,gBAAM,UAAU,KAAK,IAAI,GAAG,IAAI,OAAO,WAAW;AAClD,gBAAM,YAAY,IAAI,SAAS,GAAG;AAElC,cAAI,aAAa,MAAO;AACtB,kBAAM,GAAG;AAAA,cACP;AAAA,YACF,EAAE,KAAK,GAAG,YAAY,GAAG,IAAI,EAAE,IAAI;AAAA,UACrC,OAAO;AACL,kBAAM,GAAG,QAAQ;AAAA;AAAA;AAAA,aAGhB,EAAE,KAAK,SAAS,WAAW,GAAG,YAAY,GAAG,IAAI,EAAE,IAAI;AAAA,UAC1D;AAGA,gBAAM,GAAG,QAAQ;AAAA;AAAA;AAAA,WAGhB,EAAE,KAAK,KAAK,SAAS,GAAG,EAAE,EAAE,IAAI;AAAA,QACnC;AAAA,MACF,SAAS,GAAP;AACA,gBAAQ,MAAM,wCAAwC,GAAG,OAAO,EAAE,SAAS;AAAA,MAC7E;AAAA,IACF;AAEA,YAAQ,IAAI,aAAa,QAAQ,QAAQ,6BAA6B;AAAA,EACxE,SAAS,GAAP;AACA,YAAQ,MAAM,kCAAkC,EAAE,SAAS;AAAA,EAC7D;AACF;AA1Fe;;;AEnHf,IAAM,sBAAsB;AAC5B,IAAM,yBAAyB,KAAK,KAAK,KAAK;AAM9C,eAAsB,aAAa,UAAU;AAC3C,QAAM,OAAO,OAAO,gBAAgB,IAAI,WAAW,EAAE,CAAC;AACtD,QAAM,aAAa;AAEnB,QAAM,cAAc,MAAM,OAAO,OAAO;AAAA,IACtC;AAAA,IACA,IAAI,YAAY,EAAE,OAAO,QAAQ;AAAA,IACjC,EAAE,MAAM,SAAS;AAAA,IACjB;AAAA,IACA,CAAC,YAAY;AAAA,EACf;AAEA,QAAM,OAAO,MAAM,OAAO,OAAO;AAAA,IAC/B;AAAA,MACE,MAAM;AAAA,MACN;AAAA,MACA;AAAA,MACA,MAAM;AAAA,IACR;AAAA,IACA;AAAA,IACA;AAAA,EACF;AAEA,QAAM,UAAU,KAAK,OAAO,aAAa,GAAG,IAAI,CAAC;AACjD,QAAM,UAAU,KAAK,OAAO,aAAa,GAAG,IAAI,WAAW,IAAI,CAAC,CAAC;AAEjE,SAAO,GAAG,cAAc,WAAW;AACrC;AA3BsB;AAgCtB,eAAsB,eAAe,UAAU,YAAY;AACzD,MAAI;AACF,UAAM,CAAC,eAAe,SAAS,eAAe,IAAI,WAAW,MAAM,GAAG;AACtE,UAAM,aAAa,SAAS,aAAa;AACzC,UAAM,OAAO,WAAW,KAAK,KAAK,OAAO,GAAG,OAAK,EAAE,WAAW,CAAC,CAAC;AAEhE,UAAM,cAAc,MAAM,OAAO,OAAO;AAAA,MACtC;AAAA,MACA,IAAI,YAAY,EAAE,OAAO,QAAQ;AAAA,MACjC,EAAE,MAAM,SAAS;AAAA,MACjB;AAAA,MACA,CAAC,YAAY;AAAA,IACf;AAEA,UAAM,OAAO,MAAM,OAAO,OAAO;AAAA,MAC/B;AAAA,QACE,MAAM;AAAA,QACN;AAAA,QACA;AAAA,QACA,MAAM;AAAA,MACR;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAEA,UAAM,UAAU,KAAK,OAAO,aAAa,GAAG,IAAI,WAAW,IAAI,CAAC,CAAC;AACjE,WAAO,YAAY;AAAA,EACrB,QAAE;AACA,WAAO;AAAA,EACT;AACF;AA9BsB;AAmCtB,eAAsB,aAAa,IAAI;AACrC,QAAM,MAAM,MAAM,GAAG,QAAQ,wDAAwD,EAAE,MAAM;AAC7F,SAAO,IAAI,QAAQ;AACrB;AAHsB;AAQtB,eAAsB,cAAc,IAAI,QAAQ;AAC9C,QAAM,YAAY,OAAO,WAAW,IAAI,MAAM,OAAO,WAAW;AAEhE,QAAM,GAAG,IAAI,WAAW,aAAa,KAAK,UAAU;AAAA,IAClD;AAAA,IACA,WAAW,KAAK,IAAI;AAAA,EACtB,CAAC,GAAG;AAAA,IACF,eAAe;AAAA,EACjB,CAAC;AAED,SAAO;AACT;AAXsB;AAgBtB,eAAsB,eAAe,IAAI,WAAW;AAClD,MAAI,CAAC;AAAW,WAAO;AAEvB,QAAMC,QAAO,MAAM,GAAG,IAAI,WAAW,aAAa,MAAM;AACxD,MAAI,CAACA;AAAM,WAAO;AAGlB,QAAM,GAAG,IAAI,WAAW,aAAa,KAAK,UAAUA,KAAI,GAAG;AAAA,IACzD,eAAe;AAAA,EACjB,CAAC;AAED,SAAOA,MAAK;AACd;AAZsB;AAiBtB,eAAsB,cAAc,IAAI,WAAW;AACjD,MAAI,WAAW;AACb,UAAM,GAAG,OAAO,WAAW,WAAW;AAAA,EACxC;AACF;AAJsB;AAStB,eAAe,YAAY,IAAI,QAAQ;AACrC,QAAM,MAAM,MAAM,GAAG;AAAA,IACnB;AAAA,EACF,EAAE,KAAK,MAAM,EAAE,MAAM;AAErB,MAAI,CAAC;AAAK,WAAO;AACjB,SAAO,EAAE,IAAI,IAAI,IAAI,UAAU,IAAI,UAAU,SAAS,CAAC,CAAC,IAAI,SAAS;AACvE;AAPe;AAYf,eAAsB,eAAe,GAAG;AACtC,QAAM,YAAY,UAAU,GAAG,mBAAmB;AAClD,MAAI,CAAC;AAAW,WAAO;AAEvB,QAAM,SAAS,MAAM,eAAe,EAAE,IAAI,YAAY,SAAS;AAC/D,MAAI,CAAC;AAAQ,WAAO;AAEpB,SAAO,YAAY,EAAE,IAAI,IAAI,MAAM;AACrC;AARsB;AA0CtB,eAAsB,uBAAuB,IAAI,WAAW,MAAM;AAChE,MAAI,CAAC;AAAM,WAAO;AAClB,QAAM,MAAM,MAAM,GAAG;AAAA,IACnB;AAAA,EACF,EAAE,KAAK,SAAS,EAAE,MAAM;AAExB,MAAI,CAAC;AAAK,WAAO;AACjB,SAAO,IAAI,YAAY,KAAK;AAC9B;AARsB;AAatB,SAAS,UAAU,GAAG,MAAM;AAC1B,QAAM,eAAe,EAAE,IAAI,OAAO,QAAQ;AAC1C,MAAI,CAAC;AAAc,WAAO;AAE1B,QAAM,UAAU,aAAa,MAAM,GAAG,EAAE,IAAI,CAAAC,OAAKA,GAAE,KAAK,CAAC;AACzD,aAAW,UAAU,SAAS;AAC5B,UAAM,CAAC,KAAK,GAAG,UAAU,IAAI,OAAO,MAAM,GAAG;AAC7C,QAAI,IAAI,KAAK,MAAM,MAAM;AACvB,aAAO,WAAW,KAAK,GAAG,EAAE,KAAK;AAAA,IACnC;AAAA,EACF;AACA,SAAO;AACT;AAZS;AAiBF,SAAS,iBAAiB,GAAG,WAAW;AAC7C,IAAE;AAAA,IAAO;AAAA,IACP,GAAG,uBAAuB,sDAAsD;AAAA,EAClF;AACF;AAJgB;AAST,SAAS,mBAAmB,GAAG;AACpC,IAAE;AAAA,IAAO;AAAA,IACP,GAAG;AAAA,EACL;AACF;AAJgB;;;AClNhB,IAAM,OAAO,IAAIC,MAAK;AAMtB,eAAe,wBAAwB,IAAI,QAAQ;AAEjD,QAAM,aAAa,MAAM,GAAG;AAAA,IAC1B;AAAA,EACF,EAAE,KAAK,MAAM,EAAE,MAAM;AAErB,MAAI,cAAc,WAAW,OAAO;AAClC,WAAO,SAAS,WAAW,KAAK;AAAA,EAClC;AAGA,QAAM,MAAM,MAAM,GAAG;AAAA,IACnB;AAAA,EACF,EAAE,KAAK,MAAM,EAAE,MAAM;AAErB,SAAO,MAAM,IAAI,KAAK;AACxB;AAhBe;AAsBf,KAAK,IAAI,gBAAgB,OAAO,MAAM;AACpC,QAAM,KAAK,EAAE,IAAI;AACjB,QAAM,YAAY,CAAE,MAAM,aAAa,EAAE;AAEzC,MAAI,eAAe;AACnB,MAAI;AACF,UAAM,EAAE,sBAAAC,uBAAsB,wBAAAC,wBAAuB,IAAI,MAAM;AAC/D,UAAM,UAAU,MAAMD,sBAAqB,EAAE;AAC7C,mBAAe,UAAU,KAAK,YAAYC;AAAA,EAC5C,QAAE;AAAA,EAAO;AAET,SAAO,EAAE,KAAK,EAAE,YAAY,WAAW,eAAe,aAAa,CAAC;AACtE,CAAC;AAED,KAAK,KAAK,SAAS,OAAO,MAAM;AAC9B,QAAM,KAAK,EAAE,IAAI;AAEjB,MAAI,MAAM,aAAa,EAAE,GAAG;AAC1B,WAAO,EAAE,KAAK,EAAE,QAAQ,mDAAW,GAAG,GAAG;AAAA,EAC3C;AAEA,QAAM,EAAE,UAAU,SAAS,IAAI,MAAM,EAAE,IAAI,KAAK;AAChD,MAAI,CAAC,YAAY,CAAC,UAAU;AAC1B,WAAO,EAAE,KAAK,EAAE,QAAQ,+DAAa,GAAG,GAAG;AAAA,EAC7C;AAEA,MAAI,SAAS,SAAS,GAAG;AACvB,WAAO,EAAE,KAAK,EAAE,QAAQ,gDAAa,GAAG,GAAG;AAAA,EAC7C;AAEA,QAAM,eAAe,MAAM,aAAa,QAAQ;AAEhD,QAAM,SAAS,MAAM,GAAG;AAAA,IACtB;AAAA,EACF,EAAE,KAAK,UAAU,YAAY,EAAE,IAAI;AAEnC,QAAM,SAAS,OAAO,KAAK;AAG3B,QAAM,GAAG;AAAA,IACP;AAAA,EACF,EAAE,KAAK,4BAAQ,gEAAc,MAAM,EAAE,IAAI;AAGzC,QAAM,EAAE,iCAAAC,iCAAgC,IAAI,MAAM;AAClD,QAAM,gBAAgBA,iCAAgC,CAAC,CAAC;AACxD,QAAM,GAAG;AAAA,IACP;AAAA,EACF,EAAE,KAAK,kCAAc,IAAI,cAAc,CAAC,EAAE,SAAS,cAAc,CAAC,EAAE,SAAS,MAAM,EAAE,IAAI;AAEzF,SAAO,EAAE,KAAK;AAAA,IACZ,SAAS;AAAA,IACT,MAAM,EAAE,IAAI,QAAQ,UAAU,UAAU,KAAK;AAAA,EAC/C,CAAC;AACH,CAAC;AAED,KAAK,IAAI,iBAAiB,OAAO,MAAM;AACrC,QAAM,KAAK,EAAE,IAAI;AACjB,QAAM,MAAM,MAAM,GAAG;AAAA,IACnB;AAAA,EACF,EAAE,MAAM;AAER,QAAM,UAAU,MAAM,IAAI,UAAU,OAAO,IAAI,UAAU,SAAS;AAClE,SAAO,EAAE,KAAK,EAAE,sBAAsB,QAAQ,CAAC;AACjD,CAAC;AAED,KAAK,IAAI,SAAS,OAAO,MAAM;AAC7B,QAAM,KAAK,EAAE,IAAI;AACjB,QAAM,gBAAgB,MAAM,aAAa,EAAE;AAC3C,SAAO,EAAE,KAAK;AAAA,IACZ,aAAa,EAAE,IAAI,eAAe;AAAA,IAClC,iBAAiB;AAAA,EACnB,CAAC;AACH,CAAC;AAED,KAAK,KAAK,UAAU,OAAO,MAAM;AAC/B,QAAM,KAAK,EAAE,IAAI;AACjB,QAAM,EAAE,UAAU,SAAS,IAAI,MAAM,EAAE,IAAI,KAAK;AAEhD,MAAI,CAAC,YAAY,CAAC,UAAU;AAC1B,WAAO,EAAE,KAAK,EAAE,QAAQ,+DAAa,GAAG,GAAG;AAAA,EAC7C;AAEA,QAAM,OAAO,MAAM,GAAG;AAAA,IACpB;AAAA,EACF,EAAE,KAAK,QAAQ,EAAE,MAAM;AAEvB,MAAI,CAAC,QAAQ,CAAE,MAAM,eAAe,UAAU,KAAK,aAAa,GAAI;AAClE,WAAO,EAAE,KAAK,EAAE,QAAQ,mDAAW,GAAG,GAAG;AAAA,EAC3C;AAGA,QAAM,YAAY,MAAM,cAAc,EAAE,IAAI,YAAY,KAAK,EAAE;AAC/D,mBAAiB,GAAG,SAAS;AAE7B,QAAM,mBAAmB,MAAM,wBAAwB,IAAI,KAAK,EAAE;AAElE,SAAO,EAAE,KAAK;AAAA,IACZ,IAAI,KAAK;AAAA,IACT,UAAU,KAAK;AAAA,IACf,UAAU,CAAC,CAAC,KAAK;AAAA,IACjB,oBAAoB;AAAA,EACtB,CAAC;AACH,CAAC;AAED,KAAK,KAAK,WAAW,OAAO,MAAM;AAChC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAG/C,QAAM,eAAe,EAAE,IAAI,OAAO,QAAQ,KAAK;AAC/C,QAAMC,SAAQ,aAAa,MAAM,oBAAoB;AACrD,MAAIA,QAAO;AACT,UAAM,cAAc,EAAE,IAAI,YAAYA,OAAM,CAAC,CAAC;AAAA,EAChD;AAEA,qBAAmB,CAAC;AACpB,SAAO,EAAE,KAAK,EAAE,SAAS,qBAAM,CAAC;AAClC,CAAC;AAED,KAAK,KAAK,aAAa,OAAO,MAAM;AAClC,QAAM,KAAK,EAAE,IAAI;AAGjB,QAAM,SAAS,MAAM,GAAG;AAAA,IACtB;AAAA,EACF,EAAE,MAAM;AACR,QAAM,aAAa,SAAS,OAAO,UAAU,OAAO,OAAO,UAAU,SAAS;AAE9E,MAAI,CAAC,YAAY;AACf,WAAO,EAAE,KAAK,EAAE,QAAQ,6CAAU,GAAG,GAAG;AAAA,EAC1C;AAEA,QAAM,EAAE,UAAU,SAAS,IAAI,MAAM,EAAE,IAAI,KAAK;AAChD,MAAI,CAAC,YAAY,CAAC,UAAU;AAC1B,WAAO,EAAE,KAAK,EAAE,QAAQ,+DAAa,GAAG,GAAG;AAAA,EAC7C;AAEA,MAAI,SAAS,SAAS,GAAG;AACvB,WAAO,EAAE,KAAK,EAAE,QAAQ,gDAAa,GAAG,GAAG;AAAA,EAC7C;AAGA,QAAM,WAAW,MAAM,GAAG;AAAA,IACxB;AAAA,EACF,EAAE,KAAK,QAAQ,EAAE,MAAM;AAEvB,MAAI,UAAU;AACZ,WAAO,EAAE,KAAK,EAAE,QAAQ,uCAAS,GAAG,GAAG;AAAA,EACzC;AAEA,QAAM,eAAe,MAAM,aAAa,QAAQ;AAChD,QAAM,SAAS,MAAM,GAAG;AAAA,IACtB;AAAA,EACF,EAAE,KAAK,UAAU,YAAY,EAAE,IAAI;AAEnC,QAAM,SAAS,OAAO,KAAK;AAG3B,QAAM,GAAG;AAAA,IACP;AAAA,EACF,EAAE,KAAK,4BAAQ,IAAI,MAAM,EAAE,IAAI;AAG/B,QAAM,YAAY,MAAM,cAAc,EAAE,IAAI,YAAY,MAAM;AAC9D,mBAAiB,GAAG,SAAS;AAE7B,QAAM,mBAAmB,MAAM,wBAAwB,IAAI,MAAM;AAEjE,SAAO,EAAE,KAAK;AAAA,IACZ,IAAI;AAAA,IACJ;AAAA,IACA,UAAU;AAAA,IACV,oBAAoB;AAAA,EACtB,CAAC;AACH,CAAC;AAED,KAAK,IAAI,OAAO,OAAO,MAAM;AAC3B,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,KAAK,EAAE,IAAI;AACjB,QAAM,mBAAmB,MAAM,wBAAwB,IAAI,KAAK,EAAE;AAElE,SAAO,EAAE,KAAK;AAAA,IACZ,IAAI,KAAK;AAAA,IACT,UAAU,KAAK;AAAA,IACf,UAAU,KAAK;AAAA,IACf,oBAAoB;AAAA,EACtB,CAAC;AACH,CAAC;AAED,KAAK,KAAK,oBAAoB,OAAO,MAAM;AACzC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,KAAK,EAAE,IAAI;AACjB,QAAM,EAAE,cAAc,aAAa,IAAI,MAAM,EAAE,IAAI,KAAK;AAExD,MAAI,CAAC,gBAAgB,CAAC,cAAc;AAClC,WAAO,EAAE,KAAK,EAAE,QAAQ,mDAAW,GAAG,GAAG;AAAA,EAC3C;AAEA,MAAI,aAAa,SAAS,GAAG;AAC3B,WAAO,EAAE,KAAK,EAAE,QAAQ,sDAAc,GAAG,GAAG;AAAA,EAC9C;AAEA,QAAM,SAAS,MAAM,GAAG;AAAA,IACtB;AAAA,EACF,EAAE,KAAK,KAAK,EAAE,EAAE,MAAM;AAEtB,MAAI,CAAE,MAAM,eAAe,cAAc,OAAO,aAAa,GAAI;AAC/D,WAAO,EAAE,KAAK,EAAE,QAAQ,iCAAQ,GAAG,GAAG;AAAA,EACxC;AAEA,QAAM,UAAU,MAAM,aAAa,YAAY;AAC/C,QAAM,GAAG;AAAA,IACP;AAAA,EACF,EAAE,KAAK,SAAS,KAAK,EAAE,EAAE,IAAI;AAE7B,SAAO,EAAE,KAAK,EAAE,SAAS,uCAAS,CAAC;AACrC,CAAC;AAMD,KAAK,KAAK,UAAU,OAAO,MAAM;AAC/B,QAAM,QAAQ,MAAM,eAAe,CAAC;AACpC,MAAI,CAAC;AAAO,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAChD,MAAI,CAAC,MAAM;AAAS,WAAO,EAAE,KAAK,EAAE,QAAQ,2BAAO,GAAG,GAAG;AAEzD,QAAM,KAAK,EAAE,IAAI;AACjB,QAAM,EAAE,UAAU,UAAU,WAAW,MAAM,IAAI,MAAM,EAAE,IAAI,KAAK;AAElE,MAAI,CAAC,YAAY,CAAC,UAAU;AAC1B,WAAO,EAAE,KAAK,EAAE,QAAQ,+DAAa,GAAG,GAAG;AAAA,EAC7C;AAEA,QAAM,WAAW,MAAM,GAAG;AAAA,IACxB;AAAA,EACF,EAAE,KAAK,QAAQ,EAAE,MAAM;AAEvB,MAAI,UAAU;AACZ,WAAO,EAAE,KAAK,EAAE,QAAQ,uCAAS,GAAG,GAAG;AAAA,EACzC;AAEA,QAAM,eAAe,MAAM,aAAa,QAAQ;AAChD,QAAM,SAAS,MAAM,GAAG;AAAA,IACtB;AAAA,EACF,EAAE,KAAK,UAAU,cAAc,WAAW,IAAI,CAAC,EAAE,IAAI;AAErD,QAAM,SAAS,OAAO,KAAK;AAG3B,QAAM,GAAG;AAAA,IACP;AAAA,EACF,EAAE,KAAK,4BAAQ,IAAI,MAAM,EAAE,IAAI;AAE/B,SAAO,EAAE,KAAK,EAAE,IAAI,QAAQ,UAAU,UAAU,CAAC,CAAC,SAAS,CAAC;AAC9D,CAAC;AAED,KAAK,IAAI,UAAU,OAAO,MAAM;AAC9B,QAAM,QAAQ,MAAM,eAAe,CAAC;AACpC,MAAI,CAAC;AAAO,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAChD,MAAI,CAAC,MAAM;AAAS,WAAO,EAAE,KAAK,EAAE,QAAQ,2BAAO,GAAG,GAAG;AAEzD,QAAM,KAAK,EAAE,IAAI;AACjB,QAAM,SAAS,MAAM,GAAG;AAAA,IACtB;AAAA,EACF,EAAE,IAAI;AAEN,QAAM,QAAQ,CAAC;AACf,aAAW,OAAO,OAAO,SAAS;AAChC,UAAM,mBAAmB,MAAM,wBAAwB,IAAI,IAAI,EAAE;AACjE,UAAM,KAAK;AAAA,MACT,IAAI,IAAI;AAAA,MACR,UAAU,IAAI;AAAA,MACd,UAAU,CAAC,CAAC,IAAI;AAAA,MAChB,oBAAoB;AAAA,IACtB,CAAC;AAAA,EACH;AAEA,SAAO,EAAE,KAAK,KAAK;AACrB,CAAC;AAED,KAAK,OAAO,cAAc,OAAO,MAAM;AACrC,QAAM,QAAQ,MAAM,eAAe,CAAC;AACpC,MAAI,CAAC;AAAO,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAChD,MAAI,CAAC,MAAM;AAAS,WAAO,EAAE,KAAK,EAAE,QAAQ,2BAAO,GAAG,GAAG;AAEzD,QAAM,KAAK,EAAE,IAAI;AACjB,QAAM,SAAS,SAAS,EAAE,IAAI,MAAM,IAAI,CAAC;AAEzC,MAAI,WAAW,MAAM,IAAI;AACvB,WAAO,EAAE,KAAK,EAAE,QAAQ,uCAAS,GAAG,GAAG;AAAA,EACzC;AAEA,QAAM,GAAG,QAAQ,gCAAgC,EAAE,KAAK,MAAM,EAAE,IAAI;AACpE,SAAO,EAAE,KAAK,EAAE,SAAS,iCAAQ,CAAC;AACpC,CAAC;AAED,KAAK,KAAK,iBAAiB,OAAO,MAAM;AACtC,QAAM,QAAQ,MAAM,eAAe,CAAC;AACpC,MAAI,CAAC;AAAO,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAChD,MAAI,CAAC,MAAM;AAAS,WAAO,EAAE,KAAK,EAAE,QAAQ,2BAAO,GAAG,GAAG;AAEzD,QAAM,KAAK,EAAE,IAAI;AACjB,QAAM,EAAE,QAAQ,IAAI,MAAM,EAAE,IAAI,KAAK;AAErC,QAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,GAKhB,EAAE,KAAK,UAAU,MAAM,GAAG,EAAE,IAAI;AAEjC,SAAO,EAAE,KAAK,EAAE,sBAAsB,CAAC,CAAC,QAAQ,CAAC;AACnD,CAAC;AAED,IAAO,eAAQ;;;ACjWf;AAOA,IAAM,QAAQ,IAAIC,MAAK;AAGvB,MAAM,IAAI,WAAW,OAAO,MAAM;AAChC,QAAM,IAAI,EAAE,IAAI,MAAM,GAAG,GAAG,KAAK;AACjC,MAAI,CAAC;AAAG,WAAO,EAAE,KAAK,CAAC,CAAC;AAExB,QAAM,UAAU,MAAM,YAAY,EAAE,IAAI,IAAI,CAAC;AAC7C,SAAO,EAAE,KAAK,OAAO;AACvB,CAAC;AAGD,MAAM,IAAI,aAAa,OAAO,MAAM;AAClC,QAAM,SAAS,EAAE,IAAI,MAAM,IAAI;AAC/B,MAAI;AACF,UAAMC,QAAO,MAAM,gBAAgB,EAAE,IAAI,IAAI,MAAM;AACnD,WAAO,EAAE,KAAKA,KAAI;AAAA,EACpB,SAAS,GAAP;AACA,YAAQ,MAAM,yBAAyB,WAAW,EAAE,SAAS;AAC7D,WAAO,EAAE,KAAK,EAAE,QAAQ,qDAAa,EAAE,UAAU,GAAG,GAAG;AAAA,EACzD;AACF,CAAC;AAGD,MAAM,IAAI,qBAAqB,OAAO,MAAM;AAC1C,QAAM,SAAS,EAAE,IAAI,MAAM,IAAI;AAC/B,QAAM,QAAQ,SAAS,EAAE,IAAI,MAAM,OAAO,KAAK,IAAI;AAEnD,MAAI;AACF,UAAM,UAAU,MAAM,eAAe,EAAE,IAAI,IAAI,QAAQ,KAAK;AAC5D,WAAO,EAAE,KAAK,OAAO;AAAA,EACvB,SAAS,GAAP;AACA,WAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,GAAG,GAAG;AAAA,EAC1C;AACF,CAAC;AAGD,MAAM,IAAI,sBAAsB,OAAO,MAAM;AAC3C,QAAM,SAAS,EAAE,IAAI,MAAM,IAAI;AAC/B,QAAM,KAAK,EAAE,IAAI;AAEjB,MAAI;AACF,UAAM,QAAQ,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,KAAK,KAAK,GAAI,EAAE,YAAY,EAAE,MAAM,GAAG,EAAE;AACjF,UAAM,SAAS,MAAM,GAAG;AAAA,MACtB;AAAA,IACF,EAAE,KAAK,QAAQ,KAAK,EAAE,IAAI;AAE1B,WAAO,EAAE,KAAK,OAAO,QAAQ,IAAI,QAAM;AAAA,MACrC,MAAM,EAAE;AAAA,MACR,UAAU,EAAE;AAAA,IACd,EAAE,CAAC;AAAA,EACL,SAAS,GAAP;AACA,WAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,GAAG,GAAG;AAAA,EAC1C;AACF,CAAC;AAGD,MAAM,IAAI,sBAAsB,OAAO,MAAM;AAC3C,QAAM,SAAS,EAAE,IAAI,MAAM,IAAI;AAC/B,QAAM,SAAS,SAAS,EAAE,IAAI,MAAM,QAAQ,KAAK,IAAI;AACrD,QAAM,KAAK,EAAE,IAAI;AAEjB,MAAI;AACF,UAAM,UAAU,MAAM,eAAe,IAAI,QAAQ,MAAM;AACvD,QAAI,CAAC,WAAW,QAAQ,WAAW,GAAG;AACpC,aAAO,EAAE,KAAK,EAAE,QAAQ,iCAAQ,GAAG,GAAG;AAAA,IACxC;AAEA,UAAM,aAAa,6BAA6B,OAAO;AAGvD,UAAM,YAAY,QAAQ,IAAI,WAAS;AAAA,MACrC,MAAM,KAAK;AAAA,MACX,KAAK,KAAK;AAAA,IACZ,EAAE;AAGF,UAAM,WAAW,QAAQ,CAAC,EAAE;AAC5B,UAAM,SAAS,QAAQ,QAAQ,SAAS,CAAC,EAAE;AAC3C,UAAM,gBAAgB,SAAS,YAAY,WAAW,KAAK,QAAQ,CAAC;AAEpE,WAAO,EAAE,KAAK;AAAA,MACZ;AAAA,MACA,cAAc,GAAG;AAAA,MACjB,WAAW;AAAA,MACX,SAAS;AAAA,MACT,aAAa,QAAQ;AAAA,MACrB;AAAA,MACA,YAAY;AAAA,IACd,CAAC;AAAA,EACH,SAAS,GAAP;AACA,WAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,GAAG,GAAG;AAAA,EAC1C;AACF,CAAC;AAGD,MAAM,KAAK,uBAAuB,OAAO,MAAM;AAC7C,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,SAAS,EAAE,IAAI,MAAM,IAAI;AAC/B,QAAM,OAAO,MAAM,EAAE,IAAI,KAAK;AAC9B,QAAM,EAAE,OAAO,cAAc,gBAAgB,eAAe,aAAa,kBAAkB,IAAI;AAE/F,MAAI,CAAC;AAAO,WAAO,EAAE,KAAK,EAAE,QAAQ,uCAAS,GAAG,GAAG;AAEnD,MAAI;AACF,UAAM,mBAAmB,EAAE,IAAI,IAAI,KAAK,IAAI,QAAQ,OAAO,cAAc,gBAAgB;AAAA,MACvF,cAAc,gBAAgB,IAAI;AAAA,MAClC,YAAY,eAAe;AAAA,MAC3B,kBAAkB,sBAAsB,QAAQ,IAAI;AAAA,IACtD,CAAC;AAED,WAAO,EAAE,KAAK,EAAE,QAAQ,MAAM,SAAS,iCAAQ,CAAC;AAAA,EAClD,SAAS,GAAP;AACA,WAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,GAAG,GAAG;AAAA,EAC1C;AACF,CAAC;AAGD,MAAM,IAAI,kBAAkB,OAAO,MAAM;AACvC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,OAAO,MAAM,iBAAiB,EAAE,IAAI,IAAI,KAAK,EAAE;AACrD,SAAO,EAAE,KAAK,IAAI;AACpB,CAAC;AAGD,MAAM,OAAO,sBAAsB,OAAO,MAAM;AAC9C,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,QAAQ,SAAS,EAAE,IAAI,MAAM,IAAI,CAAC;AACxC,QAAM,mBAAmB,EAAE,IAAI,IAAI,KAAK,IAAI,KAAK;AACjD,SAAO,EAAE,KAAK,EAAE,SAAS,iCAAQ,CAAC;AACpC,CAAC;AAGD,MAAM,IAAI,eAAe,OAAO,MAAM;AACpC,QAAM,aAAa,CAAC,sBAAO,sBAAO,sBAAO,sBAAO,oBAAK;AACrD,SAAO,EAAE,KAAK,UAAU;AAC1B,CAAC;AAED,IAAO,gBAAQ;;;ACvJf,eAAsB,gBAAgB,IAAI,QAAQ;AAChD,QAAM,SAAS,MAAM,GAAG;AAAA,IACtB;AAAA,EACF,EAAE,KAAK,MAAM,EAAE,IAAI;AACnB,SAAO,OAAO;AAChB;AALsB;AAUtB,eAAsB,cAAc,IAAI,QAAQ,MAAM,cAAc,IAAI;AACtE,QAAM,SAAS,MAAM,GAAG;AAAA,IACtB;AAAA,EACF,EAAE,KAAK,MAAM,eAAe,IAAI,MAAM,EAAE,IAAI;AAC5C,SAAO,OAAO,KAAK;AACrB;AALsB;AAUtB,eAAsB,cAAc,IAAI,WAAW,MAAM,aAAa;AACpE,QAAM,GAAG;AAAA,IACP;AAAA,EACF,EAAE,KAAK,MAAM,eAAe,IAAI,SAAS,EAAE,IAAI;AACjD;AAJsB;AAStB,eAAsB,cAAc,IAAI,WAAW;AACjD,QAAM,WAAW,MAAM,GAAG;AAAA,IACxB;AAAA,EACF,EAAE,KAAK,SAAS,EAAE,MAAM;AAExB,MAAI,SAAS,MAAM,GAAG;AACpB,UAAM,IAAI,MAAM,oHAAqB;AAAA,EACvC;AAEA,QAAM,GAAG,QAAQ,mCAAmC,EAAE,KAAK,SAAS,EAAE,IAAI;AAC5E;AAVsB;AAetB,eAAsB,aAAa,IAAI,WAAW;AAChD,QAAM,SAAS,MAAM,GAAG;AAAA,IACtB;AAAA,EACF,EAAE,KAAK,SAAS,EAAE,IAAI;AACtB,SAAO,OAAO;AAChB;AALsB;AAUtB,eAAsB,sBAAsB,IAAI,QAAQ;AACtD,QAAM,SAAS,MAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAM/B,EAAE,KAAK,MAAM,EAAE,IAAI;AACpB,SAAO,OAAO;AAChB;AATsB;AActB,eAAsB,eAAe,IAAI,WAAW,MAAM,MAAM,QAAQ;AACtE,QAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAOhB,EAAE,KAAK,WAAW,MAAM,MAAM,MAAM,EAAE,IAAI;AAC7C;AATsB;AActB,eAAsB,eAAe,IAAI,WAAW,MAAM;AACxD,QAAM,GAAG;AAAA,IACP;AAAA,EACF,EAAE,KAAK,WAAW,IAAI,EAAE,IAAI;AAC9B;AAJsB;AAStB,eAAsB,SAAS,IAAI,WAAW,MAAM,WAAW,YAAY,MAAM;AAC/E,QAAM,MAAM,oBAAI,KAAK;AACrB,QAAM,cAAc,eAAe,YAAY,IAAI,KAAK,SAAS,IAAI,GAAG;AAExE,QAAM,GAAG,QAAQ;AAAA;AAAA;AAAA,GAGhB,EAAE,KAAK,WAAW,MAAM,WAAW,WAAW,EAAE,IAAI;AAErD,SAAO,EAAE,cAAc,aAAa,SAAS,oBAAO,sCAAkB,cAAc;AACtF;AAVsB;AAetB,eAAsB,YAAY,IAAI,WAAW,MAAM,QAAQ,YAAY,MAAM;AAC/E,QAAM,WAAW,MAAM,GAAG;AAAA,IACxB;AAAA,EACF,EAAE,KAAK,WAAW,IAAI,EAAE,MAAM;AAE9B,MAAI,CAAC,YAAY,SAAS,SAAS,QAAQ;AACzC,UAAM,IAAI,MAAM,sCAAQ;AAAA,EAC1B;AAEA,QAAM,MAAM,oBAAI,KAAK;AACrB,QAAM,cAAc,eAAe,YAAY,IAAI,KAAK,SAAS,IAAI,GAAG;AAExE,QAAM,GAAG,QAAQ;AAAA;AAAA;AAAA,GAGhB,EAAE,KAAK,WAAW,MAAM,QAAQ,WAAW,EAAE,IAAI;AAElD,SAAO,EAAE,cAAc,aAAa,SAAS,gBAAM,0CAAiB,cAAc;AACpF;AAlBsB;AAuBtB,eAAsB,gBAAgB,IAAI,WAAW,OAAO,MAAM,QAAQ,KAAK;AAC7E,MAAI,QAAQ;AACZ,QAAM,SAAS,CAAC,SAAS;AAEzB,MAAI,MAAM;AACR,aAAS;AACT,WAAO,KAAK,IAAI;AAAA,EAClB;AAEA,WAAS;AACT,SAAO,KAAK,KAAK;AAEjB,QAAM,OAAO,GAAG,QAAQ,KAAK;AAC7B,QAAM,SAAS,MAAM,KAAK,KAAK,GAAG,MAAM,EAAE,IAAI;AAC9C,SAAO,OAAO;AAChB;AAfsB;AAoBtB,SAAS,eAAe,YAAY;AAClC,QAAM,IAAI,IAAI,KAAK,UAAU;AAC7B,IAAE,QAAQ,EAAE,QAAQ,IAAI,CAAC;AAGzB,SAAO,EAAE,OAAO,MAAM,KAAK,EAAE,OAAO,MAAM,GAAG;AAC3C,MAAE,QAAQ,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC3B;AAEA,SAAO,EAAE,YAAY,EAAE,MAAM,GAAG,EAAE;AACpC;AAVS;;;AChJT;AAEA,IAAM,UAAU,IAAIC,MAAK;AAMzB,QAAQ,IAAI,aAAa,OAAO,MAAM;AACpC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAC/C,QAAM,WAAW,MAAM,gBAAgB,EAAE,IAAI,IAAI,KAAK,EAAE;AACxD,SAAO,EAAE,KAAK,QAAQ;AACxB,CAAC;AAED,QAAQ,KAAK,aAAa,OAAO,MAAM;AACrC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAC/C,QAAM,EAAE,MAAM,YAAY,IAAI,MAAM,EAAE,IAAI,KAAK;AAC/C,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,mDAAW,GAAG,GAAG;AAEpD,MAAI;AACF,UAAM,KAAK,MAAM,cAAc,EAAE,IAAI,IAAI,KAAK,IAAI,MAAM,WAAW;AACnE,WAAO,EAAE,KAAK,EAAE,IAAI,MAAM,aAAa,SAAS,uCAAS,CAAC;AAAA,EAC5D,SAAS,GAAP;AACA,WAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,GAAG,GAAG;AAAA,EAC1C;AACF,CAAC;AAED,QAAQ,IAAI,iBAAiB,OAAO,MAAM;AACxC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,YAAY,SAAS,EAAE,IAAI,MAAM,IAAI,CAAC;AAC5C,MAAI,CAAE,MAAM,uBAAuB,EAAE,IAAI,IAAI,WAAW,IAAI,GAAI;AAC9D,WAAO,EAAE,KAAK,EAAE,QAAQ,6CAAU,GAAG,GAAG;AAAA,EAC1C;AAEA,QAAM,EAAE,MAAM,YAAY,IAAI,MAAM,EAAE,IAAI,KAAK;AAC/C,QAAM,cAAc,EAAE,IAAI,IAAI,WAAW,MAAM,WAAW;AAC1D,SAAO,EAAE,KAAK,EAAE,SAAS,iCAAQ,CAAC;AACpC,CAAC;AAED,QAAQ,OAAO,iBAAiB,OAAO,MAAM;AAC3C,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,YAAY,SAAS,EAAE,IAAI,MAAM,IAAI,CAAC;AAC5C,MAAI,CAAE,MAAM,uBAAuB,EAAE,IAAI,IAAI,WAAW,IAAI,GAAI;AAC9D,WAAO,EAAE,KAAK,EAAE,QAAQ,6CAAU,GAAG,GAAG;AAAA,EAC1C;AAEA,MAAI;AACF,UAAM,cAAc,EAAE,IAAI,IAAI,SAAS;AACvC,WAAO,EAAE,KAAK,EAAE,SAAS,iCAAQ,CAAC;AAAA,EACpC,SAAS,GAAP;AACA,WAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,GAAG,GAAG;AAAA,EAC1C;AACF,CAAC;AAOD,QAAQ,IAAI,wBAAwB,OAAO,MAAM;AAC/C,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,KAAK,EAAE,IAAI;AACjB,QAAM,YAAY,MAAM,sBAAsB,IAAI,KAAK,EAAE;AAGzD,QAAM,WAAW,CAAC;AAClB,aAAW,OAAO,WAAW;AAC3B,QAAI;AACF,YAAM,YAAY,MAAM,qBAAqB,IAAI,IAAI,IAAI;AACzD,YAAM,UAAU,MAAM,GAAG,QAAQ,6CAA6C,EAAE,KAAK,IAAI,IAAI,EAAE,MAAM;AACrG,YAAM,OAAO,UAAU,QAAQ,SAAS,QAAQ,IAAI;AACpD,YAAM,OAAO,SAAS,QAAQ;AAC9B,YAAM,WAAW,gBAAgB,IAAI;AAErC,YAAM,MAAM,WAAW,UAAU,OAAO,CAAC;AACzC,YAAM,WAAW,WAAW,UAAU,YAAY,CAAC;AACnD,YAAM,UAAU,WAAW,UAAU,WAAW,CAAC;AACjD,YAAM,SAAS,WAAW,IAAI,UAAU,CAAC;AACzC,YAAM,OAAO,WAAW,IAAI,QAAQ,CAAC;AAErC,YAAM,cAAc,WAAW,IAAI,WAAW,SAAS,MAAM;AAC7D,YAAM,cAAc,OAAO,KAAM,cAAc,QAAQ,OAAO,MAAO;AAErE,eAAS,KAAK;AAAA,QACZ,MAAM,IAAI;AAAA,QACV;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,aAAa,KAAK,MAAM,cAAc,GAAG,IAAI;AAAA,QAC7C,aAAa,KAAK,MAAM,cAAc,GAAG,IAAI;AAAA,QAC7C,MAAM,UAAU,QAAQ;AAAA,QACxB,YAAY,IAAI;AAAA,QAChB,cAAc,IAAI;AAAA,MACpB,CAAC;AAAA,IACH,SAAS,GAAP;AACA,eAAS,KAAK;AAAA,QACZ,MAAM,IAAI;AAAA,QACV,MAAM,IAAI;AAAA,QACV,MAAM,IAAI;AAAA,QACV,QAAQ,IAAI;AAAA,QACZ,OAAO,EAAE;AAAA,QACT,YAAY,IAAI;AAAA,QAChB,cAAc,IAAI;AAAA,MACpB,CAAC;AAAA,IACH;AAAA,EACF;AAEA,SAAO,EAAE,KAAK,QAAQ;AACxB,CAAC;AAGD,QAAQ,IAAI,cAAc,OAAO,MAAM;AACrC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,YAAY,SAAS,EAAE,IAAI,MAAM,YAAY,CAAC;AACpD,MAAI,CAAC;AAAW,WAAO,EAAE,KAAK,EAAE,QAAQ,uCAAmB,GAAG,GAAG;AAEjE,MAAI,CAAE,MAAM,uBAAuB,EAAE,IAAI,IAAI,WAAW,IAAI,GAAI;AAC9D,WAAO,EAAE,KAAK,EAAE,QAAQ,6CAAU,GAAG,GAAG;AAAA,EAC1C;AAEA,QAAM,YAAY,MAAM,aAAa,EAAE,IAAI,IAAI,SAAS;AACxD,SAAO,EAAE,KAAK,SAAS;AACzB,CAAC;AAGD,QAAQ,IAAI,cAAc,OAAO,MAAM;AACrC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,YAAY,SAAS,EAAE,IAAI,MAAM,YAAY,CAAC;AACpD,MAAI,CAAC;AAAW,WAAO,EAAE,KAAK,EAAE,QAAQ,uCAAmB,GAAG,GAAG;AAEjE,MAAI,CAAE,MAAM,uBAAuB,EAAE,IAAI,IAAI,WAAW,IAAI,GAAI;AAC9D,WAAO,EAAE,KAAK,EAAE,QAAQ,6CAAU,GAAG,GAAG;AAAA,EAC1C;AAEA,QAAM,EAAE,MAAM,MAAM,OAAO,IAAI,MAAM,EAAE,IAAI,KAAK;AAChD,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,mDAAW,GAAG,GAAG;AAEpD,QAAM,eAAe,EAAE,IAAI,IAAI,WAAW,MAAM,MAAM,MAAM;AAC5D,SAAO,EAAE,KAAK,EAAE,SAAS,iCAAQ,CAAC;AACpC,CAAC;AAGD,QAAQ,OAAO,oBAAoB,OAAO,MAAM;AAC9C,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,YAAY,SAAS,EAAE,IAAI,MAAM,YAAY,CAAC;AACpD,MAAI,CAAC;AAAW,WAAO,EAAE,KAAK,EAAE,QAAQ,uCAAmB,GAAG,GAAG;AAEjE,MAAI,CAAE,MAAM,uBAAuB,EAAE,IAAI,IAAI,WAAW,IAAI,GAAI;AAC9D,WAAO,EAAE,KAAK,EAAE,QAAQ,6CAAU,GAAG,GAAG;AAAA,EAC1C;AAEA,QAAM,OAAO,EAAE,IAAI,MAAM,MAAM;AAC/B,QAAM,eAAe,EAAE,IAAI,IAAI,WAAW,IAAI;AAC9C,SAAO,EAAE,KAAK,EAAE,SAAS,iCAAQ,CAAC;AACpC,CAAC;AAGD,QAAQ,KAAK,yBAAyB,OAAO,MAAM;AACjD,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,YAAY,SAAS,EAAE,IAAI,MAAM,YAAY,CAAC;AACpD,MAAI,CAAC;AAAW,WAAO,EAAE,KAAK,EAAE,QAAQ,uCAAmB,GAAG,GAAG;AAEjE,MAAI,CAAE,MAAM,uBAAuB,EAAE,IAAI,IAAI,WAAW,IAAI,GAAI;AAC9D,WAAO,EAAE,KAAK,EAAE,QAAQ,6CAAU,GAAG,GAAG;AAAA,EAC1C;AAEA,QAAM,KAAK,EAAE,IAAI;AACjB,QAAM,YAAY,MAAM,aAAa,IAAI,SAAS;AAElD,MAAI,UAAU;AACd,MAAI,SAAS;AACb,QAAM,SAAS,CAAC;AAEhB,aAAW,OAAO,WAAW;AAC3B,QAAI;AACF,YAAM,UAAU,MAAM,eAAe,IAAI,IAAI,MAAM,CAAC;AACpD,UAAI,QAAQ,SAAS;AAAG;AAAA;AACnB;AAAA,IACP,SAAS,GAAP;AACA;AACA,aAAO,KAAK,GAAG,IAAI,SAAS,EAAE,SAAS;AAAA,IACzC;AAAA,EACF;AAEA,SAAO,EAAE,KAAK;AAAA,IACZ,SAAS,yCAAW,yBAAe;AAAA,IACnC;AAAA,IACA;AAAA,IACA,QAAQ,OAAO,SAAS,IAAI,SAAS;AAAA,EACvC,CAAC;AACH,CAAC;AAOD,QAAQ,KAAK,oBAAoB,OAAO,MAAM;AAC5C,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,YAAY,SAAS,EAAE,IAAI,MAAM,YAAY,CAAC;AACpD,MAAI,CAAC;AAAW,WAAO,EAAE,KAAK,EAAE,QAAQ,uCAAmB,GAAG,GAAG;AAEjE,MAAI,CAAE,MAAM,uBAAuB,EAAE,IAAI,IAAI,WAAW,IAAI,GAAI;AAC9D,WAAO,EAAE,KAAK,EAAE,QAAQ,6CAAU,GAAG,GAAG;AAAA,EAC1C;AAEA,QAAM,OAAO,EAAE,IAAI,MAAM,MAAM;AAC/B,QAAM,EAAE,QAAQ,WAAW,IAAI,MAAM,EAAE,IAAI,KAAK;AAEhD,MAAI,CAAC,UAAU,UAAU;AAAG,WAAO,EAAE,KAAK,EAAE,QAAQ,qDAAa,GAAG,GAAG;AAEvE,MAAI;AACF,UAAM,SAAS,MAAM,SAAS,EAAE,IAAI,IAAI,WAAW,MAAM,QAAQ,UAAU;AAC3E,WAAO,EAAE,KAAK,MAAM;AAAA,EACtB,SAAS,GAAP;AACA,WAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,GAAG,GAAG;AAAA,EAC1C;AACF,CAAC;AAGD,QAAQ,KAAK,qBAAqB,OAAO,MAAM;AAC7C,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,YAAY,SAAS,EAAE,IAAI,MAAM,YAAY,CAAC;AACpD,MAAI,CAAC;AAAW,WAAO,EAAE,KAAK,EAAE,QAAQ,uCAAmB,GAAG,GAAG;AAEjE,MAAI,CAAE,MAAM,uBAAuB,EAAE,IAAI,IAAI,WAAW,IAAI,GAAI;AAC9D,WAAO,EAAE,KAAK,EAAE,QAAQ,6CAAU,GAAG,GAAG;AAAA,EAC1C;AAEA,QAAM,OAAO,EAAE,IAAI,MAAM,MAAM;AAC/B,QAAM,EAAE,QAAQ,WAAW,IAAI,MAAM,EAAE,IAAI,KAAK;AAEhD,MAAI,CAAC,UAAU,UAAU;AAAG,WAAO,EAAE,KAAK,EAAE,QAAQ,qDAAa,GAAG,GAAG;AAEvE,MAAI;AACF,UAAM,SAAS,MAAM,YAAY,EAAE,IAAI,IAAI,WAAW,MAAM,QAAQ,UAAU;AAC9E,WAAO,EAAE,KAAK,MAAM;AAAA,EACtB,SAAS,GAAP;AACA,WAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,GAAG,GAAG;AAAA,EAC1C;AACF,CAAC;AAGD,QAAQ,IAAI,iBAAiB,OAAO,MAAM;AACxC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,YAAY,SAAS,EAAE,IAAI,MAAM,YAAY,CAAC;AACpD,MAAI,CAAC;AAAW,WAAO,EAAE,KAAK,EAAE,QAAQ,uCAAmB,GAAG,GAAG;AAEjE,MAAI,CAAE,MAAM,uBAAuB,EAAE,IAAI,IAAI,WAAW,IAAI,GAAI;AAC9D,WAAO,EAAE,KAAK,EAAE,QAAQ,6CAAU,GAAG,GAAG;AAAA,EAC1C;AAEA,QAAM,OAAO,EAAE,IAAI,MAAM,MAAM,KAAK;AACpC,QAAM,QAAQ,SAAS,EAAE,IAAI,MAAM,OAAO,KAAK,KAAK;AACpD,QAAM,eAAe,MAAM,gBAAgB,EAAE,IAAI,IAAI,WAAW,MAAM,KAAK;AAC3E,SAAO,EAAE,KAAK,YAAY;AAC5B,CAAC;AAED,IAAO,kBAAQ;;;ACrSf;AACA;AACA;AAKO,IAAM,YAAN,MAAgB;AAAA;AAAA;AAAA;AAAA,EAIrB,MAAM,cAAc,IAAI,KAAK,QAAQ;AACnC,UAAM,eAAe,8BAAO,iBAAiB;AAC3C,UAAI,OAAO,CAAC;AACZ,UAAI,gBAAgB,MAAM;AACxB,cAAM,SAAS,MAAM,GAAG;AAAA,UACtB;AAAA,QACF,EAAE,IAAI;AACN,eAAO,OAAO,WAAW,CAAC;AAAA,MAC5B,OAAO;AACL,cAAM,SAAS,MAAM,GAAG;AAAA,UACtB;AAAA,QACF,EAAE,KAAK,YAAY,EAAE,IAAI;AACzB,eAAO,OAAO,WAAW,CAAC;AAAA,MAC5B;AAEA,YAAM,cAAc,CAAC;AACrB,iBAAW,OAAO,MAAM;AACtB,YAAI,QAAQ,IAAI;AAChB,YAAI,IAAI,aAAa,OAAO;AAC1B,kBAAQ,MAAM,aAAa,OAAO,GAAG;AAAA,QACvC;AACA,oBAAY,IAAI,GAAG,IAAI;AAAA,MACzB;AACA,aAAO;AAAA,IACT,GAvBqB;AAyBrB,UAAM,iBAAiB,MAAM,aAAa,IAAI;AAC9C,QAAI,gBAAgB,CAAC;AACrB,QAAI,UAAU,MAAM;AAClB,YAAM,WAAW,MAAM,GAAG;AAAA,QACxB;AAAA,MACF,EAAE,MAAM;AAER,UAAI,UAAU,MAAM,SAAS,OAAO,QAAQ;AAC1C,wBAAgB,MAAM,aAAa,SAAS,EAAE;AAAA,MAChD;AAAA,IACF;AAEA,UAAM,eAAe,UAAU,OAAO,MAAM,aAAa,MAAM,IAAI,CAAC;AACpE,UAAMC,YAAW,EAAE,GAAG,gBAAgB,GAAG,eAAe,GAAG,aAAa;AAExE,WAAO;AAAA,MACL,SAAS,IAAI,mBAAmBA,UAAS,mBAAmB;AAAA,MAC5D,QAAQ,IAAI,kBAAkBA,UAAS,kBAAkB;AAAA,MACzD,OAAO,IAAI,iBAAiBA,UAAS,iBAAiB;AAAA,IACxD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,kBAAkB,IAAI,UAAU,QAAQ;AAC5C,QAAI;AACJ,QAAI,UAAU;AACZ,UAAI,UAAU,MAAM;AAClB,cAAM,MAAM,GAAG;AAAA,UACb;AAAA,QACF,EAAE,KAAK,QAAQ,EAAE,MAAM;AAAA,MACzB,OAAO;AACL,cAAM,MAAM,GAAG;AAAA,UACb;AAAA,QACF,EAAE,KAAK,UAAU,MAAM,EAAE,MAAM;AAAA,MACjC;AAAA,IACF,OAAO;AACL,UAAI,UAAU,MAAM;AAClB,cAAM,MAAM,GAAG;AAAA,UACb;AAAA,QACF,EAAE,MAAM;AAAA,MACV,OAAO;AACL,cAAM,MAAM,GAAG;AAAA,UACb;AAAA,QACF,EAAE,KAAK,MAAM,EAAE,MAAM;AAAA,MACvB;AAAA,IACF;AAEA,QAAI,CAAC;AAAK,aAAO;AACjB,WAAO,EAAE,cAAc,IAAI,eAAe,YAAY,IAAI,YAAY;AAAA,EACxE;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WAAW,OAAO;AACtB,QAAI;AACF,YAAM,OAAO,MAAM;AAAA,QACjB,iCAAiC,mBAAmB,KAAK;AAAA,QACzD,EAAE,SAAS,EAAE,cAAc,mBAAmB,EAAE;AAAA,MAClD;AACA,YAAMC,QAAO,MAAM,KAAK,KAAK;AAE7B,UAAI,CAACA,MAAK,iBAAiBA,MAAK,cAAc,WAAW,GAAG;AAC1D,eAAO;AAAA,MACT;AAEA,aAAOA,MAAK,cACT,MAAM,GAAG,CAAC,EACV,IAAI,CAAC,GAAG,MAAM,GAAG,IAAI,MAAM,EAAE,QAAQ,IAAI,EACzC,KAAK,IAAI;AAAA,IACd,QAAE;AACA,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAoB,SAAS;AAC3B,QAAI,CAAC,WAAW,QAAQ,SAAS,GAAG;AAClC,aAAO,EAAE,QAAQ,4BAAQ,MAAM,mDAAW;AAAA,IAC5C;AAEA,UAAM,OAAO,QAAQ,IAAI,OAAK,EAAE,GAAG;AACnC,UAAM,UAAU,KAAK,KAAK,SAAS,CAAC;AACpC,UAAM,MAAM,KAAK,IAAI,GAAG,IAAI;AAC5B,UAAM,MAAM,KAAK,IAAI,GAAG,IAAI;AAC5B,UAAM,MAAM,KAAK,OAAO,CAAC,GAAG,MAAM,IAAI,GAAG,CAAC,IAAI,KAAK;AAEnD,UAAM,WAAW,MAAM,OAAO,UAAU,QAAQ,MAAM,OAAO;AAE7D,QAAI,SAAS;AACb,QAAI,WAAW;AAAK,eAAS;AAAA,aACpB,WAAW;AAAK,eAAS;AAAA,aACzB,UAAU,MAAM;AAAM,eAAS;AAAA,aAC/B,UAAU,MAAM;AAAM,eAAS;AAExC,UAAM,WAAW,WAAW,MAAM,iBAAO,WAAW,MAAM,iBAAO;AACjE,WAAO;AAAA,MACL;AAAA,MACA,MAAM,6BAAS,IAAI,QAAQ,CAAC,kBAAQ,IAAI,QAAQ,CAAC,8BAAU,yBAAe,KAAK,MAAM,WAAW,GAAG;AAAA,IACrG;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAY,IAAI,KAAK,UAAU,WAAW,MAAM,SAAS,MAAM;AACnE,UAAMD,YAAW,MAAM,KAAK,cAAc,IAAI,KAAK,MAAM;AAEzD,QAAI,CAACA,UAAS,QAAQ;AACpB,aAAO;AAAA,QACL,UAAU;AAAA,QACV,YAAY,EAAE,QAAQ,gBAAM,MAAM,2BAAO;AAAA,QACzC,YAAW,oBAAI,KAAK,GAAE,aAAa,EAAE,MAAM,GAAG,CAAC;AAAA,MACjD;AAAA,IACF;AAEA,UAAM,SAAS,SAAS;AACxB,UAAM,WAAW,SAAS,QAAQ;AAGlC,UAAM,aAAa,MAAM,gBAAgB,IAAI,MAAM;AACnD,UAAM,WAAW,WAAW,YAAY,aAAa,CAAC;AAEtD,UAAM,UAAU,MAAM,eAAe,IAAI,QAAQ,GAAG;AACpD,UAAM,aAAa,KAAK;AAAA,MACtB,QAAQ,UAAU,KAAK,QAAQ,MAAM,GAAG,EAAE,IAAI;AAAA,IAChD;AAEA,QAAI,iBAAiB;AACrB,QAAI,QAAQ,SAAS,GAAG;AACtB,YAAM,SAAS,QAAQ,MAAM,GAAG,EAAE;AAClC,uBAAiB,2CAAa,OAAO,CAAC,EAAE,sBAAY,OAAO,OAAO,SAAS,CAAC,EAAE,QAAQ,WAAW;AAAA,IACnG;AAEA,QAAI,cAAc;AAClB,QAAI,WAAW,YAAY,WAAW,SAAS,SAAS,GAAG;AACzD,oBAAc,WAAW,SACtB,MAAM,GAAG,EAAE,EACX,IAAI,OAAK,KAAK,EAAE,SAAS,EAAE,2BAAiB,EAAE,UAAU,IAAI,MAAM,KAAK,EAAE,OAAO,QAAQ,CAAC,KAAK,EAC9F,KAAK,IAAI;AAAA,IACd;AAGA,UAAM,YAAY;AAAA,MAChB,WAAW;AAAA,MACX,WAAW;AAAA,MACX,WAAW,WAAW,QAAQ;AAAA,MAC9B,SAAS,WAAW,WAAW;AAAA,MAC/B,KAAK,WAAW,OAAO;AAAA,MACvB,UAAU,WAAW,YAAY;AAAA,MACjC,UAAU,GAAG,WAAW,WAAW;AAAA,MACnC,eAAe,WAAW,YAAY,iBAAiB;AAAA,MACvD,UAAU,eAAe;AAAA,MACzB,QAAQ,SAAS,UAAU;AAAA,MAC3B,YAAY,SAAS,cAAc;AAAA,MACnC,cAAc,SAAS,gBAAgB;AAAA,MACvC,eAAe,SAAS,iBAAiB;AAAA,MACzC,iBAAiB;AAAA,IACnB;AAGA,UAAM,eAAe,MAAM,KAAK,kBAAkB,IAAI,UAAU,MAAM;AAEtE,QAAI;AACJ,QAAI,gBAAgB,aAAa,gBAAgB,aAAa,YAAY;AACxE,iBAAW;AAAA,QACT,EAAE,MAAM,UAAU,SAAS,KAAK,iBAAiB,aAAa,cAAc,SAAS,EAAE;AAAA,QACvF,EAAE,MAAM,QAAQ,SAAS,KAAK,iBAAiB,aAAa,YAAY,SAAS,EAAE;AAAA,MACrF;AAAA,IACF,OAAO;AAEL,iBAAW,gCAAgC,SAAS;AAAA,IACtD;AAGA,QAAI;AACF,YAAM,SAAS,GAAGA,UAAS,QAAQ,QAAQ,OAAO,EAAE;AACpD,YAAM,OAAO,MAAM,MAAM,QAAQ;AAAA,QAC/B,QAAQ;AAAA,QACR,SAAS;AAAA,UACP,gBAAgB;AAAA,UAChB,iBAAiB,UAAUA,UAAS;AAAA,QACtC;AAAA,QACA,MAAM,KAAK,UAAU;AAAA,UACnB,OAAOA,UAAS;AAAA,UAChB;AAAA,UACA,aAAa;AAAA,UACb,YAAY;AAAA,QACd,CAAC;AAAA,MACH,CAAC;AAED,UAAI,CAAC,KAAK,IAAI;AACZ,cAAM,UAAU,MAAM,KAAK,KAAK;AAChC,cAAM,IAAI,MAAM,gBAAgB,KAAK,WAAW,SAAS;AAAA,MAC3D;AAEA,YAAM,SAAS,MAAM,KAAK,KAAK;AAC/B,UAAI,WAAW,OAAO,UAAU,CAAC,GAAG,SAAS,WAAW;AAGxD,iBAAW,SAAS,KAAK;AACzB,UAAI,SAAS,SAAS,aAAa,GAAG;AACpC,mBAAW,SAAS,MAAM,aAAa,EAAE,CAAC,EAAE,MAAM,KAAK,EAAE,CAAC,EAAE,KAAK;AAAA,MACnE,WAAW,SAAS,WAAW,KAAK,KAAK,SAAS,SAAS,KAAK,GAAG;AACjE,mBAAW,SAAS,MAAM,GAAG,EAAE,EAAE,KAAK;AAAA,MACxC;AAGA,YAAM,KAAK,oBAAoB,IAAI;AAAA,QACjC;AAAA,QACA,WAAW,SAAS,cAAc;AAAA,QAClC,UAAU;AAAA,QACV;AAAA,QACA;AAAA,QACA,YAAY,MAAM,KAAK,cAAc,IAAI,UAAU,MAAM;AAAA,QACzD;AAAA,QACA,gBAAgB,KAAK,UAAU,UAAU;AAAA,QACzC,QAAQ;AAAA,MACV,CAAC;AAED,aAAO;AAAA,QACL;AAAA,QACA;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,aAAa,EAAE,MAAM,GAAG,CAAC;AAAA,MACjD;AAAA,IACF,SAAS,GAAP;AACA,cAAQ,MAAM,sBAAsB,EAAE,SAAS;AAC/C,YAAM,gBAAgB;AAAA;AAAA,gCAAwB,EAAE;AAAA;AAAA;AAEhD,YAAM,KAAK,oBAAoB,IAAI;AAAA,QACjC;AAAA,QACA,WAAW,SAAS,cAAc;AAAA,QAClC,UAAU;AAAA,QACV;AAAA,QACA;AAAA,QACA,YAAY,MAAM,KAAK,cAAc,IAAI,UAAU,MAAM;AAAA,QACzD,UAAU;AAAA,QACV,gBAAgB,KAAK,UAAU,UAAU;AAAA,QACzC,QAAQ;AAAA,QACR,cAAc,EAAE;AAAA,MAClB,CAAC;AAED,aAAO;AAAA,QACL,UAAU;AAAA,QACV;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,aAAa,EAAE,MAAM,GAAG,CAAC;AAAA,MACjD;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAiB,UAAU,WAAW;AACpC,WAAO,SAAS,QAAQ,cAAc,CAACE,QAAO,QAAQ;AACpD,aAAO,UAAU,GAAG,MAAM,SAAY,OAAO,UAAU,GAAG,CAAC,IAAIA;AAAA,IACjE,CAAC;AAAA,EACH;AAAA,EAEA,MAAM,cAAc,IAAI,UAAU,QAAQ;AACxC,QAAI,CAAC;AAAU,aAAO;AACtB,QAAI;AACJ,QAAI,UAAU,MAAM;AAClB,YAAM,MAAM,GAAG,QAAQ,8DAA8D,EAAE,KAAK,QAAQ,EAAE,MAAM;AAAA,IAC9G,OAAO;AACL,YAAM,MAAM,GAAG,QAAQ,0DAA0D,EAAE,KAAK,UAAU,MAAM,EAAE,MAAM;AAAA,IAClH;AACA,WAAO,KAAK,QAAQ,WAAW;AAAA,EACjC;AAAA,EAEA,MAAM,oBAAoB,IAAI,EAAE,QAAQ,WAAW,UAAU,UAAU,UAAU,YAAY,UAAU,gBAAgB,QAAQ,eAAe,KAAK,GAAG;AACpJ,QAAI;AACF,YAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA,OAIhB,EAAE,KAAK,QAAQ,WAAW,UAAU,UAAU,UAAU,YAAY,UAAU,gBAAgB,QAAQ,YAAY,EAAE,IAAI;AAGzH,YAAM,KAAK,kBAAkB,IAAI,QAAQ,WAAW,QAAQ;AAAA,IAC9D,SAAS,GAAP;AACA,cAAQ,MAAM,oCAAoC,EAAE,SAAS;AAAA,IAC/D;AAAA,EACF;AAAA,EAEA,MAAM,kBAAkB,IAAI,QAAQ,WAAW,UAAU;AACvD,QAAI;AACF,UAAI;AACJ,UAAI,UAAU,MAAM;AAClB,mBAAW,MAAM,GAAG;AAAA,UAClB;AAAA,QACF,EAAE,KAAK,WAAW,QAAQ,EAAE,MAAM;AAAA,MACpC,OAAO;AACL,mBAAW,MAAM,GAAG;AAAA,UAClB;AAAA,QACF,EAAE,KAAK,QAAQ,WAAW,QAAQ,EAAE,MAAM;AAAA,MAC5C;AAEA,UAAI,SAAS,MAAM,IAAI;AACrB,cAAM,WAAW,SAAS,MAAM;AAChC,YAAI,UAAU,MAAM;AAClB,gBAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAMhB,EAAE,KAAK,WAAW,UAAU,QAAQ,EAAE,IAAI;AAAA,QAC7C,OAAO;AACL,gBAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAMhB,EAAE,KAAK,QAAQ,WAAW,UAAU,QAAQ,EAAE,IAAI;AAAA,QACrD;AAAA,MACF;AAAA,IACF,SAAS,GAAP;AACA,cAAQ,MAAM,8BAA8B,EAAE,SAAS;AAAA,IACzD;AAAA,EACF;AACF;AApWa;AAsWN,IAAM,YAAY,IAAI,UAAU;;;ACxWvC,IAAM,KAAK,IAAIC,MAAK;AAEpB,GAAG,KAAK,SAAS,OAAO,MAAM;AAC5B,QAAM,gBAAgB,MAAM,aAAa,EAAE,IAAI,EAAE;AACjD,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,iBAAiB,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAEhE,QAAM,OAAO,MAAM,EAAE,IAAI,KAAK;AAC9B,QAAM,EAAE,UAAU,QAAQ,aAAa,YAAY,MAAM,IAAI,QAAQ,CAAC;AACtE,MAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,GAAG;AACrD,WAAO,EAAE,KAAK,EAAE,QAAQ,oCAAgB,GAAG,GAAG;AAAA,EAChD;AAEA,MAAIC,YAAW,EAAE,SAAS,IAAI,QAAQ,IAAI,OAAO,GAAG;AACpD,MAAI;AACF,IAAAA,YAAW,MAAM,UAAU,cAAc,EAAE,IAAI,IAAI,EAAE,KAAK,MAAM,MAAM,IAAI;AAAA,EAC5E,QAAE;AACA,IAAAA,YAAW,EAAE,SAAS,IAAI,QAAQ,IAAI,OAAO,GAAG;AAAA,EAClD;AAEA,QAAM,WAAW,EAAE,IAAI,mBAAmBA,UAAS,WAAW,uCAAuC,QAAQ,OAAO,EAAE;AACtH,QAAM,SAAS,EAAE,IAAI,kBAAkBA,UAAS;AAChD,QAAM,QAAQ,EAAE,IAAI,gBAAgBA,UAAS,SAAS;AAEtD,MAAI,CAAC,QAAQ;AACX,WAAO,EAAE,KAAK,EAAE,QAAQ,qNAA8E,GAAG,GAAG;AAAA,EAC9G;AAEA,QAAM,OAAO,MAAM,MAAM,GAAG,4BAA4B;AAAA,IACtD,QAAQ;AAAA,IACR,SAAS;AAAA,MACP,gBAAgB;AAAA,MAChB,iBAAiB,UAAU;AAAA,IAC7B;AAAA,IACA,MAAM,KAAK,UAAU;AAAA,MACnB;AAAA,MACA;AAAA,MACA,QAAQ,CAAC,CAAC;AAAA,MACV,aAAa,OAAO,gBAAgB,WAAW,cAAc;AAAA,MAC7D,OAAO,OAAO,UAAU,WAAW,QAAQ;AAAA,MAC3C,YAAY,OAAO,eAAe,WAAW,aAAa;AAAA,IAC5D,CAAC;AAAA,EACH,CAAC;AAED,MAAI,CAAC,KAAK,IAAI;AACZ,UAAM,UAAU,MAAM,KAAK,KAAK;AAChC,WAAO,EAAE,KAAK,EAAE,QAAQ,WAAW,4BAAQ,KAAK,SAAS,GAAG,GAAG;AAAA,EACjE;AAEA,MAAI,QAAQ;AACV,WAAO,IAAI,SAAS,KAAK,MAAM;AAAA,MAC7B,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,iBAAiB;AAAA,MACnB;AAAA,IACF,CAAC;AAAA,EACH;AAEA,QAAMC,QAAO,MAAM,KAAK,KAAK;AAC7B,SAAO,EAAE,KAAKA,KAAI;AACpB,CAAC;AAGD,GAAG,KAAK,YAAY,OAAO,MAAM;AAC/B,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,OAAO,MAAM,EAAE,IAAI,KAAK;AAC9B,QAAM,EAAE,SAAS,WAAW,WAAW,WAAW,IAAI;AAEtD,MAAI,CAAC;AAAS,WAAO,EAAE,KAAK,EAAE,QAAQ,mDAAW,GAAG,GAAG;AAEvD,MAAI;AACF,UAAM,SAAS,MAAM,UAAU,YAAY,EAAE,IAAI,IAAI,EAAE,KAAK;AAAA,MAC1D,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,YAAY,cAAc;AAAA,IAC5B,GAAG,WAAW,KAAK,EAAE;AAErB,WAAO,EAAE,KAAK,MAAM;AAAA,EACtB,SAAS,GAAP;AACA,YAAQ,MAAM,sBAAsB,EAAE,SAAS;AAC/C,WAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,GAAG,GAAG;AAAA,EAC1C;AACF,CAAC;AAGD,GAAG,IAAI,YAAY,OAAO,MAAM;AAC9B,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,KAAK,EAAE,IAAI;AACjB,QAAM,YAAY,EAAE,IAAI,MAAM,YAAY;AAC1C,QAAM,WAAW,EAAE,IAAI,MAAM,WAAW;AACxC,QAAM,QAAQ,SAAS,EAAE,IAAI,MAAM,OAAO,KAAK,IAAI;AAEnD,MAAI,QAAQ;AACZ,QAAM,SAAS,CAAC,KAAK,EAAE;AAEvB,MAAI,WAAW;AACb,aAAS;AACT,WAAO,KAAK,SAAS,SAAS,CAAC;AAAA,EACjC;AAEA,MAAI,UAAU;AACZ,aAAS;AACT,WAAO,KAAK,QAAQ;AAAA,EACtB;AAEA,WAAS;AACT,SAAO,KAAK,KAAK;AAEjB,QAAM,SAAS,MAAM,GAAG,QAAQ,KAAK,EAAE,KAAK,GAAG,MAAM,EAAE,IAAI;AAC3D,SAAO,EAAE,KAAK,OAAO,OAAO;AAC9B,CAAC;AAGD,GAAG,OAAO,gBAAgB,OAAO,MAAM;AACrC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,YAAY,SAAS,EAAE,IAAI,MAAM,IAAI,CAAC;AAC5C,QAAM,EAAE,IAAI,GAAG;AAAA,IACb;AAAA,EACF,EAAE,KAAK,WAAW,KAAK,EAAE,EAAE,IAAI;AAE/B,SAAO,EAAE,KAAK,EAAE,SAAS,qBAAM,CAAC;AAClC,CAAC;AAOD,GAAG,IAAI,YAAY,OAAO,MAAM;AAC9B,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,SAAS,MAAM,EAAE,IAAI,GAAG;AAAA,IAC5B;AAAA,EACF,EAAE,KAAK,KAAK,EAAE,EAAE,IAAI;AAEpB,SAAO,EAAE,KAAK,OAAO,OAAO;AAC9B,CAAC;AAGD,GAAG,KAAK,YAAY,OAAO,MAAM;AAC/B,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,EAAE,MAAM,eAAe,aAAa,WAAW,IAAI,MAAM,EAAE,IAAI,KAAK;AAC1E,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,yDAAY,GAAG,GAAG;AAErD,QAAM,KAAK,EAAE,IAAI;AAGjB,MAAI,YAAY;AACd,UAAM,GAAG;AAAA,MACP;AAAA,IACF,EAAE,KAAK,KAAK,EAAE,EAAE,IAAI;AAAA,EACtB;AAEA,QAAM,SAAS,MAAM,GAAG;AAAA,IACtB;AAAA,EACF,EAAE,KAAK,MAAM,IAAI,iBAAiB,IAAI,eAAe,IAAI,aAAa,IAAI,GAAG,KAAK,EAAE,EAAE,IAAI;AAE1F,SAAO,EAAE,KAAK,EAAE,IAAI,OAAO,KAAK,aAAa,SAAS,uCAAS,CAAC;AAClE,CAAC;AAGD,GAAG,IAAI,gBAAgB,OAAO,MAAM;AAClC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,WAAW,SAAS,EAAE,IAAI,MAAM,IAAI,CAAC;AAC3C,QAAM,EAAE,MAAM,eAAe,aAAa,WAAW,IAAI,MAAM,EAAE,IAAI,KAAK;AAE1E,QAAM,KAAK,EAAE,IAAI;AAEjB,MAAI,YAAY;AACd,UAAM,GAAG;AAAA,MACP;AAAA,IACF,EAAE,KAAK,KAAK,EAAE,EAAE,IAAI;AAAA,EACtB;AAEA,QAAM,GAAG;AAAA,IACP;AAAA,EACF,EAAE,KAAK,MAAM,iBAAiB,IAAI,eAAe,IAAI,aAAa,IAAI,GAAG,UAAU,KAAK,EAAE,EAAE,IAAI;AAEhG,SAAO,EAAE,KAAK,EAAE,SAAS,uCAAS,CAAC;AACrC,CAAC;AAGD,GAAG,OAAO,gBAAgB,OAAO,MAAM;AACrC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,WAAW,SAAS,EAAE,IAAI,MAAM,IAAI,CAAC;AAC3C,QAAM,EAAE,IAAI,GAAG;AAAA,IACb;AAAA,EACF,EAAE,KAAK,UAAU,KAAK,EAAE,EAAE,IAAI;AAE9B,SAAO,EAAE,KAAK,EAAE,SAAS,uCAAS,CAAC;AACrC,CAAC;AAED,IAAO,aAAQ;;;AChNf;AAEA,IAAM,WAAW,IAAIC,MAAK;AAE1B,IAAM,mBAAmB,oBAAI,IAAI,CAAC,kBAAkB,eAAe,CAAC;AAEpE,SAAS,cAAc,OAAO;AAC5B,SAAO,mDAAmD,KAAK,KAAK;AACtE;AAFS;AAIT,SAAS,YAAY,KAAK;AACxB,SAAO,mBAAmB,KAAK,GAAG;AACpC;AAFS;AAIT,SAAS,aAAa,MAAM;AAC1B,QAAM,IAAI,SAAS,IAAI;AACvB,SAAO,CAAC,MAAM,CAAC,KAAK,KAAK,KAAK,KAAK;AACrC;AAHS;AAMT,SAAS,IAAI,aAAa,OAAO,MAAM;AACrC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,KAAK,EAAE,IAAI;AACjB,QAAM,SAAS,MAAM,GAAG;AAAA,IACtB;AAAA,EACF,EAAE,KAAK,KAAK,EAAE,EAAE,IAAI;AAEpB,QAAM,cAAc,CAAC;AACrB,aAAW,OAAO,OAAO,SAAS;AAChC,QAAI,IAAI,aAAa,IAAI,OAAO;AAC9B,kBAAY,IAAI,GAAG,IAAI;AAAA,IACzB,OAAO;AACL,kBAAY,IAAI,GAAG,IAAI,IAAI;AAAA,IAC7B;AAAA,EACF;AAGA,MAAI,OAAO,KAAK,WAAW,EAAE,WAAW,GAAG;AACzC,WAAO,EAAE,KAAK;AAAA,MACZ,UAAU;AAAA,QACR,gBAAgB;AAAA,QAChB,iBAAiB;AAAA,QACjB,eAAe;AAAA,QACf,WAAW;AAAA,QACX,WAAW;AAAA,QACX,WAAW;AAAA,QACX,eAAe;AAAA,QACf,YAAY;AAAA,MACd;AAAA,IACF,CAAC;AAAA,EACH;AAEA,SAAO,EAAE,KAAK,EAAE,UAAU,YAAY,CAAC;AACzC,CAAC;AAGD,SAAS,KAAK,aAAa,OAAO,MAAM;AACtC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,OAAO,MAAM,EAAE,IAAI,KAAK;AAC9B,QAAM,eAAe,KAAK,YAAY,CAAC;AACvC,QAAM,SAAS,CAAC;AAGhB,MAAI,eAAe,gBAAgB,aAAa,WAAW;AACzD,QAAI,CAAC,aAAa,aAAa,SAAS,GAAG;AACzC,aAAO,YAAY;AAAA,IACrB;AAAA,EACF;AACA,MAAI,eAAe,gBAAgB,aAAa,WAAW;AACzD,QAAI,CAAC,cAAc,aAAa,SAAS,GAAG;AAC1C,aAAO,YAAY;AAAA,IACrB;AAAA,EACF;AACA,MAAI,gBAAgB,gBAAgB,aAAa,YAAY;AAC3D,QAAI,CAAC,cAAc,aAAa,UAAU,GAAG;AAC3C,aAAO,aAAa;AAAA,IACtB;AAAA,EACF;AACA,MAAI,qBAAqB,gBAAgB,aAAa,iBAAiB;AACrE,QAAI,CAAC,YAAY,aAAa,eAAe,GAAG;AAC9C,aAAO,kBAAkB;AAAA,IAC3B;AAAA,EACF;AAEA,MAAI,OAAO,KAAK,MAAM,EAAE,SAAS,GAAG;AAClC,WAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAE,GAAG,GAAG;AAAA,EAC3C;AAEA,QAAM,KAAK,EAAE,IAAI;AACjB,aAAW,CAAC,KAAK,KAAK,KAAK,OAAO,QAAQ,YAAY,GAAG;AACvD,QAAI,UAAU;AAAO;AAErB,UAAM,YAAY,iBAAiB,IAAI,GAAG,IAAI,IAAI;AAClD,QAAI,cAAc;AAClB,QAAI,aAAa,OAAO;AACtB,oBAAc,MAAM,aAAa,OAAO,EAAE,GAAG;AAAA,IAC/C;AAEA,UAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAOhB,EAAE,KAAK,KAAK,aAAa,WAAW,KAAK,EAAE,EAAE,IAAI;AAAA,EACpD;AAEA,SAAO,EAAE,KAAK,EAAE,SAAS,iCAAQ,CAAC;AACpC,CAAC;AAGD,SAAS,IAAI,gBAAgB,OAAO,MAAM;AACxC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,KAAK,EAAE,IAAI;AAEjB,QAAM,eAAe,MAAM,GAAG;AAAA,IAC5B;AAAA,EACF,EAAE,KAAK,KAAK,EAAE,EAAE,MAAM;AAEtB,QAAM,aAAa,MAAM,GAAG;AAAA,IAC1B;AAAA,EACF,EAAE,KAAK,KAAK,EAAE,EAAE,MAAM;AAEtB,QAAM,UAAU,MAAM,GAAG;AAAA,IACvB;AAAA,EACF,EAAE,KAAK,KAAK,EAAE,EAAE,MAAM;AAEtB,SAAO,EAAE,KAAK;AAAA,IACZ,WAAW,cAAc,SAAS;AAAA,IAClC,gBAAgB,aAAa,SAAS,WAAW,KAAK,IAAI;AAAA,IAC1D,YAAY,SAAS,SAAS;AAAA,EAChC,CAAC;AACH,CAAC;AAGD,SAAS,KAAK,gBAAgB,OAAO,MAAM;AACzC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,KAAK,EAAE,IAAI;AACjB,QAAMC,QAAO,MAAM,EAAE,IAAI,KAAK;AAE9B,QAAM,aAAa,8BAAO,KAAK,UAAU;AACvC,UAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,KAKhB,EAAE,KAAK,KAAK,OAAO,KAAK,GAAG,KAAK,EAAE,EAAE,IAAI;AAAA,EAC3C,GAPmB;AASnB,MAAI,eAAeA;AAAM,UAAM,WAAW,kBAAkBA,MAAK,SAAS;AAC1E,MAAI,oBAAoBA;AAAM,UAAM,WAAW,wBAAwBA,MAAK,cAAc;AAC1F,MAAI,gBAAgBA;AAAM,UAAM,WAAW,oBAAoBA,MAAK,UAAU;AAE9E,SAAO,EAAE,KAAK,EAAE,SAAS,iCAAQ,CAAC;AACpC,CAAC;AAED,IAAO,mBAAQ;;;ACrKf,eAAsB,WAAW,IAAI,SAAS,MAAM;AAClD,QAAMC,QAAO,EAAE,SAAS,GAAG,cAAa,oBAAI,KAAK,GAAE,YAAY,GAAG,SAAS,CAAC,EAAE;AAE9E,aAAW,OAAO,SAAS;AACzB,YAAQ,KAAK;AAAA,MACX,KAAK,YAAY;AACf,cAAM,SAAS,MAAM,GAAG;AAAA,UACtB;AAAA,QACF,EAAE,KAAK,KAAK,EAAE,EAAE,IAAI;AACpB,QAAAA,MAAK,QAAQ,WAAW,OAAO;AAC/B;AAAA,MACF;AAAA,MACA,KAAK,aAAa;AAChB,cAAM,SAAS,MAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,SAK/B,EAAE,KAAK,KAAK,EAAE,EAAE,IAAI;AACrB,QAAAA,MAAK,QAAQ,YAAY,OAAO;AAChC;AAAA,MACF;AAAA,MACA,KAAK,gBAAgB;AACnB,cAAM,SAAS,MAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAM/B,EAAE,KAAK,KAAK,EAAE,EAAE,IAAI;AACrB,QAAAA,MAAK,QAAQ,eAAe,OAAO;AACnC;AAAA,MACF;AAAA,MACA,KAAK,cAAc;AACjB,cAAM,SAAS,MAAM,GAAG;AAAA,UACtB;AAAA,QACF,EAAE,KAAK,KAAK,EAAE,EAAE,IAAI;AACpB,QAAAA,MAAK,QAAQ,aAAa,OAAO;AACjC;AAAA,MACF;AAAA,MACA,KAAK,iBAAiB;AACpB,cAAM,SAAS,MAAM,GAAG;AAAA,UACtB;AAAA,QACF,EAAE,KAAK,KAAK,EAAE,EAAE,IAAI;AACpB,QAAAA,MAAK,QAAQ,gBAAgB,OAAO;AACpC;AAAA,MACF;AAAA,MACA,KAAK,YAAY;AACf,cAAM,SAAS,MAAM,GAAG;AAAA,UACtB;AAAA,QACF,EAAE,KAAK,KAAK,IAAI,kBAAkB,eAAe,EAAE,IAAI;AACvD,QAAAA,MAAK,QAAQ,WAAW,OAAO;AAC/B;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAEA,SAAOA;AACT;AA1DsB;AA+DtB,eAAsB,WAAW,IAAIA,OAAM,SAAS,MAAM,MAAM;AAC9D,QAAM,UAAU,CAAC;AAEjB,aAAW,OAAO,SAAS;AACzB,UAAM,UAAUA,MAAK,GAAG,KAAKA,OAAM,UAAU,GAAG;AAChD,QAAI,CAAC,WAAW,CAAC,MAAM,QAAQ,OAAO,GAAG;AACvC,cAAQ,GAAG,IAAI,EAAE,QAAQ,WAAW,QAAQ,qBAAM;AAClD;AAAA,IACF;AAEA,QAAI;AACF,UAAI,SAAS,WAAW;AACtB,cAAM,gBAAgB,IAAI,KAAK,KAAK,EAAE;AAAA,MACxC;AAEA,UAAI,WAAW;AACf,cAAQ,KAAK;AAAA,QACX,KAAK;AACH,qBAAW,QAAQ,SAAS;AAC1B,kBAAM,GAAG;AAAA,cACP;AAAA,YACF,EAAE,KAAK,KAAK,MAAM,KAAK,eAAe,IAAI,KAAK,EAAE,EAAE,IAAI;AACvD;AAAA,UACF;AACA;AAAA,QAEF,KAAK;AACH,qBAAW,QAAQ,SAAS;AAC1B,gBAAI,YAAY,KAAK;AACrB,gBAAI,KAAK,cAAc;AACrB,oBAAM,MAAM,MAAM,GAAG;AAAA,gBACnB;AAAA,cACF,EAAE,KAAK,KAAK,cAAc,KAAK,EAAE,EAAE,MAAM;AACzC,kBAAI;AAAK,4BAAY,IAAI;AAAA,YAC3B;AACA,gBAAI,CAAC;AAAW;AAChB,kBAAM,GAAG,QAAQ;AAAA;AAAA;AAAA,aAGhB,EAAE,KAAK,WAAW,KAAK,MAAM,KAAK,MAAM,KAAK,MAAM,EAAE,IAAI;AAC1D;AAAA,UACF;AACA;AAAA,QAEF,KAAK;AACH,qBAAW,QAAQ,SAAS;AAC1B,kBAAM,GAAG,QAAQ;AAAA;AAAA;AAAA,aAGhB,EAAE;AAAA,cACD,KAAK;AAAA,cAAY,KAAK;AAAA,cAAM,KAAK;AAAA,cAAS,KAAK;AAAA,cAC/C,KAAK;AAAA,cAAiB,KAAK;AAAA,cAAc,KAAK;AAAA,cAC9C,KAAK;AAAA,cAAc,KAAK;AAAA,YAC1B,EAAE,IAAI;AACN;AAAA,UACF;AACA;AAAA,QAEF,KAAK;AACH,qBAAW,QAAQ,SAAS;AAC1B,kBAAM,GAAG,QAAQ;AAAA;AAAA;AAAA,aAGhB,EAAE,KAAK,KAAK,MAAM,KAAK,UAAU,IAAI,KAAK,iBAAiB,IAAI,KAAK,eAAe,IAAI,KAAK,cAAc,GAAG,KAAK,EAAE,EAAE,IAAI;AAC3H;AAAA,UACF;AACA;AAAA,QAEF,KAAK;AACH,qBAAW,QAAQ,SAAS;AAC1B,kBAAM,GAAG,QAAQ;AAAA;AAAA;AAAA,aAGhB,EAAE,KAAK,KAAK,MAAM,KAAK,OAAO,KAAK,IAAI,KAAK,cAAc,KAAK,gBAAgB,KAAK,iBAAiB,GAAG,KAAK,eAAe,SAAS,KAAK,qBAAqB,CAAC,EAAE,IAAI;AACvK;AAAA,UACF;AACA;AAAA,QAEF,KAAK;AACH,qBAAW,QAAQ,SAAS;AAC1B,gBAAI,KAAK,QAAQ,oBAAoB,KAAK,QAAQ;AAAiB;AACnE,kBAAM,GAAG,QAAQ;AAAA;AAAA;AAAA,aAGhB,EAAE,KAAK,KAAK,KAAK,KAAK,OAAO,KAAK,aAAa,GAAG,KAAK,EAAE,EAAE,IAAI;AAChE;AAAA,UACF;AACA;AAAA,MACJ;AAEA,cAAQ,GAAG,IAAI,EAAE,QAAQ,MAAM,SAAS;AAAA,IAC1C,SAAS,GAAP;AACA,cAAQ,GAAG,IAAI,EAAE,QAAQ,SAAS,OAAO,EAAE,QAAQ;AAAA,IACrD;AAAA,EACF;AAEA,SAAO,EAAE,QAAQ;AACnB;AAjGsB;AAmGtB,eAAe,gBAAgB,IAAI,KAAK,QAAQ;AAC9C,UAAQ,KAAK;AAAA,IACX,KAAK;AACH,YAAM,GAAG,QAAQ,wCAAwC,EAAE,KAAK,MAAM,EAAE,IAAI;AAC5E;AAAA,IACF,KAAK;AACH,YAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA,OAIhB,EAAE,KAAK,MAAM,EAAE,IAAI;AACpB;AAAA,IACF,KAAK;AACH,YAAM,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA,OAIhB,EAAE,KAAK,MAAM,EAAE,IAAI;AACpB;AAAA,IACF,KAAK;AACH,YAAM,GAAG,QAAQ,0CAA0C,EAAE,KAAK,MAAM,EAAE,IAAI;AAC9E;AAAA,IACF,KAAK;AACH,YAAM,GAAG,QAAQ,6CAA6C,EAAE,KAAK,MAAM,EAAE,IAAI;AACjF;AAAA,IACF,KAAK;AACH,YAAM,GAAG;AAAA,QACP;AAAA,MACF,EAAE,KAAK,QAAQ,kBAAkB,eAAe,EAAE,IAAI;AACtD;AAAA,EACJ;AACF;AA/Be;;;AChKf,IAAM,OAAO,IAAIC,MAAK;AAEtB,IAAM,gBAAgB,CAAC,YAAY,aAAa,gBAAgB,cAAc,iBAAiB,UAAU;AAGzG,KAAK,IAAI,gBAAgB,OAAO,MAAM;AACpC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,eAAe,EAAE,IAAI,MAAM,SAAS;AAC1C,MAAI;AAEJ,MAAI,cAAc;AAChB,iBAAa,aAAa,MAAM,GAAG,EAAE,IAAI,OAAK,EAAE,KAAK,CAAC;AACtD,UAAM,UAAU,WAAW,OAAO,OAAK,CAAC,cAAc,SAAS,CAAC,CAAC;AACjE,QAAI,QAAQ,SAAS,GAAG;AACtB,aAAO,EAAE,KAAK,EAAE,QAAQ,oBAAoB,QAAQ,KAAK,IAAI,IAAI,GAAG,GAAG;AAAA,IACzE;AAAA,EACF,OAAO;AACL,iBAAa;AAAA,EACf;AAEA,MAAI;AACF,UAAM,SAAS,MAAM,WAAW,EAAE,IAAI,IAAI,YAAY,IAAI;AAC1D,UAAM,aAAY,oBAAI,KAAK,GAAE,YAAY,EAAE,QAAQ,SAAS,EAAE,EAAE,MAAM,GAAG,EAAE;AAC3E,UAAM,WAAW,kBAAkB;AAEnC,WAAO,IAAI,SAAS,KAAK,UAAU,QAAQ,MAAM,CAAC,GAAG;AAAA,MACnD,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,uBAAuB,wBAAwB;AAAA,MACjD;AAAA,IACF,CAAC;AAAA,EACH,SAAS,GAAP;AACA,WAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,GAAG,GAAG;AAAA,EAC1C;AACF,CAAC;AAGD,KAAK,KAAK,gBAAgB,OAAO,MAAM;AACrC,QAAM,OAAO,MAAM,eAAe,CAAC;AACnC,MAAI,CAAC;AAAM,WAAO,EAAE,KAAK,EAAE,QAAQ,qBAAM,GAAG,GAAG;AAE/C,QAAM,OAAO,MAAM,EAAE,IAAI,KAAK;AAC9B,QAAM,EAAE,MAAM,eAAe,SAAS,OAAO,QAAQ,IAAI;AAEzD,MAAI,CAAC,WAAW,CAAC,MAAM,QAAQ,OAAO,GAAG;AACvC,WAAO,EAAE,KAAK,EAAE,QAAQ,+DAAa,GAAG,GAAG;AAAA,EAC7C;AAEA,MAAI,CAAC,CAAC,SAAS,SAAS,EAAE,SAAS,IAAI,GAAG;AACxC,WAAO,EAAE,KAAK,EAAE,QAAQ,6CAA6C,GAAG,GAAG;AAAA,EAC7E;AAEA,QAAM,UAAU,QAAQ,OAAO,OAAK,CAAC,cAAc,SAAS,CAAC,CAAC;AAC9D,MAAI,QAAQ,SAAS,GAAG;AACtB,WAAO,EAAE,KAAK,EAAE,QAAQ,oBAAoB,QAAQ,KAAK,IAAI,IAAI,GAAG,GAAG;AAAA,EACzE;AAEA,MAAI;AACF,UAAM,SAAS,MAAM,WAAW,EAAE,IAAI,IAAI,eAAe,SAAS,MAAM,IAAI;AAC5E,WAAO,EAAE,KAAK,MAAM;AAAA,EACtB,SAAS,GAAP;AACA,WAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,GAAG,GAAG;AAAA,EAC1C;AACF,CAAC;AAED,IAAO,eAAQ;;;ACtEf;AAEA,IAAM,SAAS,IAAIC,MAAK;AAGxB,OAAO,IAAI,cAAc,OAAO,MAAM;AACpC,QAAM,KAAK,EAAE,IAAI;AAEjB,MAAI;AACF,UAAM,UAAU,MAAM,qBAAqB,EAAE;AAC7C,UAAM,eAAe,UAAU,KAAK,YAAY;AAChD,UAAM,SAAS,MAAM,aAAa,EAAE;AAEpC,WAAO,EAAE,KAAK;AAAA,MACZ;AAAA,MACA,iBAAiB;AAAA,MACjB,eAAe;AAAA,MACf,aAAa,OAAO;AAAA,IACtB,CAAC;AAAA,EACH,SAAS,GAAP;AACA,WAAO,EAAE,KAAK,EAAE,QAAQ,oCAAoC,EAAE,UAAU,GAAG,GAAG;AAAA,EAChF;AACF,CAAC;AAGD,OAAO,KAAK,eAAe,OAAO,MAAM;AACtC,QAAM,KAAK,EAAE,IAAI;AAEjB,MAAI;AACF,UAAM,UAAU,MAAM,qBAAqB,EAAE;AAE7C,QAAI,YAAY,wBAAwB;AACtC,aAAO,EAAE,KAAK,EAAE,QAAQ,4DAA4D,GAAG,GAAG;AAAA,IAC5F;AAEA,YAAQ,KAAK,yCAAyC,oBAAoB,yBAAyB;AAEnG,UAAM,cAAc,EAAE;AACtB,UAAM,OAAO,EAAE;AAEf,UAAM,aAAa,MAAM,qBAAqB,EAAE;AAChD,QAAI,eAAe,wBAAwB;AACzC,YAAM,IAAI,MAAM,8BAA8B,wBAAwB,wBAAwB;AAAA,IAChG;AAEA,WAAO,EAAE,KAAK;AAAA,MACZ,SAAS;AAAA,MACT,SAAS;AAAA,IACX,CAAC;AAAA,EACH,SAAS,GAAP;AACA,QAAI,EAAE,SAAS,SAAS,4BAA4B,GAAG;AACrD,aAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,GAAG,GAAG;AAAA,IAC1C;AACA,WAAO,EAAE,KAAK,EAAE,QAAQ,+BAA+B,EAAE,UAAU,GAAG,GAAG;AAAA,EAC3E;AACF,CAAC;AAED,IAAO,iBAAQ;;;Ab5Cf,IAAM,MAAM,IAAIC,MAAK;AAOrB,IAAI,IAAI,UAAU,KAAK;AAAA,EACrB,QAAQ;AAAA,EACR,cAAc,CAAC,OAAO,QAAQ,OAAO,UAAU,SAAS;AAAA,EACxD,cAAc,CAAC,gBAAgB,eAAe;AAAA,EAC9C,aAAa;AACf,CAAC,CAAC;AAGF,IAAI,gBAAgB;AACpB,IAAI,IAAI,UAAU,OAAO,GAAG,SAAS;AACnC,MAAI,CAAC,eAAe;AAClB,QAAI;AACF,YAAM,OAAO,EAAE,IAAI,EAAE;AACrB,sBAAgB;AAAA,IAClB,SAAS,GAAP;AACA,cAAQ,MAAM,kBAAkB,EAAE,SAAS;AAAA,IAE7C;AAAA,EACF;AACA,SAAO,KAAK;AACd,CAAC;AAOD,IAAI,MAAM,aAAa,YAAU;AAGjC,IAAI,MAAM,QAAQ,aAAU;AAG5B,IAAI,MAAM,QAAQ,eAAa;AAG/B,IAAI,MAAM,WAAW,UAAQ;AAG7B,IAAI,MAAM,QAAQ,gBAAc;AAGhC,IAAI,MAAM,QAAQ,YAAU;AAG5B,IAAI,MAAM,eAAe,cAAY;AAMrC,IAAO,cAAQ;AAAA,EACb,OAAO,IAAI;AAAA;AAAA,EAGX,MAAM,UAAU,OAAO,KAAK,KAAK;AAC/B,QAAI,UAAU,gBAAgB,OAAO,GAAG,CAAC;AAAA,EAC3C;AACF;",
  "names": ["match", "data", "estimateNav", "data", "match", "raw", "data", "data", "app", "Node", "_Node", "Node", "Hono", "getCombinedValuation", "sendNotificationEmail", "data", "c", "Hono", "checkDatabaseVersion", "CURRENT_SCHEMA_VERSION", "LINUS_FINANCIAL_ANALYSIS_PROMPT", "match", "Hono", "data", "Hono", "settings", "data", "match", "Hono", "settings", "data", "Hono", "data", "data", "Hono", "Hono", "Hono"]
}
